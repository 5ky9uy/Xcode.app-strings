EFPropertyKey_contentID
EFPropertyKey_uttype
EFPropertyKey_data
EFPropertyKey_additionalMarkup
-[MSComposeBundlePageController observerProxy]
MSComposeBundlePageController.m
v8@?0
Promise
v24@?0@"NSString"8@"NSString"16
v16@?0@"JSValue"8
insertRichLink
then
makeRichLinkFromSelection
removeRichLinkFromSelection
containsRichLinks
stripCustomBodyIdentifiers
changeQuoteLevel
stack
JavaScript exception: %@:%@:%@: %@
sourceURL
line
column
v24@?0@"JSContext"8@"JSValue"16
addEventListener
unhandledrejection
reason
MailSupport/BodyField.js
MailSupport/BodyInputController.js
MailSupport/Constants.js
MailSupport/DocumentExtras.js
MailSupport/ElementExtras.js
MailSupport/HTMLDocumentExtras.js
MailSupport/HTMLElementExtras.js
MailSupport/NodeExtras.js
MailSupport/RangeExtras.js
NSUTF8StringEncoding
NSURL
B8@?0
Mail
RichLinks
richLinksEnabled
BigEmojis
bigEmojiEnabled
[\n\r\s]+
whitespaceRegex
(\p{Emoji_Presentation}|\p{Extended_Pictographic})
emojiRegex
stringToArrayRegex
Range
prototype
@"NSString"8@?0
text
String
ef_isWebAddress
{_NSRange=QQ}24@?0{_NSRange=QQ}8
ef_rangeOfWebAddressContainingRange
@"JSValue"16@?0@"NSString"8
_createRichLink
com.apple.email
MSPDFAttachmentController.m
Delegate is missing to update attachment
(%{public}@) Attachment is not a PDF
(%{public}@) Data is missing
(%{public}@) Could not create PDF document from data
(%{public}@) Attached PDF has %lu pages, isLocked=%{BOOL}d
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";function getPlainTextURLAtPoint(e,t){let n=document.caretRangeFromPoint(e,t);if(n&&n.startContainer.nodeType===Node.TEXT_NODE){if(n.expand("word"),n.startContainer!=n.endContainer)return null;let e={location:n.startOffset,length:n.endOffset-n.startOffset},t=n.startContainer.textContent.ef_rangeOfWebAddressContainingRange(e);if(t.length>0)return n.setStart(n.startContainer,t.location),n.setEnd(n.startContainer,t.location+t.length),{selectedText:n.toString(),range:n}}return null}function replaceNodes(e,t){if(console.assert(e.length),console.assert(t.length),!e.length&&!t.length)return;const n=e[0],i=n.parentElement;if(console.assert(i),!i)return;for(let t=0;t<e.length;++t){const n=e[t];if(console.assert(n.parentElement==i),n.parentElement!=i)return;if(!t)continue;const o=e[t-1];if(console.assert(o.nextSibling==n),o.nextSibling!=n)return}let o=null;for(let e=0;e<i.childNodes.length;++e)if(i.childNodes[e]===n){o=e;break}for(let n=e.length-1;n>=0;--n){const o=e[n];n?o.remove():i.replaceChild(t[0],o)}for(let e=1;e<t.length;++e)i.insertBefore(t[e],t[e-1].nextSibling)}function getSelectionRange(){let e=window.getSelection();return e.rangeCount?e.getRangeAt(0):null}const _appendTextFromDOMRange=function(e,t,n,i){let o=t.text();if(o){e||(e=[]);let t=o;t=t.replace(/\xa0/g," "),i&&"\n"!==o.charAt(o.length-1)&&(t+="\n"),e.push([t,n])}return e},MFCreatePlainTextRepresentationFromDOMDocument=function(e,t){let n,i=[],o=e.body,r=e.createRange(),l=0;r.setStartBefore(o);let a=o.firstChild;for(;a&&o!==a;){let e,o=a.firstChild,d=a.mf_quoteLevelDelta(),s=t?t(a):undefined;if(a instanceof HTMLAnchorElement&&!a.richLinkContainer()){let t=document.createRange();t.selectNode(a);let n=t.text();n!=a.href&&(e=`${n} <${a.href}>`)}else a instanceof HTMLDivElement&&a.isRichLink()&&(document.createRange().selectNode(a),e=a.getAttribute("data-url"));for((s||e||0!==d)&&(r.setEndBefore(a),n=_appendTextFromDOMRange(n,r,l,0!==d),r.collapse()),e&&(n&&(i.push(n),n=null),i.push([[e,l]]),r.setStartAfter(a)),s&&(n&&(i.push(n),n=null),i.push(s)),l+=d;!o&&a;){let e=a.mf_quoteLevelDelta();0!==e&&(r.setEndAfter(a),n=_appendTextFromDOMRange(n,r,l,!0),r.collapse(),l-=e);let t=a.nextSibling;o=t,a=t=a.parentNode}a=o}return r.setEndAfter(o),(n=_appendTextFromDOMRange(n,r,l,!1))&&i.push(n),i.length||((n=[]).push(["",0]),i=[n]),i},MFFindQuotedAttachmentsFromDOMDocument=function(e,t,n){if(!document||!t||!n)return[];let i=[];for(let o of e.querySelectorAll("attachment, img"))if(o.mf_isQuoteOrWithinQuote()){let e=t(o,n);e&&i.push(e.replace("cid:",""))}return i},_copyHtmlStringFromRange=function(e,t,n,i,o,r,l,a){let d,s,c,f=e.body,m=t.startContainer.mf_commonAncestorWithNode(t.endContainer),u=t.cloneContents();if(i&&!o||u.recursivelyRemoveMailAttributes(!i,o,!1),u){let t,n,o=!0;for(t=m;o&&t;t=t.parentNode)o=f!==t;if(!o)for(t=m;t;t=t.parentNode){let e=t.cloneNode();if(e.appendChild(u),u=e,n=t,t===f){m=t.parentNode;break}}let r=e.head?e.head.cloneNode(!0):e.createElement("head");for(i||(c=r.querySelector("meta[http-equiv=Content-Type]"))||(c=e.createElement("meta"),r.appendChild(c)),u.insertBefore(r,u.firstChild),t=m;t&&e!==t;t=t.parentNode){let e,i=t.cloneNode();if(o&&n)for(e=i.firstChild;e&&n!==e;e=e.nextSibling){let t=e.cloneNode(!0);t&&i.appendChild(t)}if(u&&i.appendChild(u),o&&n)for(e=n.nextSibling;e;e=e.nextSibling){let t=e.cloneNode(!0);t&&i.appendChild(t)}o||(o=f===t),u=i,n=t}}if(u){if(u.normalize(),r){let e;if("html"===u.nodeName.toLowerCase()){let t=u.firstChild;for(;t;){if("body"===t.nodeName.toLowerCase()){e=t;break}t=t.nextSibling}}if(e){e.removeAttribute("id"),e.removeAttribute("contenteditable"),e.removeAttribute("style");let t=e.getElementsByTagName("IMG");for(let e=0;e<t.length;e++){let n,i=t.item(e);try{n=new URL(i.src)}catch(e){}n!==undefined&&"file:"===n.protocol&&i.setAttribute("SRC","cid:"+n.pathname.substring(1))}}}if(a&&u.querySelectorAll("attachment, img").forEach(a),s=charsetForString(u.outerHTML,n),i||(c.httpEquiv="content-type",c.content="text/html; charset="+s.charsetName()),l){let e=u.ownerDocument.createRange();e.selectNodeContents(u),e.linkify()}d=u.outerHTML}return{string:d,charset:s}},_isSelectionPlaceholderNode=function(e){return e instanceof HTMLElement&&(e.id!==MFHtmlIDSelectionStart&&e.id!==MFHtmlIDSelectionEnd)};Object.defineProperty(this,"BodyField",{value:function(){this.bodyInputController=new BodyInputController,addEventListener("beforeinput",e=>{if(document.bigEmojiEnabled&&this.bodyInputController.pickEmojiFontSize(e),"insertParagraph"!==e.inputType||this._insertingNewlineInQuotedContent)return;let t=e.getTargetRanges()[0];t&&t.startContainer.mf_isQuoteOrWithinQuote()&&(e.preventDefault(),this._insertingNewlineInQuotedContent=!0,document.execCommand("InsertNewlineInQuotedContent"),this._insertingNewlineInQuotedContent=!1)}),addEventListener("input",e=>{document.bigEmojiEnabled&&"deleteContentBackward"==e.inputType&&this.bodyInputController.manageDeletedEmojiFontSize(e)}),addEventListener("load",()=>{function e(e){if(e.types.includes("Files"))return null;if(e.types.includes("text/uri-list"))return e.getData("text/uri-list");if(e.types.includes("text/plain")){let t=e.getData("text/plain").trim();if(t.ef_isWebAddress())return t}return null}document.shouldRichifyLinksAutomatically=!0,document.richLinksEnabled=richLinksEnabled(),document.bigEmojiEnabled=bigEmojiEnabled(),document.whitespaceRegex=RegExp(whitespaceRegex),document.emojiRegex=RegExp(emojiRegex,"u"),document.stringToArrayRegex=RegExp(stringToArrayRegex,"gus"),document.addEventListener("drop",t=>{if(!document.richLinksEnabled)return;let n=e(t.dataTransfer);if(!n||!document.shouldRichifyLinksAutomatically)return;let i=document.caretRangeFromPoint(t.clientX,t.clientY);if(0!=i.startOffset||0!=i.endOffset)return;let o=window.getSelection();o.removeAllRanges(),o.addRange(i),this.insertRichLink(n),t.preventDefault()}),document.addEventListener("paste",e=>{if(document.bigEmojiEnabled&&this.bodyInputController.pickEmojiFontSize(e),!document.richLinksEnabled)return;let t=(e.clipboardData||window.clipboardData).getData("text").trim();if(!t.ef_isWebAddress()||!document.shouldRichifyLinksAutomatically)return;let n=getSelectionRange();n&&0==n.startOffset&&0==n.endOffset&&(this.insertRichLink(t),e.preventDefault(),window.webkit.messageHandlers.RichLinkPasted.postMessage(t))}),document.addEventListener("cut",e=>{document.bigEmojiEnabled&&this.bodyInputController.manageDeleting(e.currentTarget.getSelection())}),document.addEventListener("mousemove",function(e){if(!document.richLinksEnabled)return;let t=e.target.richLinkContainer();if(t){this.lastRichLinkElementOrRange=t,this.lastRichLinkCandidateURL=null;let e=t.getBoundingClientRect(),n={x:e.x,y:e.y,width:e.width,height:e.height};window.webkit.messageHandlers.RichLinkHighlighted.postMessage(n)}else{let t,n;if(e.target instanceof HTMLAnchorElement){let i=e.target,o=i.text;["http:","https:"].includes(i.protocol)&&(o.startsWith(i.origin)||o.startsWith(i.hostname))&&(t=i.href,n=i)}else{let i=getPlainTextURLAtPoint(e.x,e.y);i&&(t=i.selectedText,n=i.range)}let i;if(t){let e=n.getBoundingClientRect();i={x:e.x,y:e.y,width:e.width,height:e.height},this.lastRichLinkElementOrRange=n,this.lastRichLinkCandidateURL=t}else i={x:e.x,y:e.y};window.webkit.messageHandlers.PlainTextLinkHighlighted.postMessage(i)}},!1)})}}),BodyField.prototype={constructor:BodyField},BodyField.prototype.insertNodeWithParentAndNextSibling=function(e,t,n){if(t&&e)if(Node.DOCUMENT_FRAGMENT_NODE===e.nodeType){let i;for(;i=e.firstChild;)this.insertNodeWithParentAndNextSibling(i,t,n)}else if(n){if(!t.isSameNode(n.parentNode))return;t.insertBefore(e,n),_isSelectionPlaceholderNode(e)&&(this._dirty=!0)}else t.appendChild(e)},BodyField.prototype.insertNodeWithParentAndOffset=function(e,t,n){let i,o=t.childNodes;if(t&&n<=o.length)if(Node.DOCUMENT_FRAGMENT_NODE===e.nodeType){let i;for(;i=e.firstChild;)this.insertNodeWithParentAndOffset(i,t,n++)}else n===o.length?t.appendChild(e):(i=o.item(n),t.insertBefore(e,i)),_isSelectionPlaceholderNode(e)&&(this._dirty=!0)},BodyField.prototype.deleteNode=function(e){let t=e.parentNode;if(t){e.nextSibling;t.removeChild(e),_isSelectionPlaceholderNode(e)&&(this._dirty=!0)}},BodyField.prototype.insertRichLink=async function(e){let t=null,n=e=>{t=e.target};document.addEventListener("DOMNodeInserted",n),document.execCommand("InsertHTML",!1,'<div style="display: inline-block;"><span style="-webkit-user-select: none;">'+e+"</span></div>"),document.removeEventListener("DOMNodeInserted",n);let i=await this._createRichLink(e),o="",r="";if(i&&i.length>1&&(o=i[0],r=i[1]),!o)return;let l=this.richLinkFromMarkup(o);if(t&&t.firstChild){t.replaceChild(l,t.firstChild);let e=t.nextSibling;if((!e||e.nodeType===Node.TEXT_NODE&&0==e.textContent.length)&&t.parentNode){let e=document.createElement("div");e.innerHTML="<br>",t.parentNode.insertBefore(e,null),e.focus()}if(t.setAttribute("style","display: block;"),r&&r.length>0){let e=this.createRichLinkMetadataContainer(r);t.appendChild(e)}}},BodyField.prototype.richLinkFromMarkup=function(e){let t=document.createElementFromMarkup(e);return t.setAttribute("style","-webkit-user-select: all; -webkit-user-drag: element; display: inline-block;"),t.setAttribute("class",MFRichLinkClass),t.setAttribute("draggable","true"),t.setAttribute("role","link"),t.setAttribute("data-url",t.firstChild.getAttribute("href")),t},BodyField.prototype.createRichLinkMetadataContainer=function(e){let t=document.createElement("div");return t.setAttribute("class",MFRichLinkMetadataClass),t.setAttribute("style","display: none;"),t.setAttribute("data-metadata",e),t},BodyField.prototype.makeRichLinkFromSelection=function(){document.shouldRichifyLinksAutomatically=!0;let e;if(this.selectionIsWebAddress())e=window.getSelection().getRangeAt(0).toString();else if(document.lastRichLinkElementOrRange&&document.lastRichLinkCandidateURL){let t=document.lastRichLinkElementOrRange;if(document.getSelection().removeAllRanges(),t instanceof Range)document.getSelection().addRange(t);else if(t instanceof HTMLElement){let e=new Range;e.selectNode(t),document.getSelection().addRange(e)}e=document.lastRichLinkCandidateURL,document.lastRichLinkCandidateURL=null,document.lastRichLinkElementOrRange=null}e&&this.insertRichLink(e)},BodyField.prototype.removeRichLinkFromSelection=function(){let e=document.lastRichLinkElementOrRange;if(e&&!(e instanceof Range)&&e.parentNode&&e.richLinkContainer()==e){document.shouldRichifyLinksAutomatically=!1;let t=decodeURI(e.getAttribute("data-url")),n=document.createElement("a");n.href=t,n.innerHTML=t;let i=e.parentNode.innerHTML==e.outerHTML?e.parentNode:e;if(replaceNodes([i],[n]),document.lastRichLinkElementOrRange=null,!document.undoManager)return;(()=>{const e=[n],t=[i];document.undoManager.addItem(new UndoItem({label:"",undo:()=>{replaceNodes(e,t)},redo:()=>{replaceNodes(t,e)}}))})()}},BodyField.prototype.containsRichLinks=function(){return document.querySelector(".apple-rich-link")},BodyField.prototype.selectionIsWebAddress=function(){let e=getSelectionRange();return!!e&&e.toString().ef_isWebAddress()},BodyField.prototype._canonicalizeSelection=function(e){let t,n,i,o,r=e.startContainer,l=e.endContainer,a=e.startOffset,d=e.endOffset,s=r===l;if(r instanceof Text)if(t=r.parentNode,a)if(a>=r.length)n=r.nextSibling;else{let e=r.cloneNode(!1),i=e.splitText(a);this.insertNodeWithParentAndNextSibling(e,t,r),this.insertNodeWithParentAndNextSibling(i,t,r),this.deleteNode(r),s&&(d-=Math.min(d,a),l=i),n=i}else n=r;else{for(n=r.firstChild;a--;)n=n.nextSibling;t=r}if(l instanceof Text)if(i=l.parentNode,d)if(d>=l.length)o=l.nextSibling;else{let e=l.cloneNode(!1),t=e.splitText(d);this.insertNodeWithParentAndNextSibling(e,i,l),this.insertNodeWithParentAndNextSibling(t,i,l),s&&l===n&&(n=e),this.deleteNode(l),o=t}else o=l;else{for(o=l.firstChild;d--;)o=o.nextSibling;i=l}return{startParent:t,startNextSibling:n,endParent:i,endNextSibling:o}},BodyField.prototype.deleteRange=function(e){let t=e.commonAncestorContainer,{startParent:n,startNextSibling:i,endParent:o,endNextSibling:r}=this._canonicalizeSelection(e),l=i;for(;l&&(!r||!r.isSameNode(l));)if(r&&r.mf_isDescendantOfNode(l)||!l.isSameNode(o)&&o.mf_isDescendantOfNode(l))l=l.mf_traverseNextNodeStayingWithin(t);else{let e=l.mf_traverseNextSiblingStayingWithin(t);if(this.deleteNode(l),l.isSameNode(o))break;l=e}},BodyField.prototype.splitUpBlockQuotesOverlappingStartOfRange=function(e){let t,n,i,o,r,l,a;for(e.mf_hoistRange(),n=e.mf_firstNode(),i=e.mf_lastNode(),t=(r=n).mf_containingBlockQuote();t;)n.mf_isAtBeginningOfContainerNode(t)?r=r.parentNode:((l=n.ownerDocument.createRange()).setStartBefore(t.firstChild),l.setEndBefore(n),a=l.cloneContents(),(o=n.ownerDocument.mf_createMessageQuoteElement()).appendChild(a),this.deleteRange(l),this.insertNodeWithParentAndNextSibling(o,t.parentNode,t),e.setStartBefore(n),e.setEndAfter(i),r=o.parentNode),t=r.mf_containingBlockQuote()},BodyField.prototype.splitUpBlockQuotesOverlappingEndOfRange=function(e){let t,n,i,o,r,l,a;for(n=e.mf_firstNode(),t=(o=i=e.mf_lastNode()).mf_containingBlockQuote();t;)i.mf_isAtEndOfContainerNode(t)?o=o.parentNode:((l=n.ownerDocument.createRange()).setStartBefore(t.firstChild),l.setEndAfter(e.mf_lastNode()),a=l.cloneContents(),r=n.ownerDocument.mf_createMessageQuoteElement(),n.mf_isDescendantOfNode(t)&&(n=a.firstChild),i=a.lastChild,r.appendChild(a),this.deleteRange(l),this.insertNodeWithParentAndNextSibling(r,t.parentNode,t),e.setStartBefore(n),e.setEndAfter(i),o=r.parentNode),t=o.mf_containingBlockQuote()},BodyField.prototype.replaceNode=function(e,t){e&&t&&(this.insertNodeWithParentAndNextSibling(e,t.parentNode,t),this.deleteNode(t))},BodyField.prototype.removeBlockQuoteFromTree=function(e){let t,n,i=e.parentNode,o=!1,r=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);for(t=r.nextNode();t;t=r.nextNode())if(t!==e&&t.mf_blockNodeAncestor()===e){o=!0;break}for(n=e,o&&(i=e.ownerDocument.createElement("div"),n=null);t=e.firstChild;)this.deleteNode(t),this.insertNodeWithParentAndNextSibling(t,i,n);o?this.replaceNode(i,e):this.deleteNode(e)},BodyField.prototype.temporaryEndingSelectionMarker=function(){let e=[window],t=e.length;for(;t>0;){let n,i=e[0];try{n=i.document}catch(e){}if(e.shift(),t--,n instanceof HTMLDocument){let e=n.mf_findElement("SPAN",MFHtmlTemporaryEditingElement,MFHtmlIDSelectionEnd);if(e)return e}let o=i.frames;o.length&&(t+=o.length,e=e.concat(Array.from(o)))}return undefined},BodyField.prototype.insertTemporarySelectionMarkersForRange=function(e){let t=e;t||(t=getSelectionRange());let n;if(t){let{startParent:e,startNextSibling:i,endParent:o,endNextSibling:r}=this._canonicalizeSelection(t),l=e.ownerDocument;if(l&&l instanceof HTMLDocument){let t=l.createElement("SPAN");t.className=MFHtmlTemporaryEditingElement,t.id=MFHtmlIDSelectionEnd,this.insertNodeWithParentAndNextSibling(t,o,r),(n=l.createElement("SPAN")).className=MFHtmlTemporaryEditingElement,n.id=MFHtmlIDSelectionStart,this.insertNodeWithParentAndNextSibling(n,e,t)}}return n},BodyField.prototype.restoreSelectionFromTemporaryMarkers=function(e){let t=[window],n=t.length;for(;n>0;){let i,o=t[0];try{i=o.document}catch(e){}if(t.shift(),n--,i instanceof HTMLDocument){let t=e?undefined:MFHtmlTemporaryEditingElement,n=i.mf_findElement("SPAN",t,MFHtmlIDSelectionStart),o=i.mf_findElement("SPAN",t,MFHtmlIDSelectionEnd);if(n||o){let e=i.createRange();n&&e.setStartBefore(n),o&&e.setEndBefore(o),n||e.collapse(!1),o||e.collapse(!0),n&&this.deleteNode(n),o&&this.deleteNode(o);let t=window.getSelection();t.empty(),t.addRange(e)}}let r=o.frames;r.length&&(n+=r.length,t=t.concat(Array.from(r)))}},BodyField.prototype.changeQuoteLevel=function(e){let t=getSelectionRange();if(!t)return;let n=!1,i=t.startContainer.ownerDocument;if(t.mf_hoistRange(),!t.collapsed&&e>0){let e=t.endContainer;if(e instanceof Text&&!t.endOffset){let n=e.previousSibling;"blockquote"===n.nodeName.toLowerCase()&&t.setEnd(n,n.childNodes.length)}}this.insertTemporarySelectionMarkersForRange(t);let{parent:o,nextSibling:r}=t.mf_getBlockBoundaryParentAndNextSibling(!0),{parent:l,nextSibling:a}=t.mf_getBlockBoundaryParentAndNextSibling(!1),d=i.createRange();if(r)d.setStartBefore(r);else{let e=o.lastChild;e||(e=o),d.setStartAfter(e)}if(a)d.setEndBefore(a);else{let e=l.lastChild;e||(e=l),d.setEndAfter(e)}let s;if(1===e){let e,t,o,c,f;if(s=i.mf_createMessageQuoteElement(),(f=d.cloneContents())&&s.appendChild(f),s.mf_containsOnlySelectionMarkers()&&s.mf_appendBlockPlaceholder(),n=!0,o=d.startContainer,c=d.endContainer,o===c)this.insertNodeWithParentAndNextSibling(s,o,r),d.setStartAfter(s),a?d.setEndBefore(a):d.setEndAfter(l),this.deleteRange(d);else if((e=d.commonAncestorContainer)===c){for(this.deleteRange(d),t=a;t&&t.parentNode!==e;)t=t.parentNode;this.insertNodeWithParentAndNextSibling(s,e,t)}else if(e===o)this.deleteRange(d),this.insertNodeWithParentAndOffset(s,e,d.startOffset);else{if(this.splitUpBlockQuotesOverlappingStartOfRange(d),this.splitUpBlockQuotesOverlappingEndOfRange(d),s=i.mf_createMessageQuoteElement(),(f=d.cloneContents())&&s.appendChild(f),s.mf_containsOnlySelectionMarkers()&&s.mf_appendBlockPlaceholder(),"blockquote"===(e=d.commonAncestorContainer).nodeName.toLowerCase())d.setStart(e,0),t=undefined,this.deleteRange(d);else{let n=d.endContainer;for(let t=n.parentElement;t!==e;t=t.parentElement)n=t;t=n.nextSibling,this.deleteRange(d),n.parentElement===e&&(t=n)}this.insertNodeWithParentAndNextSibling(s,e,t)}}else if(-1===e){let e,t,i,o,r;for(this.splitUpBlockQuotesOverlappingStartOfRange(d),this.splitUpBlockQuotesOverlappingEndOfRange(d),e=d.mf_lastNode(),i=d.mf_firstNode(),r=!1;!r&&i;)(o=(t=i).mf_highestContainingBlockQuote())||(o=t.mf_firstDescendantBlockQuote()),o?(r=e.mf_isDescendantOfNode(o),i=o.mf_nextSiblingOrAunt(),this.removeBlockQuoteFromTree(o),n=!0):(r=e.mf_isDescendantOfNode(t)||t.mf_isDescendantOfNode(e),i=t.mf_nextSiblingOrAunt())}return s&&s.parentNode&&this.temporaryEndingSelectionMarker()===s.lastChild&&s.parentNode.insertBefore(this.temporaryEndingSelectionMarker(),s.nextSibling),this.restoreSelectionFromTemporaryMarkers(),n},BodyField.prototype.convertInternalImagesToAttachments=function(e,t,n){let i={};for(let e of document.querySelectorAll("img")){let o=e.src;if(!o||!o.startsWith("cid:"))continue;let r=t[o];r&&(e.removeAttribute("src"),i[HTMLAttachmentElement.getAttachmentIdentifier(e)]=new NSURL(o),n&&n(e,r))}return i},BodyField.prototype.replacePlaceholderWithAttachment=function(e,t){let n;if(t.isImage){let t=document.createElement("img");e.replaceWith(t),n=HTMLAttachmentElement.getAttachmentIdentifier(t)}else{let t=document.createElement("attachment");e.replaceWith(t),n=t.uniqueIdentifier}return n},BodyField.prototype.convertObjectElementsToAttachmentElements=function(e,t){let n={};for(let i of e.querySelectorAll("object[type='application/x-apple-msg-attachment']")){let e=i.getAttribute("data"),o=new NSURL(e);if(!o)continue;let r=t[e];r&&(n[this.replacePlaceholderWithAttachment(i,r)]=o)}return n},BodyField.prototype.replaceRangeWithNode=function(e,t){e.deleteContents(),e.insertNode(t)},BodyField.prototype.stripCustomBodyIdentifiers=function(){this.bodyInputController.stripCustomBodyIdentifiers()};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";var emojiFontSize,numberOfEmojis=0,numberOfOtherCharacters=0,hasValidNumOfEmojis=!1,hasOnlyEmojis=!1,newParagraphInserted=!1;Object.defineProperty(this,"BodyInputController",{value:function(){}}),BodyInputController.prototype={constructor:BodyInputController,pickEmojiFontSize:function(e){let t=document.getSelection(),i=t.anchorNode.mf_containingBlockQuote(),n=t.anchorNode.mf_isDescendantOfNode(this._locateSignatureDiv(document)),o="paste"==e.type?e.clipboardData.getData("Text"):e.data,s=document.whitespaceRegex.test(o);i||s||n||("deleteContentBackward"==e.inputType?this._manageDeleting(t):"insertParagraph"==e.inputType?this.newParagraphInserted=!0:(this.shouldShowBigEmoji(o,t),this._manageInputEmojiFontSize(document,e,o)))},shouldShowBigEmoji:function(e,t){numberOfEmojis=0,numberOfOtherCharacters=0;let i=t.anchorNode.wholeText;var n=i?i.match(document.stringToArrayRegex):[];let o=e.match(document.stringToArrayRegex).concat(n);this._updateCounts(o),this.hasValidNumOfEmojis=numberOfEmojis<=maxNumberBigEmoji&&numberOfEmojis>0,this.hasOnlyEmojis=0==numberOfOtherCharacters,emojiFontSize=this.hasValidNumOfEmojis&&this.hasOnlyEmojis?bigEmojiFontSize:defaultEmojiFontSize,this.newParagraphInserted=!i},_manageInputEmojiFontSize:function(e,t,i){let n=e.getSelection(),o=n.anchorNode,s=n.getRangeAt(0);if(this.hasValidNumOfEmojis&&this.hasOnlyEmojis&&this.newParagraphInserted){let o=e.createElement("span");o.className=MFMailBigEmojiAttribute,o.innerHTML+=i,o.setAttribute("style","font-size:"+emojiFontSize),s.insertNode(o),n.setPosition(s.endContainer,s.endOffset),t.preventDefault(),this.newParagraphInserted=!1}else if(!this.hasOnlyEmojis||!this.hasValidNumOfEmojis){let t=o.parentElement;if(t.className==MFMailBigEmojiAttribute){let a=t.parentElement;"FONT"==a.tagName?(a.setAttribute("size",emojiFontSize),a.remove()):(t.setAttribute("style","font-size:"+emojiFontSize),t.remove()),t.setAttribute("style","font-size:"+emojiFontSize);let r=o.textContent+i;s.insertNode(e.createTextNode(r)),n.setPosition(s.endContainer,s.endOffset)}"FONT"==o.tagName&&o.size==largeInheritedFontSize&&o.setAttribute("size",emojiFontSize)}},_manageDeleting:function(e){let t=e.anchorOffset,i=e.focusOffset,n=e.anchorNode;var o,s;numberOfEmojis=0,numberOfOtherCharacters=0,t==i?(n.wholeText?s=n.wholeText.match(document.stringToArrayRegex):n.childNodes&&(s=[],n.querySelectorAll("[class=AppleMailBigEmoji]").forEach(function(e){s.push(e.textContent)})),this._updateCounts(s),o=s.splice(s.length-e.rangeCount,e.rangeCount)):(this._updateCounts(n.wholeText.match(document.stringToArrayRegex)),o=n.wholeText.slice(t,i)),document.emojiRegex.test(o)?0==(numberOfEmojis=numberOfEmojis<0?0:numberOfEmojis-o.length)&&n.parentElement.setAttribute("style","font-size:"+defaultEmojiFontSize):numberOfOtherCharacters=numberOfOtherCharacters<0?0:numberOfOtherCharacters-o.length,this.hasSingleEmoji=1==numberOfEmojis,this.hasValidNumOfEmojis=numberOfEmojis<=maxNumberBigEmoji&&numberOfEmojis>0,this.hasOnlyEmojis=0==numberOfOtherCharacters},manageDeletedEmojiFontSize:function(){let e=document.getSelection(),t=e.anchorNode;if(t){let i=t.parentElement.className;if(this.hasValidNumOfEmojis&&this.hasOnlyEmojis&&i!=MFMailBigEmojiAttribute){let i=e.getRangeAt(0),n=document.createElement("span");n.className=MFMailBigEmojiAttribute,n.setAttribute("style","font-size:"+bigEmojiFontSize),n.appendChild(t),i.insertNode(n),e.setPosition(i.endContainer,i.endOffset)}}},_locateSignatureDiv:function(e){let t=e.body.querySelectorAll(`div[id="${MFHtmlIDSignature}"]`);for(let e=0;e<t.length;++e){let i=t.item(e);if(!i.mf_isQuoteOrWithinQuote())return i}return null},_updateCounts:function(e){e.map(e=>{document.whitespaceRegex.test(e)||(document.emojiRegex.test(e)?numberOfEmojis+=1:numberOfOtherCharacters+=1)})},stripCustomBodyIdentifiers:function(){let e=document.querySelectorAll("[class=AppleMailBigEmoji]");e.length>0&&e.forEach(function(e){e.removeAttribute("class")})}};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";const MFContentIDScheme="cid",MFHtmlIDSelectionEnd="x-apple-selection:end",MFHtmlIDSelectionStart="x-apple-selection:start",MFHtmlTemporaryEditingElement="AppleTemporaryEditingElement",MFHtmlTemporaryPresentationElement="AppleTemporaryPresentationElement",MFMailDropBannerClass="x-apple-maildropbanner",MFMailDropItemClass="x-apple-maildrop",MFHtmlIDSignature="AppleMailSignature",MFRichLinkClass="apple-rich-link",MFRichLinkMetadataClass="apple-rich-link-metadata",MFMailBigEmojiAttribute="AppleMailBigEmoji",bigEmojiFontSize="-webkit-xxx-large",defaultEmojiFontSize="-apple-system-body",maxNumberBigEmoji=3,largeInheritedFontSize=7;
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Document.prototype.createBlockPlaceholder=function(){let e=this.createElement("BR");return e.className="webkit-block-placeholder",e};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Element.prototype.isRichTextElementType=function(){let e=this.nodeName.toUpperCase();return-1!==["B","I","U","H1","H2","H3","H4","H5","H6","A","TABLE","BDO","FONT","CODE","TT","UL","LI","OL","STYLE","STRIKE"].indexOf(e)},Element.prototype.hasMarginsOfZero=function(){let e,t=[CSSPrimitiveValue.CSS_ATTR,CSSPrimitiveValue.CSS_COUNTER,CSSPrimitiveValue.CSS_IDENT,CSSPrimitiveValue.CSS_RECT,CSSPrimitiveValue.CSS_RGBCOLOR,CSSPrimitiveValue.CSS_STRING,CSSPrimitiveValue.CSS_URI,CSSPrimitiveValue.CSS_UNKNOWN];if(!this.hasAttribute("style"))return!1;e=this.style;for(let i of["margin-top","margin-bottom","margin-left","margin-right"]){let S=e.getPropertyCSSValue(i);if(!S)return!1;let l=S.primitiveType;if(!l||t.includes(l)||S.getFloatValue(l))return!1}return!0};const _isZeroColorComponent=function(e){return!e||0===e.getFloatValue(CSSPrimitiveValue.CSS_NUMBER)},_isBlackCSSColorValue=function(e){if(!e)return!0;let t=!1;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let i=e;i.length>0&&(t=_isBlackCSSColorValue(i.item(0)))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let i=e,S=i.primitiveType;if(CSSPrimitiveValue.CSS_RGBCOLOR===S){let e=i.getRGBColorValue();t=!e||_isZeroColorComponent(e.red)&&_isZeroColorComponent(e.blue)&&_isZeroColorComponent(e.green)}else CSSPrimitiveValue.CSS_IDENT===S&&(t="black"===i.getStringValue().toLowerCase())}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return t},_isMatchingFontFamilyCSSValue=function(e,t){if(!e)return!0;let i=!1;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let S=e;S.length>0&&(i=_isMatchingFontFamilyCSSValue(S.item(0),t))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{i=!0;let S=e;if(CSSPrimitiveValue.CSS_STRING===S.primitiveType){let e=S.getStringValue();e&&e.length&&(i=t.toLowerCase()===e.toLowerCase())}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return i},_isMatchingPixelSizeCSSValue=function(e,t){if(!e)return!0;let i=!1;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let S=e;S.length>0&&(i=_isMatchingPixelSizeCSSValue(S.item(0),t))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let S=e;switch(S.primitiveType){case CSSPrimitiveValue.CSS_PERCENTAGE:case CSSPrimitiveValue.CSS_EMS:case CSSPrimitiveValue.CSS_EXS:case CSSPrimitiveValue.CSS_PX:case CSSPrimitiveValue.CSS_CM:case CSSPrimitiveValue.CSS_MM:case CSSPrimitiveValue.CSS_IN:case CSSPrimitiveValue.CSS_PT:case CSSPrimitiveValue.CSS_PC:try{i=Math.abs(S.getFloatValue(CSSPrimitiveValue.CSS_PX)-t)<.1}catch(e){}}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return i},lightWeight=Symbol("lightWeight"),normalWeight=Symbol("normalWeight"),heavyWeight=Symbol("heavyWeight"),_isMatchingFontWeightCSSValue=function(e,t){if(!e)return!0;let i,S=t,l=normalWeight;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let i=e;i.length>0&&_isMatchingFontWeightCSSValue(i.item(0),t)&&(l=S)}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let t=e.primitiveType;l=CSSPrimitiveValue.CSS_STRING===t||CSSPrimitiveValue.CSS_IDENT===t?"normal"===(i=e.getStringValue().toLowerCase())||"400"===i?normalWeight:"bold"===i||"bolder"===i||i>400?heavyWeight:lightWeight:S;break}case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:l=S}return S===l},_isRichFontStyleCSSValue=function(e){if(!e)return!1;let t=e.cssText;return t.length&&"normal"!==t},_isRichTextDecorationStyleCSSValue=function(e){if(!e)return!1;let t=!1;switch(e.cssValueType){case CSSPrimitiveValue.CSS_VALUE_LIST:{let i=e;i.length>0&&(t=_isRichTextDecorationStyleCSSValue(i.item(0)))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let i=e,S=i.primitiveType;if(CSSPrimitiveValue.CSS_STRING===S||CSSPrimitiveValue.CSS_IDENT===S){let e=i.getStringValue().toLowerCase();t="none"!==e&&"inherit"!==e}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return t},_isRichTextAlignmentStyleCSSValue=function(e){if(!e)return!1;let t=!1;switch(e.cssValueType){case CSSPrimitiveValue.CSS_VALUE_LIST:{let i=e;i.length>0&&(t=_isRichTextAlignmentStyleCSSValue(i.item(0)))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let i=e,S=i.primitiveType;if(CSSPrimitiveValue.CSS_STRING===S||CSSPrimitiveValue.CSS_IDENT===S){let e=i.getStringValue().toLowerCase();t="left"!==e&&"inherit"!==e}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return t};Element.prototype.isRichTextStyle=function(e){let t=!1;return(t=!_isBlackCSSColorValue(e.getPropertyCSSValue("color")))||(t||(t=!_isMatchingFontFamilyCSSValue(e.getPropertyCSSValue("font-family"),defaultComposeFontFamily)),t||(t=!_isMatchingPixelSizeCSSValue(e.getPropertyCSSValue("font-size"),defaultComposeFontPixelSize)),t||(t=!_isMatchingFontWeightCSSValue(e.getPropertyCSSValue("font-weight"),normalWeight))),t||(t=_isRichFontStyleCSSValue(e.getPropertyCSSValue("font-style"))),t||(t=_isRichTextDecorationStyleCSSValue(e.getPropertyCSSValue("text-decoration"))),t||(t=_isRichTextAlignmentStyleCSSValue(e.getPropertyCSSValue("text-align"))),t||(t=!!e.getPropertyCSSValue("direction")),t},Element.prototype.isRichTextElement=function(){let e=this.isRichTextElementType();if(!e){let t=this.nodeName.toLowerCase();if("blockquote"===t){let t=this.getAttribute("type");e=!t||"cite"!==t.toLowerCase()}else if("img"===t){if(!(this instanceof HTMLImageElement&&this.attachmentIdentifier)){let t=this.src;t&&(e=new URL(t).protocol!==MFContentIDScheme+":")}}else"p"===t&&(e=!this.hasMarginsOfZero())}if(!e){let t=this.hasAttribute("STYLE")?this.style:undefined;t&&"none"!==t.getPropertyValue("display")&&(e=this.isRichTextStyle(t))}return e||this.getAttribute("class")!==MFMailDropItemClass&&this.getAttribute("class")!==MFMailDropBannerClass||(e=!0),e||this.getAttribute("id")===MFHtmlIDSignature&&(e=!0),e},Element.prototype.isRichLink=function(){let e=this.classList;return e.length&&e.contains(MFRichLinkClass)},Element.prototype.richLinkContainer=function(){if(this.isRichLink())return this;let e=this.parentElement;return e?e.richLinkContainer():null},Element.prototype.mf_expectsNewline=function(){return this instanceof HTMLParagraphElement||this instanceof HTMLDivElement},Element.prototype.mf_isListContainer=function(){return this instanceof HTMLOListElement||this instanceof HTMLUListElement};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";HTMLDocument.prototype.mf_createMessageQuoteElement=function(){let e=this.createElement("BLOCKQUOTE");return e.setAttribute("TYPE","cite"),e},HTMLDocument.prototype.createElementFromMarkup=function(e){let t=this.createElement("template");return t.innerHTML=e,t.content.firstChild},HTMLDocument.mf_listElements=["ul","ol","dl"];
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";HTMLElement.prototype.mf_quoteLevelDelta=function(){if("BLOCKQUOTE"!==this.nodeName.toUpperCase())return 0;let t=this.getAttribute("type");if(t&&"CITE"===t.toUpperCase())return 1;let e=this.getAttribute("class");return e&&"GMAIL_QUOTE"===e.toUpperCase()?1:0};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Node.prototype.mf_quoteLevelDelta=function(){return 0},Node.prototype.mf_isQuoteOrWithinQuote=function(){let e=this;for(;e;){if(e.mf_quoteLevelDelta()>0)return!0;e=e.parentNode}return!1},Node.prototype.mf_commonAncestorWithNode=function(e){let t,o,n=this;for(;n&&!t;n=n.parentNode)n===e?t=n:(o||(o=new Set),o.add(n));for(;e&&!t;e=e.parentNode)o&&o.has(e)&&(t=e);return t},Node.prototype.mf_appendBlockPlaceholder=function(){let e=this.ownerDocument.createBlockPlaceholder();return e&&this.appendChild(e),e},Node.prototype.mf_containsRichText=function(){let e=!1;this instanceof Element&&(e=this.isRichTextElement());let t=this.firstChild;for(;!e&&t;)e=t.mf_containsRichText(),t=t.nextSibling;return e},Node.prototype.stringValue=function(){let e=this.ownerDocument.createRange();return e.selectNode(this),e.stringValue()},Node.prototype.mf_isBody=function(){return"body"===this.nodeName.toLowerCase()},Node.prototype.mf_traversePreviousNode=function(){let e=this.previousSibling;for(;e&&e.lastChild;)e=e.lastChild;return e||this.parentNode},Node.prototype.mf_traverseNextNodeStayingWithin=function(e){let t=this.firstChild;if(t)return t;if(this.isSameNode(e))return undefined;if(t=this.nextSibling)return t;for(t=this;t&&!t.nextSibling&&(!e||!t.parentNode.isSameNode(e));)t=t.parentNode;return t.nextSibling},Node.prototype.mf_traverseNextSiblingStayingWithin=function(e){let t;if(this.isSameNode(e))return t;if(t=this.nextSibling)return t;for(t=this;t&&!t.nextSibling&&(!e||!t.parentNode.isSameNode(e));)t=t.parentNode;return t.nextSibling},Node.prototype.mf_topmostContainingNodeWithNameInArray=function(e){let t,o=this;for(;o&&!o.mf_isBody();)-1!==e.indexOf(o.nodeName.toLowerCase())&&(t=o),o=o.parentNode;return t},Node.prototype.mf_containsOnlySelectionMarkers=function(){let e=!1;if(this.firstChild){let t=this.firstChild;for(e=!0;t;)t instanceof HTMLElement&&"span"===t.tagName.toLowerCase()&&t.className===MFHtmlTemporaryEditingElement&&!t.firstChild||(e=!1),t=e?t.nextSibling:undefined}else e=!0;return e},Node.prototype.mf_isDescendantOfNode=function(e){let t=this,o=!1;for(;!o&&t;)t===e&&(o=!0),t=t.parentNode;return o},Node.prototype.mf_containingBlockQuote=function(){let e=this;for(;e&&!e.mf_quoteLevelDelta();)e=e.parentNode;return e},Node.prototype.mf_isAtBeginningOfContainerNode=function(e){let t=e;for(;t&&t!==this;)t=t.firstChild;return!!t},Node.prototype.mf_isAtEndOfContainerNode=function(e){let t=e;for(;t&&t!==this;)t=t.lastChild;return!!t},Node.prototype.mf_nextSiblingOrAunt=function(){let e,t=this;for(;!e&&t;)(e=t.nextSibling)||(t=t.parentNode);return e},Node.prototype.mf_highestContainingBlockQuote=function(){let e,t=this.mf_containingBlockQuote();for(;t&&(e=t.parentNode.mf_containingBlockQuote());)t=e;return t},Node.prototype.mf_firstDescendantBlockQuote=function(){let e;if(this.mf_quoteLevelDelta()>0)e=this;else{let t,o=this.childNodes,n=o.length;for(t=0;!e&&t<n;t++)e=o.item(t).mf_firstDescendantBlockQuote()}return e},Node.prototype.mf_blockNodeAncestor=function(){let e=this;for(;!isBlockLevelNode(e)&&"li"!==e.nodeName.toLowerCase();)e=e.parentNode;return e},Node.prototype.mf_findElement=function(e,t,o){e=e.toLowerCase();let n,i,r;if(this instanceof HTMLDocument?(r=this,i=this.body):(r=this.ownerDocument,i=this),i){let s,f=r.createNodeIterator(i,NodeFilter.SHOW_ELEMENT);for(;!n&&(s=f.nextNode());){let i=!0;e&&!(i=i&&s.nodeName.toLowerCase()===e)||(t&&!(i=i&&s.className===t)||o&&!(i=i&&s.id===o)||i&&(n=s))}}return n};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";const blockElementNames=new Set(["HTML","BODY","BR","OL","UL","TD","TH","HR","DD","DL","DT","PRE","BLOCKQUOTE","DIV","P","TR","H1","H2","H3","H4","H5","H6"]),isBlockElementName=function(e){return blockElementNames.has(e)};Range.prototype.stringValue=function(){let e=this.text();return isBlockElementName(this.endContainer.nodeName)&&0===this.endOffset&&(e+="\n"),e},Range.prototype.mf_hoistRange=function(){let e,t=!1;for(e=this.startContainer;!t&&!e.mf_isBody()&&!e.mf_quoteLevelDelta();)t=!0,this.endContainer===e&&(this.startOffset||this.endOffset!==e.childNodes.length||(this.setStartBefore(e),this.setEndAfter(e),e=this.startContainer,t=!1))},Range.prototype.mf_firstNode=function(){let e;if(this.collapsed)return e;let t=this.startContainer,n=this.startOffset,i=!1;if(t instanceof Text)e=(i=n>0)?t.mf_traverseNextNodeStayingWithin():t;else{for(e=t.firstChild;n-- >0;)e=e.nextSibling;e||(e=t.mf_traverseNextSiblingStayingWithin())}return e&&!this.intersectsNode(e)&&(e=undefined),e},Range.prototype.mf_lastNode=function(){let e;if(this.collapsed)return e;let t=this.endContainer,n=this.endOffset,i=!1;if(t instanceof Text)e=(i=n<t.length)?t.mf_traversePreviousNode():t;else{for(e=t.firstChild;--n>0;)e=e.nextSibling;e&&this.endOffset||(e=t.mf_traversePreviousNode())}return e&&!this.intersectsNode(e)&&(e=undefined),e};const IS_BLOCK_ELEMENT_NAME=function(e){const t=["HTML","BODY","BR","LI","OL","UL","TD","TH","HR","DD","DL","DT","PRE","BLOCKQUOTE","DIV","P","TR","H1","H2","H3","H4","H5","H6"];return e&&-1!==t.indexOf(e)},isBlockLevelNode=function(e){let t=!1;return t=!!IS_BLOCK_ELEMENT_NAME(e.nodeName)};Range.prototype.mf_getBlockBoundaryParentAndNextSibling=function(e){let t,n;if(e){let e=this.mf_firstNode(),t=e&&e.mf_topmostContainingNodeWithNameInArray(HTMLDocument.mf_listElements);if(t)return{parent:t.parentNode,nextSibling:t}}else{let e=this.mf_lastNode(),t=e&&e.mf_topmostContainingNodeWithNameInArray(HTMLDocument.mf_listElements);if(t)return{parent:t.parentNode,nextSibling:t.nextSibling}}let i,s,o;if(e?(i=this.startContainer,o=this.startOffset):(i=this.endContainer,o=this.endOffset),i instanceof Text)i=(s=i).parentNode;else for(s=i.firstChild;o-- >0;s=s.nextSibling);for(e&&(s=s?s.previousSibling:i.lastChild);!t&&i;){for(;!t&&s;)isBlockLevelNode(s)?(t=i,n=e||"BR"===s.nodeName.toUpperCase()?s.nextSibling:s):s=e?s.previousSibling:s.nextSibling;s||(isOrContainsBlockLevelNode(i)?(t=i,n=e?t.firstChild:undefined):(s=i,i=i.parentNode))}return{parent:t,nextSibling:n}};const isOrContainsBlockLevelNode=function(e){let t,n=!1;if(IS_BLOCK_ELEMENT_NAME(e.nodeName))n=!0;else for(t=e.firstChild;!n&&t;)n=isOrContainsBlockLevelNode(t),t=t.nextSibling;return n};
MSAttachmentItem
NSSecureCoding
NSCoding
MSRichLinkGeneration
NSObject
MSComposeBundlePageController
WKWebProcessPlugInLoadDelegate
MSBundlePageController
MSComposeBodyFieldController
MSComposeBundlePageControllerExtras
_MSComposeBundlePageControllerNSURL
JSExport
MSPDFAttachmentController
MSMailWebProcessAttachmentProxy
init
copy
contentID
encodeObject:forKey:
uttype
data
additionalMarkup
decodeObjectOfClass:forKey:
supportsSecureCoding
encodeWithCoder:
initWithCoder:
TB,R
initWithContentID:uttype:data:additionalMarkup:
.cxx_destruct
_contentID
_uttype
_data
_additionalMarkup
T@"NSString",R,C,N,V_contentID
T@"UTType",R,N,V_uttype
T@"NSData",R,C,N,V_data
T@"NSString",R,C,N,V_additionalMarkup
setLoadDelegate:
doesNotRecognizeSelector:
addObject:
resumePerformOnPage
firstObject
removeObjectAtIndex:
invokeMethod:withArguments:
performOnPage:
controller
_remoteObjectRegistry
isEqual:
class
self
performSelector:
performSelector:withObject:
performSelector:withObject:withObject:
isProxy
isKindOfClass:
isMemberOfClass:
conformsToProtocol:
respondsToSelector:
retain
release
autorelease
retainCount
zone
hash
superclass
description
debugDescription
TQ,R
T#,R
T@"NSString",R,C
createRichLinkWithURL:completionHandler:
remoteObjectInterfaceWithProtocol:
remoteObjectProxyWithInterface:
currentContext
objectForKeyedSubscript:
_lp_URLWithUserTypedString:relativeToURL:
_linkGeneratorProxy
arrayWithObjects:count:
valueWithObject:inContext:
callWithArguments:
constructWithArguments:
suspendPerformOnPage
absoluteString
performBodyFieldMethodOnPage:withArguments:
jsBodyField
toBool
numberWithInteger:
mainFrame
normalWorld
jsContextForWorld:
callStackSymbols
toString
componentsSeparatedByString:
dictionaryWithObjects:forKeys:count:
stringWithFormat:
exceptionWithName:reason:userInfo:
observerProxy
composeBodyFieldDidThrowException:
setExceptionHandler:
globalObject
jsContext
exceptionHandler
initializeGlobalObject
willSendRequest:
initWithBytes:length:encoding:
stringWithUTF8String:
URLWithString:
evaluateScript:withSourceURL:
setObject:forKeyedSubscript:
currentThis
rangeHandleWithJSValue:inContext:
text
ef_isWebAddress
ef_rangeOfWebAddressContainingRange:
createRichLink:
webProcessPlugInBrowserContextController:didStartProvisionalLoadForFrame:
webProcessPlugInBrowserContextController:didReceiveServerRedirectForProvisionalLoadForFrame:
webProcessPlugInBrowserContextController:didCommitLoadForFrame:
webProcessPlugInBrowserContextController:didFinishDocumentLoadForFrame:
webProcessPlugInBrowserContextController:didFailProvisionalLoadWithErrorForFrame:error:
webProcessPlugInBrowserContextController:didFailLoadWithErrorForFrame:error:
webProcessPlugInBrowserContextController:didFinishLoadForFrame:
webProcessPlugInBrowserContextController:didSameDocumentNavigation:forFrame:
webProcessPlugInBrowserContextController:didClearWindowObjectForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:globalObjectIsAvailableForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:serviceWorkerGlobalObjectIsAvailableForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:willInjectUserScriptForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:didRemoveFrameFromHierarchy:
webProcessPlugInBrowserContextController:didHandleOnloadEventsForFrame:
webProcessPlugInBrowserContextController:didLayoutForFrame:
webProcessPlugInBrowserContextController:renderingProgressDidChange:
webProcessPlugInBrowserContextController:didFirstVisuallyNonEmptyLayoutForFrame:
webProcessPlugInBrowserContextControllerRenderingProgressEvents:
webProcessPlugInBrowserContextController:frame:willSendRequestForResource:request:redirectResponse:
webProcessPlugInBrowserContextController:frame:willSendRequest:redirectResponse:
webProcessPlugInBrowserContextController:frame:didInitiateLoadForResource:request:pageIsProvisionallyLoading:
webProcessPlugInBrowserContextController:frame:didInitiateLoadForResource:request:
webProcessPlugInBrowserContextController:frame:didReceiveResponse:forResource:
webProcessPlugInBrowserContextController:frame:didFinishLoadForResource:
webProcessPlugInBrowserContextController:frame:didFailLoadForResource:error:
initWithPlugIn:contextController:
invalidate
insertRichLinkWithURL:completionHandler:
makeRichLinkFromSelection
removeRichLinkFromSelection
containsRichLinks:
stripCustomBodyIdentifiers
changeQuoteLevelBy:
initializeBodyField:
plugIn
_performOnPageSuspendCount
_blocksToPerformOnPage
_jsBodyField
_plugIn
_controller
_jsContext
T@"<WKWebProcessPlugIn>",R,W,N,V_plugIn
T@"WKWebProcessPlugInBrowserContextController",R,N,V_controller
T@"JSContext",R,N,V_jsContext
T@"JSValue",R,N,V_jsBodyField
T@"<MSComposeBodyFieldObserver>",R,N
initWithString:
scheme
UTF8String
conformsToType:
initWithData:
pageCount
isLocked
delegate
currentHandler
handleFailureInMethod:object:file:lineNumber:description:
attachmentController:updateToInlineAttachment:
updateToInlinePDFAttachmentIfNeeded:
setDelegate:
_delegate
T@"<MSPDFAttachmentControllerDelegate>",W,N,V_delegate
B16@0:8
v24@0:8@16
@24@0:8@16
v24@0:8@"NSCoder"16
@24@0:8@"NSCoder"16
@48@0:8@16@24@32@40
@16@0:8
v16@0:8
@"NSString"
@"UTType"
@"NSData"
B24@0:8@16
#16@0:8
@24@0:8:16
@32@0:8:16@24
@40@0:8:16@24@32
B24@0:8#16
B24@0:8:16
Vv16@0:8
Q16@0:8
^{_NSZone=}16@0:8
B24@0:8@"Protocol"16
@"NSString"16@0:8
v32@0:8@16@?24
v32@0:8@"NSURL"16@?<v@?@"NSString"@"NSString">24
v32@0:8@16@24
v40@0:8@16@24@32
v40@0:8@16q24@32
v32@0:8@16Q24
Q24@0:8@16
@56@0:8@16@24Q32@40@48
v52@0:8@16@24Q32@40B48
v48@0:8@16@24Q32@40
v48@0:8@16@24@32Q40
v40@0:8@16@24Q32
v32@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24
v40@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"NSError"32
v40@0:8@"WKWebProcessPlugInBrowserContextController"16q24@"WKWebProcessPlugInFrame"32
v40@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"WKWebProcessPlugInScriptWorld"32
v32@0:8@"WKWebProcessPlugInBrowserContextController"16Q24
Q24@0:8@"WKWebProcessPlugInBrowserContextController"16
@"NSURLRequest"56@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSURLRequest"40@"NSURLResponse"48
@"NSURLRequest"48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"NSURLRequest"32@"NSURLResponse"40
v52@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSURLRequest"40B48
v48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSURLRequest"40
v48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"NSURLResponse"32Q40
v40@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32
v48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSError"40
@32@0:8@16@24
@32@0:8@"<WKWebProcessPlugIn>"16@"WKWebProcessPlugInBrowserContextController"24
v24@0:8@?16
v24@0:8q16
v32@0:8@"NSURL"16@?<v@?>24
v24@0:8@?<v@?B>16
@"NSMutableArray"
@"JSValue"
@"<MSRichLinkGeneration>"
@"<WKWebProcessPlugIn>"
@"WKWebProcessPlugInBrowserContextController"
@"JSContext"
@24@0:8@"NSString"16
v24@0:8@"MSAttachmentItem"16
@"<MSPDFAttachmentControllerDelegate>"
EFPropertyKey_contentID
EFPropertyKey_uttype
EFPropertyKey_data
EFPropertyKey_additionalMarkup
-[MSComposeBundlePageController observerProxy]
MSComposeBundlePageController.m
v8@?0
Promise
v24@?0@"NSString"8@"NSString"16
v16@?0@"JSValue"8
insertRichLink
then
makeRichLinkFromSelection
removeRichLinkFromSelection
containsRichLinks
stripCustomBodyIdentifiers
changeQuoteLevel
stack
JavaScript exception: %@:%@:%@: %@
sourceURL
line
column
v24@?0@"JSContext"8@"JSValue"16
addEventListener
unhandledrejection
reason
MailSupport/BodyField.js
MailSupport/BodyInputController.js
MailSupport/Constants.js
MailSupport/DocumentExtras.js
MailSupport/ElementExtras.js
MailSupport/HTMLDocumentExtras.js
MailSupport/HTMLElementExtras.js
MailSupport/NodeExtras.js
MailSupport/RangeExtras.js
NSUTF8StringEncoding
NSURL
B8@?0
Mail
RichLinks
richLinksEnabled
BigEmojis
bigEmojiEnabled
[\n\r\s]+
whitespaceRegex
(\p{Emoji_Presentation}|\p{Extended_Pictographic})
emojiRegex
stringToArrayRegex
Range
prototype
@"NSString"8@?0
text
String
ef_isWebAddress
{_NSRange=QQ}24@?0{_NSRange=QQ}8
ef_rangeOfWebAddressContainingRange
@"JSValue"16@?0@"NSString"8
_createRichLink
com.apple.email
MSPDFAttachmentController.m
Delegate is missing to update attachment
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";function getPlainTextURLAtPoint(e,t){let n=document.caretRangeFromPoint(e,t);if(n&&n.startContainer.nodeType===Node.TEXT_NODE){if(n.expand("word"),n.startContainer!=n.endContainer)return null;let e={location:n.startOffset,length:n.endOffset-n.startOffset},t=n.startContainer.textContent.ef_rangeOfWebAddressContainingRange(e);if(t.length>0)return n.setStart(n.startContainer,t.location),n.setEnd(n.startContainer,t.location+t.length),{selectedText:n.toString(),range:n}}return null}function replaceNodes(e,t){if(console.assert(e.length),console.assert(t.length),!e.length&&!t.length)return;const n=e[0],i=n.parentElement;if(console.assert(i),!i)return;for(let t=0;t<e.length;++t){const n=e[t];if(console.assert(n.parentElement==i),n.parentElement!=i)return;if(!t)continue;const o=e[t-1];if(console.assert(o.nextSibling==n),o.nextSibling!=n)return}let o=null;for(let e=0;e<i.childNodes.length;++e)if(i.childNodes[e]===n){o=e;break}for(let n=e.length-1;n>=0;--n){const o=e[n];n?o.remove():i.replaceChild(t[0],o)}for(let e=1;e<t.length;++e)i.insertBefore(t[e],t[e-1].nextSibling)}function getSelectionRange(){let e=window.getSelection();return e.rangeCount?e.getRangeAt(0):null}const _appendTextFromDOMRange=function(e,t,n,i){let o=t.text();if(o){e||(e=[]);let t=o;t=t.replace(/\xa0/g," "),i&&"\n"!==o.charAt(o.length-1)&&(t+="\n"),e.push([t,n])}return e},MFCreatePlainTextRepresentationFromDOMDocument=function(e,t){let n,i=[],o=e.body,r=e.createRange(),l=0;r.setStartBefore(o);let a=o.firstChild;for(;a&&o!==a;){let e,o=a.firstChild,d=a.mf_quoteLevelDelta(),s=t?t(a):undefined;if(a instanceof HTMLAnchorElement&&!a.richLinkContainer()){let t=document.createRange();t.selectNode(a);let n=t.text();n!=a.href&&(e=`${n} <${a.href}>`)}else a instanceof HTMLDivElement&&a.isRichLink()&&(document.createRange().selectNode(a),e=a.getAttribute("data-url"));for((s||e||0!==d)&&(r.setEndBefore(a),n=_appendTextFromDOMRange(n,r,l,0!==d),r.collapse()),e&&(n&&(i.push(n),n=null),i.push([[e,l]]),r.setStartAfter(a)),s&&(n&&(i.push(n),n=null),i.push(s)),l+=d;!o&&a;){let e=a.mf_quoteLevelDelta();0!==e&&(r.setEndAfter(a),n=_appendTextFromDOMRange(n,r,l,!0),r.collapse(),l-=e);let t=a.nextSibling;o=t,a=t=a.parentNode}a=o}return r.setEndAfter(o),(n=_appendTextFromDOMRange(n,r,l,!1))&&i.push(n),i.length||((n=[]).push(["",0]),i=[n]),i},MFFindQuotedAttachmentsFromDOMDocument=function(e,t,n){if(!document||!t||!n)return[];let i=[];for(let o of e.querySelectorAll("attachment, img"))if(o.mf_isQuoteOrWithinQuote()){let e=t(o,n);e&&i.push(e.replace("cid:",""))}return i},_copyHtmlStringFromRange=function(e,t,n,i,o,r,l,a){let d,s,c,f=e.body,m=t.startContainer.mf_commonAncestorWithNode(t.endContainer),u=t.cloneContents();if(i&&!o||u.recursivelyRemoveMailAttributes(!i,o,!1),u){let t,n,o=!0;for(t=m;o&&t;t=t.parentNode)o=f!==t;if(!o)for(t=m;t;t=t.parentNode){let e=t.cloneNode();if(e.appendChild(u),u=e,n=t,t===f){m=t.parentNode;break}}let r=e.head?e.head.cloneNode(!0):e.createElement("head");for(i||(c=r.querySelector("meta[http-equiv=Content-Type]"))||(c=e.createElement("meta"),r.appendChild(c)),u.insertBefore(r,u.firstChild),t=m;t&&e!==t;t=t.parentNode){let e,i=t.cloneNode();if(o&&n)for(e=i.firstChild;e&&n!==e;e=e.nextSibling){let t=e.cloneNode(!0);t&&i.appendChild(t)}if(u&&i.appendChild(u),o&&n)for(e=n.nextSibling;e;e=e.nextSibling){let t=e.cloneNode(!0);t&&i.appendChild(t)}o||(o=f===t),u=i,n=t}}if(u){if(u.normalize(),r){let e;if("html"===u.nodeName.toLowerCase()){let t=u.firstChild;for(;t;){if("body"===t.nodeName.toLowerCase()){e=t;break}t=t.nextSibling}}if(e){e.removeAttribute("id"),e.removeAttribute("contenteditable"),e.removeAttribute("style");let t=e.getElementsByTagName("IMG");for(let e=0;e<t.length;e++){let n,i=t.item(e);try{n=new URL(i.src)}catch(e){}n!==undefined&&"file:"===n.protocol&&i.setAttribute("SRC","cid:"+n.pathname.substring(1))}}}if(a&&u.querySelectorAll("attachment, img").forEach(a),s=charsetForString(u.outerHTML,n),i||(c.httpEquiv="content-type",c.content="text/html; charset="+s.charsetName()),l){let e=u.ownerDocument.createRange();e.selectNodeContents(u),e.linkify()}d=u.outerHTML}return{string:d,charset:s}},_isSelectionPlaceholderNode=function(e){return e instanceof HTMLElement&&(e.id!==MFHtmlIDSelectionStart&&e.id!==MFHtmlIDSelectionEnd)};Object.defineProperty(this,"BodyField",{value:function(){this.bodyInputController=new BodyInputController,addEventListener("beforeinput",e=>{if(document.bigEmojiEnabled&&this.bodyInputController.pickEmojiFontSize(e),"insertParagraph"!==e.inputType||this._insertingNewlineInQuotedContent)return;let t=e.getTargetRanges()[0];t&&t.startContainer.mf_isQuoteOrWithinQuote()&&(e.preventDefault(),this._insertingNewlineInQuotedContent=!0,document.execCommand("InsertNewlineInQuotedContent"),this._insertingNewlineInQuotedContent=!1)}),addEventListener("input",e=>{document.bigEmojiEnabled&&"deleteContentBackward"==e.inputType&&this.bodyInputController.manageDeletedEmojiFontSize(e)}),addEventListener("load",()=>{function e(e){if(e.types.includes("Files"))return null;if(e.types.includes("text/uri-list"))return e.getData("text/uri-list");if(e.types.includes("text/plain")){let t=e.getData("text/plain").trim();if(t.ef_isWebAddress())return t}return null}document.shouldRichifyLinksAutomatically=!0,document.richLinksEnabled=richLinksEnabled(),document.bigEmojiEnabled=bigEmojiEnabled(),document.whitespaceRegex=RegExp(whitespaceRegex),document.emojiRegex=RegExp(emojiRegex,"u"),document.stringToArrayRegex=RegExp(stringToArrayRegex,"gus"),document.addEventListener("drop",t=>{if(!document.richLinksEnabled)return;let n=e(t.dataTransfer);if(!n||!document.shouldRichifyLinksAutomatically)return;let i=document.caretRangeFromPoint(t.clientX,t.clientY);if(0!=i.startOffset||0!=i.endOffset)return;let o=window.getSelection();o.removeAllRanges(),o.addRange(i),this.insertRichLink(n),t.preventDefault()}),document.addEventListener("paste",e=>{if(document.bigEmojiEnabled&&this.bodyInputController.pickEmojiFontSize(e),!document.richLinksEnabled)return;let t=(e.clipboardData||window.clipboardData).getData("text").trim();if(!t.ef_isWebAddress()||!document.shouldRichifyLinksAutomatically)return;let n=getSelectionRange();n&&0==n.startOffset&&0==n.endOffset&&(this.insertRichLink(t),e.preventDefault(),window.webkit.messageHandlers.RichLinkPasted.postMessage(t))}),document.addEventListener("cut",e=>{document.bigEmojiEnabled&&this.bodyInputController.manageDeleting(e.currentTarget.getSelection())}),document.addEventListener("mousemove",function(e){if(!document.richLinksEnabled)return;let t=e.target.richLinkContainer();if(t){this.lastRichLinkElementOrRange=t,this.lastRichLinkCandidateURL=null;let e=t.getBoundingClientRect(),n={x:e.x,y:e.y,width:e.width,height:e.height};window.webkit.messageHandlers.RichLinkHighlighted.postMessage(n)}else{let t,n;if(e.target instanceof HTMLAnchorElement){let i=e.target,o=i.text;["http:","https:"].includes(i.protocol)&&(o.startsWith(i.origin)||o.startsWith(i.hostname))&&(t=i.href,n=i)}else{let i=getPlainTextURLAtPoint(e.x,e.y);i&&(t=i.selectedText,n=i.range)}let i;if(t){let e=n.getBoundingClientRect();i={x:e.x,y:e.y,width:e.width,height:e.height},this.lastRichLinkElementOrRange=n,this.lastRichLinkCandidateURL=t}else i={x:e.x,y:e.y};window.webkit.messageHandlers.PlainTextLinkHighlighted.postMessage(i)}},!1)})}}),BodyField.prototype={constructor:BodyField},BodyField.prototype.insertNodeWithParentAndNextSibling=function(e,t,n){if(t&&e)if(Node.DOCUMENT_FRAGMENT_NODE===e.nodeType){let i;for(;i=e.firstChild;)this.insertNodeWithParentAndNextSibling(i,t,n)}else if(n){if(!t.isSameNode(n.parentNode))return;t.insertBefore(e,n),_isSelectionPlaceholderNode(e)&&(this._dirty=!0)}else t.appendChild(e)},BodyField.prototype.insertNodeWithParentAndOffset=function(e,t,n){let i,o=t.childNodes;if(t&&n<=o.length)if(Node.DOCUMENT_FRAGMENT_NODE===e.nodeType){let i;for(;i=e.firstChild;)this.insertNodeWithParentAndOffset(i,t,n++)}else n===o.length?t.appendChild(e):(i=o.item(n),t.insertBefore(e,i)),_isSelectionPlaceholderNode(e)&&(this._dirty=!0)},BodyField.prototype.deleteNode=function(e){let t=e.parentNode;if(t){e.nextSibling;t.removeChild(e),_isSelectionPlaceholderNode(e)&&(this._dirty=!0)}},BodyField.prototype.insertRichLink=async function(e){let t=null,n=e=>{t=e.target};document.addEventListener("DOMNodeInserted",n),document.execCommand("InsertHTML",!1,'<div style="display: inline-block;"><span style="-webkit-user-select: none;">'+e+"</span></div>"),document.removeEventListener("DOMNodeInserted",n);let i=await this._createRichLink(e),o="",r="";if(i&&i.length>1&&(o=i[0],r=i[1]),!o)return;let l=this.richLinkFromMarkup(o);if(t&&t.firstChild){t.replaceChild(l,t.firstChild);let e=t.nextSibling;if((!e||e.nodeType===Node.TEXT_NODE&&0==e.textContent.length)&&t.parentNode){let e=document.createElement("div");e.innerHTML="<br>",t.parentNode.insertBefore(e,null),e.focus()}if(t.setAttribute("style","display: block;"),r&&r.length>0){let e=this.createRichLinkMetadataContainer(r);t.appendChild(e)}}},BodyField.prototype.richLinkFromMarkup=function(e){let t=document.createElementFromMarkup(e);return t.setAttribute("style","-webkit-user-select: all; -webkit-user-drag: element; display: inline-block;"),t.setAttribute("class",MFRichLinkClass),t.setAttribute("draggable","true"),t.setAttribute("role","link"),t.setAttribute("data-url",t.firstChild.getAttribute("href")),t},BodyField.prototype.createRichLinkMetadataContainer=function(e){let t=document.createElement("div");return t.setAttribute("class",MFRichLinkMetadataClass),t.setAttribute("style","display: none;"),t.setAttribute("data-metadata",e),t},BodyField.prototype.makeRichLinkFromSelection=function(){document.shouldRichifyLinksAutomatically=!0;let e;if(this.selectionIsWebAddress())e=window.getSelection().getRangeAt(0).toString();else if(document.lastRichLinkElementOrRange&&document.lastRichLinkCandidateURL){let t=document.lastRichLinkElementOrRange;if(document.getSelection().removeAllRanges(),t instanceof Range)document.getSelection().addRange(t);else if(t instanceof HTMLElement){let e=new Range;e.selectNode(t),document.getSelection().addRange(e)}e=document.lastRichLinkCandidateURL,document.lastRichLinkCandidateURL=null,document.lastRichLinkElementOrRange=null}e&&this.insertRichLink(e)},BodyField.prototype.removeRichLinkFromSelection=function(){let e=document.lastRichLinkElementOrRange;if(e&&!(e instanceof Range)&&e.parentNode&&e.richLinkContainer()==e){document.shouldRichifyLinksAutomatically=!1;let t=decodeURI(e.getAttribute("data-url")),n=document.createElement("a");n.href=t,n.innerHTML=t;let i=e.parentNode.innerHTML==e.outerHTML?e.parentNode:e;if(replaceNodes([i],[n]),document.lastRichLinkElementOrRange=null,!document.undoManager)return;(()=>{const e=[n],t=[i];document.undoManager.addItem(new UndoItem({label:"",undo:()=>{replaceNodes(e,t)},redo:()=>{replaceNodes(t,e)}}))})()}},BodyField.prototype.containsRichLinks=function(){return document.querySelector(".apple-rich-link")},BodyField.prototype.selectionIsWebAddress=function(){let e=getSelectionRange();return!!e&&e.toString().ef_isWebAddress()},BodyField.prototype._canonicalizeSelection=function(e){let t,n,i,o,r=e.startContainer,l=e.endContainer,a=e.startOffset,d=e.endOffset,s=r===l;if(r instanceof Text)if(t=r.parentNode,a)if(a>=r.length)n=r.nextSibling;else{let e=r.cloneNode(!1),i=e.splitText(a);this.insertNodeWithParentAndNextSibling(e,t,r),this.insertNodeWithParentAndNextSibling(i,t,r),this.deleteNode(r),s&&(d-=Math.min(d,a),l=i),n=i}else n=r;else{for(n=r.firstChild;a--;)n=n.nextSibling;t=r}if(l instanceof Text)if(i=l.parentNode,d)if(d>=l.length)o=l.nextSibling;else{let e=l.cloneNode(!1),t=e.splitText(d);this.insertNodeWithParentAndNextSibling(e,i,l),this.insertNodeWithParentAndNextSibling(t,i,l),s&&l===n&&(n=e),this.deleteNode(l),o=t}else o=l;else{for(o=l.firstChild;d--;)o=o.nextSibling;i=l}return{startParent:t,startNextSibling:n,endParent:i,endNextSibling:o}},BodyField.prototype.deleteRange=function(e){let t=e.commonAncestorContainer,{startParent:n,startNextSibling:i,endParent:o,endNextSibling:r}=this._canonicalizeSelection(e),l=i;for(;l&&(!r||!r.isSameNode(l));)if(r&&r.mf_isDescendantOfNode(l)||!l.isSameNode(o)&&o.mf_isDescendantOfNode(l))l=l.mf_traverseNextNodeStayingWithin(t);else{let e=l.mf_traverseNextSiblingStayingWithin(t);if(this.deleteNode(l),l.isSameNode(o))break;l=e}},BodyField.prototype.splitUpBlockQuotesOverlappingStartOfRange=function(e){let t,n,i,o,r,l,a;for(e.mf_hoistRange(),n=e.mf_firstNode(),i=e.mf_lastNode(),t=(r=n).mf_containingBlockQuote();t;)n.mf_isAtBeginningOfContainerNode(t)?r=r.parentNode:((l=n.ownerDocument.createRange()).setStartBefore(t.firstChild),l.setEndBefore(n),a=l.cloneContents(),(o=n.ownerDocument.mf_createMessageQuoteElement()).appendChild(a),this.deleteRange(l),this.insertNodeWithParentAndNextSibling(o,t.parentNode,t),e.setStartBefore(n),e.setEndAfter(i),r=o.parentNode),t=r.mf_containingBlockQuote()},BodyField.prototype.splitUpBlockQuotesOverlappingEndOfRange=function(e){let t,n,i,o,r,l,a;for(n=e.mf_firstNode(),t=(o=i=e.mf_lastNode()).mf_containingBlockQuote();t;)i.mf_isAtEndOfContainerNode(t)?o=o.parentNode:((l=n.ownerDocument.createRange()).setStartBefore(t.firstChild),l.setEndAfter(e.mf_lastNode()),a=l.cloneContents(),r=n.ownerDocument.mf_createMessageQuoteElement(),n.mf_isDescendantOfNode(t)&&(n=a.firstChild),i=a.lastChild,r.appendChild(a),this.deleteRange(l),this.insertNodeWithParentAndNextSibling(r,t.parentNode,t),e.setStartBefore(n),e.setEndAfter(i),o=r.parentNode),t=o.mf_containingBlockQuote()},BodyField.prototype.replaceNode=function(e,t){e&&t&&(this.insertNodeWithParentAndNextSibling(e,t.parentNode,t),this.deleteNode(t))},BodyField.prototype.removeBlockQuoteFromTree=function(e){let t,n,i=e.parentNode,o=!1,r=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);for(t=r.nextNode();t;t=r.nextNode())if(t!==e&&t.mf_blockNodeAncestor()===e){o=!0;break}for(n=e,o&&(i=e.ownerDocument.createElement("div"),n=null);t=e.firstChild;)this.deleteNode(t),this.insertNodeWithParentAndNextSibling(t,i,n);o?this.replaceNode(i,e):this.deleteNode(e)},BodyField.prototype.temporaryEndingSelectionMarker=function(){let e=[window],t=e.length;for(;t>0;){let n,i=e[0];try{n=i.document}catch(e){}if(e.shift(),t--,n instanceof HTMLDocument){let e=n.mf_findElement("SPAN",MFHtmlTemporaryEditingElement,MFHtmlIDSelectionEnd);if(e)return e}let o=i.frames;o.length&&(t+=o.length,e=e.concat(Array.from(o)))}return undefined},BodyField.prototype.insertTemporarySelectionMarkersForRange=function(e){let t=e;t||(t=getSelectionRange());let n;if(t){let{startParent:e,startNextSibling:i,endParent:o,endNextSibling:r}=this._canonicalizeSelection(t),l=e.ownerDocument;if(l&&l instanceof HTMLDocument){let t=l.createElement("SPAN");t.className=MFHtmlTemporaryEditingElement,t.id=MFHtmlIDSelectionEnd,this.insertNodeWithParentAndNextSibling(t,o,r),(n=l.createElement("SPAN")).className=MFHtmlTemporaryEditingElement,n.id=MFHtmlIDSelectionStart,this.insertNodeWithParentAndNextSibling(n,e,t)}}return n},BodyField.prototype.restoreSelectionFromTemporaryMarkers=function(e){let t=[window],n=t.length;for(;n>0;){let i,o=t[0];try{i=o.document}catch(e){}if(t.shift(),n--,i instanceof HTMLDocument){let t=e?undefined:MFHtmlTemporaryEditingElement,n=i.mf_findElement("SPAN",t,MFHtmlIDSelectionStart),o=i.mf_findElement("SPAN",t,MFHtmlIDSelectionEnd);if(n||o){let e=i.createRange();n&&e.setStartBefore(n),o&&e.setEndBefore(o),n||e.collapse(!1),o||e.collapse(!0),n&&this.deleteNode(n),o&&this.deleteNode(o);let t=window.getSelection();t.empty(),t.addRange(e)}}let r=o.frames;r.length&&(n+=r.length,t=t.concat(Array.from(r)))}},BodyField.prototype.changeQuoteLevel=function(e){let t=getSelectionRange();if(!t)return;let n=!1,i=t.startContainer.ownerDocument;if(t.mf_hoistRange(),!t.collapsed&&e>0){let e=t.endContainer;if(e instanceof Text&&!t.endOffset){let n=e.previousSibling;"blockquote"===n.nodeName.toLowerCase()&&t.setEnd(n,n.childNodes.length)}}this.insertTemporarySelectionMarkersForRange(t);let{parent:o,nextSibling:r}=t.mf_getBlockBoundaryParentAndNextSibling(!0),{parent:l,nextSibling:a}=t.mf_getBlockBoundaryParentAndNextSibling(!1),d=i.createRange();if(r)d.setStartBefore(r);else{let e=o.lastChild;e||(e=o),d.setStartAfter(e)}if(a)d.setEndBefore(a);else{let e=l.lastChild;e||(e=l),d.setEndAfter(e)}let s;if(1===e){let e,t,o,c,f;if(s=i.mf_createMessageQuoteElement(),(f=d.cloneContents())&&s.appendChild(f),s.mf_containsOnlySelectionMarkers()&&s.mf_appendBlockPlaceholder(),n=!0,o=d.startContainer,c=d.endContainer,o===c)this.insertNodeWithParentAndNextSibling(s,o,r),d.setStartAfter(s),a?d.setEndBefore(a):d.setEndAfter(l),this.deleteRange(d);else if((e=d.commonAncestorContainer)===c){for(this.deleteRange(d),t=a;t&&t.parentNode!==e;)t=t.parentNode;this.insertNodeWithParentAndNextSibling(s,e,t)}else if(e===o)this.deleteRange(d),this.insertNodeWithParentAndOffset(s,e,d.startOffset);else{if(this.splitUpBlockQuotesOverlappingStartOfRange(d),this.splitUpBlockQuotesOverlappingEndOfRange(d),s=i.mf_createMessageQuoteElement(),(f=d.cloneContents())&&s.appendChild(f),s.mf_containsOnlySelectionMarkers()&&s.mf_appendBlockPlaceholder(),"blockquote"===(e=d.commonAncestorContainer).nodeName.toLowerCase())d.setStart(e,0),t=undefined,this.deleteRange(d);else{let n=d.endContainer;for(let t=n.parentElement;t!==e;t=t.parentElement)n=t;t=n.nextSibling,this.deleteRange(d),n.parentElement===e&&(t=n)}this.insertNodeWithParentAndNextSibling(s,e,t)}}else if(-1===e){let e,t,i,o,r;for(this.splitUpBlockQuotesOverlappingStartOfRange(d),this.splitUpBlockQuotesOverlappingEndOfRange(d),e=d.mf_lastNode(),i=d.mf_firstNode(),r=!1;!r&&i;)(o=(t=i).mf_highestContainingBlockQuote())||(o=t.mf_firstDescendantBlockQuote()),o?(r=e.mf_isDescendantOfNode(o),i=o.mf_nextSiblingOrAunt(),this.removeBlockQuoteFromTree(o),n=!0):(r=e.mf_isDescendantOfNode(t)||t.mf_isDescendantOfNode(e),i=t.mf_nextSiblingOrAunt())}return s&&s.parentNode&&this.temporaryEndingSelectionMarker()===s.lastChild&&s.parentNode.insertBefore(this.temporaryEndingSelectionMarker(),s.nextSibling),this.restoreSelectionFromTemporaryMarkers(),n},BodyField.prototype.convertInternalImagesToAttachments=function(e,t,n){let i={};for(let e of document.querySelectorAll("img")){let o=e.src;if(!o||!o.startsWith("cid:"))continue;let r=t[o];r&&(e.removeAttribute("src"),i[HTMLAttachmentElement.getAttachmentIdentifier(e)]=new NSURL(o),n&&n(e,r))}return i},BodyField.prototype.replacePlaceholderWithAttachment=function(e,t){let n;if(t.isImage){let t=document.createElement("img");e.replaceWith(t),n=HTMLAttachmentElement.getAttachmentIdentifier(t)}else{let t=document.createElement("attachment");e.replaceWith(t),n=t.uniqueIdentifier}return n},BodyField.prototype.convertObjectElementsToAttachmentElements=function(e,t){let n={};for(let i of e.querySelectorAll("object[type='application/x-apple-msg-attachment']")){let e=i.getAttribute("data"),o=new NSURL(e);if(!o)continue;let r=t[e];r&&(n[this.replacePlaceholderWithAttachment(i,r)]=o)}return n},BodyField.prototype.replaceRangeWithNode=function(e,t){e.deleteContents(),e.insertNode(t)},BodyField.prototype.stripCustomBodyIdentifiers=function(){this.bodyInputController.stripCustomBodyIdentifiers()};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";var emojiFontSize,numberOfEmojis=0,numberOfOtherCharacters=0,hasValidNumOfEmojis=!1,hasOnlyEmojis=!1,newParagraphInserted=!1;Object.defineProperty(this,"BodyInputController",{value:function(){}}),BodyInputController.prototype={constructor:BodyInputController,pickEmojiFontSize:function(e){let t=document.getSelection(),i=t.anchorNode.mf_containingBlockQuote(),n=t.anchorNode.mf_isDescendantOfNode(this._locateSignatureDiv(document)),o="paste"==e.type?e.clipboardData.getData("Text"):e.data,s=document.whitespaceRegex.test(o);i||s||n||("deleteContentBackward"==e.inputType?this._manageDeleting(t):"insertParagraph"==e.inputType?this.newParagraphInserted=!0:(this.shouldShowBigEmoji(o,t),this._manageInputEmojiFontSize(document,e,o)))},shouldShowBigEmoji:function(e,t){numberOfEmojis=0,numberOfOtherCharacters=0;let i=t.anchorNode.wholeText;var n=i?i.match(document.stringToArrayRegex):[];let o=e.match(document.stringToArrayRegex).concat(n);this._updateCounts(o),this.hasValidNumOfEmojis=numberOfEmojis<=maxNumberBigEmoji&&numberOfEmojis>0,this.hasOnlyEmojis=0==numberOfOtherCharacters,emojiFontSize=this.hasValidNumOfEmojis&&this.hasOnlyEmojis?bigEmojiFontSize:defaultEmojiFontSize,this.newParagraphInserted=!i},_manageInputEmojiFontSize:function(e,t,i){let n=e.getSelection(),o=n.anchorNode,s=n.getRangeAt(0);if(this.hasValidNumOfEmojis&&this.hasOnlyEmojis&&this.newParagraphInserted){let o=e.createElement("span");o.className=MFMailBigEmojiAttribute,o.innerHTML+=i,o.setAttribute("style","font-size:"+emojiFontSize),s.insertNode(o),n.setPosition(s.endContainer,s.endOffset),t.preventDefault(),this.newParagraphInserted=!1}else if(!this.hasOnlyEmojis||!this.hasValidNumOfEmojis){let t=o.parentElement;if(t.className==MFMailBigEmojiAttribute){let a=t.parentElement;"FONT"==a.tagName?(a.setAttribute("size",emojiFontSize),a.remove()):(t.setAttribute("style","font-size:"+emojiFontSize),t.remove()),t.setAttribute("style","font-size:"+emojiFontSize);let r=o.textContent+i;s.insertNode(e.createTextNode(r)),n.setPosition(s.endContainer,s.endOffset)}"FONT"==o.tagName&&o.size==largeInheritedFontSize&&o.setAttribute("size",emojiFontSize)}},_manageDeleting:function(e){let t=e.anchorOffset,i=e.focusOffset,n=e.anchorNode;var o,s;numberOfEmojis=0,numberOfOtherCharacters=0,t==i?(n.wholeText?s=n.wholeText.match(document.stringToArrayRegex):n.childNodes&&(s=[],n.querySelectorAll("[class=AppleMailBigEmoji]").forEach(function(e){s.push(e.textContent)})),this._updateCounts(s),o=s.splice(s.length-e.rangeCount,e.rangeCount)):(this._updateCounts(n.wholeText.match(document.stringToArrayRegex)),o=n.wholeText.slice(t,i)),document.emojiRegex.test(o)?0==(numberOfEmojis=numberOfEmojis<0?0:numberOfEmojis-o.length)&&n.parentElement.setAttribute("style","font-size:"+defaultEmojiFontSize):numberOfOtherCharacters=numberOfOtherCharacters<0?0:numberOfOtherCharacters-o.length,this.hasSingleEmoji=1==numberOfEmojis,this.hasValidNumOfEmojis=numberOfEmojis<=maxNumberBigEmoji&&numberOfEmojis>0,this.hasOnlyEmojis=0==numberOfOtherCharacters},manageDeletedEmojiFontSize:function(){let e=document.getSelection(),t=e.anchorNode;if(t){let i=t.parentElement.className;if(this.hasValidNumOfEmojis&&this.hasOnlyEmojis&&i!=MFMailBigEmojiAttribute){let i=e.getRangeAt(0),n=document.createElement("span");n.className=MFMailBigEmojiAttribute,n.setAttribute("style","font-size:"+bigEmojiFontSize),n.appendChild(t),i.insertNode(n),e.setPosition(i.endContainer,i.endOffset)}}},_locateSignatureDiv:function(e){let t=e.body.querySelectorAll(`div[id="${MFHtmlIDSignature}"]`);for(let e=0;e<t.length;++e){let i=t.item(e);if(!i.mf_isQuoteOrWithinQuote())return i}return null},_updateCounts:function(e){e.map(e=>{document.whitespaceRegex.test(e)||(document.emojiRegex.test(e)?numberOfEmojis+=1:numberOfOtherCharacters+=1)})},stripCustomBodyIdentifiers:function(){let e=document.querySelectorAll("[class=AppleMailBigEmoji]");e.length>0&&e.forEach(function(e){e.removeAttribute("class")})}};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";const MFContentIDScheme="cid",MFHtmlIDSelectionEnd="x-apple-selection:end",MFHtmlIDSelectionStart="x-apple-selection:start",MFHtmlTemporaryEditingElement="AppleTemporaryEditingElement",MFHtmlTemporaryPresentationElement="AppleTemporaryPresentationElement",MFMailDropBannerClass="x-apple-maildropbanner",MFMailDropItemClass="x-apple-maildrop",MFHtmlIDSignature="AppleMailSignature",MFRichLinkClass="apple-rich-link",MFRichLinkMetadataClass="apple-rich-link-metadata",MFMailBigEmojiAttribute="AppleMailBigEmoji",bigEmojiFontSize="-webkit-xxx-large",defaultEmojiFontSize="-apple-system-body",maxNumberBigEmoji=3,largeInheritedFontSize=7;
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Document.prototype.createBlockPlaceholder=function(){let e=this.createElement("BR");return e.className="webkit-block-placeholder",e};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Element.prototype.isRichTextElementType=function(){let e=this.nodeName.toUpperCase();return-1!==["B","I","U","H1","H2","H3","H4","H5","H6","A","TABLE","BDO","FONT","CODE","TT","UL","LI","OL","STYLE","STRIKE"].indexOf(e)},Element.prototype.hasMarginsOfZero=function(){let e,t=[CSSPrimitiveValue.CSS_ATTR,CSSPrimitiveValue.CSS_COUNTER,CSSPrimitiveValue.CSS_IDENT,CSSPrimitiveValue.CSS_RECT,CSSPrimitiveValue.CSS_RGBCOLOR,CSSPrimitiveValue.CSS_STRING,CSSPrimitiveValue.CSS_URI,CSSPrimitiveValue.CSS_UNKNOWN];if(!this.hasAttribute("style"))return!1;e=this.style;for(let i of["margin-top","margin-bottom","margin-left","margin-right"]){let S=e.getPropertyCSSValue(i);if(!S)return!1;let l=S.primitiveType;if(!l||t.includes(l)||S.getFloatValue(l))return!1}return!0};const _isZeroColorComponent=function(e){return!e||0===e.getFloatValue(CSSPrimitiveValue.CSS_NUMBER)},_isBlackCSSColorValue=function(e){if(!e)return!0;let t=!1;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let i=e;i.length>0&&(t=_isBlackCSSColorValue(i.item(0)))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let i=e,S=i.primitiveType;if(CSSPrimitiveValue.CSS_RGBCOLOR===S){let e=i.getRGBColorValue();t=!e||_isZeroColorComponent(e.red)&&_isZeroColorComponent(e.blue)&&_isZeroColorComponent(e.green)}else CSSPrimitiveValue.CSS_IDENT===S&&(t="black"===i.getStringValue().toLowerCase())}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return t},_isMatchingFontFamilyCSSValue=function(e,t){if(!e)return!0;let i=!1;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let S=e;S.length>0&&(i=_isMatchingFontFamilyCSSValue(S.item(0),t))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{i=!0;let S=e;if(CSSPrimitiveValue.CSS_STRING===S.primitiveType){let e=S.getStringValue();e&&e.length&&(i=t.toLowerCase()===e.toLowerCase())}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return i},_isMatchingPixelSizeCSSValue=function(e,t){if(!e)return!0;let i=!1;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let S=e;S.length>0&&(i=_isMatchingPixelSizeCSSValue(S.item(0),t))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let S=e;switch(S.primitiveType){case CSSPrimitiveValue.CSS_PERCENTAGE:case CSSPrimitiveValue.CSS_EMS:case CSSPrimitiveValue.CSS_EXS:case CSSPrimitiveValue.CSS_PX:case CSSPrimitiveValue.CSS_CM:case CSSPrimitiveValue.CSS_MM:case CSSPrimitiveValue.CSS_IN:case CSSPrimitiveValue.CSS_PT:case CSSPrimitiveValue.CSS_PC:try{i=Math.abs(S.getFloatValue(CSSPrimitiveValue.CSS_PX)-t)<.1}catch(e){}}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return i},lightWeight=Symbol("lightWeight"),normalWeight=Symbol("normalWeight"),heavyWeight=Symbol("heavyWeight"),_isMatchingFontWeightCSSValue=function(e,t){if(!e)return!0;let i,S=t,l=normalWeight;switch(e.cssValueType){case CSSValue.CSS_VALUE_LIST:{let i=e;i.length>0&&_isMatchingFontWeightCSSValue(i.item(0),t)&&(l=S)}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let t=e.primitiveType;l=CSSPrimitiveValue.CSS_STRING===t||CSSPrimitiveValue.CSS_IDENT===t?"normal"===(i=e.getStringValue().toLowerCase())||"400"===i?normalWeight:"bold"===i||"bolder"===i||i>400?heavyWeight:lightWeight:S;break}case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:l=S}return S===l},_isRichFontStyleCSSValue=function(e){if(!e)return!1;let t=e.cssText;return t.length&&"normal"!==t},_isRichTextDecorationStyleCSSValue=function(e){if(!e)return!1;let t=!1;switch(e.cssValueType){case CSSPrimitiveValue.CSS_VALUE_LIST:{let i=e;i.length>0&&(t=_isRichTextDecorationStyleCSSValue(i.item(0)))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let i=e,S=i.primitiveType;if(CSSPrimitiveValue.CSS_STRING===S||CSSPrimitiveValue.CSS_IDENT===S){let e=i.getStringValue().toLowerCase();t="none"!==e&&"inherit"!==e}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return t},_isRichTextAlignmentStyleCSSValue=function(e){if(!e)return!1;let t=!1;switch(e.cssValueType){case CSSPrimitiveValue.CSS_VALUE_LIST:{let i=e;i.length>0&&(t=_isRichTextAlignmentStyleCSSValue(i.item(0)))}break;case CSSValue.CSS_PRIMITIVE_VALUE:{let i=e,S=i.primitiveType;if(CSSPrimitiveValue.CSS_STRING===S||CSSPrimitiveValue.CSS_IDENT===S){let e=i.getStringValue().toLowerCase();t="left"!==e&&"inherit"!==e}}break;case CSSValue.CSS_CUSTOM:case CSSValue.CSS_INHERIT:}return t};Element.prototype.isRichTextStyle=function(e){let t=!1;return(t=!_isBlackCSSColorValue(e.getPropertyCSSValue("color")))||(t||(t=!_isMatchingFontFamilyCSSValue(e.getPropertyCSSValue("font-family"),defaultComposeFontFamily)),t||(t=!_isMatchingPixelSizeCSSValue(e.getPropertyCSSValue("font-size"),defaultComposeFontPixelSize)),t||(t=!_isMatchingFontWeightCSSValue(e.getPropertyCSSValue("font-weight"),normalWeight))),t||(t=_isRichFontStyleCSSValue(e.getPropertyCSSValue("font-style"))),t||(t=_isRichTextDecorationStyleCSSValue(e.getPropertyCSSValue("text-decoration"))),t||(t=_isRichTextAlignmentStyleCSSValue(e.getPropertyCSSValue("text-align"))),t||(t=!!e.getPropertyCSSValue("direction")),t},Element.prototype.isRichTextElement=function(){let e=this.isRichTextElementType();if(!e){let t=this.nodeName.toLowerCase();if("blockquote"===t){let t=this.getAttribute("type");e=!t||"cite"!==t.toLowerCase()}else if("img"===t){if(!(this instanceof HTMLImageElement&&this.attachmentIdentifier)){let t=this.src;t&&(e=new URL(t).protocol!==MFContentIDScheme+":")}}else"p"===t&&(e=!this.hasMarginsOfZero())}if(!e){let t=this.hasAttribute("STYLE")?this.style:undefined;t&&"none"!==t.getPropertyValue("display")&&(e=this.isRichTextStyle(t))}return e||this.getAttribute("class")!==MFMailDropItemClass&&this.getAttribute("class")!==MFMailDropBannerClass||(e=!0),e||this.getAttribute("id")===MFHtmlIDSignature&&(e=!0),e},Element.prototype.isRichLink=function(){let e=this.classList;return e.length&&e.contains(MFRichLinkClass)},Element.prototype.richLinkContainer=function(){if(this.isRichLink())return this;let e=this.parentElement;return e?e.richLinkContainer():null},Element.prototype.mf_expectsNewline=function(){return this instanceof HTMLParagraphElement||this instanceof HTMLDivElement},Element.prototype.mf_isListContainer=function(){return this instanceof HTMLOListElement||this instanceof HTMLUListElement};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";HTMLDocument.prototype.mf_createMessageQuoteElement=function(){let e=this.createElement("BLOCKQUOTE");return e.setAttribute("TYPE","cite"),e},HTMLDocument.prototype.createElementFromMarkup=function(e){let t=this.createElement("template");return t.innerHTML=e,t.content.firstChild},HTMLDocument.mf_listElements=["ul","ol","dl"];
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";HTMLElement.prototype.mf_quoteLevelDelta=function(){if("BLOCKQUOTE"!==this.nodeName.toUpperCase())return 0;let t=this.getAttribute("type");if(t&&"CITE"===t.toUpperCase())return 1;let e=this.getAttribute("class");return e&&"GMAIL_QUOTE"===e.toUpperCase()?1:0};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Node.prototype.mf_quoteLevelDelta=function(){return 0},Node.prototype.mf_isQuoteOrWithinQuote=function(){let e=this;for(;e;){if(e.mf_quoteLevelDelta()>0)return!0;e=e.parentNode}return!1},Node.prototype.mf_commonAncestorWithNode=function(e){let t,o,n=this;for(;n&&!t;n=n.parentNode)n===e?t=n:(o||(o=new Set),o.add(n));for(;e&&!t;e=e.parentNode)o&&o.has(e)&&(t=e);return t},Node.prototype.mf_appendBlockPlaceholder=function(){let e=this.ownerDocument.createBlockPlaceholder();return e&&this.appendChild(e),e},Node.prototype.mf_containsRichText=function(){let e=!1;this instanceof Element&&(e=this.isRichTextElement());let t=this.firstChild;for(;!e&&t;)e=t.mf_containsRichText(),t=t.nextSibling;return e},Node.prototype.stringValue=function(){let e=this.ownerDocument.createRange();return e.selectNode(this),e.stringValue()},Node.prototype.mf_isBody=function(){return"body"===this.nodeName.toLowerCase()},Node.prototype.mf_traversePreviousNode=function(){let e=this.previousSibling;for(;e&&e.lastChild;)e=e.lastChild;return e||this.parentNode},Node.prototype.mf_traverseNextNodeStayingWithin=function(e){let t=this.firstChild;if(t)return t;if(this.isSameNode(e))return undefined;if(t=this.nextSibling)return t;for(t=this;t&&!t.nextSibling&&(!e||!t.parentNode.isSameNode(e));)t=t.parentNode;return t.nextSibling},Node.prototype.mf_traverseNextSiblingStayingWithin=function(e){let t;if(this.isSameNode(e))return t;if(t=this.nextSibling)return t;for(t=this;t&&!t.nextSibling&&(!e||!t.parentNode.isSameNode(e));)t=t.parentNode;return t.nextSibling},Node.prototype.mf_topmostContainingNodeWithNameInArray=function(e){let t,o=this;for(;o&&!o.mf_isBody();)-1!==e.indexOf(o.nodeName.toLowerCase())&&(t=o),o=o.parentNode;return t},Node.prototype.mf_containsOnlySelectionMarkers=function(){let e=!1;if(this.firstChild){let t=this.firstChild;for(e=!0;t;)t instanceof HTMLElement&&"span"===t.tagName.toLowerCase()&&t.className===MFHtmlTemporaryEditingElement&&!t.firstChild||(e=!1),t=e?t.nextSibling:undefined}else e=!0;return e},Node.prototype.mf_isDescendantOfNode=function(e){let t=this,o=!1;for(;!o&&t;)t===e&&(o=!0),t=t.parentNode;return o},Node.prototype.mf_containingBlockQuote=function(){let e=this;for(;e&&!e.mf_quoteLevelDelta();)e=e.parentNode;return e},Node.prototype.mf_isAtBeginningOfContainerNode=function(e){let t=e;for(;t&&t!==this;)t=t.firstChild;return!!t},Node.prototype.mf_isAtEndOfContainerNode=function(e){let t=e;for(;t&&t!==this;)t=t.lastChild;return!!t},Node.prototype.mf_nextSiblingOrAunt=function(){let e,t=this;for(;!e&&t;)(e=t.nextSibling)||(t=t.parentNode);return e},Node.prototype.mf_highestContainingBlockQuote=function(){let e,t=this.mf_containingBlockQuote();for(;t&&(e=t.parentNode.mf_containingBlockQuote());)t=e;return t},Node.prototype.mf_firstDescendantBlockQuote=function(){let e;if(this.mf_quoteLevelDelta()>0)e=this;else{let t,o=this.childNodes,n=o.length;for(t=0;!e&&t<n;t++)e=o.item(t).mf_firstDescendantBlockQuote()}return e},Node.prototype.mf_blockNodeAncestor=function(){let e=this;for(;!isBlockLevelNode(e)&&"li"!==e.nodeName.toLowerCase();)e=e.parentNode;return e},Node.prototype.mf_findElement=function(e,t,o){e=e.toLowerCase();let n,i,r;if(this instanceof HTMLDocument?(r=this,i=this.body):(r=this.ownerDocument,i=this),i){let s,f=r.createNodeIterator(i,NodeFilter.SHOW_ELEMENT);for(;!n&&(s=f.nextNode());){let i=!0;e&&!(i=i&&s.nodeName.toLowerCase()===e)||(t&&!(i=i&&s.className===t)||o&&!(i=i&&s.id===o)||i&&(n=s))}}return n};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";const blockElementNames=new Set(["HTML","BODY","BR","OL","UL","TD","TH","HR","DD","DL","DT","PRE","BLOCKQUOTE","DIV","P","TR","H1","H2","H3","H4","H5","H6"]),isBlockElementName=function(e){return blockElementNames.has(e)};Range.prototype.stringValue=function(){let e=this.text();return isBlockElementName(this.endContainer.nodeName)&&0===this.endOffset&&(e+="\n"),e},Range.prototype.mf_hoistRange=function(){let e,t=!1;for(e=this.startContainer;!t&&!e.mf_isBody()&&!e.mf_quoteLevelDelta();)t=!0,this.endContainer===e&&(this.startOffset||this.endOffset!==e.childNodes.length||(this.setStartBefore(e),this.setEndAfter(e),e=this.startContainer,t=!1))},Range.prototype.mf_firstNode=function(){let e;if(this.collapsed)return e;let t=this.startContainer,n=this.startOffset,i=!1;if(t instanceof Text)e=(i=n>0)?t.mf_traverseNextNodeStayingWithin():t;else{for(e=t.firstChild;n-- >0;)e=e.nextSibling;e||(e=t.mf_traverseNextSiblingStayingWithin())}return e&&!this.intersectsNode(e)&&(e=undefined),e},Range.prototype.mf_lastNode=function(){let e;if(this.collapsed)return e;let t=this.endContainer,n=this.endOffset,i=!1;if(t instanceof Text)e=(i=n<t.length)?t.mf_traversePreviousNode():t;else{for(e=t.firstChild;--n>0;)e=e.nextSibling;e&&this.endOffset||(e=t.mf_traversePreviousNode())}return e&&!this.intersectsNode(e)&&(e=undefined),e};const IS_BLOCK_ELEMENT_NAME=function(e){const t=["HTML","BODY","BR","LI","OL","UL","TD","TH","HR","DD","DL","DT","PRE","BLOCKQUOTE","DIV","P","TR","H1","H2","H3","H4","H5","H6"];return e&&-1!==t.indexOf(e)},isBlockLevelNode=function(e){let t=!1;return t=!!IS_BLOCK_ELEMENT_NAME(e.nodeName)};Range.prototype.mf_getBlockBoundaryParentAndNextSibling=function(e){let t,n;if(e){let e=this.mf_firstNode(),t=e&&e.mf_topmostContainingNodeWithNameInArray(HTMLDocument.mf_listElements);if(t)return{parent:t.parentNode,nextSibling:t}}else{let e=this.mf_lastNode(),t=e&&e.mf_topmostContainingNodeWithNameInArray(HTMLDocument.mf_listElements);if(t)return{parent:t.parentNode,nextSibling:t.nextSibling}}let i,s,o;if(e?(i=this.startContainer,o=this.startOffset):(i=this.endContainer,o=this.endOffset),i instanceof Text)i=(s=i).parentNode;else for(s=i.firstChild;o-- >0;s=s.nextSibling);for(e&&(s=s?s.previousSibling:i.lastChild);!t&&i;){for(;!t&&s;)isBlockLevelNode(s)?(t=i,n=e||"BR"===s.nodeName.toUpperCase()?s.nextSibling:s):s=e?s.previousSibling:s.nextSibling;s||(isOrContainsBlockLevelNode(i)?(t=i,n=e?t.firstChild:undefined):(s=i,i=i.parentNode))}return{parent:t,nextSibling:n}};const isOrContainsBlockLevelNode=function(e){let t,n=!1;if(IS_BLOCK_ELEMENT_NAME(e.nodeName))n=!0;else for(t=e.firstChild;!n&&t;)n=isOrContainsBlockLevelNode(t),t=t.nextSibling;return n};
(%{public}@) Attachment is not a PDF
(%{public}@) Data is missing
(%{public}@) Could not create PDF document from data
(%{public}@) Attached PDF has %lu pages, isLocked=%{BOOL}d
MSAttachmentItem
NSSecureCoding
NSCoding
MSRichLinkGeneration
NSObject
MSComposeBundlePageController
WKWebProcessPlugInLoadDelegate
MSBundlePageController
MSComposeBodyFieldController
MSComposeBundlePageControllerExtras
_MSComposeBundlePageControllerNSURL
JSExport
MSPDFAttachmentController
MSMailWebProcessAttachmentProxy
valueWithObject:inContext:
toString
toBool
text
stringWithUTF8String:
stringWithFormat:
setObject:forKeyedSubscript:
setLoadDelegate:
setExceptionHandler:
removeObjectAtIndex:
remoteObjectProxyWithInterface:
remoteObjectInterfaceWithProtocol:
rangeHandleWithJSValue:inContext:
pageCount
objectForKeyedSubscript:
numberWithInteger:
normalWorld
mainFrame
jsContextForWorld:
isLocked
invokeMethod:withArguments:
initWithData:
initWithBytes:length:encoding:
handleFailureInMethod:object:file:lineNumber:description:
globalObject
firstObject
exceptionWithName:reason:userInfo:
exceptionHandler
evaluateScript:withSourceURL:
encodeObject:forKey:
ef_rangeOfWebAddressContainingRange:
ef_isWebAddress
doesNotRecognizeSelector:
dictionaryWithObjects:forKeys:count:
decodeObjectOfClass:forKey:
currentThis
currentHandler
currentContext
copy
constructWithArguments:
conformsToType:
composeBodyFieldDidThrowException:
componentsSeparatedByString:
callWithArguments:
callStackSymbols
attachmentController:updateToInlineAttachment:
arrayWithObjects:count:
addObject:
UTF8String
_lp_URLWithUserTypedString:relativeToURL:
URLWithString:
_remoteObjectRegistry
init
supportsSecureCoding
encodeWithCoder:
initWithCoder:
TB,R
initWithContentID:uttype:data:additionalMarkup:
contentID
uttype
data
additionalMarkup
.cxx_destruct
_contentID
_uttype
_data
_additionalMarkup
T@"NSString",R,C,N,V_contentID
T@"UTType",R,N,V_uttype
T@"NSData",R,C,N,V_data
T@"NSString",R,C,N,V_additionalMarkup
isEqual:
class
self
performSelector:
performSelector:withObject:
performSelector:withObject:withObject:
isProxy
isKindOfClass:
isMemberOfClass:
conformsToProtocol:
respondsToSelector:
retain
release
autorelease
retainCount
zone
hash
superclass
description
debugDescription
TQ,R
T#,R
T@"NSString",R,C
createRichLinkWithURL:completionHandler:
webProcessPlugInBrowserContextController:didStartProvisionalLoadForFrame:
webProcessPlugInBrowserContextController:didReceiveServerRedirectForProvisionalLoadForFrame:
webProcessPlugInBrowserContextController:didCommitLoadForFrame:
webProcessPlugInBrowserContextController:didFinishDocumentLoadForFrame:
webProcessPlugInBrowserContextController:didFailProvisionalLoadWithErrorForFrame:error:
webProcessPlugInBrowserContextController:didFailLoadWithErrorForFrame:error:
webProcessPlugInBrowserContextController:didFinishLoadForFrame:
webProcessPlugInBrowserContextController:didSameDocumentNavigation:forFrame:
webProcessPlugInBrowserContextController:didClearWindowObjectForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:globalObjectIsAvailableForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:serviceWorkerGlobalObjectIsAvailableForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:willInjectUserScriptForFrame:inScriptWorld:
webProcessPlugInBrowserContextController:didRemoveFrameFromHierarchy:
webProcessPlugInBrowserContextController:didHandleOnloadEventsForFrame:
webProcessPlugInBrowserContextController:didLayoutForFrame:
webProcessPlugInBrowserContextController:renderingProgressDidChange:
webProcessPlugInBrowserContextController:didFirstVisuallyNonEmptyLayoutForFrame:
webProcessPlugInBrowserContextControllerRenderingProgressEvents:
webProcessPlugInBrowserContextController:frame:willSendRequestForResource:request:redirectResponse:
webProcessPlugInBrowserContextController:frame:willSendRequest:redirectResponse:
webProcessPlugInBrowserContextController:frame:didInitiateLoadForResource:request:pageIsProvisionallyLoading:
webProcessPlugInBrowserContextController:frame:didInitiateLoadForResource:request:
webProcessPlugInBrowserContextController:frame:didReceiveResponse:forResource:
webProcessPlugInBrowserContextController:frame:didFinishLoadForResource:
webProcessPlugInBrowserContextController:frame:didFailLoadForResource:error:
initWithPlugIn:contextController:
invalidate
insertRichLinkWithURL:completionHandler:
makeRichLinkFromSelection
removeRichLinkFromSelection
containsRichLinks:
stripCustomBodyIdentifiers
changeQuoteLevelBy:
observerProxy
performOnPage:
suspendPerformOnPage
resumePerformOnPage
performBodyFieldMethodOnPage:withArguments:
_linkGeneratorProxy
createRichLink:
willSendRequest:
initializeGlobalObject
initializeBodyField:
plugIn
controller
jsContext
jsBodyField
_performOnPageSuspendCount
_blocksToPerformOnPage
_jsBodyField
_plugIn
_controller
_jsContext
T@"<WKWebProcessPlugIn>",R,W,N,V_plugIn
T@"WKWebProcessPlugInBrowserContextController",R,N,V_controller
T@"JSContext",R,N,V_jsContext
T@"JSValue",R,N,V_jsBodyField
T@"<MSComposeBodyFieldObserver>",R,N
initWithString:
absoluteString
scheme
updateToInlinePDFAttachmentIfNeeded:
delegate
setDelegate:
_delegate
T@"<MSPDFAttachmentControllerDelegate>",W,N,V_delegate
B16@0:8
v24@0:8@16
@24@0:8@16
v24@0:8@"NSCoder"16
@24@0:8@"NSCoder"16
@48@0:8@16@24@32@40
@16@0:8
v16@0:8
@"NSString"
@"UTType"
@"NSData"
B24@0:8@16
#16@0:8
@24@0:8:16
@32@0:8:16@24
@40@0:8:16@24@32
B24@0:8#16
B24@0:8:16
Vv16@0:8
Q16@0:8
^{_NSZone=}16@0:8
B24@0:8@"Protocol"16
@"NSString"16@0:8
v32@0:8@16@?24
v32@0:8@"NSURL"16@?<v@?@"NSString"@"NSString">24
v32@0:8@16@24
v40@0:8@16@24@32
v40@0:8@16q24@32
v32@0:8@16Q24
Q24@0:8@16
@56@0:8@16@24Q32@40@48
v52@0:8@16@24Q32@40B48
v48@0:8@16@24Q32@40
v48@0:8@16@24@32Q40
v40@0:8@16@24Q32
v32@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24
v40@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"NSError"32
v40@0:8@"WKWebProcessPlugInBrowserContextController"16q24@"WKWebProcessPlugInFrame"32
v40@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"WKWebProcessPlugInScriptWorld"32
v32@0:8@"WKWebProcessPlugInBrowserContextController"16Q24
Q24@0:8@"WKWebProcessPlugInBrowserContextController"16
@"NSURLRequest"56@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSURLRequest"40@"NSURLResponse"48
@"NSURLRequest"48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"NSURLRequest"32@"NSURLResponse"40
v52@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSURLRequest"40B48
v48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSURLRequest"40
v48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24@"NSURLResponse"32Q40
v40@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32
v48@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInFrame"24Q32@"NSError"40
@32@0:8@16@24
@32@0:8@"<WKWebProcessPlugIn>"16@"WKWebProcessPlugInBrowserContextController"24
v24@0:8@?16
v24@0:8q16
v32@0:8@"NSURL"16@?<v@?>24
v24@0:8@?<v@?B>16
@"NSMutableArray"
@"JSValue"
@"<MSRichLinkGeneration>"
@"<WKWebProcessPlugIn>"
@"WKWebProcessPlugInBrowserContextController"
@"JSContext"
@24@0:8@"NSString"16
v24@0:8@"MSAttachmentItem"16
@"<MSPDFAttachmentControllerDelegate>"
