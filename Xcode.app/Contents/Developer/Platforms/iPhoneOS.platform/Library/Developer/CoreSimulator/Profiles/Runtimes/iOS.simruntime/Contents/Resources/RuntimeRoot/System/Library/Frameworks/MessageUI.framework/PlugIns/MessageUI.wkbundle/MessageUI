initWithPlugIn:contextController:
_setEditingDelegate:
_remoteObjectRegistry
isEqual:
class
self
performSelector:
performSelector:withObject:
performSelector:withObject:withObject:
isProxy
isKindOfClass:
isMemberOfClass:
conformsToProtocol:
respondsToSelector:
retain
release
autorelease
retainCount
zone
hash
superclass
description
debugDescription
changeQuoteLevelBy:
prependPreamble:quote:layoutDirection:
addMarkupString:quote:emptyFirst:prepended:composeType:attachmentInfoByURL:
appendOrReplace:withMarkupString:quote:composeType:attachmentInfoByURL:completionHandler:
addMailAttributesBeforeDisplayHidingTrailingEmptyQuotes:
setReplacementFilenamesByContentID:
replaceImagesIfNecessary
setFileName:forImageWithContentID:
insertAttachmentAsImage:isSinglePagePDF:completionHandler:
countDuplicatedAttachments:completionHandler:
replaceFilenamePlaceholderWithImage:completionHandler:
replaceFilenamePlaceholderWithAttachment:identifier:
removeMediaAttachment:completionHandler:
displayAttachmentWithIdentifierAsSinglePagePDF:completionHandler:
forceNextSelectionFromSecondToFirstLine
containsRichText:
plainTextContentUsingAttachmentInfoByIdentifier:completionHandler:
htmlStringUsingAttachmentInfoByIdentifier:completionHandler:
htmlStringsAttachmentURLsAndPlainTextAlternativeRemovingSignature:attachmentInfoByIdentifier:completion:
placeCaretAtStartOfBody
setDirty:completionHandler:
clearSelection
remoteObjectInterfaceWithProtocol:
setWithObjects:
setClasses:forSelector:argumentIndex:
registerExportedObject:interface:
addSignature:prepend:
updateSignature:
finalizeSignature:
removeSignature
controller
unregisterExportedObject:interface:
invalidate
initializeGlobalObject
jsContext
setObject:forKeyedSubscript:
initWithBytes:length:encoding:
stringWithUTF8String:
URLWithString:
evaluateScript:withSourceURL:
objectForKeyedSubscript:
constructWithArguments:
initializeBodyField:
plugIn
isPad
globalObject
numberWithBool:
defaultComposeFontPixelSize
dictionaryWithObjects:forKeys:count:
defineProperty:descriptor:
isNumber
toNumber
unsignedIntegerValue
charsetForEncoding:
mf_bestMimeCharsetUsingHint:
currentThis
currentContext
rangeHandleWithJSValue:inContext:
detectDataWithTypes:context:
toString
mf_isAttribution
mf_isForwardSeparator
isEqualToArray:
observerProxy
selectedAttachmentIdentifiersDidChange:
attachmentTapped:
composeBodyFieldSelectionContainsLinkStateDidChange:
valueWithBool:inContext:
toBool
_setDirty:
bundleForClass:
localizedStringForKey:value:table:
composeBodyFieldDidChange
composeBodyFieldDidThrowException:
composeBodyFieldIsDirtyChanged:
remoteObjectProxyWithInterface:
numberWithInt:
arrayWithObjects:count:
performBodyFieldMethodOnPage:withArguments:
jsBodyField
invokeMethod:withArguments:
toObject
_addMarkupString:quote:emptyFirst:prepended:composeType:attachmentInfoByURL:completionHandler:
performOnPage:
caseInsensitiveCompare:
toArray
isArray
toUInt32
initWithCapacity:
objectAtIndexedSubscript:
isString
addObject:
_performSignatureControllerMethodOnPage:withArguments:
_copyBundleRangeHandleRef
frame
normalWorld
jsRangeForRangeHandle:inWorld:
_webProcessPlugInBrowserContextController:shouldInsertText:replacingRange:givenAction:
_webProcessPlugInBrowserContextController:shouldChangeSelectedRange:toRange:affinity:stillSelecting:
_webProcessPlugInBrowserContextControllerDidChangeByEditing:
_webProcessPlugInBrowserContextController:willWriteRangeToPasteboard:
_webProcessPlugInBrowserContextController:pasteboardDataForRange:
_webProcessPlugInBrowserContextControllerDidWriteToPasteboard:
_webProcessPlugInBrowserContextController:performTwoStepDrop:atDestination:isMove:
.cxx_destruct
_bodyFieldInterface
_signatureControllerInterface
_jsSignatureController
_dirty
_shouldForceSelectionFromSecondToFirstLine
_observerProxy
_selectedAttachmentIdentifiers
charsetName
isLinebreakImpliedBeforeTagName:
isLinebreakImpliedAfterTagName:
isDisplayableImage
isImage
filename
isBasicImage
className
isObject
initWithString:charset:
init
managedValueWithValue:
value
valueWithObject:inContext:
_jsParser
nodeHandleWithJSValue:inContext:
enqueueParagraphNode:withTagName:
cacheRetainsNodes
_initWithDocument:
setTimeoutInterval:
addSubparser:
parse
willBeginParsing
shouldProceedParsing
didFinishParsing
isLandmarkTagName:
enqueueParagraphJSNode:withTagName:
flushParagraphNodes
_document
messageBodyStringAccumulatorClass
messageBodyElementClass
_copyConsumableNodesFromBodyElement:andAppendInnerTextToStringAccumulator:
parser
nodes
jsNodeForNodeHandle:inWorld:
ef_map:
setNodes:
jsNodes
setJSNodes:
quoteLevel
valueForAttributes:
retainExternally
releaseExternally
copyConsumableNodesAndAppendInnerTextToStringAccumulator:
appendRange:ofString:
appendNewline
isFull
appendRangeWithLocation:length:ofString:
appendRangeWithLocation:length:ofString:__JS_EXPORT_AS__appendRange:
isNull
parentNode
tagName
getAttribute:
dealloc
_lastUnindentedElement
set_lastUnindentedElement:
_lastUnindentedAttributionHint
set_lastUnindentedAttributionHint:
messageBodyParser:foundMessageBodyElement:
strongToStrongObjectsMapTable
parameters
valueForKey:
boolValue
doubleValue
setObject:forKey:
objectForKey:
removeObjectForKey:
webProcessPlugIn:initializeWithObject:
webProcessPlugIn:didCreateBrowserContextController:
webProcessPlugIn:willDestroyBrowserContextController:
_controller
_fieldControllersByContext
MFComposeBodyFieldController
MSComposeBodyFieldController
NSObject
MFMailSignatureController
MFComposeBodyFieldObserver
MSComposeBodyFieldObserver
ComposeBodyFieldBundleController
WKWebProcessPlugInEditingDelegate
ComposeBodyFieldBundleControllerExtras
_ComposeBodyFieldBundleControllerMFMimeCharset
JSExport
_ComposeBodyFieldBundleControllerMFMessageBodyParser
_ComposeBodyFieldBundleControllerMFComposeAttachmentInfo
MessageBodyDOMParser
MessageBodyDOMElement
_MessageBodyDOMElement
MessageBodyStringAccumulator
_MessageBodyStringAccumulator
MessageUIWebProcessBundleExtras
MFMessageBodyNode
MessageBodyDOMQuoteSubparser
MessageUIWebProcessPlugIn
WKWebProcessPlugIn
B24@0:8@16
#16@0:8
@16@0:8
@24@0:8:16
@32@0:8:16@24
@40@0:8:16@24@32
B16@0:8
B24@0:8#16
B24@0:8:16
Vv16@0:8
Q16@0:8
^{_NSZone=}16@0:8
B24@0:8@"Protocol"16
@"NSString"16@0:8
v24@0:8q16
v36@0:8@16B24q28
v48@0:8@16B24B28B32i36@40
v56@0:8@16@24B32i36@40@?48
v20@0:8B16
v24@0:8@16
v16@0:8
v32@0:8@16@24
v32@0:8B16B20@?24
v32@0:8@16@?24
v24@0:8@?16
v36@0:8B16@20@?28
v28@0:8B16@?20
v36@0:8@"NSString"16B24q28
v48@0:8@"NSString"16B24B28B32i36@"NSDictionary"40
v56@0:8@"NSString"16@"NSString"24B32i36@"NSDictionary"40@?<v@?@"NSDictionary">48
v24@0:8@"NSDictionary"16
v32@0:8@"NSString"16@"NSString"24
v32@0:8B16B20@?<v@?@"NSString">24
v32@0:8@"NSString"16@?<v@?@"NSNumber">24
v32@0:8@"NSString"16@?<v@?@"NSString">24
v32@0:8@"NSString"16@?<v@?>24
v24@0:8@?<v@?B>16
v32@0:8@"NSDictionary"16@?<v@?@"NSArray">24
v32@0:8@"NSDictionary"16@?<v@?@"NSString">24
v36@0:8B16@"NSDictionary"20@?<v@?@"ECHTMLStringAndMIMECharset"@"NSArray"@"NSArray">28
v28@0:8B16@?<v@?>20
v28@0:8@16B24
v28@0:8@"NSString"16B24
v24@0:8@"NSString"16
v24@0:8@?<v@?>16
v24@0:8@"NSException"16
v24@0:8@"NSArray"16
B48@0:8@16@24@32q40
B52@0:8@16@24@32q40B48
@32@0:8@16@24
B44@0:8@16@24@32B40
B48@0:8@"WKWebProcessPlugInBrowserContextController"16@"NSString"24@"WKWebProcessPlugInRangeHandle"32q40
B52@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKDOMRange"24@"WKDOMRange"32q40B48
v24@0:8@"WKWebProcessPlugInBrowserContextController"16
v32@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInRangeHandle"24
@"NSDictionary"32@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInRangeHandle"24
B44@0:8@"WKWebProcessPlugInBrowserContextController"16@"WKWebProcessPlugInNodeHandle"24@"WKWebProcessPlugInRangeHandle"32B40
v56@0:8@16B24B28B32i36@40@?48
@"_WKRemoteObjectInterface"
@"JSValue"
@"<MFComposeBodyFieldObserver>"
@"NSArray"
B24@0:8@"NSString"16
@"NSURL"16@0:8
@24@0:8@16
v24@0:8d16
@24@0:8@"JSValue"16
v24@0:8@"MFMessageBodySubparser"16
v32@0:8@"JSValue"16@"NSString"24
@"JSValue"16@0:8
@"JSManagedValue"
i20@0:8i16
@"NSArray"16@0:8
v24@0:8@"JSValue"16
@"<MFMessageBodyElement_Private>"16@0:8
v40@0:8Q16Q24@32
v48@0:8Q16Q24@32@40
v40@0:8Q16Q24@"NSString"32
v48@0:8Q16Q24@"NSString"32@40
@"<MFMessageBodyNode>"16@0:8
@"NSString"24@0:8@"NSString"16
v24@0:8@"<MFMessageBodyElement_Private>"16
@"<MFMessageBodyElement_Private>"
v32@0:8@"WKWebProcessPlugInController"16@24
v32@0:8@"WKWebProcessPlugInController"16@"WKWebProcessPlugInBrowserContextController"24
d16@0:8
@"WKWebProcessPlugInController"
@"NSMapTable"
hash
TQ,R
superclass
T#,R
description
T@"NSString",R,C
debugDescription
MFMessageBodyParser
MessageBodyDOMParser
MessageBodyDOMQuoteSubparser
BodyField.js
Constants.js
ElementExtras.js
HTMLBodyElementExtras.js
HTMLDocumentExtras.js
HTMLElementExtras.js
HTMLImageElementExtras.js
MessageBodyDOMParser.js
MessageBodyDOMQuoteSubparser.js
NodeExtras.js
RangeExtras.js
SignatureController.js
BodyFieldIOS
SignatureController
B8@?0
IS_PAD
@"NSURL"16@?0@"NSString"8
MFCreateURLForContentID
defaultComposeFontPixelSize
d8@?0
@"MFMimeCharset"24@?0@"NSString"8@"JSValue"16
charsetForString
Range
prototype
@"NSArray"8@?0
linkify
String
mf_isAttribution
mf_isForwardSeparator
v16@?0@"NSArray"8
_selectedAttachmentIdentifiersDidChange
v16@?0@"NSString"8
_attachmentWasTapped
v12@?0B8
_selectionContainsLinkStateDidChange
_dirty
@"JSValue"8@?0
v16@?0@"JSValue"8
ACCESSIBILITY_BODY_LABEL
Localizable
_localizedAccessibilityLabel
prependPreamble
addMarkupString
v8@?0
bodyInnerHTML
addMailAttributesBeforeDisplay
_replacementFilenamesByContentID
replaceImagesIfNecessary
containsRichText
plainTextContent
htmlString
htmlStringsAttachmentURLsEncodingsAndPlainTextAlternative
topLevelHTMLString
otherHTMLStringsAndAttachmentURLs
length
stringsAndQuoteLevels
placeCaretAtStartOfBody
setFileNameForImageWithContentID
insertAttachment
countDuplicatedAttachments
replaceFilenamePlaceholderWithImage
replaceFilenamePlaceholderWithAttachment
removeMediaAttachment
displayAttachmentWithIdentifierAsSinglePagePDF
clearSelection
addSignature
updateSignature
finalizeSignature
removeSignature
shouldChangeSelectedRange
plugIn
T@"MessageUIWebProcessPlugIn",R,W,D,N
observerProxy
T@"<MFComposeBodyFieldObserver>",R,N
T@"NSURL",R,N
filename
T@"NSString",R,N
isBasicImage
TB,R,N
isImage
className
string
charset
parse
copyConsumableNodesAndAppendInnerTextToStringAccumulator
_document
T@"JSValue",R,N
@"JSValue"16@?0@"WKWebProcessPlugInNodeHandle"8
parentNode
tagName
getAttribute
T@"<MFMessageBodyNode>",R
T@"NSString",R
messageBodyParserFoundMessageBodyElement
_lastUnindentedElement
T@"<MFMessageBodyElement_Private>",&
_lastUnindentedAttributionHint
T@"<MFMessageBodyElement_Private>",&,V_lastUnindentedElement
T@"<MFMessageBodyElement_Private>",&,V_lastUnindentedAttributionHint
isPad
Td,R,N
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Object.defineProperty(this,"BodyFieldIOS",{value:function(){BodyField.call(this),this._blockquote=null,this._needsReplaceImages=!1,this._selectionContainsLink=!1,addEventListener("load",()=>{document.body.setAttribute("role","textbox"),document.body.ariaLabel=this._localizedAccessibilityLabel,document.addEventListener("selectionchange",()=>{let e=getSelection();if(!e.rangeCount||!e.isCollapsed||document.queryCommandEnabled("InsertText"))return;let t=e.getRangeAt(0);e.setPosition(t.startContainer,t.startOffset)})})}}),BodyFieldIOS.prototype=Object.create(BodyField.prototype),BodyFieldIOS.prototype.constructor=BodyField,BodyFieldIOS.prototype._addNode=function(e,t,n,i){if(t){let t=document.createElement("blockquote");t.setAttribute("type","cite"),t.appendChild(e),e=t,this._blockquote=e}let o=document.body;if(n){let n;for(;n=o.firstChild;)o.removeChild(n);o.appendChild(e),t||(this._blockquote=null)}else if(i){let t=o.firstChild;t?o.insertBefore(e,t):o.appendChild(e)}else o.appendChild(e);let r=window.getSelection();r.isCollapsed||r.setBaseAndExtent(o,0,o,1),this._needsReplaceImages=!0},BodyFieldIOS.prototype._replaceImages=function(){if(this._needsReplaceImages=!1,!this._replacementFilenamesByContentID)return;let e,t=document.createNodeIterator(document.body,NodeFilter.SHOW_ALL);for(;e=t.nextNode();){let t="";if(e instanceof HTMLImageElement?t=e.src:e instanceof HTMLAttachmentElement&&(t=e.getAttribute("src")),t&&t.startsWith(MFContentIDScheme)){let n=t.substring(4),i=this._replacementFilenamesByContentID[n];if(i){let t=document.createElement("div");t.textContent=`<${i}>`,e.replaceWith(t)}}}},BodyFieldIOS.prototype.replaceImagesIfNecessary=function(){this._needsReplaceImages&&this._replaceImages()},BodyFieldIOS.prototype.prependPreamble=function(e,t,n){let i=document.createElement("div");i.appendChild(document.createElement("br"));let o=i;t&&((o=document.createElement("blockquote")).setAttribute("type","cite"),i.appendChild(o));let r=e.match(/(^\n*)([^]*[^\n])(\n*$)/);if(r){let{1:e,2:t,3:n}=r;for(let t=0;t<e.length;++t)o.appendChild(document.createElement("br"));o.appendChild(document.createTextNode(t));for(let e=0;e<n.length;++e)o.appendChild(document.createElement("br"))}i.dir=n?"ltr":"rtl",this._addNode(i,!1,!1,!0)},BodyFieldIOS.prototype.addMarkupString=function(e,t,n,i,o,r){let a={};if(!e.length)return a;let l=document.createElement("div");l.innerHTML=e;let d;o&&(l.mf_stripCSSStyle(),d=((e,t)=>e.className=t.className)),this._addNode(l,t,n,i),l.mf_setDirAttributeToComputedValue();for(let e of l.querySelectorAll("attachment"))a[e.uniqueIdentifier]=e.id,e.removeAttribute("id");let c=this.convertInternalImagesToAttachments(l,r,d);Object.assign(c,this.convertObjectElementsToAttachmentElements(l,r));for(let e in c)a[e]=c[e].absoluteString().substring(4);return a},BodyFieldIOS.prototype.addMailAttributesBeforeDisplay=function(e){let t=new MessageBodyDOMParser(document),n=new MessageBodyDOMQuoteSubparser;t.setTimeoutInterval(5);let i=!1;n.foundDedentedAttributionRangeHandler=function(e){let t=document.createElement("blockquote");t.setAttribute("type","cite"),t.setAttribute("x-apple-mail",MFHtmlTemporaryPresentationElement),e.surroundContents(t),i=!0},e&&(n.foundTrailingEmptyQuoteRangeHandler=function(e){let t=document.createElement("div");t.style.display="none",t.setAttribute("x-apple-mail",MFHtmlTemporaryPresentationElement),e.surroundContents(t),i=!0}),t.addSubparser(n),t.parse()},BodyFieldIOS.prototype.containsRichText=function(){return document.body.mf_containsRichText()},BodyFieldIOS.prototype.plainTextContent=function(e){return MFCreatePlainTextRepresentationFromDOMDocument(document,t=>t instanceof HTMLAttachmentElement?e[t.uniqueIdentifier].url:t instanceof HTMLImageElement&&t.attachmentIdentifier?e[t.attachmentIdentifier].url:null)},BodyFieldIOS.prototype.htmlString=function(e){let t=new Set;for(let e of document.body.querySelectorAll("attachment, img:has-attachment"))e instanceof HTMLImageElement?e.dataset.uniqueIdentifier=e.attachmentIdentifier:e.dataset.uniqueIdentifier=e.uniqueIdentifier,t.add(e.dataset.uniqueIdentifier);let n=document.body.cloneNode(!0);for(let i of n.querySelectorAll("attachment[data-unique-identifier], img[data-unique-identifier]")){let n=i.dataset.uniqueIdentifier,o=e[n];t.has(n)&&o&&(i instanceof HTMLImageElement?i.src=e[n].url.absoluteString():i.id=e[n].url.absoluteString().substring(4)),delete i.dataset.uniqueIdentifier}for(let e of document.body.querySelectorAll("attachment[data-unique-identifier], img[data-unique-identifier]"))delete e.dataset.uniqueIdentifier;return n.innerHTML},BodyFieldIOS.prototype.bodyInnerHTML=function(){return document.body.innerHTML},BodyFieldIOS.prototype.htmlStringsAttachmentURLsEncodingsAndPlainTextAlternative=function(e,t){let n=null;if(e){let e=new SignatureController;(n=e.currentSignature())&&e.updateSignature("")}let i=MFCreateHTMLFragmentsAndAttachmentsFromDOMDocument(document,t),o=MFCreatePlainTextRepresentationFromDOMDocument(document);return e&&n&&(new SignatureController).updateSignature(n),1===o.length&&(i.stringsAndQuoteLevels=o[0]),i},BodyFieldIOS.prototype.placeCaretAtStartOfBody=function(){getSelection().setPosition(document.body,0)},BodyFieldIOS.prototype.setFileNameForImageWithContentID=function(e,t){let n=document.querySelector('img[src="cid:'+t+'"]');n&&(n.className=kMFComposeImageAttachmentClass,n.id=t,n.alt=e)},BodyFieldIOS.prototype.countDuplicatedAttachments=function(e){return Array.from(document.querySelectorAll("div")).filter(t=>t.innerText==`<${e}>`&&0==t.childElementCount).length},BodyFieldIOS.prototype.replaceFilenamePlaceholderWithAttachment=function(e,t){let n=Array.from(document.querySelectorAll("div")).filter(t=>t.innerText==`<${e}>`&&0==t.childElementCount)[0];if(n)for(let e of document.querySelectorAll("attachment"))if(e.uniqueIdentifier==t){n.replaceWith(e);break}},BodyFieldIOS.prototype.replaceFilenamePlaceholderWithImage=function(e){let t=document.createElement("img");t.className=kMFComposeImageAttachmentClass;let n=Array.from(document.querySelectorAll("div")).filter(t=>t.innerText==`<${e}>`&&0==t.childElementCount)[0];return n?(n.replaceWith(t),HTMLAttachmentElement.getAttachmentIdentifier(t)):null},BodyFieldIOS.prototype.insertAttachment=function(e,t){t&&(e=!0);let n=e?"img":"attachment",i=document.createElement(n);e&&(i.className=t?kMFComposeSinglePagePDFClass:kMFComposeImageAttachmentClass);let o=window.getSelection();o.rangeCount||o.addRange(document.createRange());let r=o.getRangeAt(0),a=this.insertTemporarySelectionMarkersForRange(r);return this.insertNodeWithParentAndNextSibling(i,a.parentNode,a),r.setStartBefore(a),r.setEndAfter(this.temporaryEndingSelectionMarker()),this.deleteRange(r),r.setStartAfter(i),r.setEndAfter(i),o.empty(),o.addRange(r),e?HTMLAttachmentElement.getAttachmentIdentifier(i):i.uniqueIdentifier},BodyFieldIOS.prototype.removeMediaAttachment=function(e){let t=this._attachmentNodeByIdentifier(e),n=document.createRange();n.setStartBefore(t),n.setEndAfter(t),this.deleteRange(n)},BodyFieldIOS.prototype.displayAttachmentWithIdentifierAsSinglePagePDF=function(e){let t=Array.prototype.find.call(document.querySelectorAll("attachment"),t=>t.uniqueIdentifier===e),n=document.createElement("img");return n.className=kMFComposeSinglePagePDFClass,t.replaceWith(n),HTMLAttachmentElement.getAttachmentIdentifier(n)},BodyFieldIOS.prototype._updateLinkInSelection=function(e){let t=e.toString().ef_isWebAddress();this._selectionContainsLink!==t&&(this._selectionContainsLink=t,this._selectionContainsLinkStateDidChange(t))},BodyFieldIOS.prototype._attachmentNodeByIdentifier=function(e){let t=document.querySelectorAll("img,attachment"),n=null;for(let i of t)if((i instanceof HTMLAttachmentElement?i.uniqueIdentifier:i.attachmentIdentifier)===e){n=i;break}return n},BodyFieldIOS.prototype._updateAttachmentURLsInSelection=function(e){let t=[],n=document.querySelectorAll("img,attachment");for(let i of n)if(e.compareNode(i)===Range.NODE_INSIDE){let e=i instanceof HTMLAttachmentElement?i.uniqueIdentifier:i.attachmentIdentifier;e&&t.push(e)}for(let i of n){let n=document.createRange();if(n.selectNode(i),0===n.compareBoundaryPoints(Range.START_TO_START,e)||0===n.compareBoundaryPoints(Range.START_TO_END,e)){let e=i instanceof HTMLAttachmentElement?i.uniqueIdentifier:i.attachmentIdentifier;e&&t.push(e)}}this._selectedAttachmentIdentifiersDidChange(t)},BodyFieldIOS.prototype.shouldChangeSelectedRange=function(e,t){let n=!0;if(t){let t=document.body.firstElementChild,i=t&&t.firstElementChild,o=i&&i.nextElementSibling;if(t&&"DIV"===t.tagName&&i&&"BR"===i.tagName&&o&&"BR"===o.tagName&&e.startContainer===t&&e.endContainer===t&&1===e.startOffset&&1===e.startOffset){e.setStartBefore(i),e.setEndBefore(i);let t=getSelection();t.empty(),t.addRange(e),n=!1}}return this._updateAttachmentURLsInSelection(e),this._updateLinkInSelection(e),n},BodyFieldIOS.prototype.clearSelection=function(){document.getSelection().empty()};const attachmentInfoForNode=function(e,t){let n;return e instanceof HTMLAttachmentElement?n=e.uniqueIdentifier:e instanceof HTMLImageElement&&(n=e.attachmentIdentifier),n?t[n]:undefined},attachmentForNode=function(e,t){let n=attachmentInfoForNode(e,t);return n?n.url.absoluteString():null},MFCreateHTMLFragmentsAndAttachmentsFromDOMDocument=function(e,t){let n=e.body,i=e.createRange();i.setStartBefore(n);let o,r,a=NSUTF8StringEncoding,l=!1,d=n;for(;d;){let n=attachmentInfoForNode(d,t);if(n){a=undefined;let c=!1;if(l||n.isBasicImage&&(r||(r=[]),r.push(d),c=!0),!c){if(l=!0,o||(o=[]),r){for(let n of r){i.setEndBefore(n);const r=_copyHtmlStringFromRange(e,i,a,!1,!1,!0,!0);r&&o.push(r);let l=attachmentForNode(n,t);o.push(l),i.setStartAfter(n)}r=null}i.setEndBefore(d);const c=_copyHtmlStringFromRange(e,i,a,!1,!1,!0,!0);c&&o.push(c),o.push(n.url.absoluteString()),i.setStartAfter(d)}}let c=d.firstChild;for(;!c&&d;)(c=d.nextSibling)||(c=(d=d.parentNode)&&d.nextSibling);d=c}i.setEndAfter(n);let c=new Set;for(let t of e.querySelectorAll("attachment, img"))t instanceof HTMLImageElement?t.dataset.uniqueIdentifier=t.attachmentIdentifier:t.dataset.uniqueIdentifier=t.uniqueIdentifier,c.add(t.dataset.uniqueIdentifier);const u=_copyHtmlStringFromRange(e,i,a,!1,!1,!0,!0,n=>{let i=n.dataset.uniqueIdentifier;if(i&&c.has(i)){delete n.dataset.uniqueIdentifier;let o=t[i];if(n instanceof HTMLImageElement)n.src=o.url.absoluteString();else if(null==o){let t=n.getAttribute("title");if(t){let i=e.createElement("div");i.textContent=`<${t}>`,n.replaceWith(i)}}}});for(let t of e.querySelectorAll("attachment[data-unique-identifier], img[data-unique-identifier]"))delete t.dataset.uniqueIdentifier;let s;if(!r&&o&&o.length)s=undefined,u&&o.push(u);else if(s=u,r){o||(o=[]);for(let e of r){let n=attachmentForNode(e,t);o.push(n)}}return{topLevelHTMLString:s,otherHTMLStringsAndAttachmentURLs:o}};BodyFieldIOS.prototype.replacePlaceholderWithAttachment=function(e,t){let n;if(t.isImage){let i=document.createElement("img");i.className=t.className,e.replaceWith(i),n=HTMLAttachmentElement.getAttachmentIdentifier(i)}else{let t=document.createElement("attachment");e.replaceWith(t),n=t.uniqueIdentifier}return n};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";const MFAttachmentAttributeContentIDKey="id",MFAttributeOriginalWidth="X-APPLE-ORIGINAL-WIDTH",MFAttributeOriginalHeight="X-APPLE-ORIGINAL-HEIGHT",MFMailSignatureAttribute="AppleMailSignature",kMFComposeFileAttachmentClass="Apple-mail-fileattach",kMFComposeImageAttachmentClass="Apple-mail-imageattach",kMFComposeSinglePagePDFClass="Apple-mail-pdf";
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Element.prototype.mf_stripCSSStyle=function(){for(let t of this.querySelectorAll("style[type='text/css']"))t.parentNode.removeChild(t)},Element.prototype.mf_setDirAttributeToComputedValue=function(){this.setAttribute("dir","auto");let t=getComputedStyle(this).direction;"ltr"===t||"rtl"===t?this.setAttribute("dir",t):this.removeAttribute("dir")};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";HTMLBodyElement.prototype.recursivelyRemoveMailAttributes=function(){this.removeAttribute("aria-label"),this.removeAttribute("role"),Object.getPrototypeOf(HTMLBodyElement).prototype.recursivelyRemoveMailAttributes.call(this)};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";const _MFIsComposeAttachmentClassName=function(t){return t===kMFComposeImageAttachmentClass||t===kMFComposeFileAttachmentClass||t==kMFComposeSinglePagePDFClass};HTMLElement.prototype.recursivelyRemoveMailAttributes=function(){if(_MFIsComposeAttachmentClassName(this.getAttribute("CLASS"))&&this.removeAttribute("CLASS"),Object.getPrototypeOf(HTMLElement).prototype.recursivelyRemoveMailAttributes.call(this),MFHtmlTemporaryPresentationElement===this.getAttribute("x-apple-mail")&&null!=this.parentElement){let t=this.firstChild;for(;t;){let e=t.nextSibling;this.parentElement.insertBefore(t,this),t=e}this.parentElement.removeChild(this)}};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";HTMLImageElement.prototype.mf_unconstrainImageSize=function(){if(this.hasAttribute(MFAttributeOriginalWidth)){let t=this.getAttribute(MFAttributeOriginalWidth);""===t?(this.removeAttribute("WIDTH"),this.style.removeProperty("width"),this.style.removeProperty("max-width")):this.width=t}if(this.hasAttribute(MFAttributeOriginalHeight)){let t=this.getAttribute(MFAttributeOriginalHeight);""===t?(this.removeAttribute("HEIGHT"),this.style.removeProperty("height"),this.style.removeProperty("max-height")):this.height=t}this.removeAttribute(MFAttributeOriginalWidth),this.removeAttribute(MFAttributeOriginalHeight)},HTMLImageElement.prototype.recursivelyRemoveMailAttributes=function(){_MFIsComposeAttachmentClassName(this.getAttribute("CLASS"))&&this.mf_unconstrainImageSize(),Object.getPrototypeOf(HTMLImageElement).prototype.recursivelyRemoveMailAttributes.call(this)};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";MessageBodyDOMParser.prototype.enqueueParagraphNode=function(e,t){this.enqueueParagraphJSNodeWithTagName(e,t)},MessageBodyDOMParser.prototype._consumeAccumulatedNodes=function(e){for(let t of e)this.enqueueParagraphNode(t,t.tagName);this.flushParagraphNodes()},MessageBodyDOMParser.prototype.parse=function(){let e=this._document.body,t=[],s=[],n=e,o=0,a=o;for(this.willBeginParsing();n&&this.shouldProceedParsing();){let r=null,i=o;if(n.hasChildNodes())r=n.firstChild,i++,s=[],t.push(s);else if(s.push(n),!(r=n.nextSibling)){let o=n;for(;!(r=o.nextSibling)&&(o=o.parentNode)&&o!==e;){let e=--i>=a;if(!e){for(let e of t)this._consumeAccumulatedNodes(e),e.length=0;a=-1}t.pop(),s=t[t.length-1],e&&s.push(o)}}if(n=r,o=i,n instanceof Element){let e=n.tagName;if(this.isLandmarkTagName(e)){a=o;for(let e of t)this._consumeAccumulatedNodes(e),e.length=0}}}for(let e of t)this._consumeAccumulatedNodes(e);return this.didFinishParsing(),!0},MessageBodyDOMParser.prototype.copyConsumableNodesAndAppendInnerTextToStringAccumulator=function(e,t){for(let s of e.jsNodes()){let e=null,n=null;if(s instanceof Element){let t=s;n=t.mf_isAttachment()?"\xa0":t.innerText,e=t.tagName}else s instanceof Text&&(n=s.data);if(MFMessageBodyParser.isLinebreakImpliedBeforeTagName(e)&&t.appendNewline(),n&&t.appendRange(0,n.length,n),MFMessageBodyParser.isLinebreakImpliedAfterTagName(e)&&t.appendNewline(),t.isFull())break}return null},MessageBodyDOMParser.prototype.rangeForElement=function(e){let t=this._document.createRange(),s=e.jsNodes();return t.setStartBefore(s[0]),t.setEndAfter(s[s.length-1]),t},MessageBodyDOMParser.prototype.extendRangeToElement=function(e,t){let s=t.jsNodes();e.setEndAfter(s[s.length-1])},MessageBodyDOMParser.prototype.rangeFromElementToElement=function(e,t){let s=this._document.createRange();s.setStartBefore(e.jsNodes()[0]);let n=t.jsNodes();return s.setEndAfter(n[n.length-1]),s};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";MessageBodyDOMQuoteSubparser.prototype.AttributeEmpty=1,MessageBodyDOMQuoteSubparser.prototype.AttributeWhitespace=4,MessageBodyDOMQuoteSubparser.prototype.AttributeAttribution=8,MessageBodyDOMQuoteSubparser.prototype.AttributeAttributionPrefix=128,MessageBodyDOMQuoteSubparser.prototype.doesRangeContainAnyElementWithTagName=function(t,e){let n=!1,i=t.commonAncestorContainer;if(i instanceof Element){let s=i.getElementsByTagName(e),r=s.length;for(let e=0;e<r;e++)if(t.intersectsNode(s.item(e))){n=!0;break}}return n},MessageBodyDOMQuoteSubparser.prototype._enumerateSurroundableRangesInRange=function(t,e){let n=t.startContainer,i=t.endContainer;if(n===i)e(t);else{let s=t.commonAncestorContainer,r=t.cloneRange(),o=n.mf_childNodeAtIndex(t.startOffset),a=!0;for(;n!==s;)a?r.setStartBefore(o):r.setStartAfter(o),r.setEndAfter(o.mf_lastSibling()),e(r),n=(o=n).parentNode,a=!1;let d=i.mf_childNodeAtIndex(t.endOffset-1),l=!0;for(;i!==s;)l?r.setEndAfter(d):r.setEndBefore(d),r.setStartBefore(d.mf_firstSibling()),e(r),i=(d=i).parentNode,l=!1;a?r.setStartBefore(o):r.setStartAfter(o),l?r.setEndAfter(d):r.setEndBefore(d),e(r)}},MessageBodyDOMQuoteSubparser.prototype.messageBodyParserFoundMessageBodyElement=function(t,e){if(this.foundDedentedAttributionRangeHandler){const n=2;if(this._unindentedSiblingNodes||(this._unindentedSiblingNodes=[]),this._lastUnindentedAttributionHint&&e.quoteLevel()===this._lastUnindentedElement.quoteLevel()+1&&(this._lastUnindentedAttributionHint.setJSNodes(this._lastUnindentedAttributionHint.jsNodes().concat(this._unindentedSiblingNodes)),this._lastUnindentedAttributionHint.valueForAttributes(this.AttributeAttribution))){let e=t.rangeFromElementToElement(this._lastUnindentedAttributionHint,this._lastUnindentedElement);this._enumerateSurroundableRangesInRange(e,t=>{this.foundDedentedAttributionRangeHandler(t)}),this._lastUnindentedAttributionHint&&this._lastUnindentedAttributionHint.releaseExternally(),this._lastUnindentedAttributionHint=undefined,this._unindentedSiblingGap=0,this._unindentedSiblingNodes.length=0}if(e.valueForAttributes(this.AttributeAttributionPrefix)){this._lastUnindentedAttributionHint&&this._lastUnindentedAttributionHint.releaseExternally(),this._lastUnindentedAttributionHint=e.retainExternally();for(let t of e.jsNodes())this._unindentedSiblingNodes.push(t)}else if(this._lastUnindentedAttributionHint)if(this._unindentedSiblingGap>n)this._lastUnindentedAttributionHint&&this._lastUnindentedAttributionHint.releaseExternally(),this._lastUnindentedAttributionHint=undefined,this._unindentedSiblingGap=0,this._unindentedSiblingNodes.length=0;else{for(let t of e.jsNodes())this._unindentedSiblingNodes.push(t);this._unindentedSiblingGap++}this._lastUnindentedElement&&this._lastUnindentedElement.releaseExternally(),this._lastUnindentedElement=e.retainExternally()}if(this.foundTrailingEmptyQuoteRangeHandler){if(this._trailingEmptyQuoteRange){let n=!1;e.quoteLevel()<this._trailingEmptyQuoteLevel?this.doesRangeContainAnyElementWithTagName(this._trailingEmptyQuoteRange,"img")||this._enumerateSurroundableRangesInRange(this._trailingEmptyQuoteRange,t=>{this.foundTrailingEmptyQuoteRangeHandler(t)}):e.quoteLevel()===this._trailingEmptyQuoteLevel&&0!==e.valueForAttributes(this.AttributeEmpty|this.AttributeWhitespace)&&(n=!0),n?t.extendRangeToElement(this._trailingEmptyQuoteRange,e):this._trailingEmptyQuoteRange=null}!this._trailingEmptyQuoteRange&&e.quoteLevel()>0&&0!==e.valueForAttributes(this.AttributeEmpty|this.AttributeWhitespace)&&(this._trailingEmptyQuoteRange=t.rangeForElement(e),this._trailingEmptyQuoteLevel=e.quoteLevel())}};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Node.prototype.mf_isAttachment=function(){let t=!1;if(this instanceof Element){let e=this;"wrapper"===e.getAttribute("x-apple-mail")?t=!0:IS_PAD()&&"ATTACHMENT"===e.tagName&&(t=!0)}return t},Node.prototype.mf_childNodeAtIndex=function(t){let e=this.firstChild;for(;e&&t>0;)e=e.nextSibling,t--;return e},Node.prototype.mf_firstSibling=function(){let t=this,e=null;for(;e=t.previousSibling;)t=e;return t},Node.prototype.mf_lastSibling=function(){let t=this,e=null;for(;e=t.nextSibling;)t=e;return t},Node.prototype.recursivelyRemoveMailAttributes=function(){let t=this.firstChild;for(;t;){let e=t.nextSibling;t.recursivelyRemoveMailAttributes(),t=e}};
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";
 * Copyright (c) <%= Time.now.strftime(fmt="%Y") %> Apple Inc. All rights reserved.
"use strict";Object.defineProperty(this,"SignatureController",{value:function(){}}),SignatureController.prototype={constructor:SignatureController,_isDraftRestore:function(e){return"<div><span></span></div>"===e.body.innerHTML},_locateSignatureDiv:function(e){let t=e.body.querySelectorAll(`div[id="${MFMailSignatureAttribute}"]`);for(let e=0;e<t.length;++e){let i=t.item(e);if(!i.mf_isQuoteOrWithinQuote())return i}return null},_handleSignatureModified:function(e){let t=e.currentTarget;t.removeEventListener("DOMCharacterDataModified",this._handleSignatureModified),t.removeEventListener("DOMSubtreeModified",this._handleSignatureModified),t.removeAttribute("id");let i=t.firstChild;for(;i;){let e=i.nextSibling;i.nodeType===Node.COMMENT_NODE&&t.removeChild(i),i=e}},_updateToSignature:function(e,t){if(null===e||!t)return!1;let i=!1,n=`<!-- signature placeholder open -->${e}<!-- signature placeholder close -->`,r=this._locateSignatureDiv(t);if(r){let e=r;do{e.removeEventListener("DOMCharacterDataModified",this._handleSignatureModified),e.removeEventListener("DOMSubtreeModified",this._handleSignatureModified),e.removeAttribute("id"),e=this._locateSignatureDiv(t)}while(e);let a=r.innerHTML;a.match(/<!-- signature open -->.*?<!-- signature close -->/g)&&(r.innerHTML=a.replace(/<!-- signature open -->.*?<!-- signature close -->/g,n),r.id=MFMailSignatureAttribute,i=!0)}if(!i){let e=`<div id='${MFMailSignatureAttribute}'>${n}</div>`,r=t.body.innerHTML;r.match(/<!-- signature open -->.*?<!-- signature close -->/g)&&(t.body.innerHTML=r.replace(/<!-- signature open -->.*?<!-- signature close -->/g,e),i=!0)}let a=t.body.innerHTML;if(a.match(/<!-- signature [a-z]{4,5} -->/g)&&(t.body.innerHTML=a.replace(/<!-- signature [a-z]{4,5} -->/g,"")),i){let e=this._locateSignatureDiv(t),i=e.innerHTML;i.match(/<!-- signature placeholder /g)&&(e.innerHTML=i.replace(/<!-- signature placeholder /g,"<!-- signature ")),e.mf_setDirAttributeToComputedValue(),e.addEventListener("DOMCharacterDataModified",this._handleSignatureModified),e.addEventListener("DOMSubtreeModified",this._handleSignatureModified)}return i},_createSignatureElement:function(e,t,i,n){i=i||e.body.firstChild;let r=e.createElement("div");if(r.id=MFMailSignatureAttribute,t?i&&i.parentNode.insertBefore(r,i):e.body.appendChild(r),n){let t=`<!-- signature open -->${n}<!-- signature close -->`;r.innerHTML=t;let i=r.parentElement;i&&(i.insertBefore(e.createElement("BR"),r),i.insertBefore(e.createElement("BR"),r))}return r.mf_setDirAttributeToComputedValue(),r.addEventListener("DOMCharacterDataModified",this._handleSignatureModified),r.addEventListener("DOMSubtreeModified",this._handleSignatureModified),r},_createSignature:function(e,t,i,n){let r=this._locateSignatureDiv(t);return r||(r=this._createSignatureElement(t,i,n,e)),r},_prependSignature:function(e,t,i){let n;for(;i;){if(i instanceof HTMLElement){let r=i.innerText;(r.mf_isAttribution()||r.mf_isForwardSeparator())&&(n=this._createSignature(e,t,!0,i))}i=i.previousSibling}return n},currentSignature:function(){let e=null,t=this._locateSignatureDiv(document);if(t){let i=t.innerHTML.match(/<!-- signature open -->(.*?)<!-- signature close -->/);i&&2===i.length?e=i[1]:(i=document.body.innerHTML.match(/<!-- signature open -->(.*?)<!-- signature close -->/))&&2===i.length&&(e=i[1])}return e},addSignature:function(e,t){let i=this._locateSignatureDiv(document);document&&!i&&this._createSignature(e,document,t,null)},updateSignature:function(e){if(this._isDraftRestore(document))return;let t=!1,i=document.body.lastChild;i||(t=!0);let n=document.getElementsByTagName("blockquote");n.length&&(t=!0),this._updateToSignature(e,document)||(t?(i=n.item(0)||i)&&this._prependSignature(e,document,i)&&getSelection().setPosition(document.body,0):this._createSignature(e,document,!1,null))},finalizeSignature:function(){let e=this._locateSignatureDiv(document);e&&e.removeEventListener("DOMCharacterDataModified",this._handleSignatureModified),e&&e.removeEventListener("DOMSubtreeModified",this._handleSignatureModified);const t=document.createTreeWalker(document.body,NodeFilter.SHOW_COMMENT,{acceptNode:e=>e.textContent.match(/^ signature [a-z]{4,5} $/)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}),i=[];for(;t.nextNode();)i.push(t.currentNode);for(const e of i)e.remove();e&&e.removeAttribute("id")},removeSignature:function(){this._updateToSignature("",document)}};
