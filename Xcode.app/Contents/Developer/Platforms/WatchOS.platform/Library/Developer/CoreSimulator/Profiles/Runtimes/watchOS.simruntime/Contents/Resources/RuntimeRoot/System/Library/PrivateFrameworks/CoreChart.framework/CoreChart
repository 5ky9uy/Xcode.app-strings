@(#)PROGRAM:CoreChart  PROJECT:CoreChart-1
v8@?0
com.apple.CoreChart
renderer
strokeOffset
items
size
cornerRadius
width
angle
height
opacity
zindex
strokeMiterLimit
fillOpacity
strokeOpacity
strokeWidth
radius
theta
fontSize
interpolate
orient
path
strokeCap
strokeJoin
shape
baseline
fontStyle
font
fontWeight
align
clip
text
length
defined
bounds
fill
stroke
strokeDash
_caLayer
_caDirty
Td,R
T@"NSString",R
T@"NSObject<CCVegaColorOrGradientInterface>",R
T@"NSArray",R
TB,R
itemCount
TQ,R,N
caLayer
T@"CALayer",&,N
isDirty
TB,N
mark
T@"JSValue",&,Vmark
com.apple.CoreChart-Transaction
callback
T@"JSValue",&,Vcallback
-cc-internal-
sans-serif
Helvetica
serif
Times
monospace
Courier
system-ui
-apple-system
-apple-system-rounded
-apple-system-monospaced
-apple-system-serif
bold
italic
oblique
right
center
largeTitle
title1
title2
title3
headline
subheadline
body
callout
footnote
caption1
caption2
normal
-cc-internal-%@-%@-%@
fontFamily
fontName
pointSize
ascender
descender
leading
xHeight
capHeight
lineHeight
small-caps
bolder
lighter
T@"NSString",&,N,VfontFamily
T@"NSString",&,N,VfontSize
T@"NSString",&,N,VfontStyle
T@"NSString",&,N,VfontWeight
fontVariant
T@"NSString",&,N,VfontVariant
T@"NSString",&,N,VlineHeight
%lf$$%@$$%@$$%@$$%@
%@$$%@$$%@
hash
TQ,R
superclass
T#,R
description
T@"NSString",R,C
debugDescription
__chartViewDataRowID
count
Unknown argument type given to console.log
var console = {};
console
warn
error
v24@?0@"JSContext"8@"JSValue"16
line
column
stack
linear
linear-closed
basis
bundle
cardinal
catmull-rom
monotone
natural
step
step-after
step-before
T^{CGPath=},N
T^{CGPath=},N,Vpath
square
round
bevel
cornerRadiusTopLeft
cornerRadiusTopRight
cornerRadiusBottomLeft
cornerRadiusBottomRight
stops
color
offset
gradient
radial
alphabetic
middle
bottom
line-top
line-bottom
left
nativeNumberFormat
nativeDateComponentsFormat
nativeDateFormat
nativeTextMetrics
nativeFontMetrics
number
format
positiveFormat
negativeFormat
numberStyle
decimal
percent
scientific
spellOut
ordinal
currency
currencyAccounting
currencyISOCode
currencyPlural 
formatterBehavior
default
10_4
multiplier
@"JSValue"8@?0
year
yearForWeekOfYear
quarter
month
weekOfYear
weekOfMonth
weekday
weekdayOrdinal
hour
minute
second
nanosecond
calendar
timeZone
date-components
unitsStyle
full
short
brief
abbreviated
positional
includesApproximationPhrase
includesTimeRemainingPhrase
allowedUnits
allowsFractionalUnits
collapsesLargestUnit
maximumUnitCount
zeroFormattingBehavior
none
dropLeading
dropMiddle
dropTrailing
dropAll
medium
long
date
dateStyle
timeStyle
dateFormat
localizedFormatFromTemplate
locale
T@"NSLocale",&
T@"NSCalendar",&
T@,&,N,Vline
T{CGRect={CGPoint=dd}{CGSize=dd}},N,Vbounds
baselineOffset
Td,N,VbaselineOffset
xOffset
Td,N,VxOffset
T@,&,N,V_font
fillColor
T@,&,N,V_fillColor
strokeColor
T@,&,N,V_strokeColor
Td,N,V_strokeWidth
lines
T@"NSArray",&,N,V_lines
Td,N,V_lineHeight
combinedCTMHint
T{CGAffineTransform=dddddd},N,V_combinedCTMHint
Ti,N,V_align
Ti,N,V_baseline
textPosition
T{CGPoint=dd},N,V_textPosition
textAngle
Td,N,V_textAngle
You must either override enterMark, and updateMark
You must either override enterMultiMark, and updateMultiMark
delegate
T@"CCVegaCARenderer",W,Vdelegate
You must override pathForMark
vega
pathRender
pathParse
context
cgCanvas
T@"CCVegaCGContext",&,VcgCanvas
cursor
T@"NSString",&,N
T@"NSString",&,N,Vcursor
recursiveSetSize
style
T@"CCVegaCSSStyleDeclaration",&,N
childNodes
T@"NSMutableArray",&,N
tagName
events
T@"NSMutableDictionary",&,N
parentNode
T@"NSObject<CCVegaHTMLElementInterface>",&,N
clientWidth
Td,N
clientHeight
T@"CCVegaCSSStyleDeclaration",&,N,Vstyle
T@"NSMutableArray",&,N,VchildNodes
T@"NSString",&,N,VtagName
T@"NSMutableDictionary",&,N,Vevents
T@"NSObject<CCVegaHTMLElementInterface>",&,N,VparentNode
Td,N,VclientWidth
Td,N,VclientHeight
__tmp_propertyAccess
typeof __tmp_propertyAccess
function
bind
__LogProxy_wrapped
window
HTMLElement
document
@"JSValue"20@?0@"JSValue"8i16
setTimeout
setInterval
v16@?0@"JSValue"8
clearTimeout
clearInterval
expressionFunction
virtualMachine
T@"JSVirtualMachine",&,VvirtualMachine
T@"JSContext",&,Vcontext
T@"CCVegaJSDocument",&,N,Vdocument
currentClient
T@"CCVegaWorkerClient",W,VcurrentClient
dispatchQueueID
TQ,R,V_dispatchQueueID
worker
T@"CCVegaWorker",&,Vworker
T@"NSObject<CCVegaWorkerClientDelegate>",W,Vdelegate
isValid
TB,VisValid
CCVegaWorkerDispatchQueueID
scaleX
scaleY
horizontal
interactive
marktype
name
role
TB,R,N
T@"NSString",R,N
Td,R,N
container
T@,W,Vcontainer
frame
T{CGRect={CGPoint=dd}{CGSize=dd}}
label
T@"NSString",&,Vlabel
roleDescription
T@"NSString",&,VroleDescription
allocator<T>::allocate(size_t n) 'n' exceeds maximum supported size
__tmp_instance
__tmp_handler
new Proxy(__tmp_instance, __tmp_handler);
__tmp_proxy
Object.defineProperty(__tmp_proxy, '__LogProxy_wrapped', {  enumerable: true,  value: __tmp_instance,});
aspect
CCChartViewZoomFactor
CCChartViewBaseConfig
CCChartViewDelegate
CCChartViewRendererType
CCChartViewCATransactionFromBackgroundThread
CCBaseConfigApple
CCBaseConfigVega
CCRendererTypeCoreGraphics
CCRendererTypeCoreAnimation
mousemove
mousedown
mouseup
source_0
v24@?0@"NSString"8@"JSValue"16
prepareSpecDict
spec
config
baseConfig
mode
vega-lite
precompileSpec
json
result
compileError
message
T@"NSString",&
configDictionary
T@"NSDictionary",&
specDictionary
CATransactionFromBackgroundThread
rendererType
data
T@"NSArray",&,N
T@"NSLocale",&,N
T@"NSCalendar",&,N
zoomFactor
CGImage
T^{CGImage=},R
contentScaleFactor
T@"NSObject<CCChartViewDelegate>",W,Vdelegate
accessibilityDataSeriesElements
T@"NSArray",&,V_accessibilityDataSeriesElements
T@"NSString",&,Vconfig
T@"NSString",&,VrendererType
T@"NSString",&,VbaseConfig
expressionFunctions
T@"NSDictionary",&,VexpressionFunctions
v16@?0@?<v@?>8
T@"NSObject<CCAsyncQueueDelegate>",W,N,V_delegate
vega-lite.js
vega-parser.js
vegaParser
parse
vega.js
vega2canvas.js
vega-scenegraph-renderer.js
VEGA_VERSION
VEGA_LITE_VERSION
5.11.1
4.13.1
script://
rect
symbol
rule
area
group
image
callFunction
blend
multiply
screen
overlay
darken
lighten
color-dodge
color-burn
hard-light
soft-light
difference
exclusion
saturation
luminosity
source-over
aria
ariaRoleDescription
pixelRatio
backgroundColor
T@"JSContext",W,Vcontext
rootLayer
T@"CALayer",&
containerSize
T{CGSize=dd},VcontainerSize
accessibilityElements
T@"NSArray",&,VaccessibilityElements
scenegraphRoot
T@"JSManagedValue",&,VscenegraphRoot
_currentCombinedCTM
T{CGAffineTransform=dddddd},R
Td,VpixelRatio
Td,VzoomFactor
T@"NSString",&,VbackgroundColor
Td,N,Vwidth
12px system-ui
butt
miter
fillStyle
T@"JSValue",&
globalAlpha
lineCap
lineJoin
lineWidth
miterLimit
strokeStyle
textAlign
lineDashOffset
globalCompositeOperation
T@"CCVegaRenderer",W,N,Vrenderer
T^{CGContext=},R
Td,N,VpixelRatio
canvas
T@"CCVegaCGContext",&,N,Vcontext
rgb(
rgba(
isGradient
isColor
T@"NSString",&,Vcolor
T@"NSDictionary",&,Vgradient
cross
diamond
arrow
wedge
triangle
triangle-up
triangle-down
triangle-right
triangle-left
circle
undefined
T@"CCVegaHTMLElement",&,N
T@"CCVegaHTMLElement",&,N,Vbody
URL loading not supported
vegaRenderer
T@"CCVegaRenderer",W,VvegaRenderer
createViewRenderer
CCVegaCARenderer
CADelegate
CCVegaCanvasRenderer
devicePixelRatio
setScaleZoomFactor
finalize
@"NSObject"24@?0@"JSValue"8@"NSString"16
setupSignalHandler
textStyle
string
identifier
firstWeekday
languageCode
countryCode
currencySymbol
groupingSeparator
decimalSeparator
usesMetricSystem
quotationBeginDelimiter
quotationEndDelimiter
alternateQuotationBeginDelimiter
alternateQuotationEndDelimiter
characterDirection
leftToRight
rightToLeft
topToBottom
bottomToTop
unknown
macOS
tvOS
watchOS
macCatalyst
simulator
version
majorVersion
minorVersion
patchVersion
safeSetSignal
mainScreenWidth
mainScreenHeight
touchDataflow
vegaView
resize
getWidth
getHeight
runAsync
then
catch
getContext
rerender
redraw
B16@?0@"<CCChartDataRow>"8
safeGetSignal
safeAddSignalListener
safeRemoveSignalListener
saveState
loadState
data:image/png;base64,
data:image/jpeg;base64,
T@"NSString",&,N,Vspec
T@"NSString",&,N,Vconfig
T@"CCVegaHTMLElement",&,N,Vcontainer
T@"JSValue",&,N,Vrenderer
CARenderer
T@"CCVegaCARenderer",&,VCARenderer
viewDelegate
T@"CCViewRendererDelegate",&,VviewDelegate
asyncQueue
T@"CCAsyncQueue",&,N,VasyncQueue
currentCGImage
T^{CGImage=},VcurrentCGImage
workerClient
T@"CCVegaWorkerClient",&,VworkerClient
scaleFactor
TI,VrendererType
T@"NSObject<CCVegaRendererDelegate>",W,Vdelegate
specIsValid
isActive
contentSizeCategory
isEventConsumed
T@"CCVegaRenderer",W,N,V_renderer
type
T@"NSString",&,N,V_type
event
T@"CCVegaJSMouseEvent",&,N,V_event
v32@?0@"<CCChartDataRow>"8Q16^B24
changeset
insert
remove
change
namedDataset
T@"NSString",&,V_namedDataset
rowsToInsert
T@"NSArray",&,V_rowsToInsert
callbackForRowsToRemove
T@?,C,V_callbackForRowsToRemove
T@"NSString",&,N,V_name
value
T@,&,N,V_value
Td,VscaleFactor
T{CGSize=dd},Vsize
T@"NSLocale",&,Vlocale
T@"NSCalendar",&,Vcalendar
T@"NSString",&,VcontentSizeCategory
TI,Vrenderer
T@"CALayer",&,VcaLayer
caUpdateFromBackground
TB,VcaUpdateFromBackground
clientX
clientY
movementX
movementY
propagationStopped
defaultPrevented
isConsumed
Td,N,VclientX
Td,N,VclientY
Td,N,VmovementX
Td,N,VmovementY
TB,N,VpropagationStopped
TB,N,VdefaultPrevented
TB,N,VisConsumed
aliceblue
antiquewhite
aqua
aquamarine
azure
beige
bisque
black
blanchedalmond
blue
blueviolet
brown
burlywood
cadetblue
chartreuse
chocolate
coral
cornflowerblue
cornsilk
crimson
cyan
darkblue
darkcyan
darkgoldenrod
darkgray
darkgreen
darkgrey
darkkhaki
darkmagenta
darkolivegreen
darkorange
darkorchid
darkred
darksalmon
darkseagreen
darkslateblue
darkslategray
darkslategrey
darkturquoise
darkviolet
deeppink
deepskyblue
dimgray
dimgrey
dodgerblue
firebrick
floralwhite
forestgreen
fuchsia
gainsboro
ghostwhite
gold
goldenrod
gray
green
greenyellow
grey
honeydew
hotpink
indianred
indigo
ivory
khaki
lavender
lavenderblush
lawngreen
lemonchiffon
lightblue
lightcoral
lightcyan
lightgoldenrodyellow
lightgray
lightgreen
lightgrey
lightpink
lightsalmon
lightseagreen
lightskyblue
lightslategray
lightslategrey
lightsteelblue
lightyellow
lime
limegreen
linen
magenta
maroon
mediumaquamarine
mediumblue
mediumorchid
mediumpurple
mediumseagreen
mediumslateblue
mediumspringgreen
mediumturquoise
mediumvioletred
midnightblue
mintcream
mistyrose
moccasin
navajowhite
navy
oldlace
olive
olivedrab
orange
orangered
orchid
palegoldenrod
palegreen
paleturquoise
palevioletred
papayawhip
peachpuff
peru
pink
plum
powderblue
purple
rebeccapurple
rosybrown
royalblue
saddlebrown
salmon
sandybrown
seagreen
seashell
sienna
silver
skyblue
slateblue
slategray
slategrey
snow
springgreen
steelblue
teal
thistle
tomato
turquoise
violet
wheat
white
whitesmoke
yellow
yellowgreen
CCVegaTransaction:begin
CCVegaTransaction:commit
CCVegaJSFont: font style '%s' doesn't exist
chartViewDataRowID(%p): address for self is larger than 2^53-1, taking the lowest 53 bits as row ID
JS console log: %s
JS console warning: %s
JS console error: %s
Unhandled exception: %s
In context: %s
Line %s, column %s
Stacktrace: %s
curve type %s is not implemented in the CA renderer
unexpected text baseline property: %s
unexpected text align property: %s
Getting property "%s" on LogProxy wrapped object %s
Get for missing property "%s" on LogProxy wrapped object %s
Setting property "%s" on LogProxy wrapped object %s to value "%s"
Set for missing property "%s" on LogProxy wrapped object %s to value %s
CCVegaWorker: expression function '%s' called without a worker client.
CCVegaWorkerClient: expression function '%s' is not registered for use with this client.
CCChartView(%p):dealloc
CCChartView(%p):initialize
CCChartView(%p): setupWithSpec called multiple times. This will result in unexpected behavior
render CGImage: (%.2lfx%.2lf, scale factor = %.2lf)
CCChartView(%p):lazilyInitializeRenderer
CCChartView(%p):reinitializeRenderer
Vega: %s, Vega-Lite: %s
CCVegaCARenderer(%p):updateCALayers, skipped because there is no root layer
CCVegaCARenderer(%p):updateCALayers, dirtyAll = %d
CCVegaCARenderer(%p): mark type '%s' not implemented
CCVegaRenderer(%p):init
CCVegaRenderer(%p):displayWithCommitter
CCVegaRenderer(%p):displayWithCommitter updateCALayers
CCVegaRenderer(%p):displayWithCommitter rendererDidUpdate
CCVegaRenderer(%p):dealloc
CCVegaRenderer(%p):isActive cannot be set to false once it's true
CCVegaRenderer(%p):updateNativeView
CCVegaRenderer(%p):runAsync: use runAsyncWithCallback instead
CCVegaRenderer(%p):runAsyncWithCallback: we should have a valid callback
CCVegaRenderer(%p):runAsyncWithCallback
Unexpected error in runAsync
CCVegaRenderer(%p):setSize: %.2lf %.2lf, was %.2lf %.2lf
CCVegaRenderer(%p):updateScaleZoomFactor scaleFactor = %.2lf zoomFactor = %.2lf
Encountered extra properties on canvas: %s
Encountered extra properties on canvas context: %s
CCVegaRenderer(%p):rerenderEntireChart
CCVegaRenderer(%p):changeDataset: %s
CCVegaRenderer(%p):processEvent %s %lf %lf
CCVegaRenderer(%p):setSignal: %s
zPLR
zPLR
zPLR
zPLR
zPLR
zPLR
zPLR
zPLR
CCVegaCurveFactoryLinear
CCVegaCurveFactoryLinearClosed
CCVegaRuleMarkDef
CCVegaLogger
CCVegaGroupMarkDef
CCVegaMarkItem
CCVegaMarkItemInterface
CCVegaTransaction
CCVegaTransactionCommitter
CCVegaTransactionMainThreadOperation
CCVegaSignalListener
CCVegaJSFont
CCVegaCGFontProperties
CCVegaJSFontCache
CCChartDataRow
NSObject
CCChartDataRowBinding
CCVegaJSConsole
CCVegaCurveFactory
CCVegaCurveFactoryInterface
CCVegaScenegraphUtils
CCVegaRectMarkDef
CCVegaTextMarkDef
CCVegaExpressionFunctions
CCTextLayerLineData
CCTextLayer
CCVegaMarkDef
CCVegaMarkDefInterface
JSExport
CCVegaSingleItemShapeMarkDef
CCVegaMultiItemShapeMarkDef
CCVegaSymbolMarkDef
CCVegaSVGRenderer
CCVegaCSSStyleDeclaration
CCVegaCSSStyleDeclarationInterface
CCVegaHTMLElement
CCVegaHTMLElementInterface
CCVegaLogProxyHandler
CCVegaLogProxyHandling
CCVegaCurves
CCVegaWorker
CCVegaWorkerClient
CCVegaPathMarkDef
CCTransaction
CCVegaAreaMarkDef
CCVegaMark
CCVegaMarkInterface
CCVegaAccessibilityHelper
CCAccessibilityElement
CCVegaLogProxy
CCVegaImageMarkDef
CCChartView
CCChartViewSetupOptions
CCVegaCurveFactoryCardinal
CCAsyncQueueBlockOperation
CCAsyncOperation
CCAsyncQueue
CCVegaShapeMarkDef
CCVegaScripts
CCTestUtils
CCVegaCARenderer
CCVegaCARendererDelegateInterface
CCVegaCGLinearGradient
CCVegaCGGradientInterface
CCVegaCGImage
CCVegaCGImageInterface
CCVegaCGTextMetrics
CCVegaCGTextMetricsInterface
CCVegaCGContext
CCVegaCGContextInterface
CCVegaCGCanvas
CCVegaCGCanvasInterface
CCVegaJSColor
CCVegaColorOrGradient
CCVegaColorOrGradientInterface
CCVegaSymbolPath
CCVegaJSDocument
CCVegaJSDocumentInterface
CCViewRendererDelegate
CCViewRendererDelegateInterface
CCVegaRenderer
CCAsyncQueueDelegate
CCVegaWorkerClientDelegate
CCVegaEventAsyncOperation
CCVegaDataUpdateAsyncOperation
CCVegaSignalUpdateAsyncOperation
CCVegaRendererOptions
CCVegaJSMouseEvent
CCVegaJSMouseEventInterface
CCVegaJSColorMap
CCVegaLineMarkDef
init
path
lineStart
lineEnd
areaStart
areaEnd
point:
_point
_areaState
getDouble:defaultValue:
newPathForMark:
accessibilityFrameForMark:layer:
instance
newPathForRectangleMark:offset:
sublayers
objectAtIndex:
setSublayerTransform:
delegate
updateShapeLayer:withMark:delegate:
fillColor
strokeColor
newGroupPath:
setPath:
clip
mask
layer
setTransform:
setMask:
arrayWithObjects:count:
setSublayers:
updateLayer:withMark:
caLayer
bounds
enterMark:
updateMark:
setMark:
objectForKeyedSubscript:
isArray
isUndefined
toDouble
isNull
toString
toBool
toUInt32
initWithCapacity:
valueAtIndex:
addObject:
toObject
isBoolean
isObject
initWithJSValue:
toArray
toObjectOfClass:
setObject:forKeyedSubscript:
context
valueWithBool:inContext:
valueForProperty:
mark
getInstance
newPathFromJSFunction:item:
newPathByCallingShapeFunction
getString:defaultValue:
getObject:defaultValue:
getBoolean:defaultValue:
defined
getText
itemAtIndex:
isEqual:
cornerRadius
shape
orient
size
baseline
radius
theta
fontStyle
fontSize
fontWeight
font
align
width
angle
height
opacity
fill
fillOpacity
stroke
strokeOpacity
strokeWidth
strokeCap
strokeDash
strokeJoin
interpolate
strokeMiterLimit
zindex
itemCount
setCaLayer:
isDirty
setIsDirty:
.cxx_destruct
_items
allObjects
removeAllObjects
_commitTransactionForRenderers:
initWithRenderers:
commit
singleton
begin
scheduleDisplay:
_status
_scheduledRenderers
_dispatchQueue
countByEnumeratingWithState:objects:count:
displayWithCommitter:
count
waitForBlockReady
setDisableActions:
runBlock
flush
newMainThreadOperation
setNeedsCATransaction
_renderers
_mainThreadOperations
_needsCATransaction
provideBlock:
cancel
_semaphore
_block
setCallback:
initWithCallback:
callback
componentsSeparatedByString:
whitespaceCharacterSet
stringByTrimmingCharactersInSet:
characterSetWithCharactersInString:
parseCSSFontFamilyList:
hasPrefix:
cacheedFontForInternalName:
isEqualToString:
systemFontOfSize:
fontDescriptor
fontDescriptorWithDesign:
fontWithDescriptor:size:
fontWithName:size:
numberWithFloat:
setValue:forKey:
numberWithUnsignedInt:
dictionaryWithObjects:forKeys:count:
initWithDictionary:
initWithCSSFontString:
hasSuffix:
length
substringToIndex:
doubleValue
fontFamily
fontVariant
initWithFontFamily:fontSize:fontWeight:fontStyle:fontVariant:
dealloc
currentLocale
languageCode
nativeTextStyleFromTextStyle:
UTF8String
traitCollectionWithPreferredContentSizeCategory:
preferredFontForTextStyle:compatibleWithTraitCollection:
stringWithFormat:
cacheFont:forInternalName:
fontMetricsForFont:fontNameOverride:lineHeightOverride:
_defaultLineHeightForUILayout
_leading
defaultLineHeightForNativeFont:
cssFontWeightFromNumericWeight:
familyName
fontName
pointSize
numberWithDouble:
ascender
descender
leading
xHeight
capHeight
fontMetricsForTextStyle:contentSizeCategory:language:
measureText:
extendedMeasureText:
drawText:x:y:align:color:drawingMode:inContext:
CTFont
fontMetrics
defaultLineHeight
_font
setFontFamily:
setFontSize:
setFontVariant:
setFontWeight:
setFontStyle:
setLineHeight:
componentsSeparatedByCharactersInSet:
objectAtIndexedSubscript:
subarrayWithRange:
componentsJoinedByString:
stringByAppendingString:
lineHeight
sharedCache
objectForKey:
setObject:forKey:
null
fontWithCSSFontString:
fontWithFontFamily:fontSize:fontWeight:fontStyle:fontVariant:
_cache
_styleCache
_internalNameCache
allKeys
numberWithUnsignedLong:
columnsInChartView
chartViewDataValueForColumn:
chartViewDataRowID
class
self
performSelector:
performSelector:withObject:
performSelector:withObject:withObject:
isProxy
isKindOfClass:
isMemberOfClass:
conformsToProtocol:
respondsToSelector:
retain
release
autorelease
retainCount
zone
hash
superclass
description
debugDescription
initWithArray:
objectEnumerator
initWithChartDataRow:
keyEnumerator
_dataRow
currentArguments
appendString:
evaluateScript:
arguments
setExceptionHandler:
attachToJavaScriptContext:
initWithTension:
factoryWithCurve:
isGradient
gradient
createOrUpdateLayer:path:gradient:mode:lineWidth:delegate:
updateShapeLayerFill:withMark:delegate:
setFillColor:
updateShapeLayerStroke:withMark:delegate:
insertSublayer:atIndex:
insertSublayer:above:
setOpacity:
isColor
color
newColorFromCSSString:alpha:
setStrokeColor:
setLineWidth:
setLineCap:
setLineJoin:
setMiterLimit:
setLineDashPattern:
applyGradient:toLayer:delegate:
createOrUpdateGradientLayer:existingLayer:delegate:
setFrame:
arrayWithCapacity:
newColorFromCSSString:
setColors:
setLocations:
setStartPoint:
setEndPoint:
setType:
createOrUpdateLayer:path:withMark:delegate:
arrayWithObject:
setFont:
setStrokeWidth:
setBaseline:
setAlign:
anchorPoint:
_currentCombinedCTM
setCombinedCTMHint:
setTextPosition:
setTextAngle:
setLines:
pixelRatio
setContentsScale:
updateTextContents
updateTextLayer:withMark:
frame
autoupdatingCurrentLocale
autoupdatingCurrentCalendar
nativeNumberFormat
registerExpressionFunction:withName:
nativeDateComponentsFormat
nativeDateFormat
nativeTextMetrics
nativeFontMetrics
dataWithJSONObject:options:error:
initWithData:encoding:
currentContext
valueWithObject:inContext:
valueWithUndefinedInContext:
keyForKind:options:
locale
setLocale:
setPositiveFormat:
setNegativeFormat:
setNumberStyle:
setFormatterBehavior:
setMultiplier:
makeReturnValue:
toNumber
isString
toDictionary
numberFormatterFromOptions:
stringFromNumber:
calendar
setCalendar:
setUnitsStyle:
boolValue
setIncludesApproximationPhrase:
setIncludesTimeRemainingPhrase:
calendarUnitFromString:
setAllowedUnits:
setAllowsFractionalUnits:
setCollapsesLargestUnit:
integerValue
setMaximumUnitCount:
setZeroFormattingBehavior:
dateComponentsFormatterFromOptions:
stringFromTimeInterval:
timeZone
setTimeZone:
dateFormatterStyleFromString:
setDateStyle:
setTimeStyle:
setDateFormat:
setLocalizedDateFormatFromTemplate:
toDate
dateFormatterFromOptions:
stringFromDate:
isNumber
fontFromJSFontDesc:
functionNames
registerFunctionsToClient:
_locale
_calendar
line
setLine:
setBounds:
baselineOffset
setBaselineOffset:
xOffset
setXOffset:
dictionary
setAnchorPoint:
setNeedsDisplay
display
position
drawInContext:
lines
textPosition
textAngle
combinedCTMHint
_lineContents
_align
_baseline
_lines
_lineHeight
_strokeColor
_fillColor
_strokeWidth
_textAngle
_textPosition
_combinedCTMHint
setDelegate:
raise:format:
initWithDelegate:
isMultiItemMark
enterMultiMark:
updateMultiMark:
transformForMark:
drawMark:withLayer:
setShouldRasterize:
setRasterizationScale:
setCgCanvas:
cgCanvas
setWidth:
setHeight:
callWithArguments:
invokeMethod:withArguments:
newPathFromParsedPath:size:rendererContext:
parseString:rendererContext:
setCursor:
cursor
initWithTagName:
setStyle:
setChildNodes:
setEvents:
setTagName:
setParentNode:
setClientWidth:
setClientHeight:
childNodes
value
recursiveSetSize:
managedValueWithValue:
removeObject:
clientWidth
clientHeight
valueWithSize:inContext:
insertObject:atIndex:
events
valueForKey:
managedValueWithValue:andOwner:
getBoundingClientRect
removeWithChild:
appendWithChild:
prependWithChild:
setAttributeWithName:value:
addEventListenerWithType:listener:
removeEventListenerWithType:listener:
style
tagName
parentNode
removeWithChild:__JS_EXPORT_AS__removeChild:
appendWithChild:__JS_EXPORT_AS__appendChild:
prependWithChild:__JS_EXPORT_AS__prepend:
setAttributeWithName:value:__JS_EXPORT_AS__setAttribute:
addEventListenerWithType:listener:__JS_EXPORT_AS__addEventListener:
removeEventListenerWithType:listener:__JS_EXPORT_AS__removeEventListener:
wrap:
hasProperty:
getPropertyOnObject:named:
setPropertyOnObject:named:toValue:
getPropertyOnObject:named:__JS_EXPORT_AS__get:
setPropertyOnObject:named:toValue:__JS_EXPORT_AS__set:
newPathForLineWithPoints:count:interpolate:
newPathForAreaWithPoints:count:interpolate:
setVirtualMachine:
virtualMachine
initWithVirtualMachine:
setContext:
setupContext
globalObject
setupTimerFunctions
setupConsole
setDocument:
document
evaluateBootstrapScriptsInContext:
registerProxyExpressionFunction:
evaluateVegaLiteScriptInContext:
evaluateVegaParserScriptInContext:
currentClient
evaluateExpressionFunction:
nextTimerIndex
dispatchQueue
clientEnter
clientDidExecuteTimerCallback
clientExit
numberWithInteger:
valueWithInt32:inContext:
removeObjectForKey:
initWithQueue:
sharedWorker
sharedMainThreadWorker
requireVegaLite
requireVegaParser
setCurrentClient:
dispatchQueueID
_currentTimerIndex
_timers
_vegaLiteLoaded
_vegaParserLoaded
_dispatchQueueID
setWorker:
setIsValid:
worker
workerContextEnter
workerContextExit
workerDidExecuteTimerCallback
initWithWorker:delegate:
runBlockAsync:
runBlockSync:
waitForWorker
isValid
_expressionFunctions
_cachedPathDef
_cachedPath
interactive
marktype
name
role
firstObject
removeObjectAtIndex:
container
initWithAccessibilityContainer:
newAccessibilityElementWithFrame:
setLabel:
setRoleDescription:
initWithElements:
translateX:Y:
markAriaHidden
saveState
restoreState
addElementWithLabel:roleDescription:frame:
getElements
setContainer:
.cxx_construct
_stateStack
_currentState
_elementCache
_children
label
setAccessibilityFrameInContainerSpace:
accessibilityFrameInContainerSpace
isAccessibilityElement
accessibilityLabel
roleDescription
wrap:withHandler:
wrapObject:
tryUnwrap:
unwrap:
setPosition:
newImageFromURL:
setContents:
setContentsGravity:
initWithCoder:
initialize
initWithFrame:
initWithSpec:config:
initWithSpec:config:options:
setSpec:
setConfig:
setZoomFactor:
setRendererType:
setBaseConfig:
setCATransactionFromBackgroundThread:
defaultCenter
removeObserver:
refreshLocaleAndCalendar
addObserver:selector:name:object:
spec
rendererType
baseConfig
config
expressionFunctions
lazilyInitializeRenderer
setupWithSpec:options:
JSONStringFromDictionary:
renderer
setLocale:calendar:shouldRefresh:
reinitializeRenderer
scaleFactor
contentScaleFactor
zoomFactor
setScaleFactor:
setSize:
setIsActive:
currentBitmap
currentBitmapScaleFactor
traitCollectionDidChange:
traitCollection
userInterfaceStyle
traitCollectionWithUserInterfaceStyle:
traitCollectionWithTraitsFromCollections:
rerender
render
preferredContentSizeCategory
setContentSizeCategory:
refreshNativeSignals
rerenderEntireChart
setRenderer:
setCaUpdateFromBackground:
configForBaseConfigType:
initWithSpec:config:options:workerClient:
saveStateWithNamedDatasets:
loadState:
chartViewLoadDataFromURL:error:
loadChartDataFromURL:error:
accessibilityDataSeriesElements
chartViewColorNamed:
colorNamed:
rangeOfString:
dynamicColorNamed:
chartViewLocalizedStringNamed:
localizedStringNamed:
mainBundle
localizedStringForKey:value:table:
chartViewImageNamed:
imageNamed:
touchesForView:
locationInView:
initWithLocation:movement:
triggerMouseEvent:type:setConsumed:
eventToMouseEvent:
triggerEventWithType:event:waitForEventHandling:
isConsumed
triggerMouseEvent:type:
view
contentSize
dataUsingEncoding:
JSONObjectWithData:options:error:
dictionaryFromJSONString:
setSpecDictionary:
setConfigDictionary:
setDefaultDataset:
setNamedDataset:rows:
changeDefaultDatasetByInserting:removingIDs:
changeNamedDataset:inserting:removingIDs:
setContentScaleFactor:
CGImage
numberWithBool:
isDate
getSignalWithName:
unwrapJSValue:
setSignalWithName:toValue:
addListener:toSignalWithName:
removeListener:fromSignalWithName:
accessibilityElements
arrayByAddingObjectsFromArray:
stringForScriptData:length:
errorWithDomain:code:userInfo:
compileSpec:config:baseConfig:expressionFunctionNames:error:
getBenchmarkRecords
preloadFrameworkAssets
compileSpecDictionary:configDictionary:baseConfig:expressionFunctionNames:error:
initWithSpec:
setupWithSpec:
setupWithSpecDictionary:
setupWithSpecDictionary:options:
CATransactionFromBackgroundThread
drawRect:
rendererDidUpdate
touchesBegan:withEvent:
touchesEnded:withEvent:
touchesMoved:withEvent:
touchesCancelled:withEvent:
gestureRecognizerShouldBegin:
specDictionary
configDictionary
setSpec:config:
setSpec:config:baseConfig:
setSpec:config:baseConfig:rendererType:
setSpecDictionary:configDictionary:
setSpecDictionary:configDictionary:baseConfig:
setSpecDictionary:configDictionary:baseConfig:rendererType:
data
setData:
registerLocalExpressionFunction:withName:
setAccessibilityDataSeriesElements:
_worker
_workerClient
_renderer
_baseConfigType
_rendererType
_config
_configDictionary
_spec
_specDictionary
_zoomFactor
_legacyData
_knownNamedDatasets
_preventGestures
_caUpdateFromBackground
_didCustomizeLocale
_didCustomizeCalendar
_accessibilityDataSeriesElements
setExpressionFunctions:
addCurveX:Y:
performOperationWithCallback:
initWithBlock:
enqueueOperation:
startProcessOperations
processOperations:
simplifyQueue:
enqueueOperationWithBlock:
waitForPendingOperations
initWithWorkerClient:
waitForOperation:
_nextActionID
_queue
_isProcessing
_delegate
loadScriptWithName:source:inVirtualMachine:
evaluateJSScript:
dataWithBytes:length:
URLWithString:
scriptOfType:withSource:andSourceURL:andBytecodeCache:inVirtualMachine:error:
evaluateScriptWithName:source:inContext:
vegaJS
vegaliteJS
compareImage:withImage:
setRootLayer:
setPixelRatio:
setAccessibilityElements:
setValue:forProperty:
initWithValue:
setScenegraphRoot:
scenegraphRoot
updateCALayers:dirtyAll:
rootLayer
addSublayer:
backgroundColor
setBackgroundColor:
drawMark:parentGroup:into:dirtyAll:
callFromJSFunction:
superlayer
sublayerTransform
transform
marks
compositingFilterForItem:
setCompositingFilter:
replaceSublayer:with:
applyClip:onLayer:
drawMark:parentGroup:item:into:dirtyAll:
copy
containsObject:
removeFromSuperlayer
resizeWidth:height:originX:originY:
dirty:
dirtyAll
render:
updateCALayers
invalidateCaches
resizeWidth:height:originX:originY:__JS_EXPORT_AS__resize:
dirty:__JS_EXPORT_AS__dirty:
render:__JS_EXPORT_AS__render:
initWithRenderer:context:rootLayer:updateFromBackground:
containerSize
setContainerSize:
_updateFromBackground
_marks
_rootLayer
_contentLayer
_initialized
_width
_height
_containerSize
_originX
_originY
_dirty
_dirtyAll
_pendingUpdate
_pendingUpdateDirtyAll
_imageCache
_accessibilityHelper
_currentTranslate
initWithX0:y0:x1:y1:
addColorStopWithOffset:color:
newColorFromString:
addColorStopWithOffset:color:__JS_EXPORT_AS__addColorStop:
initWithDictionary:context:
fillWithContext:
_colorStops
_context
resizeBitmapContext
textWithString:x:y:drawingMode:
flipYAxisWithHeight:
rectWithX:y:width:height:
lineDashOffset
save
restore
arcWithX:y:radius:startAngle:endAngle:anticlockwise:
beginPath
bezierCurveToCP1x:cp1y:cp2x:cp2y:x:y:
quadraticCurveToCP1x:cp1y:x:y:
clearRectWithX:y:w:h:
closePath
createLinearGradientWithX0:y0:x1:y1:
fillTextWithString:x:y:
fillRectWithX:y:width:height:
lineToX:y:
moveToX:y:
strokeTextWithString:x:y:
setLineDashWithSegments:
rotateWithAngle:
setTransformWithA:b:c:d:e:f:
translateWithX:y:
isPointInPathWithX:y:
fillStyle
setFillStyle:
globalAlpha
setGlobalAlpha:
lineCap
lineJoin
lineWidth
miterLimit
strokeStyle
setStrokeStyle:
textAlign
setTextAlign:
setLineDashOffset:
globalCompositeOperation
setGlobalCompositeOperation:
arcWithX:y:radius:startAngle:endAngle:anticlockwise:__JS_EXPORT_AS__arc:
bezierCurveToCP1x:cp1y:cp2x:cp2y:x:y:__JS_EXPORT_AS__bezierCurveTo:
quadraticCurveToCP1x:cp1y:x:y:__JS_EXPORT_AS__quadraticCurveTo:
clearRectWithX:y:w:h:__JS_EXPORT_AS__clearRect:
createLinearGradientWithX0:y0:x1:y1:__JS_EXPORT_AS__createLinearGradient:
fillTextWithString:x:y:__JS_EXPORT_AS__fillText:
fillRectWithX:y:width:height:__JS_EXPORT_AS__fillRect:
lineToX:y:__JS_EXPORT_AS__lineTo:
moveToX:y:__JS_EXPORT_AS__moveTo:
rectWithX:y:width:height:__JS_EXPORT_AS__rect:
strokeTextWithString:x:y:__JS_EXPORT_AS__strokeText:
setLineDashWithSegments:__JS_EXPORT_AS__setLineDash:
rotateWithAngle:__JS_EXPORT_AS__rotate:
setTransformWithA:b:c:d:e:f:__JS_EXPORT_AS__setTransform:
translateWithX:y:__JS_EXPORT_AS__translate:
isPointInPathWithX:y:__JS_EXPORT_AS__isPointInPath:
_fillStyle
_globalAlpha
_lineCap
_lineJoin
_lineWidth
_miterLimit
_strokeStyle
_textAlign
_currentTransform
_lineDashOffset
_globalCompositeOperation
_bitmapContext
_internalFont
getContext:
newColorTransparent
characterAtIndex:
newColorFromR:G:B:A:
substringWithRange:
scannerWithString:
scanInt:
scanDouble:
unsignedIntValue
newColorBlack
newColorWhite
setColor:
setGradient:
newCrossPathWithSize:
newDiamondPathWithSize:
newSquarePathWithSize:
newArrowPathWithSize:
newWedgePathWithSize:
newTrianglePathWithSize:
newTriangleUpPathWithSize:
newTriangleDownPathWithSize:
newTriangleRightPathWithSize:
newTriangleLeftPathWithSize:
newStrokePathWithSize:
newCirclePathWithSize:
newPathForBuiltin:withSize:
newPathForCustomSVGShape:withSize:withContext:
setBody:
createElementWithString:
body
createElementWithString:__JS_EXPORT_AS__createElement:
setVegaRenderer:
vegaRenderer
workerClient
updateNativeView
loadURL:options:withCallback:
loadURL:options:withCallback:__JS_EXPORT_AS__loadURL:
initWithVegaRenderer:
contentSizeCategory
setViewDelegate:
setWorkerClient:
setAsyncQueue:
asyncQueue
caUpdateFromBackground
setCARenderer:
CARenderer
viewDelegate
setupSignalHandlers
setupScreenSignal
runAsyncWithCallback:
_doUpdateInMainThread
shrinkFootprintWhenIdle
scheduleDisplay
calendarIdentifier
firstWeekday
numberWithUnsignedInteger:
localeIdentifier
countryCode
currencySymbol
groupingSeparator
decimalSeparator
usesMetricSystem
quotationBeginDelimiter
quotationEndDelimiter
alternateQuotationBeginDelimiter
alternateQuotationEndDelimiter
characterDirectionForLanguage:
processInfo
operatingSystemVersionString
operatingSystemVersion
mainScreen
refreshNativeSignalsRerunDataflow:
type
removeObjectsInRange:
updateInMainThreadIfNeeded
vegaContext
setCurrentCGImage:
clearPendingDataUpdates
updateScaleFactor:zoomFactor:
currentCGImage
enqueueRunAsync
renderInContext:
setEvent:
changeNamedDataset:inserting:removingWithCallback:
setNamedDataset:
setRowsToInsert:
setCallbackForRowsToRemove:
setName:
setValue:
substringFromIndex:
getWhite:alpha:
colorWithAlphaComponent:
CGColor
dataWithContentsOfURL:
initWithData:
specIsValid
isActive
runAsync
addPendingDataUpdate:
hasPendingDataUpdate:
_contentSizeCategory
_builtinExpressionFunctions
_currentCGImage
_currentCGImageScaleFactor
_needsUpdateFromMainThread
_pendingDataUpdates
_internalScaleFactor
_internalZoomFactor
_caLayer
_data
_isActive
_scaleFactor
event
setPropagationStopped:
clientX
clientY
propagationStopped
setIsConsumed:
_type
_event
rowsToInsert
enumerateObjectsUsingBlock:
callbackForRowsToRemove
namedDataset
doDataUpdate:
_namedDataset
_rowsToInsert
_callbackForRowsToRemove
_name
_value
setDefaultPrevented:
setClientX:
setClientY:
setMovementX:
setMovementY:
preventDefault
stopPropagation
movementX
movementY
defaultPrevented
@16@0:8
v16@0:8
v32@0:8{CGPoint=dd}16
^{CGPath=}24@0:8@16
{CGRect={CGPoint=dd}{CGSize=dd}}32@0:8@16@24
v32@0:8@16@24
@24@0:8@16
^{CGPath=}16@0:8
d32@0:8@16d24
@32@0:8@16@24
B28@0:8@16B24
{CGRect={CGPoint=dd}{CGSize=dd}}16@0:8
B16@0:8
@24@0:8Q16
B24@0:8@16
d16@0:8
Q16@0:8
v24@0:8@16
v20@0:8B16
d32@0:8@"NSString"16d24
@"NSString"32@0:8@"NSString"16@"NSString"24
@"NSObject"32@0:8@"NSString"16@"NSObject"24
B28@0:8@"NSString"16B24
@"NSObject"16@0:8
@"CCVegaMark"24@0:8Q16
B24@0:8@"NSObject<CCVegaMarkItemInterface>"16
@"NSString"16@0:8
@"NSObject<CCVegaColorOrGradientInterface>"16@0:8
@"NSArray"16@0:8
@"CALayer"16@0:8
v24@0:8@"CALayer"16
@"JSValue"
@"NSMutableSet"
@"NSObject<OS_dispatch_queue>"
@"NSArray"
@"NSMutableArray"
v24@0:8@?16
@"NSObject<OS_dispatch_semaphore>"
@24@0:8d16
@40@0:8@16@24@32
d24@0:8@16
@40@0:8^{__CTFont=}16@24d32
@56@0:8@16d24@32@40@48
{?={CGSize=dd}}24@0:8@16
{?={CGSize=dd}{CGSize=dd}ddd}24@0:8@16
v68@0:8@16d24d32@40^{CGColor=}48i56^{CGContext=}60
^{__CTFont=}16@0:8
^{__CTFont=}
@"NSString"
v32@0:8^{__CTFont=}16@24
^{__CTFont=}24@0:8@16
@"NSMutableDictionary"
#16@0:8
@24@0:8:16
@32@0:8:16@24
@40@0:8:16@24@32
B24@0:8#16
B24@0:8:16
Vv16@0:8
^{_NSZone=}16@0:8
B24@0:8@"Protocol"16
@24@0:8@"NSString"16
@"NSNumber"16@0:8
@"<CCChartDataRow>"
v24@0:8^{CGPath=}16
^{CGPath=}
@48@0:8@16^{CGPath=}24@32@40
v40@0:8@16@24@32
^{CGPath=}32@0:8@16d24
@60@0:8@16^{CGPath=}24@32i40d44@52
{CGPoint=dd}24@0:8@16
@?16@0:8
Q24@0:8@16
@"NSLocale"
@"NSCalendar"
v48@0:8{CGRect={CGPoint=dd}{CGSize=dd}}16
v24@0:8d16
{CGRect="origin"{CGPoint="x"d"y"d}"size"{CGSize="width"d"height"d}}
v24@0:8^{CGContext=}16
i16@0:8
v20@0:8i16
{CGPoint=dd}16@0:8
{CGAffineTransform=dddddd}16@0:8
v64@0:8{CGAffineTransform=dddddd}16
{CGPoint="x"d"y"d}
{CGAffineTransform="a"d"b"d"c"d"d"d"tx"d"ty"d}
@"CCVegaCARenderer"
{CATransform3D=dddddddddddddddd}24@0:8@16
^{CGPath=}40@0:8@16d24@32
^{CGPath=}32@0:8@16@24
@"CCVegaCGContext"
v24@0:8@"NSString"16
v32@0:8{CGSize=dd}16
@"NSDictionary"16@0:8
@"NSObject<CCVegaHTMLElementInterface>"24@0:8@"JSValue"16
v32@0:8@"NSString"16@"NSString"24
v32@0:8@"NSString"16@"JSValue"24
@"CCVegaCSSStyleDeclaration"16@0:8
v24@0:8@"CCVegaCSSStyleDeclaration"16
@"NSMutableArray"16@0:8
v24@0:8@"NSMutableArray"16
@"NSMutableDictionary"16@0:8
v24@0:8@"NSMutableDictionary"16
@"NSObject<CCVegaHTMLElementInterface>"16@0:8
v24@0:8@"NSObject<CCVegaHTMLElementInterface>"16
@"NSObject<CCVegaHTMLElementInterface>"32@0:8@"JSValue"16@24
v40@0:8@"NSString"16@"NSString"24@32
v40@0:8@"NSString"16@"JSValue"24@32
@"CCVegaCSSStyleDeclaration"
@"NSObject<CCVegaHTMLElementInterface>"
B40@0:8@16@24@32
B48@0:8@16@24@32@40
@"JSValue"32@0:8@"JSValue"16@"NSString"24
B40@0:8@"JSValue"16@"NSString"24@"JSValue"32
@"JSValue"40@0:8@"JSValue"16@"NSString"24@32
B48@0:8@"JSValue"16@"NSString"24@"JSValue"32@40
^{CGPath=}40@0:8^{?=ddB}16Q24@32
^{CGPath=}40@0:8^{?=ddddB}16Q24@32
v32@0:8@?16@24
@"JSContext"
@"JSVirtualMachine"
@"CCVegaJSDocument"
@"CCVegaWorkerClient"
@"CCVegaWorker"
@"NSObject<CCVegaWorkerClientDelegate>"
@"CCVegaMarkItem"24@0:8Q16
B24@0:8@"NSObject<CCVegaMarkInterface>"16
@48@0:8{CGRect={CGPoint=dd}{CGSize=dd}}16
v32@0:8d16d24
v64@0:8@16@24{CGRect={CGPoint=dd}{CGSize=dd}}32
{stack<CCVegaAccessibilityHelperState, std::__1::deque<CCVegaAccessibilityHelperState, std::__1::allocator<CCVegaAccessibilityHelperState> > >="c"{deque<CCVegaAccessibilityHelperState, std::__1::allocator<CCVegaAccessibilityHelperState> >="__map_"{__split_buffer<CCVegaAccessibilityHelperState *, std::__1::allocator<CCVegaAccessibilityHelperState *> >="__first_"^^{?}"__begin_"^^{?}"__end_"^^{?}"__end_cap_"{__compressed_pair<CCVegaAccessibilityHelperState **, std::__1::allocator<CCVegaAccessibilityHelperState *> >="__value_"^^{?}}}"__start_"Q"__size_"{__compressed_pair<unsigned long, std::__1::allocator<CCVegaAccessibilityHelperState> >="__value_"Q}}}
{?="origin"{CGPoint="x"d"y"d}"ariaHidden"B}
@56@0:8@16@24@32@40^@48
@32@0:8@16^@24
v36@0:8@16@24B32
v48@0:8@16@24@32@40
^{CGImage=}16@0:8
@32@0:8@?16@24
@"CCVegaRenderer"
@"NSDictionary"
@"NSObject<CCChartViewDelegate>"
v24@0:8@?<v@?>16
@24@0:8@?16
Q24@0:8@?16
v24@0:8Q16
@"NSObject<CCAsyncQueueDelegate>"
@32@0:8*16Q24
{?=dddii}32@0:8^{CGImage=}16^{CGImage=}24
v48@0:8d16d24d32d40
v56@0:8d16d24d32d40@48
v24@0:8@"JSValue"16
v32@0:8@"JSValue"16@24
@44@0:8@16@24@32B40
{CGSize=dd}16@0:8
v28@0:8@16B24
v44@0:8@16@24@32B40
@52@0:8@16@24@32@40B48
^{CGColor=}24@0:8@16
^{CGColor=}32@0:8@16d24
^{CGImage=}24@0:8@16
@"CALayer"
{CGSize="width"d"height"d}
@"CCVegaAccessibilityHelper"
@"JSManagedValue"
v32@0:8d16@24
v40@0:8d16@24@32
v32@0:8d16@"NSString"24
v40@0:8d16@"NSString"24@32
@48@0:8d16d24d32d40
{CGAffineTransform=dddddd}24@0:8d16
v60@0:8d16d24d32d40d48B56
v64@0:8d16d24d32d40d48d56
v40@0:8@16d24d32
B32@0:8d16d24
v68@0:8d16d24d32d40d48B56@60
v72@0:8d16d24d32d40d48d56@64
@56@0:8d16d24d32d40@48
v48@0:8@16d24d32@40
v40@0:8d16d24@32
B40@0:8d16d24@32
@"JSValue"24@0:8@"NSString"16
@"JSValue"48@0:8d16d24d32d40
v40@0:8@"NSString"16d24d32
v24@0:8@"NSArray"16
@"JSValue"16@0:8
@"JSValue"56@0:8d16d24d32d40@48
v48@0:8@"NSString"16d24d32@40
v32@0:8@"NSArray"16@24
^{CGContext=}16@0:8
v44@0:8@16d24d32i40
^{CGContext=}
@"CCVegaJSFont"
@"CCVegaCGContext"24@0:8@"NSString"16
^{CGColor=}48@0:8d16d24d32d40
^{CGColor=}16@0:8
v24@0:8@"NSDictionary"16
^{CGPath=}24@0:8d16
@"CCVegaHTMLElement"24@0:8@"NSString"16
@"CCVegaHTMLElement"16@0:8
v24@0:8@"CCVegaHTMLElement"16
@"CCVegaHTMLElement"32@0:8@"NSString"16@24
@"CCVegaHTMLElement"
v40@0:8@"NSString"16@"JSValue"24@"JSValue"32
v48@0:8@"NSString"16@"JSValue"24@"JSValue"32@40
@48@0:8@16@24@32@40
v24@0:8^{CGImage=}16
v40@0:8@16@24@?32
I16@0:8
v20@0:8I16
@"CCVegaExpressionFunctions"
^{CGImage=}
@"CCViewRendererDelegate"
@"CCAsyncQueue"
@"NSObject<CCVegaRendererDelegate>"
@"CCVegaJSMouseEvent"
@48@0:8{CGPoint=dd}16{CGPoint=dd}32
  "aria": false,
  "customFormatTypes": true,
  "padding": 12,
  "signals": [
    {"name": "os", "value": {}},
    {"name": "color", "value": {}},
    {
      "name": "chartColor",
      "update": "os.macOS ? {\"mark\":color.controlAccentColor,\"background\":color.controlBackgroundColor,\"gridOuter\":color.quaternaryLabelColor,\"gridInner\":color.quaternaryLabelColor,\"gridDivider\":color.quaternaryLabelColor,\"groupTitle\":color.labelColor,\"axisLabel\":color.secondaryLabelColor,\"groupSubtitle\":color.secondaryLabelColor,\"axisTitle\":color.secondaryLabelColor,\"textMark\":color.labelColor} : os.watchOS ? {\"background\":\"black\",\"gridOuter\":\"rgb(64,64,64)\",\"gridInner\":\"rgb(64,64,64)\",\"gridDivider\":\"rgb(64,64,64)\",\"axisLabel\":\"rgb(128,128,128)\",\"axisTitle\":\"rgb(128,128,128)\",\"mark\":\"rgb(32,148,250)\",\"groupTitle\":\"rgb(128,128,128)\",\"groupSubtitle\":\"rgb(128,128,128)\",\"textMark\":\"rgb(128,128,128)\"} : {\"background\":color.systemBackgroundColor,\"gridOuter\":color.systemGray2Color,\"gridInner\":color.systemGray3Color,\"gridDivider\":color.systemGrayColor,\"axisLabel\":color.secondaryLabelColor,\"axisTitle\":color.secondaryLabelColor,\"mark\":color.systemBlueColor,\"groupTitle\":color.labelColor,\"groupSubtitle\":color.secondaryLabelColor,\"textMark\":color.labelColor}"
    },
    {"name": "textStyle", "value": {}},
    {"name": "calendar", "value": {}},
    {"name": "locale", "value": {}},
    {
      "name": "guideLabelStyle",
      "update": "os.macOS ? textStyle.subheadline : os.watchOS ? textStyle.caption2 : textStyle.caption2"
    },
    {
      "name": "guideTitleStyle",
      "update": "os.macOS ? textStyle.subheadline : os.watchOS ? textStyle.caption1 : textStyle.caption1"
    },
    {
      "name": "titleStyle",
      "update": "os.macOS ? textStyle.headline : os.watchOS ? textStyle.headline : textStyle.headline"
    },
    {
      "name": "subtitleStyle",
      "update": "os.macOS ? textStyle.subheadline : os.watchOS ? textStyle.subheadline : textStyle.subheadline"
    },
    {
      "name": "textMarkStyle",
      "update": "os.macOS ? textStyle.caption2 : os.watchOS ? textStyle.caption2 : textStyle.caption2"
    }
  ],
  "background": {"signal": "chartColor.background"},
  "view": {
    "stroke": {"signal": "chartColor.gridOuter"},
    "strokeWidth": 0.5,
    "step": 20
  },
  "mark": {"color": {"signal": "chartColor.mark"}},
  "area": {"opacity": 0.4},
  "bar": {"cornerRadiusEnd": 2},
  "circle": {"size": 50},
  "line": {"strokeCap": "round"},
  "point": {"size": 50},
  "square": {"size": 50},
  "text": {
    "color": {"signal": "chartColor.textMark"},
    "dir": {
      "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
    },
    "font": {"signal": "textMarkStyle.fontName"},
    "fontSize": {"signal": "textMarkStyle.pointSize"},
    "lineHeight": {"signal": "textMarkStyle.lineHeight"}
  },
  "style": {
    "guide-title": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.axisTitle"},
      "font": {"signal": "guideTitleStyle.fontName"},
      "fontSize": {"signal": "guideTitleStyle.pointSize"},
      "lineHeight": {"signal": "guideTitleStyle.lineHeight"}
    },
    "guide-label": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.axisLabel"},
      "fontWeight": 400,
      "fontSize": {"signal": "guideLabelStyle.pointSize"},
      "font": {"signal": "guideLabelStyle.fontName"},
      "lineHeight": {"signal": "guideLabelStyle.lineHeight"}
    },
    "group-title": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.groupTitle"},
      "font": {"signal": "titleStyle.fontName"},
      "fontSize": {"signal": "titleStyle.pointSize"},
      "lineHeight": {"signal": "titleStyle.lineHeight"}
    },
    "group-subtitle": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.groupSubtitle"},
      "font": {"signal": "subtitleStyle.fontName"},
      "fontSize": {"signal": "subtitleStyle.pointSize"},
      "lineHeight": {"signal": "subtitleStyle.lineHeight"}
    },
    "lineMarker": {"fill": "white", "stroke": {"signal": "chartColor.mark"}},
    "crosshair": {"stroke": "#666", "strokeDash": [2, 2]},
    "axis": {
      "domain": false,
      "domainColor": {"signal": "chartColor.gridOuter"},
      "domainWidth": 0.5,
      "gridColor": {"signal": "chartColor.gridInner"},
      "gridWidth": 0.5,
      "labelPadding": 4,
      "labelSeparation": 4,
      "ticks": false,
      "tickColor": {"signal": "chartColor.gridInner"},
      "tickRound": false,
      "translate": 0,
      "tickWidth": 0.5,
      "titlePadding": 8
    },
    "axis-temporal": {"gridDash": [2, 2], "tickDash": [2, 2]},
    "axis-x-horizontal": {
      "labelAngle": 0,
      "labelBaseline": "line-top",
      "labelPadding": 2
    },
    "axis-x-interval": {
      "ticks": true,
      "tickSize": {"signal": "guideLabelStyle.lineHeight + 2"},
      "labelAlign": "left",
      "labelPadding": {"signal": "-guideLabelStyle.lineHeight"},
      "labelOffset": 4,
      "labelExpr": "datum.index === 1 ? \"\" : datum.label"
    },
    "axis-year": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 4
    },
    "axis-month": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      }
    },
    "axis-week": {
      "gridDash": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 7
    },
    "axis-day": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 4
    },
    "axis-hour": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 4
    }
  },
  "axis": {"style": "axis"},
  "axisXQuantitative": {"style": "axis-x-horizontal"},
  "axisTemporal": {"style": "axis-temporal"},
  "axisXTemporal": {"style": ["axis-x-horizontal", "axis-x-interval"]},
  "scale": {"bandPaddingInner": 0.2},
  "legend": {
    "offset": 24,
    "symbolBaseFillColor": {"signal": "chartColor.axisTitle"}
  },
  "title": {"offset": 16},
  "range": {
    "category": [
      "#308BEF",
      "#4DC960",
      "#FF9500",
      "#EF5C53",
      "#A34FCD",
      "#00A39B",
      "#98685E",
      "#EEDB41"
    ],
    "heatmap": {"scheme": "yellowgreenblue"},
    "ordinal": {"scheme": "yellowgreenblue"},
    "ramp": {"scheme": "yellowgreenblue"}
var vega=function(t){"use strict";function e(t,e,n){return t.fields=e||[],t.fname=n,t}function n(t){return null==t?null:t.fname}function r(t){return null==t?null:t.fields}function i(t){throw Error(t)}function a(t){var e,n,r,a=[],u=null,o=0,s=t.length,l="";function c(){a.push(l+t.substring(e,n)),l="",e=n+1}for(t+="",e=n=0;n<s;++n)if("\\"===(r=t[n]))l+=t.substring(e,n),l+=t.substring(++n,++n),e=n;else if(r===u)c(),u=null,o=-1;else{if(u)continue;e===o&&'"'===r||e===o&&"'"===r?(e=n+1,u=r):"."!==r||o?"["===r?(n>e&&c(),o=e=n+1):"]"===r&&(o||i("Access path missing open bracket: "+t),o>0&&c(),o=0,e=n+1):n>e?c():e=n+1}return o&&i("Access path missing closing bracket: "+t),u&&i("Access path missing closing quote: "+t),n>e&&(n++,c()),a}var u=Array.isArray;function o(t){return t===Object(t)}function s(t){return"string"==typeof t}function l(t){return u(t)?"["+t.map(l)+"]":o(t)||s(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function c(t,n){var r=a(t),i="return _["+r.map(l).join("][")+"];";return e(Function("_",i),[t=1===r.length?r[0]:t],n||t)}var f=[],h=c("id"),d=e((function(t){return t}),f,"identity"),p=e((function(){return 0}),f,"zero"),m=e((function(){return 1}),f,"one"),v=e((function(){return!0}),f,"true"),g=e((function(){return!1}),f,"false");function y(t,e,n){var r=[e].concat([].slice.call(n));console[t].apply(console,r)}function _(t,e){var n=t||0;return{level:function(t){return arguments.length?(n=+t,this):n},error:function(){return n>=1&&y(e||"error","ERROR",arguments),this},warn:function(){return n>=2&&y(e||"warn","WARN",arguments),this},info:function(){return n>=3&&y(e||"log","INFO",arguments),this},debug:function(){return n>=4&&y(e||"log","DEBUG",arguments),this}}}var b=t=>"__proto__"!==t;function x(...t){return t.reduce((t,e)=>{for(var n in e)if("signals"===n)t.signals=A(t.signals,e.signals);else{var r="legend"===n?{layout:1}:"style"===n||null;w(t,n,e[n],r)}return t},{})}function w(t,e,n,r){var i,a;if(b(e))if(o(n)&&!u(n))for(i in a=o(t[e])?t[e]:t[e]={},n)r&&(!0===r||r[i])?w(a,i,n[i]):b(i)&&(a[i]=n[i]);else t[e]=n}function A(t,e){if(null==t)return e;var n={},r=[];function i(t){n[t.name]||(n[t.name]=1,r.push(t))}return e.forEach(i),t.forEach(i),r}function M(t){return t[t.length-1]}function k(t){return null==t||""===t?null:+t}function C(t){return function(e){return t*Math.exp(e)}}function D(t){return function(e){return Math.log(t*e)}}function E(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function F(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function B(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function T(t,e,n,r){var i=n(t[0]),a=n(M(t)),u=(a-i)*e;return[r(i-u),r(a-u)]}function S(t,e){return T(t,e,k,d)}function N(t,e){var n=Math.sign(t[0]);return T(t,e,D(n),C(n))}function O(t,e,n){return T(t,e,B(n),B(1/n))}function z(t,e,n){return T(t,e,E(n),F(n))}function R(t,e,n,r,i){var a=r(t[0]),u=r(M(t)),o=null!=e?r(e):(a+u)/2;return[i(o+(a-o)*n),i(o+(u-o)*n)]}function U(t,e,n){return R(t,e,n,k,d)}function q(t,e,n){var r=Math.sign(t[0]);return R(t,e,n,D(r),C(r))}function L(t,e,n,r){return R(t,e,n,B(r),B(1/r))}function P(t,e,n,r){return R(t,e,n,E(r),F(r))}function I(t){return 1+~~(new Date(t).getMonth()/3)}function j(t){return 1+~~(new Date(t).getUTCMonth()/3)}function $(t){return null!=t?u(t)?t:[t]:[]}function H(t,e,n){var r,i=t[0],a=t[1];return a<i&&(r=a,a=i,i=r),(r=a-i)>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-r),i+r]}function Y(t){return"function"==typeof t}function V(t,n){var i,u,o,s,c,f,h,d,p,m=[],v=(t=$(t)).map((function(t,e){return null==t?null:(m.push(e),Y(t)?t:a(t).map(l).join("]["))})),g=m.length-1,y=$(n),_="var u,v;return ";if(g<0)return null;for(u=0;u<=g;++u)Y(o=v[i=m[u]])?(s="(u=this."+(f="f"+i)+"(a))",c="(v=this."+f+"(b))",(h=h||{})[f]=o):(s="(u=a["+o+"])",c="(v=b["+o+"])"),f="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==y[i]?(p=1,d=-1):(p=-1,d=1),_+="("+s+"<"+c+"||u==null)&&v!=null?"+d+":(u>v||v==null)&&u!=null?"+p+":"+f+"!==u&&v===v?"+d+":v!==v&&u===u?"+p+(i<g?":":":0");return o=Function("a","b",_+";"),h&&(o=o.bind(h)),t=t.reduce((function(t,e){return Y(e)?(r(e)||[]).forEach((function(e){t[e]=1})):null!=e&&(t[e+""]=1),t}),{}),e(o,Object.keys(t))}function G(t){return Y(t)?t:function(){return t}}function W(t,e){var n,r;function i(){e(r),n=r=null}return function(e){r=e,n&&clearTimeout(n),n=setTimeout(i,t)}}function X(t){for(var e,n,r=1,i=arguments.length;r<i;++r)for(n in e=arguments[r])t[n]=e[n];return t}function J(t,e){var n,r,i,a,u=0;if(t&&(n=t.length))if(null==e){for(r=t[u];u<n&&(null==r||r!=r);r=t[++u]);for(i=a=r;u<n;++u)null!=(r=t[u])&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=e(t[u]);u<n&&(null==r||r!=r);r=e(t[++u]));for(i=a=r;u<n;++u)null!=(r=e(t[u]))&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function Z(t,e){var n,r,i,a,u,o=-1,s=t.length;if(null==e){for(;++o<s;)if(null!=(r=t[o])&&r>=r){n=i=r;break}if(o===s)return[-1,-1];for(a=u=o;++o<s;)null!=(r=t[o])&&(n>r&&(n=r,a=o),i<r&&(i=r,u=o))}else{for(;++o<s;)if(null!=(r=e(t[o],o,t))&&r>=r){n=i=r;break}if(o===s)return[-1,-1];for(a=u=o;++o<s;)null!=(r=e(t[o],o,t))&&(n>r&&(n=r,a=o),i<r&&(i=r,u=o))}return[a,u]}var Q=Object.prototype.hasOwnProperty;function K(t,e){return Q.call(t,e)}var tt={};function et(t){var e,n,r={};function i(t){return K(r,t)&&r[t]!==tt}return e={size:0,empty:0,object:r,has:i,get:function(t){return i(t)?r[t]:void 0},set:function(t,n){return i(t)||(++e.size,r[t]===tt&&--e.empty),r[t]=n,this},delete:function(t){return i(t)&&(--e.size,++e.empty,r[t]=tt),this},clear:function(){e.size=e.empty=0,e.object=r={}},test:function(t){return arguments.length?(n=t,e):n},clean:function(){var t,i,a={},u=0;for(t in r)(i=r[t])===tt||n&&n(i)||(a[t]=i,++u);e.size=u,e.empty=0,e.object=r=a}},t&&Object.keys(t).forEach((function(n){e.set(n,t[n])})),e}function nt(t,e,n,r,i,a){if(!n&&0!==n)return a;var u,o,s=t[0],l=M(t),c=+n;return l<s&&(u=s,s=l,l=u),(u=Math.abs(e-s))<(o=Math.abs(l-e))&&u<=c?r:o<=c?i:a}function rt(t,e){var n=t.prototype=Object.create(e.prototype);return n.constructor=t,n}function it(t,e,n,r){var i,a=e[0],u=e[e.length-1];return a>u&&(i=a,a=u,u=i),r=void 0===r||r,((n=void 0===n||n)?a<=t:a<t)&&(r?t<=u:t<u)}function at(t){return"boolean"==typeof t}function ut(t){return"[object Date]"===Object.prototype.toString.call(t)}function ot(t){return"number"==typeof t}function st(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function lt(t,n){return t&&(t=n?$(t).map((function(t){return t.replace(/\\(.)/g,"$1")})):$(t)),e(t&&t.length?Function("_","return ''+"+t.map((function(t){return"_["+(n?l(t):a(t).map(l).join("]["))+"]"})).join("+'|'+")+";"):function(){return""},t,"key")}function ct(t,e){var n=t[0],r=M(t),i=+e;return i?1===i?r:n+i*(r-n):n}function ft(t){var e,n,r;t=+t||1e4;var i=()=>{e={},n={},r=0},a=(i,a)=>(++r>t&&(n=e,e={},r=1),e[i]=a);return i(),{clear:i,has:t=>K(e,t)||K(n,t),get:t=>K(e,t)?e[t]:K(n,t)?a(t,n[t]):void 0,set:(t,n)=>K(e,t)?e[t]=n:a(t,n)}}function ht(t,e,n,r){var i=e.length,a=n.length;if(!a)return e;if(!i)return n;for(var u=r||new e.constructor(i+a),o=0,s=0,l=0;o<i&&s<a;++l)u[l]=t(e[o],n[s])>0?n[s++]:e[o++];for(;o<i;++o,++l)u[l]=e[o];for(;s<a;++s,++l)u[l]=n[s];return u}function dt(t,e){for(var n="";--e>=0;)n+=t;return n}function pt(t,e,n,r){var i=n||" ",a=t+"",u=e-a.length;return u<=0?a:"left"===r?dt(i,u)+a:"center"===r?dt(i,~~(u/2))+a+dt(i,Math.ceil(u/2)):a+dt(i,u)}function mt(t){return t&&M(t)-t[0]||0}function vt(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t)&&!!t}function gt(t){return ot(t)||ut(t)?t:Date.parse(t)}function yt(t,e){return e=e||gt,null==t||""===t?null:e(t)}function _t(t){return null==t||""===t?null:t+""}function bt(t){for(var e={},n=0,r=t.length;n<r;++n)e[t[n]]=!0;return e}function xt(t,e,n,r){var i=null!=r?r:"
",a=t+"",u=a.length,o=Math.max(0,e-i.length);return u<=e?a:"left"===n?i+a.slice(u-o):"center"===n?a.slice(0,Math.ceil(o/2))+i+a.slice(u-~~(o/2)):a.slice(0,o)+i}function wt(t,e,n){if(t){var r,i=0,a=t.length;if(e)for(;i<a;++i)(r=e(t[i]))&&n(r,i,t);else t.forEach(n)}}var At=Object.freeze({__proto__:null,accessor:e,accessorName:n,accessorFields:r,id:h,identity:d,zero:p,one:m,truthy:v,falsy:g,logger:_,None:0,Error:1,Warn:2,Info:3,Debug:4,mergeConfig:x,writeConfig:w,panLinear:S,panLog:N,panPow:O,panSymlog:z,zoomLinear:U,zoomLog:q,zoomPow:L,zoomSymlog:P,quarter:I,utcquarter:j,array:$,clampRange:H,compare:V,constant:G,debounce:W,error:i,extend:X,extent:J,extentIndex:Z,fastmap:et,field:c,flush:nt,hasOwnProperty:K,inherits:rt,inrange:it,isArray:u,isBoolean:at,isDate:ut,isFunction:Y,isNumber:ot,isObject:o,isRegExp:st,isString:s,key:lt,lerp:ct,lruCache:ft,merge:ht,pad:pt,peek:M,repeat:dt,span:mt,splitAccessPath:a,stringValue:l,toBoolean:vt,toDate:yt,toNumber:k,toString:_t,toSet:bt,truncate:xt,visitArray:wt});function Mt(t){var e=t||d,n=[],r={};return n.add=function(t){var i=e(t);return r[i]||(r[i]=1,n.push(t)),n},n.remove=function(t){var i,a=e(t);return r[a]&&(r[a]=0,(i=n.indexOf(t))>=0&&n.splice(i,1)),n},n}async function kt(t,e){try{await e(t)}catch(e){t.error(e)}}var Ct=Symbol("vega_id"),Dt=1;function Et(t){return!(!t||!Ft(t))}function Ft(t){return t[Ct]}function Bt(t,e){return t[Ct]=e,t}function Tt(t){var e=t===Object(t)?t:{data:t};return Ft(e)?e:Bt(e,Dt++)}function St(t){return Nt(t,Tt({}))}function Nt(t,e){for(var n in t)e[n]=t[n];return e}function Ot(t,e){return Bt(e,Ft(t))}function zt(t,e){return t?e?(n,r)=>t(n,r)||Ft(e(n))-Ft(e(r)):(e,n)=>t(e,n)||Ft(e)-Ft(n):null}function Rt(t){return t&&t.constructor===Ut}function Ut(){var t=[],e=[],n=[],r=[],i=[],a=!1;return{constructor:Ut,insert:function(e){for(var n=$(e),r=0,i=n.length;r<i;++r)t.push(n[r]);return this},remove:function(t){for(var n=Y(t)?r:e,i=$(t),a=0,u=i.length;a<u;++a)n.push(i[a]);return this},modify:function(t,e,r){var a={field:e,value:G(r)};return Y(t)?(a.filter=t,i.push(a)):(a.tuple=t,n.push(a)),this},encode:function(t,e){return Y(t)?i.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},reflow:function(){return a=!0,this},pulse:function(u,o){var s,l,c,f,h,d,p={},m={};for(s=0,l=o.length;s<l;++s)p[Ft(o[s])]=1;for(s=0,l=e.length;s<l;++s)p[Ft(h=e[s])]=-1;for(s=0,l=r.length;s<l;++s)f=r[s],o.forEach((function(t){f(t)&&(p[Ft(t)]=-1)}));for(s=0,l=t.length;s<l;++s)d=Ft(h=t[s]),p[d]?p[d]=1:u.add.push(Tt(t[s]));for(s=0,l=o.length;s<l;++s)h=o[s],p[Ft(h)]<0&&u.rem.push(h);function v(t,e,n){n?t[e]=n(t):u.encode=e,a||(m[Ft(t)]=t)}for(s=0,l=n.length;s<l;++s)h=(c=n[s]).tuple,f=c.field,(d=p[Ft(h)])>0&&(v(h,f,c.value),u.modifies(f));for(s=0,l=i.length;s<l;++s)c=i[s],f=c.filter,o.forEach((function(t){f(t)&&p[Ft(t)]>0&&v(t,c.field,c.value)})),u.modifies(c.field);if(a)u.mod=e.length||r.length?o.filter((function(t){return p[Ft(t)]>0})):o.slice();else for(d in m)u.mod.push(m[d]);return u}}}var qt="_:mod:_";function Lt(){Object.defineProperty(this,qt,{writable:!0,value:{}})}var Pt=Lt.prototype;Pt.set=function(t,e,n,r){var i=this,a=i[t],o=i[qt];return null!=e&&e>=0?(a[e]!==n||r)&&(a[e]=n,o[e+":"+t]=-1,o[t]=-1):(a!==n||r)&&(i[t]=n,o[t]=u(n)?1+n.length:-1),i},Pt.modified=function(t,e){var n,r=this[qt];if(!arguments.length){for(n in r)if(r[n])return!0;return!1}if(u(t)){for(n=0;n<t.length;++n)if(r[t[n]])return!0;return!1}return null!=e&&e>=0?e+1<r[t]||!!r[e+":"+t]:!!r[t]},Pt.clear=function(){return this[qt]={},this};var It=0,jt=new Lt;function $t(t,e,n,r){this.id=++It,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,r)}var Ht=$t.prototype;function Yt(t){return function(e){var n=this.flags;return 0===arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}Ht.targets=function(){return this._targets||(this._targets=Mt(h))},Ht.set=function(t){return this.value!==t?(this.value=t,1):0},Ht.skip=Yt(1),Ht.modified=Yt(2),Ht.parameters=function(t,e,n){e=!1!==e;var r,a,o,s,l=this,c=l._argval=l._argval||new Lt,f=l._argops=l._argops||[],h=[];function d(t,n,r){r instanceof $t?(r!==l&&(e&&r.targets().add(l),h.push(r)),f.push({op:r,name:t,index:n})):c.set(t,n,r)}for(r in t)if(a=t[r],"pulse"===r)$(a).forEach((function(t){t instanceof $t?t!==l&&(t.targets().add(l),h.push(t)):i("Pulse parameters must be operator instances.")})),l.source=a;else if(u(a))for(c.set(r,-1,Array(o=a.length)),s=0;s<o;++s)d(r,s,a[s]);else d(r,-1,a);return this.marshall().clear(),n&&(f.initonly=!0),h},Ht.marshall=function(t){var e,n,r,i,a,u=this._argval||jt,o=this._argops;if(o){for(n=0,r=o.length;n<r;++n)a=(i=(e=o[n]).op).modified()&&i.stamp===t,u.set(e.name,e.index,i.value,a);if(o.initonly){for(n=0;n<r;++n)(e=o[n]).op.targets().remove(this);this._argops=null,this._update=null}}return u},Ht.evaluate=function(t){var e=this._update;if(e){var n=this.marshall(t.stamp),r=e.call(this,n,t);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return t.StopPropagation}},Ht.run=function(t){return t.stamp<this.stamp?t.StopPropagation:(this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t);var e};var Vt=0;function Gt(t,e,n){this.id=++Vt,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function Wt(t,e,n){return new Gt(t,e,n)}var Xt=Gt.prototype;Xt._filter=v,Xt._apply=d,Xt.targets=function(){return this._targets||(this._targets=Mt(h))},Xt.consume=function(t){return arguments.length?(this._consume=!!t,this):!!this._consume},Xt.receive=function(t){if(this._filter(t)){for(var e=this.value=this._apply(t),n=this._targets,r=n?n.length:0,i=0;i<r;++i)n[i].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},Xt.filter=function(t){var e=Wt(t);return this.targets().add(e),e},Xt.apply=function(t){var e=Wt(null,t);return this.targets().add(e),e},Xt.merge=function(){var t=Wt();this.targets().add(t);for(var e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},Xt.throttle=function(t){var e=-1;return this.filter((function(){var n=Date.now();return n-e>t?(e=n,1):0}))},Xt.debounce=function(t){var e=Wt();return this.targets().add(Wt(null,null,W(t,(function(t){var n=t.dataflow;e.receive(t),n&&n.run&&n.run()})))),e},Xt.between=function(t,e){var n=!1;return t.targets().add(Wt(null,null,(function(){n=!0}))),e.targets().add(Wt(null,null,(function(){n=!1}))),this.filter((function(){return n}))};var Jt=/^([A-Za-z]+:)?\/\//,Zt=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Qt=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;async function Kt(t,e){var n=await this.sanitize(t,e),r=n.href;return n.localFile?this.file(r):this.http(r,e)}async function te(t,e){e=X({},this.options,e);var n,r,a,u=this.fileAccess,o={href:null},s=Zt.test(t.replace(Qt,""));null!=t&&"string"==typeof t&&s||i("Sanitize failure, invalid URI: "+l(t));var c=Jt.test(t);return(a=e.baseURL)&&!c&&(t.startsWith("/")||"/"===a[a.length-1]||(t="/"+t),t=a+t),r=(n=t.startsWith("file://"))||"file"===e.mode||"http"!==e.mode&&!c&&u,n?t=t.slice("file://".length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),r=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(o,"localFile",{value:!!r}),o.href=t,e.target&&(o.target=e.target+""),e.rel&&(o.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(o.crossOrigin=e.crossOrigin+""),o}function ee(t){return t?function(e){return new Promise((function(n,r){t.readFile(e,(function(t,e){t?r(t):n(e)}))}))}:ne}async function ne(){i("No file system access.")}function re(t){return t?async function(e,n){var r=X({},this.options.http,n),a=n&&n.response,u=await t(e,r);return u.ok?Y(u[a])?u[a]():u.text():i(u.status+""+u.statusText)}:ie}async function ie(){i("No HTTP fetch method available.")}var ae={boolean:vt,integer:k,number:k,date:yt,string:_t,unknown:d},ue=[function(t){return"true"===t||"false"===t||!0===t||!1===t},function(t){return ce(t)&&Number.isInteger(+t)},ce,function(t){return!Number.isNaN(Date.parse(t))}],oe=["boolean","integer","number","date"];function se(t,e){if(!t||!t.length)return"unknown";for(var n,r,i,a=t.length,u=ue.length,o=ue.map((t,e)=>e+1),s=0,l=0;s<a;++s)for(r=e?t[s][e]:t[s],n=0;n<u;++n)if(o[n]&&(null!=(i=r)&&i==i)&&!ue[n](r)&&(o[n]=0,++l===ue.length))return"string";return oe[o.reduce((t,e)=>0===t?e:t,0)-1]}function le(t,e){return e.reduce((function(e,n){return e[n]=se(t,n),e}),{})}function ce(t){return!(Number.isNaN(+t)||t instanceof Date)}var fe={},he={};function de(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function pe(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function me(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function ve(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+me(-t,6):t>9999?"+"+me(t,6):me(t,4)}(t.getUTCFullYear())+"-"+me(t.getUTCMonth()+1,2)+"-"+me(t.getUTCDate(),2)+(i?"T"+me(e,2)+":"+me(n,2)+":"+me(r,2)+"."+me(i,3)+"Z":r?"T"+me(e,2)+":"+me(n,2)+":"+me(r,2)+"Z":n||e?"T"+me(e,2)+":"+me(n,2)+"Z":"")}function ge(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],a=t.length,u=0,o=0,s=a<=0,l=!1;function c(){if(s)return he;if(l)return l=!1,fe;var e,r,i=u;if(34===t.charCodeAt(i)){for(;u++<a&&34!==t.charCodeAt(u)||34===t.charCodeAt(++u););return(e=u)>=a?s=!0:10===(r=t.charCodeAt(u++))?l=!0:13===r&&(l=!0,10===t.charCodeAt(u)&&++u),t.slice(i+1,e-1).replace(/""/g,'"')}for(;u<a;){if(10===(r=t.charCodeAt(e=u++)))l=!0;else if(13===r)l=!0,10===t.charCodeAt(u)&&++u;else if(r!==n)continue;return t.slice(i,e)}return s=!0,t.slice(i,a)}for(10===t.charCodeAt(a-1)&&--a,13===t.charCodeAt(a-1)&&--a;(r=c())!==he;){for(var f=[];r!==fe&&r!==he;)f.push(r),r=c();e&&null==(f=e(f,o++))||i.push(f)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return u(e[t])})).join(t)}))}function a(e){return e.map(u).join(t)}function u(t){return null==t?"":t instanceof Date?ve(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,a=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=de(t);return function(r,i){return e(n(r),i,t)}}(t,e):de(t)}));return a.columns=i||[],a},parseRows:r,format:function(e,n){return null==n&&(n=pe(e)),[n.map(u).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=pe(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(a).join("\n")},formatRow:a,formatValue:u}}function ye(t){var e=function(e,n){var r={delimiter:t};return _e(e,n?X(n,r):r)};return e.responseType="text",e}function _e(t,e){return e.header&&(t=e.header.map(l).join(e.delimiter)+"\n"+t),ge(e.delimiter).parse(t+"")}function be(t,e){var n,r=e&&e.property?c(e.property):d;return!o(t)||(n=t,"function"==typeof Buffer&&Y(Buffer.isBuffer)&&Buffer.isBuffer(n))?r(JSON.parse(t)):function(t,e){return e&&e.copy?JSON.parse(JSON.stringify(t)):t}(r(t))}function xe(t){return t}function we(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Ae(t,e)}))}:Ae(t,e)}function Ae(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,a=Me(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function Me(t,e){var n=function(t){if(null==t)return xe;var e,n,r=t.scale[0],i=t.scale[1],a=t.translate[0],u=t.translate[1];return function(t,o){o||(e=n=0);var s=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*r+a,c[1]=(n+=t[1])*i+u;s<l;)c[s]=t[s],++s;return c}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],a=0,u=i.length;a<u;++a)e.push(n(i[a],a));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,u)}function a(t){return n(t)}function u(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function o(t){for(var e=u(t);e.length<4;)e.push(e[0]);return e}function s(t){return t.map(o)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=u(e.arcs);break;case"MultiLineString":n=e.arcs.map(u);break;case"Polygon":n=s(e.arcs);break;case"MultiPolygon":n=e.arcs.map(s);break;default:return null}return{type:r,coordinates:n}}(e)}function ke(t,e){var n={},r={},i={},a=[],u=-1;function o(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),a.push(i)}}return e.forEach((function(n,r){var i,a=t.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=e[++u],e[u]=n,e[r]=i)})),e.forEach((function(e){var n,a,u=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1];return e<0?[n,i]:[i,n]}(e),o=u[0],s=u[1];if(n=i[o])if(delete i[n.end],n.push(e),n.end=s,a=r[s]){delete r[a.start];var l=a===n?n:n.concat(a);r[l.start=n.start]=i[l.end=a.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[s])if(delete r[n.start],n.unshift(e),n.start=o,a=i[o]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=o]=i[n.end=s]=n})),o(i,r),o(r,i),e.forEach((function(t){n[t<0?~t:t]||a.push([t])})),a}function Ce(t){return Me(t,De.apply(this,arguments))}function De(t,e,n){var r,i,a;if(arguments.length>1)r=Ee(t,e,n);else for(i=0,r=new Array(a=t.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:ke(t,r)}}function Ee(t,e,n){var r,i=[],a=[];function u(t){var e=t<0?~t:t;(a[e]||(a[e]=[])).push({i:t,g:r})}function o(t){t.forEach(u)}function s(t){t.forEach(o)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":o(e.arcs);break;case"MultiLineString":case"Polygon":s(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(s)}(e.arcs)}}(e),a.forEach(null==n?function(t){i.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}_e.responseType="text",be.responseType="json";var Fe={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function Be(t,e){var n,r,a,u;return t=be(t,e),e&&e.feature?(n=we,a=e.feature):e&&e.mesh?(n=Ce,a=e.mesh,u=Fe[e.filter]):i("Missing TopoJSON feature or mesh parameter."),(r=(r=t.objects[a])?n(t,r,u):i("Invalid TopoJSON object: "+a))&&r.features||[r]}Be.responseType="json";var Te={dsv:_e,csv:ye(","),tsv:ye("\t"),json:be,topojson:Be};function Se(t,e){return arguments.length>1?(Te[t]=e,this):K(Te,t)?Te[t]:null}function Ne(t){var e=Se(t);return e&&e.responseType||"text"}var Oe=new Date,ze=new Date;function Re(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,a){var u,o=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return o;do{o.push(u=new Date(+n)),e(n,a),t(n)}while(u<n&&n<r);return o},i.filter=function(n){return Re((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return Oe.setTime(+e),ze.setTime(+r),t(Oe),t(ze),Math.floor(n(Oe,ze))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var Ue=Re((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));Ue.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Re((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):Ue:null};var qe=Re((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()})),Le=Re((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getMinutes()})),Pe=Re((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getHours()})),Ie=Re((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5}),(function(t){return t.getDate()-1}));function je(t){return Re((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var $e=je(0),He=je(1),Ye=(je(2),je(3),je(4)),Ve=(je(5),je(6),Re((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}))),Ge=Re((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));Ge.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Re((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var We=Re((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getUTCMinutes()})),Xe=Re((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getUTCHours()})),Je=Re((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1}));function Ze(t){return Re((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var Qe=Ze(0),Ke=Ze(1),tn=(Ze(2),Ze(3),Ze(4)),en=(Ze(5),Ze(6),Re((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()}))),nn=Re((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));function rn(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function an(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function un(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}nn.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Re((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var on,sn,ln,cn,fn,hn={"-":"",_:" ",0:"0"},dn=/^\s*\d+/,pn=/^%/,mn=/[\\^$*+?|[\]().{}]/g;function vn(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(e)+i:i)}function gn(t){return t.replace(mn,"\\$&")}function yn(t){return new RegExp("^(?:"+t.map(gn).join("|")+")","i")}function _n(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function bn(t,e,n){var r=dn.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function xn(t,e,n){var r=dn.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function wn(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function An(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Mn(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function kn(t,e,n){var r=dn.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Cn(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Dn(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function En(t,e,n){var r=dn.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function Fn(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Bn(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Tn(t,e,n){var r=dn.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Sn(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Nn(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function On(t,e,n){var r=dn.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function zn(t,e,n){var r=dn.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Rn(t,e,n){var r=dn.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Un(t,e,n){var r=pn.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function qn(t,e,n){var r=dn.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Ln(t,e,n){var r=dn.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function Pn(t,e){return vn(t.getDate(),e,2)}function In(t,e){return vn(t.getHours(),e,2)}function jn(t,e){return vn(t.getHours()%12||12,e,2)}function $n(t,e){return vn(1+Ie.count(Ge(t),t),e,3)}function Hn(t,e){return vn(t.getMilliseconds(),e,3)}function Yn(t,e){return Hn(t,e)+"000"}function Vn(t,e){return vn(t.getMonth()+1,e,2)}function Gn(t,e){return vn(t.getMinutes(),e,2)}function Wn(t,e){return vn(t.getSeconds(),e,2)}function Xn(t){var e=t.getDay();return 0===e?7:e}function Jn(t,e){return vn($e.count(Ge(t)-1,t),e,2)}function Zn(t,e){var n=t.getDay();return t=n>=4||0===n?Ye(t):Ye.ceil(t),vn(Ye.count(Ge(t),t)+(4===Ge(t).getDay()),e,2)}function Qn(t){return t.getDay()}function Kn(t,e){return vn(He.count(Ge(t)-1,t),e,2)}function tr(t,e){return vn(t.getFullYear()%100,e,2)}function er(t,e){return vn(t.getFullYear()%1e4,e,4)}function nr(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+vn(e/60|0,"0",2)+vn(e%60,"0",2)}function rr(t,e){return vn(t.getUTCDate(),e,2)}function ir(t,e){return vn(t.getUTCHours(),e,2)}function ar(t,e){return vn(t.getUTCHours()%12||12,e,2)}function ur(t,e){return vn(1+Je.count(nn(t),t),e,3)}function or(t,e){return vn(t.getUTCMilliseconds(),e,3)}function sr(t,e){return or(t,e)+"000"}function lr(t,e){return vn(t.getUTCMonth()+1,e,2)}function cr(t,e){return vn(t.getUTCMinutes(),e,2)}function fr(t,e){return vn(t.getUTCSeconds(),e,2)}function hr(t){var e=t.getUTCDay();return 0===e?7:e}function dr(t,e){return vn(Qe.count(nn(t)-1,t),e,2)}function pr(t,e){var n=t.getUTCDay();return t=n>=4||0===n?tn(t):tn.ceil(t),vn(tn.count(nn(t),t)+(4===nn(t).getUTCDay()),e,2)}function mr(t){return t.getUTCDay()}function vr(t,e){return vn(Ke.count(nn(t)-1,t),e,2)}function gr(t,e){return vn(t.getUTCFullYear()%100,e,2)}function yr(t,e){return vn(t.getUTCFullYear()%1e4,e,4)}function _r(){return"+0000"}function br(){return"%"}function xr(t){return+t}function wr(t){return Math.floor(+t/1e3)}function Ar(t){return on=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,a=t.days,u=t.shortDays,o=t.months,s=t.shortMonths,l=yn(i),c=_n(i),f=yn(a),h=_n(a),d=yn(u),p=_n(u),m=yn(o),v=_n(o),g=yn(s),y=_n(s),_={a:function(t){return u[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return s[t.getMonth()]},B:function(t){return o[t.getMonth()]},c:null,d:Pn,e:Pn,f:Yn,H:In,I:jn,j:$n,L:Hn,m:Vn,M:Gn,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:xr,s:wr,S:Wn,u:Xn,U:Jn,V:Zn,w:Qn,W:Kn,x:null,X:null,y:tr,Y:er,Z:nr,"%":br},b={a:function(t){return u[t.getUTCDay()]},A:function(t){return a[t.getUTCDay()]},b:function(t){return s[t.getUTCMonth()]},B:function(t){return o[t.getUTCMonth()]},c:null,d:rr,e:rr,f:sr,H:ir,I:ar,j:ur,L:or,m:lr,M:cr,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:xr,s:wr,S:fr,u:hr,U:dr,V:pr,w:mr,W:vr,x:null,X:null,y:gr,Y:yr,Z:_r,"%":br},x={a:function(t,e,n){var r=d.exec(e.slice(n));return r?(t.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=m.exec(e.slice(n));return r?(t.m=v[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return M(t,e,n,r)},d:Bn,e:Bn,f:Rn,H:Sn,I:Sn,j:Tn,L:zn,m:Fn,M:Nn,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:En,Q:qn,s:Ln,S:On,u:xn,U:wn,V:An,w:bn,W:Mn,x:function(t,e,r){return M(t,n,e,r)},X:function(t,e,n){return M(t,r,e,n)},y:Cn,Y:kn,Z:Dn,"%":Un};function w(t,e){return function(n){var r,i,a,u=[],o=-1,s=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++o<l;)37===t.charCodeAt(o)&&(u.push(t.slice(s,o)),null!=(i=hn[r=t.charAt(++o)])?r=t.charAt(++o):i="e"===r?" ":"0",(a=e[r])&&(r=a(n,i)),u.push(r),s=o+1);return u.push(t.slice(s,o)),u.join("")}}function A(t,e){return function(n){var r,i,a=un(1900,void 0,1);if(M(a,t,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(e&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=an(un(a.y,0,1))).getUTCDay(),r=i>4||0===i?Ke.ceil(r):Ke(r),r=Je.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=rn(un(a.y,0,1))).getDay(),r=i>4||0===i?He.ceil(r):He(r),r=Ie.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?an(un(a.y,0,1)).getUTCDay():rn(un(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,an(a)):rn(a)}}function M(t,e,n,r){for(var i,a,u=0,o=e.length,s=n.length;u<o;){if(r>=s)return-1;if(37===(i=e.charCodeAt(u++))){if(i=e.charAt(u++),!(a=x[i in hn?e.charAt(u++):i])||(r=a(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),b.x=w(n,b),b.X=w(r,b),b.c=w(e,b),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=A(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",b);return e.toString=function(){return t},e},utcParse:function(t){var e=A(t+="",!0);return e.toString=function(){return t},e}}}(t),sn=on.format,ln=on.parse,cn=on.utcFormat,fn=on.utcParse,on}function Mr(t,e,n){var r=Se((e=e||{}).type||"json");return r||i("Unknown data format type: "+e.type),t=r(t,e),e.parse&&function(t,e,n){if(!t.length)return;n=n||ln;var r,i,a,u,o,s,l,c=t.columns||Object.keys(t[0]);"auto"===e&&(e=le(t,c));for(c=Object.keys(e),r=c.map((function(t){var r,i,a=e[t];if(a&&(a.startsWith("date:")||a.startsWith("utc:")))return("'"===(i=(r=a.split(/:(.+)?/,2))[1])[0]&&"'"===i[i.length-1]||'"'===i[0]&&'"'===i[i.length-1])&&(i=i.slice(1,-1)),"utc"===r[0]?fn(i):n(i);if(!ae[a])throw Error("Illegal format pattern: "+t+":"+a);return ae[a]})),u=0,s=t.length,l=c.length;u<s;++u)for(i=t[u],o=0;o<l;++o)a=c[o],i[a]=r[o](i[a])}(t,e.parse,n),K(t,"columns")&&delete t.columns,t}Ar({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var kr=function(t,e){return function(n){return{options:n||{},sanitize:te,load:Kt,fileAccess:!!e,file:ee(e),http:re(t)}}}("undefined"!=typeof fetch&&fetch,null),Cr=Mr;var Dr={skip:!0};function Er(t,e,n,r,i,a){var u,o,s=X({},a,Dr);Y(n)||(n=G(n)),void 0===r?u=e=>t.touch(n(e)):Y(r)?(o=new $t(null,r,i,!1),u=e=>{o.evaluate(e);var r=n(e),i=o.value;Rt(i)?t.pulse(r,i,a):t.update(r,i,s)}):u=e=>t.update(n(e),r,s),e.apply(u)}function Fr(t,e,n,r,i,a){if(void 0===r)e.targets().add(n);else{var u=a||{},o=new $t(null,function(t,e){return e=Y(e)?e:G(e),t?function(n,r){var i=e(n,r);return t.skip()||(t.skip(i!==this.value).value=i),i}:e}(n,r),i,!1);o.modified(u.force),o.rank=e.rank,e.targets().add(o),n&&(o.skip(!0),o.value=n.value,o.targets().add(n),t.connect(n,[o]))}}var Br={};function Tr(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}var Sr=Tr.prototype;function Nr(t,e){return t?function(n,r){return t(n,r)&&e(n,r)}:e}function Or(t,e){var n=[];return wt(t,e,(function(t){n.push(t)})),n}function zr(t,e){var n={};return t.visit(e,(function(t){n[Ft(t)]=1})),function(t){return n[Ft(t)]?null:t}}function Rr(t,e,n,r){var i,a,u,o,s,l=this,c=0;for(this.dataflow=t,this.stamp=e,this.fields=null,this.encode=r||null,this.pulses=n,u=0,o=n.length;u<o;++u)if((i=n[u]).stamp===e){if(i.fields)for(s in a=l.fields||(l.fields={}),i.fields)a[s]=1;i.changed(l.ADD)&&(c|=l.ADD),i.changed(l.REM)&&(c|=l.REM),i.changed(l.MOD)&&(c|=l.MOD)}this.changes=c}Sr.StopPropagation=Br,Sr.ADD=1,Sr.REM=2,Sr.MOD=4,Sr.ADD_REM=3,Sr.ADD_MOD=5,Sr.ALL=7,Sr.REFLOW=8,Sr.SOURCE=16,Sr.NO_SOURCE=32,Sr.NO_FIELDS=64,Sr.fork=function(t){return new Tr(this.dataflow).init(this,t)},Sr.clone=function(){var t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},Sr.addAll=function(){var t=this;return this.source&&this.source.length!==this.add.length?((t=new Tr(this.dataflow).init(this)).add=t.source,t):t},Sr.init=function(t,e){var n=this;return n.stamp=t.stamp,n.encode=t.encode,!t.fields||64&e||(n.fields=t.fields),1&e?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),2&e?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),4&e?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),32&e?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source),n},Sr.runAfter=function(t){this.dataflow.runAfter(t)},Sr.changed=function(t){var e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},Sr.reflow=function(t){if(t)return this.fork(7).reflow();var e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,zr(this,1))),this},Sr.modifies=function(t){var e=this.fields||(this.fields={});return u(t)?t.forEach(t=>e[t]=!0):e[t]=!0,this},Sr.modified=function(t,e){var n=this.fields;return!(!e&&!this.mod.length||!n)&&(arguments.length?u(t)?t.some((function(t){return n[t]})):n[t]:!!n)},Sr.filter=function(t,e){var n=this;return 1&t&&(n.addF=Nr(n.addF,e)),2&t&&(n.remF=Nr(n.remF,e)),4&t&&(n.modF=Nr(n.modF,e)),16&t&&(n.srcF=Nr(n.srcF,e)),n},Sr.materialize=function(t){var e=this;return 1&(t=t||7)&&e.addF&&(e.add=Or(e.add,e.addF),e.addF=null),2&t&&e.remF&&(e.rem=Or(e.rem,e.remF),e.remF=null),4&t&&e.modF&&(e.mod=Or(e.mod,e.modF),e.modF=null),16&t&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},Sr.visit=function(t,e){var n,r,i=this,a=e;return 16&t?(wt(i.source,i.srcF,a),i):(1&t&&wt(i.add,i.addF,a),2&t&&wt(i.rem,i.remF,a),4&t&&wt(i.mod,i.modF,a),8&t&&(n=i.source)&&((r=i.add.length+i.mod.length)===n.length||wt(n,r?zr(i,5):i.srcF,a)),i)};var Ur=rt(Rr,Tr);function qr(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}Ur.fork=function(t){var e=new Tr(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,(function(t){return e.add.push(t)})),t&e.REM&&this.visit(e.REM,(function(t){return e.rem.push(t)})),t&e.MOD&&this.visit(e.MOD,(function(t){return e.mod.push(t)}))),e},Ur.changed=function(t){return this.changes&t},Ur.modified=function(t){var e=this,n=e.fields;return n&&e.changes&e.MOD?u(t)?t.some((function(t){return n[t]})):n[t]:0},Ur.filter=function(){i("MultiPulse does not support filtering.")},Ur.materialize=function(){i("MultiPulse does not support materialization.")},Ur.visit=function(t,e){var n=this,r=n.pulses,i=r.length,a=0;if(t&n.SOURCE)for(;a<i;++a)r[a].visit(t,e);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(t,e);return n};var Lr={skip:!1,force:!1};function Pr(t){var e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),Ir(e,0,e.length-1,t)),pop:()=>{var n,r=e.pop();return e.length?(n=e[0],e[0]=r,function(t,e,n){var r,i=e,a=t.length,u=t[e],o=1+(e<<1);for(;o<a;)(r=o+1)<a&&n(t[o],t[r])>=0&&(o=r),t[e]=t[o],o=1+((e=o)<<1);t[e]=u,Ir(t,i,e,n)}(e,0,t)):n=r,n}}}function Ir(t,e,n,r){var i,a,u;for(i=t[n];n>e&&r(i,a=t[u=n-1>>1])<0;)t[n]=a,n=u;return t[n]=i}function jr(){this.logger(_()),this.logLevel(1),this._clock=0,this._rank=0;try{this._loader=kr()}catch(t){}this._touched=Mt(h),this._input={},this._pulse=null,this._heap=Pr((t,e)=>t.qrank-e.qrank),this._postrun=[]}var $r=jr.prototype;function Hr(t){return function(){return this._log[t].apply(this,arguments)}}function Yr(t,e){$t.call(this,t,null,e)}$r.stamp=function(){return this._clock},$r.loader=function(t){return arguments.length?(this._loader=t,this):this._loader},$r.cleanThreshold=1e4,$r.add=function(t,e,n,r){var i,a=1;return t instanceof $t?i=t:t&&t.prototype instanceof $t?i=new t:Y(t)?i=new $t(null,t):(a=0,i=new $t(t,e)),this.rank(i),a&&(r=n,n=e),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},$r.connect=function(t,e){var n,r,i=t.rank;for(n=0,r=e.length;n<r;++n)if(i<e[n].rank)return void this.rerank(t)},$r.rank=function(t){t.rank=++this._rank},$r.rerank=function(t){for(var e,n,r,a=[t];a.length;)if(this.rank(e=a.pop()),n=e._targets)for(r=n.length;--r>=0;)a.push(e=n[r]),e===t&&i("Cycle detected in dataflow graph.")},$r.pulse=function(t,e,n){this.touch(t,n||Lr);var r=new Tr(this,this._clock+(this._pulse?0:1)),i=t.pulse&&t.pulse.source||[];return r.target=t,this._input[t.id]=e.pulse(r,i),this},$r.touch=function(t,e){var n=e||Lr;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},$r.update=function(t,e,n){var r=n||Lr;return(t.set(e)||r.force)&&this.touch(t,r),this},$r.changeset=Ut,$r.ingest=function(t,e,n){return this.pulse(t,this.changeset().insert(Cr(e,n)))},$r.parse=Cr,$r.preload=async function(t,e,n){var r=this,i=r._pending||function(t){var e,n=new Promise((function(t){e=t}));return n.requests=0,n.done=function(){0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(r);i.requests+=1;var a=await r.request(e,n);return r.pulse(t,r.changeset().remove(v).insert(a.data||[])),i.done(),a},$r.request=async function(t,e){var n,r=0;try{n=await this.loader().load(t,{context:"dataflow",response:Ne(e&&e.type)});try{n=Cr(n,e)}catch(e){r=-2,this.warn("Data ingestion failed",t,e)}}catch(e){r=-1,this.warn("Loading failed",t,e)}return{data:n,status:r}},$r.events=function(t,e,n,r){for(var i,a=this,u=Wt(n,r),o=function(t){t.dataflow=a;try{u.receive(t)}catch(t){a.error(t)}finally{a.run()}},s=0,l=(i="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):$(t)).length;s<l;++s)i[s].addEventListener(e,o);return u},$r.on=function(t,e,n,r,i){return(t instanceof $t?Fr:Er)(this,t,e,n,r,i),this},$r.evaluate=async function(t,e,n){var r=this,i=r.logLevel(),a=[];if(r._pulse)return qr(r);if(r._pending&&await r._pending,e&&await kt(r,e),!r._touched.length)return r.info("Dataflow invoked, but nothing to do."),r;var u,o,s,l,c=++r._clock,f=0;r._pulse=new Tr(r,c,t),i>=3&&(s=Date.now(),r.debug("-- START PROPAGATION ("+c+") -----")),r._touched.forEach(t=>r._enqueue(t,!0)),r._touched=Mt(h);try{for(;r._heap.size()>0;)(u=r._heap.pop()).rank===u.qrank?((o=u.run(r._getPulse(u,t))).then?o=await o:o.async&&(a.push(o.async),o=Br),i>=4&&r.debug(u.id,o===Br?"STOP":o,u),o!==Br&&u._targets&&u._targets.forEach(t=>r._enqueue(t)),++f):r._enqueue(u,!0)}catch(t){r._heap.clear(),l=t}if(r._input={},r._pulse=null,i>=3&&(s=Date.now()-s,r.info("> Pulse "+c+": "+f+" operators; "+s+"ms")),l&&(r._postrun=[],r.error(l)),r._postrun.length){var d=r._postrun.sort((t,e)=>e.priority-t.priority);r._postrun=[];for(var p=0;p<d.length;++p)await kt(r,d[p].callback)}return n&&await kt(r,n),a.length&&Promise.all(a).then(t=>r.runAsync(null,()=>{t.forEach(t=>{try{t(r)}catch(t){r.error(t)}})})),r},$r.run=function(t,e,n){return this._pulse?qr(this):(this.evaluate(t,e,n),this)},$r.runAsync=async function(t,e,n){for(;this._running;)await this._running;var r=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(r,r),this._running},$r.runAfter=function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(t){this.error(t)}},$r._enqueue=function(t,e){var n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},$r._getPulse=function(t,e){var n=t.source,r=this._clock;return n&&u(n)?new Rr(this,r,n.map(t=>t.pulse),e):this._input[t.id]||function(t,e){if(e&&e.stamp===t.stamp)return e;t=t.fork(),e&&e!==Br&&(t.source=e.source);return t}(this._pulse,n&&n.pulse)},$r.logger=function(t){return arguments.length?(this._log=t,this):this._log},$r.error=Hr("error"),$r.warn=Hr("warn"),$r.info=Hr("info"),$r.debug=Hr("debug"),$r.logLevel=Hr("level");var Vr=rt(Yr,$t);Vr.run=function(t){return t.stamp<this.stamp?t.StopPropagation:(this.skip()?this.skip(!1):e=this.evaluate(t),(e=e||t).then?e=e.then(t=>this.pulse=t):e!==t.StopPropagation&&(this.pulse=e),e);var e},Vr.evaluate=function(t){var e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},Vr.transform=function(){};var Gr={};function Wr(t){var e=Xr(t);return e&&e.Definition||null}function Xr(t){return t=t&&t.toLowerCase(),K(Gr,t)?Gr[t]:null}var Jr=Object.freeze({__proto__:null,UniqueList:Mt,asyncCallback:kt,changeset:Ut,isChangeSet:Rt,Dataflow:jr,EventStream:Gt,Parameters:Lt,Pulse:Tr,MultiPulse:Rr,Operator:$t,Transform:Yr,derive:St,ingest:Tt,isTuple:Et,rederive:Nt,replace:Ot,stableCompare:zt,tupleid:Ft,definition:Wr,transform:Xr,transforms:Gr});function Zr(t){return t&&t.length?1===t.length?t[0]:(e=t,function(t){for(var n=e.length,r=1,i=String(e[0](t));r<n;++r)i+="|"+e[r](t);return i}):function(){return""};var e}function Qr(t,e,n){return n||t+(e?"_"+e:"")}var Kr={values:ni({name:"values",init:"cell.store = true;",set:"cell.data.values()",idx:-1}),count:ni({name:"count",set:"cell.num"}),__count__:ni({name:"count",set:"this.missing + this.valid"}),missing:ni({name:"missing",set:"this.missing"}),valid:ni({name:"valid",set:"this.valid"}),sum:ni({name:"sum",init:"this.sum = 0;",add:"this.sum += +v;",rem:"this.sum -= v;",set:"this.sum"}),product:ni({name:"product",init:"this.product = 1;",add:"this.product *= v;",rem:"this.product /= v;",set:"this.valid ? this.product : undefined"}),mean:ni({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.valid ? this.mean : undefined"}),average:ni({name:"average",set:"this.valid ? this.mean : undefined",req:["mean"],idx:1}),variance:ni({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : undefined",req:["mean"],idx:1}),variancep:ni({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : undefined",req:["variance"],idx:2}),stdev:ni({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : undefined",req:["variance"],idx:2}),stdevp:ni({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : undefined",req:["variance"],idx:2}),stderr:ni({name:"stderr",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid * (this.valid-1))) : undefined",req:["variance"],idx:2}),distinct:ni({name:"distinct",set:"cell.data.distinct(this.get)",req:["values"],idx:3}),ci0:ni({name:"ci0",set:"cell.data.ci0(this.get)",req:["values"],idx:3}),ci1:ni({name:"ci1",set:"cell.data.ci1(this.get)",req:["values"],idx:3}),median:ni({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:ni({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:ni({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),argmin:ni({name:"argmin",init:"this.argmin = undefined;",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = undefined;",set:"this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:ni({name:"argmax",init:"this.argmax = undefined;",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = undefined;",set:"this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:ni({name:"min",init:"this.min = undefined;",add:"if (v < this.min || this.min === undefined) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (Number.isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:ni({name:"max",init:"this.max = undefined;",add:"if (v > this.max || this.max === undefined) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (Number.isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4})},ti=Object.keys(Kr);function ei(t,e){return Kr[t](e)}function ni(t){return function(e){var n=X({init:"",add:"",rem:"",idx:0},t);return n.out=e||t.name,n}}function ri(t,e){return t.idx-e.idx}function ii(t,e){var n=e||d,r=function(t,e){var n,r=t.reduce((function t(n,r){function i(e){n[e]||t(n,n[e]=Kr[e]())}return r.req&&r.req.forEach(i),e&&r.str&&r.str.forEach(i),n}),t.reduce((function(t,e){return t[e.name]=e,t}),{})),i=[];for(n in r)i.push(r[n]);return i.sort(ri)}(t,!0),i="var cell = this.cell; this.valid = 0; this.missing = 0;",a="this.cell = cell; this.init();",u="if(v==null){++this.missing; return;} if(v!==v) return; ++this.valid;",o="if(v==null){--this.missing; return;} if(v!==v) return; --this.valid;",s="var cell = this.cell;";return r.forEach((function(t){i+=t.init,u+=t.add,o+=t.rem})),t.slice().sort(ri).forEach((function(t){s+="t["+l(t.out)+"]="+t.set+";"})),s+="return t;",(a=Function("cell",a)).prototype.init=Function(i),a.prototype.add=Function("v","t",u),a.prototype.rem=Function("v","t",o),a.prototype.set=Function("t",s),a.prototype.get=n,a.fields=t.map((function(t){return t.out})),a}function*ai(t,e){if(void 0===e)for(var n of t)null!=n&&(n=+n)>=n&&(yield n);else{var r=-1;for(var i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&(yield i)}}function ui(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function oi(t){var e;return 1===t.length&&(e=t,t=function(t,n){return ui(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)<0?r=a+1:i=a}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)>0?i=a:r=a+1}return r}}}var si=oi(ui).right;function li(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),a=new Array(i);++r<i;)a[r]=t+r*n;return a}var ci=Math.sqrt(50),fi=Math.sqrt(10),hi=Math.sqrt(2);function di(t,e,n){var r,i,a,u,o=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(u=pi(t,e,n))||!isFinite(u))return[];if(u>0)for(t=Math.ceil(t/u),e=Math.floor(e/u),a=new Array(i=Math.ceil(e-t+1));++o<i;)a[o]=(t+o)*u;else for(t=Math.floor(t*u),e=Math.ceil(e*u),a=new Array(i=Math.ceil(t-e+1));++o<i;)a[o]=(t-o)/u;return r&&a.reverse(),a}function pi(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=ci?10:a>=fi?5:a>=hi?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=ci?10:a>=fi?5:a>=hi?2:1)}function mi(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=ci?i*=10:a>=fi?i*=5:a>=hi&&(i*=2),e<t?-i:i}function vi(t,e){var n;if(void 0===e)for(var r of t)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{var i=-1;for(var a of t)null!=(a=e(a,++i,t))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}function gi(t,e){var n;if(void 0===e)for(var r of t)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{var i=-1;for(var a of t)null!=(a=e(a,++i,t))&&(n>a||void 0===n&&a>=a)&&(n=a)}return n}function yi(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function _i(t){return null===t?NaN:+t}function bi(t,e,n){if(r=(t=Float64Array.from(function*(t,e){if(void 0===e)for(var n of t)null!=n&&(n=+n)>=n&&(yield n);else{var r=-1;for(var i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&(yield i)}}(t,n))).length){if((e=+e)<=0||r<2)return gi(t);if(e>=1)return vi(t);var r,i=(r-1)*e,a=Math.floor(i),u=vi(function t(e,n,r=0,i=e.length-1,a=ui){for(;i>r;){if(i-r>600){var u=i-r+1,o=n-r+1,s=Math.log(u),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(u-l)/u)*(o-u/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-o*l/u+c)),Math.min(i,Math.floor(n+(u-o)*l/u+c)),a)}var f=e[n],h=r,d=i;for(yi(e,r,n),a(e[i],f)>0&&yi(e,r,i);h<d;){for(yi(e,h,d),++h,--d;a(e[h],f)<0;)++h;for(;a(e[d],f)>0;)--d}0===a(e[r],f)?yi(e,r,d):yi(e,++d,i),d<=n&&(r=d+1),n<=d&&(i=d-1)}return e}(t,a).subarray(0,a+1));return u+(gi(t.subarray(a+1))-u)*(i-a)}}function xi(t,e){return bi(t,.5,e)}function wi(t,e,n){var r=Float64Array.from(ai(t,n));return r.sort(ui),e.map(t=>function(t,e,n=_i){if(r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,a=Math.floor(i),u=+n(t[a],a,t);return u+(+n(t[a+1],a+1,t)-u)*(i-a)}}(r,t))}function Ai(t,e){return wi(t,[.25,.5,.75],e)}function Mi(t,e){var n=t.length,r=function(t,e){var n=function(t,e){var n,r=0,i=0,a=0;if(void 0===e)for(var u of t)null!=u&&(u=+u)>=u&&(a+=(n=u-i)*(u-(i+=n/++r)));else{var o=-1;for(var s of t)null!=(s=e(s,++o,t))&&(s=+s)>=s&&(a+=(n=s-i)*(s-(i+=n/++r)))}if(r>1)return a/(r-1)}(t,e);return n?Math.sqrt(n):n}(t,e),i=Ai(t,e),a=(i[2]-i[0])/1.34;return 1.06*(r=Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function ki(t){var e,n,r,i,a,u,o,s,l=t.maxbins||20,c=t.base||10,f=Math.log(c),h=t.divide||[5,2],d=t.extent[0],p=t.extent[1],m=t.span||p-d||Math.abs(d)||1;if(t.step)e=t.step;else if(t.steps){for(a=m/l,u=0,o=t.steps.length;u<o&&t.steps[u]<a;++u);e=t.steps[Math.max(0,u-1)]}else{for(n=Math.ceil(Math.log(l)/f),r=t.minstep||0,e=Math.max(r,Math.pow(c,Math.round(Math.log(m)/f)-n));Math.ceil(m/e)>l;)e*=c;for(u=0,o=h.length;u<o;++u)(a=e/h[u])>=r&&m/a<=l&&(e=a)}return i=(a=Math.log(e))>=0?0:1+~~(-a/f),s=Math.pow(c,-i-1),(t.nice||void 0===t.nice)&&(d=d<(a=Math.floor(d/e+s)*e)?a-e:a,p=Math.ceil(p/e)*e),{start:d,stop:p===d?d+e:p,step:e}}function Ci(e,n,r,i){if(!e.length)return[void 0,void 0];var a,u,o,s,l=Float64Array.from(ai(e,i)),c=l.length,f=n;for(o=0,s=Array(f);o<f;++o){for(a=0,u=0;u<c;++u)a+=l[~~(t.random()*c)];s[o]=a/c}return s.sort(ui),[bi(s,r/2),bi(s,1-r/2)]}function Di(t,e,n,r){r=r||(t=>t);for(var i,a=0,u=1,o=t.length,s=new Float64Array(o),l=r(t[0]),c=l,f=l+e;u<o;++u){if((i=r(t[u]))>=f){for(c=(l+c)/2;a<u;++a)s[a]=c;f=i+e,l=i}c=i}for(c=(l+c)/2;a<u;++a)s[a]=c;return n?function(t,e){var n,r,i=t.length,a=0,u=1;for(;t[a]===t[u];)++u;for(;u<i;){for(n=u+1;t[u]===t[n];)++n;if(t[u]-t[u-1]<e){for(r=u+(a+n-u-u>>1);r<u;)t[r++]=t[u];for(;r>u;)t[r--]=t[a]}a=u,u=n}return t}(s,e+e/4):s}t.random=Math.random;var Ei=Math.sqrt(2*Math.PI),Fi=Math.SQRT2,Bi=NaN;function Ti(e,n){e=e||0,n=null==n?1:n;var r,i,a=0,u=0;if(Bi==Bi)a=Bi,Bi=NaN;else{do{r=(a=2*t.random()-1)*a+(u=2*t.random()-1)*u}while(0===r||r>1);a*=i=Math.sqrt(-2*Math.log(r)/r),Bi=u*i}return e+a*n}function Si(t,e,n){var r=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Ei)}function Ni(t,e,n){var r,i=(t-(e=e||0))/(n=null==n?1:n),a=Math.abs(i);if(a>37)r=0;else{var u=Math.exp(-a*a/2);a<7.07106781186547?(r=u*((((((.0352624965998911*a+.700383064443688)*a+6.37396220353165)*a+33.912866078383)*a+112.079291497871)*a+221.213596169931)*a+220.206867912376),r/=((((((.0883883476483184*a+1.75566716318264)*a+16.064177579207)*a+86.7807322029461)*a+296.564248779674)*a+637.333633378831)*a+793.826512519948)*a+440.413735824752):r=u/(a+1/(a+2/(a+3/(a+4/(a+.65)))))/2.506628274631}return i>0?1-r:r}function Oi(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*Fi*function(t){var e,n=-Math.log((1-t)*(1+t));n<6.25?e=1.6536545626831027+(e=.24015818242558962+(e=(e=(e=.00018673420803405714+(e=(e=(e=4.2347877827932404e-7+(e=(e=(e=1.0512122733215323e-9+(e=(e=(e=26335093153082323e-28+(e=(e=(e=6637638134358324e-30+(e=20972767875968562e-33+(e=(e=11157877678025181e-33+(e=128584807152564e-32+(e=(e=-364441206401782e-35)*(n-=3.125)-16850591381820166e-35)*n)*n)*n-1333171662854621e-31)*n)*n)*n-4054566272975207e-29)*n-8151934197605472e-29)*n)*n-12975133253453532e-27)*n-5415412054294628e-26)*n)*n-4.112633980346984e-9)*n-2.9070369957882005e-8)*n)*n-13654692000834679e-22)*n-13882523362786469e-21)*n)*n-.000740702534166267)*n-.006033670871430149)*n)*n:n<16?(n=Math.sqrt(n)-3.25,e=3.0838856104922208+(e=1.0052589676941592+(e=.005370914553590064+(e=(e=.002491442096107851+(e=(e=.0009532893797373805+(e=(e=24031110387097894e-21+(e=6828485145957318e-20+(e=(e=12475304481671779e-21+(e=29234449089955446e-22+(e=(e=15027403968909828e-22+(e=1.8239629214389228e-8+(e=(e=9.075656193888539e-8+(e=2.2137376921775787e-9)*n)*n-2.7517406297064545e-7)*n)*n)*n-4013867526981546e-21)*n)*n)*n-47318229009055734e-21)*n)*n)*n-.0003550375203628475)*n)*n-.0016882755560235047)*n)*n-.003751208507569241)*n)*n)*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=4.849906401408584+(e=1.0103004648645344+(e=(e=(e=7599527703001776e-20+(e=(e=4526062597223154e-21+(e=(e=2.2900482228026655e-7+(e=(e=2.914795345090108e-8+(e=(e=7.61570120807834e-9+(e=(e=1.5076572693500548e-9+(e=(e=-27109920616438573e-27)*n-2.555641816996525e-10)*n)*n-3.789465440126737e-9)*n)*n-1.496002662714924e-8)*n)*n-6.771199775845234e-8)*n)*n-9.9298272942317e-7)*n)*n-1968177810553167e-20)*n)*n-.00021503011930044477)*n-.00013871931833623122)*n)*n):e=1/0;return e*t}(2*t-1)}function zi(t,e){var n,r,i={mean:function(t){return arguments.length?(n=t||0,i):n},stdev:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>Ti(n,r),pdf:t=>Si(t,n,r),cdf:t=>Ni(t,n,r),icdf:t=>Oi(t,n,r)};return i.mean(t).stdev(e)}function Ri(e,n){var r=zi(),i={},a=0;return i.data=function(t){return arguments.length?(e=t,a=t?t.length:0,i.bandwidth(n)):e},i.bandwidth=function(t){return arguments.length?(!(n=t)&&e&&(n=Mi(e)),i):n},i.sample=function(){return e[~~(t.random()*a)]+n*r.sample()},i.pdf=function(t){for(var i=0,u=0;u<a;++u)i+=r.pdf((t-e[u])/n);return i/n/a},i.cdf=function(t){for(var i=0,u=0;u<a;++u)i+=r.cdf((t-e[u])/n);return i/a},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(e)}function Ui(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+Ti()*e)}function qi(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;var r=(Math.log(t)-e)/n;return Math.exp(-.5*r*r)/(n*Ei*t)}function Li(t,e,n){return Ni(Math.log(t),e,n)}function Pi(t,e,n){return Math.exp(Oi(t,e,n))}function Ii(t,e){var n,r,i={mean:function(t){return arguments.length?(n=t||0,i):n},stdev:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>Ui(n,r),pdf:t=>qi(t,n,r),cdf:t=>Li(t,n,r),icdf:t=>Pi(t,n,r)};return i.mean(t).stdev(e)}function ji(e,n){var r,i={},a=0;function u(t){var e,n=[],r=0;for(e=0;e<a;++e)r+=n[e]=null==t[e]?1:+t[e];for(e=0;e<a;++e)n[e]/=r;return n}return i.weights=function(t){return arguments.length?(r=u(n=t||[]),i):n},i.distributions=function(t){return arguments.length?(t?(a=t.length,e=t):(a=0,e=[]),i.weights(n)):e},i.sample=function(){for(var n=t.random(),i=e[a-1],u=r[0],o=0;o<a-1;u+=r[++o])if(n<u){i=e[o];break}return i.sample()},i.pdf=function(t){for(var n=0,i=0;i<a;++i)n+=r[i]*e[i].pdf(t);return n},i.cdf=function(t){for(var n=0,i=0;i<a;++i)n+=r[i]*e[i].cdf(t);return n},i.icdf=function(){throw Error("Mixture icdf not supported.")},i.distributions(e).weights(n)}function $i(e,n){return null==n&&(n=null==e?1:e,e=0),e+(n-e)*t.random()}function Hi(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function Yi(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function Vi(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function Gi(t,e){var n,r,i={min:function(t){return arguments.length?(n=t||0,i):n},max:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>$i(n,r),pdf:t=>Hi(t,n,r),cdf:t=>Yi(t,n,r),icdf:t=>Vi(t,n,r)};return null==e&&(e=null==t?1:t,t=0),i.min(t).max(e)}function Wi(t,e,n,r){var i=r-t*t,a=Math.abs(i)<1e-24?0:(n-t*e)/i;return[e-a*t,a]}function Xi(t,e,n,r){t=t.filter(t=>{var r=e(t),i=n(t);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i}),r&&t.sort((t,n)=>e(t)-e(n));var i,a,u,o=t.length,s=new Float64Array(o),l=new Float64Array(o),c=0,f=0,h=0;for(u of t)s[c]=i=+e(u),l[c]=a=+n(u),f+=(i-f)/++c,h+=(a-h)/c;for(c=0;c<o;++c)s[c]-=f,l[c]-=h;return[s,l,f,h]}function Ji(t,e,n,r){var i,a,u=-1;for(var o of t)i=e(o),a=n(o),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++u)}function Zi(t,e,n,r,i){var a=0,u=0;return Ji(t,e,n,(t,e)=>{var n=e-i(t),o=e-r;a+=n*n,u+=o*o}),1-a/u}function Qi(t,e,n){var r=0,i=0,a=0,u=0,o=0;Ji(t,e,n,(t,e)=>{++o,r+=(t-r)/o,i+=(e-i)/o,a+=(t*e-a)/o,u+=(t*t-u)/o});var s=Wi(r,i,a,u),l=t=>s[0]+s[1]*t;return{coef:s,predict:l,rSquared:Zi(t,e,n,i,l)}}function Ki(t,e,n){var r,i,a,u,[o,s,l,c]=Xi(t,e,n),f=o.length,h=0,d=0,p=0,m=0,v=0;for(r=0;r<f;)i=o[r],a=s[r++],h+=((u=i*i)-h)/r,d+=(u*i-d)/r,p+=(u*u-p)/r,m+=(i*a-m)/r,v+=(u*a-v)/r;var g=p-h*h,y=h*g-d*d,_=(v*h-m*d)/y,b=(m*g-v*d)/y,x=-_*h,w=t=>_*(t-=l)*t+b*t+x+c;return{coef:[x-b*l+_*l*l+c,b-2*_*l,_],predict:w,rSquared:Zi(t,e,n,c,w)}}function ta(t,e,n,r){var i,a,u,o,s=Array(t);for(i=0;i<t;++i)s[i]=0;for(i=t-1;i>=0;--i)for(u=e[i],o=1,s[i]+=u,a=1;a<=i;++a)o*=(i+1-a)/a,s[i-a]+=u*Math.pow(n,a)*o;return s[0]+=r,s}function ea(t){return(t=1-t*t*t)*t*t}function na(t,e,n){var r=t[e],i=n[0],a=n[1]+1;if(!(a>=t.length))for(;e>i&&t[a]-r<=r-t[i];)n[0]=++i,n[1]=a,++a}var ra=.1*Math.PI/180;function ia(t,e,n,r){n=n||25,r=Math.max(n,r||200);var i=e=>[e,t(e)],a=e[0],u=e[1],o=u-a,s=o/r,l=[i(a)],c=[];if(n===r){for(var f=1;f<r;++f)l.push(i(a+f/n*o));return l.push(i(u)),l}c.push(i(u));for(var h=n;--h>0;)c.push(i(a+h/n*o));for(var d,p,m,v,g,y=l[0],_=c[c.length-1];_;){var b=i((y[0]+_[0])/2);b[0]-y[0]>=s&&(d=y,p=b,m=_,v=void 0,g=void 0,v=Math.atan2(m[1]-d[1],m[0]-d[0]),g=Math.atan2(p[1]-d[1],p[0]-d[0]),Math.abs(v-g)>ra)?c.push(b):(y=_,l.push(_),c.pop()),_=c[c.length-1]}return l}function aa(t){this._key=t?c(t):Ft,this.reset()}var ua=aa.prototype;function oa(t){Yr.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}ua.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},ua.add=function(t){this._add.push(t)},ua.rem=function(t){this._rem.push(t)},ua.values=function(){if(this._get=null,0===this._rem.length)return this._add;var t,e,n,r=this._add,i=this._rem,a=this._key,u=r.length,o=i.length,s=Array(u-o),l={};for(t=0;t<o;++t)l[a(i[t])]=1;for(t=0,e=0;t<u;++t)l[a(n=r[t])]?l[a(n)]=0:s[e++]=n;return this._rem=[],this._add=s},ua.distinct=function(t){for(var e,n=this.values(),r=n.length,i={},a=0;--r>=0;)K(i,e=t(n[r])+"")||(i[e]=1,++a);return a},ua.extent=function(t){if(this._get!==t||!this._ext){var e=this.values(),n=Z(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},ua.argmin=function(t){return this.extent(t)[0]||{}},ua.argmax=function(t){return this.extent(t)[1]||{}},ua.min=function(t){var e=this.extent(t)[0];return null!=e?t(e):void 0},ua.max=function(t){var e=this.extent(t)[1];return null!=e?t(e):void 0},ua.quartile=function(t){return this._get===t&&this._q||(this._q=Ai(this.values(),t),this._get=t),this._q},ua.q1=function(t){return this.quartile(t)[0]},ua.q2=function(t){return this.quartile(t)[1]},ua.q3=function(t){return this.quartile(t)[2]},ua.ci=function(t){return this._get===t&&this._ci||(this._ci=Ci(this.values(),1e3,.05,t),this._get=t),this._ci},ua.ci0=function(t){return this.ci(t)[0]},ua.ci1=function(t){return this.ci(t)[1]},oa.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:ti},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var sa=rt(oa,Yr);sa.transform=function(t,e){var n=this,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.modified();return n.stamp=r.stamp,n.value&&(i||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(t):{},e.visit(e.SOURCE,t=>n.add(t))):(n.value=n.value||n.init(t),e.visit(e.REM,t=>n.rem(t)),e.visit(e.ADD,t=>n.add(t))),r.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),n.changes(r)},sa.cross=function(){var t=this,e=t.value,n=t._dnames,r=n.map((function(){return{}})),i=n.length;function a(t){var e,a,u,o;for(e in t)for(u=t[e].tuple,a=0;a<i;++a)r[a][o=u[n[a]]]=o}a(t._prev),a(e),function a(u,o,s){var l,c,f=n[s],h=r[s++];for(l in h)o[f]=h[l],c=u?u+"|"+l:l,s<i?a(c,o,s):e[c]||t.cell(c,o)}("",{},0)},sa.init=function(t){var e=this._inputs=[],a=this._outputs=[],u={};function o(t){for(var n,i=$(r(t)),a=0,o=i.length;a<o;++a)u[n=i[a]]||(u[n]=1,e.push(n))}this._dims=$(t.groupby),this._dnames=this._dims.map((function(t){var e=n(t);return o(t),a.push(e),e})),this.cellkey=t.key?t.key:Zr(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var s,l,c,f,h,d,p=t.fields||[null],m=t.ops||["count"],v=t.as||[],g=p.length,y={};for(g!==m.length&&i("Unmatched number of fields and aggregate ops."),d=0;d<g;++d)s=p[d],l=m[d],null==s&&"count"!==l&&i("Null aggregate field specified."),h=Qr(l,f=n(s),v[d]),a.push(h),"count"!==l?((c=y[f])||(o(s),(c=y[f]=[]).field=s,this._measures.push(c)),"count"!==l&&(this._countOnly=!1),c.push(ei(l,h))):this._counts.push(h);return this._measures=this._measures.map((function(t){return ii(t,t.field)})),{}},sa.cellkey=Zr(),sa.cell=function(t,e){var n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},sa.newcell=function(t,e){var n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){var r,i=this._measures,a=i.length;for(n.agg=Array(a),r=0;r<a;++r)n.agg[r]=new i[r](n)}return n.store&&(n.data=new aa),n},sa.newtuple=function(t,e){var n,r,i=this._dnames,a=this._dims,u={};for(n=0,r=a.length;n<r;++n)u[i[n]]=a[n](t);return e?Ot(e.tuple,u):Tt(u)},sa.add=function(t){var e,n,r,i=this.cellkey(t),a=this.cell(i,t);if(a.num+=1,!this._countOnly)for(a.store&&a.data.add(t),n=0,r=(e=a.agg).length;n<r;++n)e[n].add(e[n].get(t),t)},sa.rem=function(t){var e,n,r,i=this.cellkey(t),a=this.cell(i,t);if(a.num-=1,!this._countOnly)for(a.store&&a.data.rem(t),n=0,r=(e=a.agg).length;n<r;++n)e[n].rem(e[n].get(t),t)},sa.celltuple=function(t){var e,n,r,i=t.tuple,a=this._counts;for(t.store&&t.data.values(),n=0,r=a.length;n<r;++n)i[a[n]]=t.num;if(!this._countOnly)for(n=0,r=(e=t.agg).length;n<r;++n)e[n].set(i);return i},sa.changes=function(t){var e,n,r,i,a=this._adds,u=this._mods,o=this._prev,s=this._drop,l=t.add,c=t.rem,f=t.mod;if(o)for(n in o)e=o[n],s&&!e.num||c.push(e.tuple);for(r=0,i=this._alen;r<i;++r)l.push(this.celltuple(a[r])),a[r]=null;for(r=0,i=this._mlen;r<i;++r)(0===(e=u[r]).num&&s?c:f).push(this.celltuple(e)),u[r]=null;return this._alen=this._mlen=0,this._prev=null,t};function la(t){Yr.call(this,null,t)}la.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var ca=rt(la,Yr);function fa(t,e,n){var r=t,i=e||[],a=n||[],u={},o=0;return{add:function(t){a.push(t)},remove:function(t){u[r(t)]=++o},size:function(){return i.length},data:function(t,e){return o&&(i=i.filter((function(t){return!u[r(t)]})),u={},o=0),e&&t&&i.sort(t),a.length&&(i=t?ht(t,i,a.sort(t)):i.concat(a),a=[]),i}}}function ha(t){Yr.call(this,[],t)}function da(t){$t.call(this,null,pa,t)}function pa(t){return this.value&&!t.modified()?this.value:V(t.fields,t.orders)}function ma(t){Yr.call(this,null,t)}ca.transform=function(t,e){var n,i=!1!==t.interval,a=this._bins(t),u=a.start,o=a.step,s=t.as||["bin0","bin1"],l=s[0],c=s[1];return n=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(r(t.field))?e.ADD_MOD:e.ADD,e.visit(n,i?function(t){var e=a(t);t[l]=e,t[c]=null==e?null:u+o*(1+(e-u)/o)}:function(t){t[l]=a(t)}),e.modifies(i?s:l)},ca._bins=function(t){if(this.value&&!t.modified())return this.value;var i,a,u=t.field,o=ki(t),s=o.step,l=o.start,c=l+Math.ceil((o.stop-l)/s)*s;null!=(i=t.anchor)&&(a=i-(l+s*Math.floor((i-l)/s)),l+=a,c+=a);var f=function(t){var e=u(t);return null==e?null:e<l?-1/0:e>c?1/0:(e=Math.max(l,Math.min(+e,c-s)),l+s*Math.floor(1e-14+(e-l)/s))};return f.start=l,f.stop=o.stop,f.step=s,this.value=e(f,r(u),t.name||"bin_"+n(u))},ha.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},rt(ha,Yr).transform=function(t,e){var n=e.fork(e.ALL),r=fa(Ft,this.value,n.materialize(n.ADD).add),i=t.sort,a=e.changed()||i&&(t.modified("sort")||e.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(zt(i),a),e.source&&e.source.root&&(this.value.root=e.source.root),n},rt(da,$t),ma.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};var va=rt(ma,Yr);function ga(t){Yr.call(this,null,t)}va.transform=function(t,e){function n(e){return function(n){for(var r,i=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(o(n),t.case,a)||[],s=0,l=i.length;s<l;++s)u.test(r=i[s])||e(r)}}var r=this._parameterCheck(t,e),i=this._counts,a=this._match,u=this._stop,o=t.field,s=t.as||["text","count"],l=n((function(t){i[t]=1+(i[t]||0)})),c=n((function(t){i[t]-=1}));return r?e.visit(e.SOURCE,l):(e.visit(e.ADD,l),e.visit(e.REM,c)),this._finish(e,s)},va._parameterCheck=function(t,e){var n=!1;return!t.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),!t.modified("pattern")&&this._match||(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},va._finish=function(t,e){var n,r,i,a=this._counts,u=this._tuples||(this._tuples={}),o=e[0],s=e[1],l=t.fork(t.NO_SOURCE|t.NO_FIELDS);for(n in a)r=u[n],i=a[n]||0,!r&&i?(u[n]=r=Tt({}),r[o]=n,r[s]=i,l.add.push(r)):0===i?(r&&l.rem.push(r),a[n]=null,u[n]=null):r[s]!==i&&(r[s]=i,l.mod.push(r));return l.modifies(e)},ga.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},rt(ga,Yr).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=this.value,i=t.as||["a","b"],a=i[0],u=i[1];return!r||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter")?(r&&(n.rem=r),r=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,r){for(var i,a,u=[],o={},s=t.length,l=0;l<s;++l)for(o[e]=a=t[l],i=0;i<s;++i)o[n]=t[i],r(o)&&(u.push(Tt(o)),(o={})[e]=a);return u}(r,a,u,t.filter||v)):n.mod=r,n.source=this.value,n.modifies(i)};var ya={kde:Ri,mixture:ji,normal:zi,lognormal:Ii,uniform:Gi};function _a(t){Yr.call(this,null,t)}var ba=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],xa={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:ba},{name:"weights",type:"number",array:!0}]};function wa(t,e){return t?t.map((function(t,r){return e[r]||n(t)})):null}function Aa(t,e,n){var r,i,a,u,o,s,l=[],c=function(t){return t(u)};if(null==e)l.push(t.map(n));else for(r={},i=0,a=t.length;i<a;++i)u=t[i],(s=r[o=e.map(c)])||(r[o]=s=[],s.dims=o,l.push(s)),s.push(n(u));return l}_a.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:ba.concat(xa)},{name:"as",type:"string",array:!0,default:["value","density"]}]},rt(_a,Yr).transform=function(t,e){var n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){var r=function t(e,n){var r=e.function;K(ya,r)||i("Unknown distribution function: "+r);var a=ya[r]();for(var u in e)"field"===u?a.data((e.from||n()).map(e[u])):"distributions"===u?a[u](e[u].map((function(e){return t(e,n)}))):"function"==typeof a[u]&&a[u](e[u]);return a}(t.distribution,function(t){return function(){return t.materialize(t.SOURCE).source}}(e)),a=t.steps||t.minsteps||25,u=t.steps||t.maxsteps||200,o=t.method||"pdf";"pdf"!==o&&"cdf"!==o&&i("Invalid density method: "+o),t.extent||r.data||i("Missing density extent parameter."),o=r[o];var s=t.as||["value","density"],l=ia(o,t.extent||J(r.data()),a,u).map(t=>{var e={};return e[s[0]]=t[0],e[s[1]]=t[1],Tt(e)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n};function Ma(t){Yr.call(this,null,t)}function ka(t){$t.call(this,null,Ca,t),this.modified(!0)}function Ca(t){var i=t.expr;return this.value&&!t.modified("expr")?this.value:e(e=>i(e,t),r(i),n(i))}function Da(t){Yr.call(this,[void 0,void 0],t)}function Ea(t,e){$t.call(this,t),this.parent=e}Ma.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},rt(Ma,Yr).transform=function(t,e){if(this.value&&!t.modified()&&!e.changed())return e;for(var n,r=e.materialize(e.SOURCE).source,i=Aa(e.source,t.groupby,d),a=t.smooth||!1,u=t.field,o=t.step||function(t,e){return mt(J(t,e))/30}(r,u),s=zt((t,e)=>u(t)-u(e)),l=t.as||"bin",c=i.length,f=1/0,h=-1/0,p=0;p<c;++p){var m=i[p].sort(s);for(var v of(n=-1,Di(m,o,a,u)))v<f&&(f=v),v>h&&(h=v),m[++n][l]=v}return this.value={start:f,stop:h,step:o},e.reflow(!0).modifies(l)},rt(ka,$t),Da.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},rt(Da,Yr).transform=function(t,e){var r,i=this.value,a=t.field,u=i[0],o=i[1];if(((r=e.changed()||e.modified(a.fields)||t.modified("field"))||null==u)&&(u=1/0,o=-1/0),e.visit(r?e.SOURCE:e.ADD,(function(t){var e=a(t);null!=e&&((e=+e)<u&&(u=e),e>o&&(o=e))})),!Number.isFinite(u)||!Number.isFinite(o)){var s=n(a);s&&(s=` for field "${s}"`),e.dataflow.warn(`Infinite extent${s}: [${u}, ${o}]`),u=o=void 0}this.value=[u,o]};var Fa=rt(Ea,$t);function Ba(t){Yr.call(this,{},t),this._keys=et();var e=this._targets=[];e.active=0,e.forEach=function(t){for(var n=0,r=e.active;n<r;++n)t(e[n],n,e)}}Fa.connect=function(t){return this.targets().add(t),t.source=this},Fa.add=function(t){this.value.add.push(t)},Fa.rem=function(t){this.value.rem.push(t)},Fa.mod=function(t){this.value.mod.push(t)},Fa.init=function(t){this.value.init(t,t.NO_SOURCE)},Fa.evaluate=function(){return this.value};var Ta=rt(Ba,Yr);function Sa(t){$t.call(this,null,Na,t)}function Na(t){return this.value&&!t.modified()?this.value:u(t.name)?$(t.name).map((function(t){return c(t)})):c(t.name,t.as)}function Oa(t){Yr.call(this,et(),t)}function za(t){Yr.call(this,[],t)}function Ra(t){Yr.call(this,[],t)}function Ua(t){Yr.call(this,null,t)}function qa(t){Yr.call(this,[],t)}Ta.activate=function(t){this._targets[this._targets.active++]=t},Ta.subflow=function(t,e,n,r){var i,a,u=this.value,o=K(u,t)&&u[t];return o?o.value.stamp<n.stamp&&(o.init(n),this.activate(o)):(a=r||(a=this._group[t])&&a.tuple,o=(i=n.dataflow).add(new Ea(n.fork(n.NO_SOURCE),this)).connect(e(i,t,a)),u[t]=o,this.activate(o)),o},Ta.transform=function(t,e){var n=e.dataflow,r=this,i=t.key,a=t.subflow,u=this._keys,o=t.modified("key");function s(t){return r.subflow(t,a,e)}return this._group=t.group||{},this._targets.active=0,e.visit(e.REM,(function(t){var e=Ft(t),n=u.get(e);void 0!==n&&(u.delete(e),s(n).rem(t))})),e.visit(e.ADD,(function(t){var e=i(t);u.set(Ft(t),e),s(e).add(t)})),o||e.modified(i.fields)?e.visit(e.MOD,(function(t){var e=Ft(t),n=u.get(e),r=i(t);n===r?s(r).mod(t):(u.set(e,r),s(n).rem(t),s(r).add(t))})):e.changed(e.MOD)&&e.visit(e.MOD,(function(t){s(u.get(Ft(t))).mod(t)})),o&&e.visit(e.REFLOW,(function(t){var e=Ft(t),n=u.get(e),r=i(t);n!==r&&(u.set(e,r),s(n).rem(t),s(r).add(t))})),u.empty>n.cleanThreshold&&n.runAfter(u.clean),e},rt(Sa,$t),Oa.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},rt(Oa,Yr).transform=function(t,e){var n=e.dataflow,r=this.value,i=e.fork(),a=i.add,u=i.rem,o=i.mod,s=t.expr,l=!0;function c(e){var n=Ft(e),i=s(e,t),c=r.get(n);i&&c?(r.delete(n),a.push(e)):i||c?l&&i&&!c&&o.push(e):(r.set(n,1),u.push(e))}return e.visit(e.REM,(function(t){var e=Ft(t);r.has(e)?r.delete(e):u.push(t)})),e.visit(e.ADD,(function(e){s(e,t)?a.push(e):r.set(Ft(e),1)})),e.visit(e.MOD,c),t.modified()&&(l=!1,e.visit(e.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i},za.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},rt(za,Yr).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=t.fields,i=wa(r,t.as||[]),a=t.index||null,u=i.length;return n.rem=this.value,e.visit(e.SOURCE,(function(t){for(var e,o,s,l=r.map(e=>e(t)),c=l.reduce((t,e)=>Math.max(t,e.length),0),f=0;f<c;++f){for(o=St(t),e=0;e<u;++e)o[i[e]]=null==(s=l[e][f])?null:s;a&&(o[a]=f),n.add.push(o)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)},Ra.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},rt(Ra,Yr).transform=function(t,e){var r=e.fork(e.NO_SOURCE),i=t.fields,a=i.map(n),u=t.as||["key","value"],o=u[0],s=u[1],l=i.length;return r.rem=this.value,e.visit(e.SOURCE,(function(t){for(var e,n=0;n<l;++n)(e=St(t))[o]=a[n],e[s]=i[n](t),r.add.push(e)})),this.value=r.source=r.add,r.modifies(u)},Ua.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},rt(Ua,Yr).transform=function(t,e){var n=t.expr,r=t.as,i=t.modified(),a=t.initonly?e.ADD:i?e.SOURCE:e.modified(n.fields)||e.modified(r)?e.ADD_MOD:e.ADD;return i&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(r),e.visit(a,e=>e[r]=n(e,t))},rt(qa,Yr).transform=function(t,e){var n,r,i,a=this.value,u=e.fork(e.ALL),o=t.size-a.length,s=t.generator;if(o>0){for(n=[];--o>=0;)n.push(i=Tt(s(t))),a.push(i);u.add=u.add.length?u.materialize(u.ADD).add.concat(n):n}else r=a.slice(0,-o),u.rem=u.rem.length?u.materialize(u.REM).rem.concat(r):r,a=a.slice(-o);return u.source=this.value=a,u};var La={value:"value",median:xi,mean:function(t,e){var n=0,r=0;if(void 0===e)for(var i of t)null!=i&&(i=+i)>=i&&(++n,r+=i);else{var a=-1;for(var u of t)null!=(u=e(u,++a,t))&&(u=+u)>=u&&(++n,r+=u)}if(n)return r/n},min:gi,max:vi},Pa=[];function Ia(t){Yr.call(this,[],t)}function ja(t){oa.call(this,t)}Ia.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},rt(Ia,Yr).transform=function(t,e){var r,a,u,o,s,l,c,f,h,d,p=e.fork(e.ALL),m=function(t){var e,n=t.method||La.value;if(null!=La[n])return n===La.value?(e=void 0!==t.value?t.value:0,function(){return e}):La[n];i("Unrecognized imputation method: "+n)}(t),v=function(t){var e=t.field;return function(t){return t?e(t):NaN}}(t),g=n(t.field),y=n(t.key),_=(t.groupby||[]).map(n),b=function(t,e,n,r){var i,a,u,o,s,l,c,f,h=function(t){return t(f)},d=[],p=r?r.slice():[],m={},v={};for(p.forEach((function(t,e){m[t]=e+1})),o=0,c=t.length;o<c;++o)f=t[o],l=n(f),s=m[l]||(m[l]=p.push(l)),a=(i=e?e.map(h):Pa)+"",(u=v[a])||(u=v[a]=[],d.push(u),u.values=i),u[s-1]=f;return d.domain=p,d}(e.source,t.groupby,t.key,t.keyvals),x=[],w=this.value,A=b.domain.length;for(s=0,f=b.length;s<f;++s)for(u=(r=b[s]).values,a=NaN,c=0;c<A;++c)if(null==r[c]){for(o=b.domain[c],d={_impute:!0},l=0,h=u.length;l<h;++l)d[_[l]]=u[l];d[y]=o,d[g]=Number.isNaN(a)?a=m(r,v):a,x.push(Tt(d))}return x.length&&(p.add=p.materialize(p.ADD).add.concat(x)),w.length&&(p.rem=p.materialize(p.REM).rem.concat(w)),this.value=x,p},ja.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:ti},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var $a=rt(ja,oa);function Ha(t){Yr.call(this,null,t)}function Ya(t){$t.call(this,null,Va,t)}function Va(t){return this.value&&!t.modified()?this.value:lt(t.fields,t.flat)}function Ga(t){Yr.call(this,[],t),this._pending=null}function Wa(t,e,n){n.forEach(Tt);var r=e.fork(e.NO_FIELDS&e.NO_SOURCE);return r.rem=t.value,t.value=r.source=r.add=n,t._pending=null,r}function Xa(t){Yr.call(this,{},t)}function Ja(t){$t.call(this,null,Za,t)}function Za(t){if(this.value&&!t.modified())return this.value;var e,n,r,i=1/0,a=-1/0,u=t.extents;for(e=0,n=u.length;e<n;++e)(r=u[e])[0]<i&&(i=r[0]),r[1]>a&&(a=r[1]);return[i,a]}function Qa(t){$t.call(this,null,Ka,t)}function Ka(t){return this.value&&!t.modified()?this.value:t.values.reduce((function(t,e){return t.concat(e)}),[])}function tu(t){Yr.call(this,null,t)}function eu(t){oa.call(this,t)}$a.transform=function(t,e){var n,r=this,i=t.modified();return r.value&&(i||e.modified(r._inputs,!0))?(n=r.value=i?r.init(t):{},e.visit(e.SOURCE,(function(t){r.add(t)}))):(n=r.value=r.value||this.init(t),e.visit(e.REM,(function(t){r.rem(t)})),e.visit(e.ADD,(function(t){r.add(t)}))),r.changes(),e.visit(e.SOURCE,(function(t){X(t,n[r.cellkey(t)].tuple)})),e.reflow(i).modifies(this._outputs)},$a.changes=function(){var t,e,n=this._adds,r=this._mods;for(t=0,e=this._alen;t<e;++t)this.celltuple(n[t]),n[t]=null;for(t=0,e=this._mlen;t<e;++t)this.celltuple(r[t]),r[t]=null;this._alen=this._mlen=0},Ha.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},rt(Ha,Yr).transform=function(t,e){var r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){var a=e.materialize(e.SOURCE).source,u=Aa(a,t.groupby,t.field),o=(t.groupby||[]).map(n),s=t.bandwidth,l=t.cumulative?"cdf":"pdf",c=t.as||["value","density"],f=[],h=t.extent,d=t.steps||t.minsteps||25,p=t.steps||t.maxsteps||200;"pdf"!==l&&"cdf"!==l&&i("Invalid density method: "+l),"shared"===t.resolve&&(h||(h=J(a,t.field)),d=p=t.steps||p),u.forEach(e=>{var n=Ri(e,s)[l],r=t.counts?e.length:1;ia(n,h||J(e),d,p).forEach(t=>{for(var n={},i=0;i<o.length;++i)n[o[i]]=e.dims[i];n[c[0]]=t[0],n[c[1]]=t[1]*r,f.push(Tt(n))})}),this.value&&(r.rem=this.value),this.value=r.add=r.source=f}return r},rt(Ya,$t),rt(Ga,Yr).transform=function(t,e){var n=e.dataflow;return this._pending?Wa(this,e,this._pending):function(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}(t)?e.StopPropagation:t.values?Wa(this,e,n.parse(t.values,t.format)):t.async?{async:n.request(t.url,t.format).then(t=>(this._pending=$(t.data),t=>t.touch(this)))}:n.request(t.url,t.format).then(t=>Wa(this,e,$(t.data)))},Xa.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},rt(Xa,Yr).transform=function(t,e){var r,a,u=e,o=t.as,s=t.fields,l=t.index,c=t.values,f=null==t.default?null:t.default,h=t.modified(),d=h?e.SOURCE:e.ADD,p=s.length;return c?(a=c.length,p>1&&!o&&i('Multi-field lookup requires explicit "as" parameter.'),o&&o.length!==p*a&&i('The "as" parameter has too few output field names.'),o=o||c.map(n),r=function(t){for(var e,n,r=0,i=0;r<p;++r)if(null==(n=l.get(s[r](t))))for(e=0;e<a;++e,++i)t[o[i]]=f;else for(e=0;e<a;++e,++i)t[o[i]]=c[e](n)}):(o||i("Missing output field names."),r=function(t){for(var e,n=0;n<p;++n)e=l.get(s[n](t)),t[o[n]]=null==e?f:e}),h?u=e.reflow(!0):d|=s.some((function(t){return e.modified(t.fields)}))?e.MOD:0,e.visit(d,r),u.modifies(o)},rt(Ja,$t),rt(Qa,$t),rt(tu,Yr),tu.prototype.transform=function(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)},eu.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:ti,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var nu=rt(eu,oa);function ru(t){Ba.call(this,t)}function iu(t){Yr.call(this,null,t)}function au(t){Yr.call(this,null,t)}function uu(t){Yr.call(this,null,t)}nu._transform=nu.transform,nu.transform=function(t,n){return this._transform(function(t,n){var i=t.field,a=t.value,u=("count"===t.op?"__count__":t.op)||"sum",o=r(i).concat(r(a)),s=function(t,e,n){var r={},i=[];return n.visit(n.SOURCE,(function(e){var n=t(e);r[n]||(r[n]=1,i.push(n))})),i.sort((function(t,e){return(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0)})),e?i.slice(0,e):i}(i,t.limit||0,n);n.changed()&&t.set("__pivot__",null,null,!0);return{key:t.key,groupby:t.groupby,ops:s.map((function(){return u})),fields:s.map((function(t){return function(t,n,r,i){return e((function(e){return n(e)===t?r(e):NaN}),i,t+"")}(t,i,a,o)})),as:s.map((function(t){return t+""})),modified:t.modified.bind(t)}}(t,n),n)},rt(ru,Ba).transform=function(t,e){var n=this,a=t.subflow,u=t.field;return(t.modified("field")||u&&e.modified(r(u)))&&i("PreFacet does not support field modification."),this._targets.active=0,e.visit(e.MOD,(function(t){var r=n.subflow(Ft(t),a,e,t);u?u(t).forEach((function(t){r.mod(t)})):r.mod(t)})),e.visit(e.ADD,(function(t){var r=n.subflow(Ft(t),a,e,t);u?u(t).forEach((function(t){r.add(Tt(t))})):r.add(t)})),e.visit(e.REM,(function(t){var r=n.subflow(Ft(t),a,e,t);u?u(t).forEach((function(t){r.rem(t)})):r.rem(t)})),e},iu.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},rt(iu,Yr).transform=function(t,e){var n,r,i=t.fields,a=wa(t.fields,t.as||[]),u=i?function(t,e){return function(t,e,n,r){for(var i=0,a=n.length;i<a;++i)e[r[i]]=n[i](t);return e}(t,e,i,a)}:Nt;return this.value?r=this.value:(e=e.addAll(),r=this.value={}),n=e.fork(e.NO_SOURCE),e.visit(e.REM,(function(t){var e=Ft(t);n.rem.push(r[e]),r[e]=null})),e.visit(e.ADD,(function(t){var e=u(t,Tt({}));r[Ft(t)]=e,n.add.push(e)})),e.visit(e.MOD,(function(t){n.mod.push(u(t,r[Ft(t)]))})),n},rt(au,Yr).transform=function(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation},uu.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var ou=rt(uu,Yr);function su(t){Yr.call(this,null,t)}function lu(t){Yr.call(this,[],t),this.count=0}function cu(t){Yr.call(this,null,t)}function fu(t){Yr.call(this,null,t),this.modified(!0)}ou.transform=function(t,e){var r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return r.source=this.value,r;var a=Aa(e.materialize(e.SOURCE).source,t.groupby,t.field),u=(t.groupby||[]).map(n),o=[],s=t.step||.01,l=t.probs||li(s/2,1-1e-14,s),c=l.length;return a.forEach(t=>{for(var e=wi(t,l),n=0;n<c;++n){for(var r={},a=0;a<u.length;++a)r[u[a]]=t.dims[a];r[i[0]]=l[n],r[i[1]]=e[n],o.push(Tt(r))}}),this.value&&(r.rem=this.value),this.value=r.add=r.source=o,r},rt(su,Yr).transform=function(t,e){var n,r;return this.value?r=this.value:(n=e=e.addAll(),r=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,t=>{var e=Ft(t);n.rem.push(r[e]),r[e]=null}),e.visit(e.ADD,t=>{var e=St(t);r[Ft(t)]=e,n.add.push(e)}),e.visit(e.MOD,t=>{var e,i=r[Ft(t)];for(e in t)i[e]=t[e],n.modifies(e);n.mod.push(i)})),n},lu.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},rt(lu,Yr).transform=function(e,n){var r=n.fork(n.NO_SOURCE),i=e.modified("size"),a=e.size,u=this.value,o=this.count,s=0,l=u.reduce((function(t,e){return t[Ft(e)]=1,t}),{});function c(e){var n,i;u.length<a?u.push(e):(i=~~((o+1)*t.random()))<u.length&&i>=s&&(n=u[i],l[Ft(n)]&&r.rem.push(n),u[i]=e),++o}if(n.rem.length&&(n.visit(n.REM,(function(t){var e=Ft(t);l[e]&&(l[e]=-1,r.rem.push(t)),--o})),u=u.filter((function(t){return-1!==l[Ft(t)]}))),(n.rem.length||i)&&u.length<a&&n.source&&(s=o=u.length,n.visit(n.SOURCE,(function(t){l[Ft(t)]||c(t)})),s=-1),i&&u.length>a){for(var f=0,h=u.length-a;f<h;++f)l[Ft(u[f])]=-1,r.rem.push(u[f]);u=u.slice(h)}return n.mod.length&&n.visit(n.MOD,(function(t){l[Ft(t)]&&r.mod.push(t)})),n.add.length&&n.visit(n.ADD,c),(n.add.length||s<0)&&(r.add=u.filter((function(t){return!l[Ft(t)]}))),this.count=o,this.value=r.source=u,r},cu.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},rt(cu,Yr).transform=function(t,e){if(!this.value||t.modified()){var n=e.materialize().fork(e.MOD),r=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=li(t.start,t.stop,t.step||1).map((function(t){var e={};return e[r]=t,Tt(e)})),n.add=e.add.concat(this.value),n}},rt(fu,Yr).transform=function(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation};var hu="year",du="quarter",pu="month",mu="week",vu="date",gu="day",yu="hours",_u="minutes",bu="seconds",xu=[hu,du,pu,mu,vu,gu,"dayofyear",yu,_u,bu,"milliseconds"],wu=xu.reduce((t,e,n)=>(t[e]=1+n,t),{});function Au(t){var e=$(t).slice(),n={};return e.length||i("Missing time unit."),e.forEach(t=>{K(wu,t)?n[t]=1:i(`Invalid time unit: ${t}.`)}),(n[mu]||n.day?1:0)+(n[du]||n[pu]||n[vu]?1:0)+(n.dayofyear?1:0)>1&&i("Incompatible time units: "+t),e.sort((t,e)=>wu[t]-wu[e]),e}var Mu=new Date;function ku(t){return Mu.setFullYear(t),Mu.setMonth(0),Mu.setDate(1),Mu.setHours(0,0,0,0),Mu}function Cu(t){return Eu(new Date(t))}function Du(t){return Fu(new Date(t))}function Eu(t){return Ie.count(ku(t.getFullYear())-1,t)}function Fu(t){return $e.count(ku(t.getFullYear())-1,t)}function Bu(t){return ku(t).getDay()}function Tu(t,e,n,r,i,a,u){if(0<=t&&t<100){var o=new Date(-1,e,n,r,i,a,u);return o.setFullYear(t),o}return new Date(t,e,n,r,i,a,u)}function Su(t){return Ou(new Date(t))}function Nu(t){return zu(new Date(t))}function Ou(t){var e=Date.UTC(t.getUTCFullYear(),0,1);return Je.count(e-1,t)}function zu(t){var e=Date.UTC(t.getUTCFullYear(),0,1);return Qe.count(e-1,t)}function Ru(t){return Mu.setTime(Date.UTC(t,0,1)),Mu.getUTCDay()}function Uu(t,e,n,r,i,a,u){if(0<=t&&t<100){var o=new Date(Date.UTC(-1,e,n,r,i,a,u));return o.setUTCFullYear(n.y),o}return new Date(Date.UTC(t,e,n,r,i,a,u))}function qu(t,e,n,r,i){var a=e||1,u=M(t),o=(t,e,i)=>function(t,e,n,r){var i=n<=1?t:r?(e,i)=>r+n*Math.floor((t(e,i)-r)/n):(e,r)=>n*Math.floor(t(e,r)/n);return e?(t,n)=>e(i(t,n),n):i}(n[i=i||t],r[i],t===u&&a,e),s=new Date,l=bt(t),c=l[hu]?o(hu):G(2012),f=l[pu]?o(pu):l[du]?o(du):p,h=l[mu]&&l.day?o(gu,1,mu+gu):l[mu]?o(mu,1):l.day?o(gu,1):l[vu]?o(vu,1):l.dayofyear?o("dayofyear",1):m,d=l[yu]?o(yu):p,v=l[_u]?o(_u):p,g=l[bu]?o(bu):p,y=l.milliseconds?o("milliseconds"):p;return function(t){s.setTime(+t);var e=c(s);return i(e,f(s),h(s,e),d(s),v(s),g(s),y(s))}}function Lu(t,e,n){return e+7*t-(n+6)%7}var Pu={[hu]:t=>t.getFullYear(),[du]:t=>Math.floor(t.getMonth()/3),[pu]:t=>t.getMonth(),[vu]:t=>t.getDate(),[yu]:t=>t.getHours(),[_u]:t=>t.getMinutes(),[bu]:t=>t.getSeconds(),milliseconds:t=>t.getMilliseconds(),dayofyear:t=>Eu(t),[mu]:t=>Fu(t),[mu+gu]:(t,e)=>Lu(Fu(t),t.getDay(),Bu(e)),[gu]:(t,e)=>Lu(1,t.getDay(),Bu(e))},Iu={[du]:t=>3*t,[mu]:(t,e)=>Lu(t,0,Bu(e))};function ju(t,e){return qu(t,e||1,Pu,Iu,Tu)}var $u={[hu]:t=>t.getUTCFullYear(),[du]:t=>Math.floor(t.getUTCMonth()/3),[pu]:t=>t.getUTCMonth(),[vu]:t=>t.getUTCDate(),[yu]:t=>t.getUTCHours(),[_u]:t=>t.getUTCMinutes(),[bu]:t=>t.getUTCSeconds(),milliseconds:t=>t.getUTCMilliseconds(),dayofyear:t=>Ou(t),[mu]:t=>zu(t),[gu]:(t,e)=>Lu(1,t.getUTCDay(),Ru(e)),[mu+gu]:(t,e)=>Lu(zu(t),t.getUTCDay(),Ru(e))},Hu={[du]:t=>3*t,[mu]:(t,e)=>Lu(t,0,Ru(e))};function Yu(t,e){return qu(t,e||1,$u,Hu,Uu)}var Vu={[hu]:Ge,[du]:Ve.every(3),[pu]:Ve,[mu]:$e,[vu]:Ie,[gu]:Ie,dayofyear:Ie,[yu]:Pe,[_u]:Le,[bu]:qe,milliseconds:Ue},Gu={[hu]:nn,[du]:en.every(3),[pu]:en,[mu]:Qe,[vu]:Je,[gu]:Je,dayofyear:Je,[yu]:Xe,[_u]:We,[bu]:qe,milliseconds:Ue};function Wu(t){return Vu[t]}function Xu(t){return Gu[t]}function Ju(t,e,n){return t?t.offset(e,n):void 0}function Zu(t,e,n){return Ju(Wu(t),e,n)}function Qu(t,e,n){return Ju(Xu(t),e,n)}function Ku(t,e,n,r){return t?t.range(e,n,r):void 0}function to(t,e,n,r){return Ku(Wu(t),e,n,r)}function eo(t,e,n,r){return Ku(Xu(t),e,n,r)}var no={[hu]:"%Y ",[du]:"Q%q ",[pu]:"%b ",[vu]:"%d ",[mu]:"W%U ",[gu]:"%a ",dayofyear:"%j ",[yu]:"%H:00",[_u]:"00:%M",[bu]:":%S",milliseconds:".%L","year-month":"%Y-%m ","year-month-date":"%Y-%m-%d ",["hours-"+_u]:"%H:%M"};function ro(t,e){var n,r,i=X({},no,e),a=Au(t),u=a.length,o="",s=0;for(s=0;s<u;)for(n=a.length;n>s;--n)if(null!=i[r=a.slice(s,n).join("-")]){o+=i[r],s=n;break}return o.trim()}function io(t){return uo(sn,Wu,t)}function ao(t){return uo(cn,Xu,t)}function uo(t,e,n){return s(n)?t(n):function(t,e,n){o(n=n||{})||i("Invalid time multi-format specifier: "+n);var r=e(bu),a=e(_u),u=e(yu),s=e(vu),l=e(mu),c=e(pu),f=e(du),h=e(hu),d=t(n.milliseconds||".%L"),p=t(n[bu]||":%S"),m=t(n[_u]||"%I:%M"),v=t(n[yu]||"%I %p"),g=t(n[vu]||n.day||"%a %d"),y=t(n[mu]||"%b %d"),_=t(n[pu]||"%B"),b=t(n[du]||"%B"),x=t(n[hu]||"%Y");return function(t){return(r(t)<t?d:a(t)<t?p:u(t)<t?m:s(t)<t?v:c(t)<t?l(t)<t?g:y:h(t)<t?f(t)<t?_:b:x)(t)}}(t,e,n)}var oo=[hu,pu,vu,yu,_u,bu,"milliseconds"],so=oo.slice(0,-1),lo=so.slice(0,-1),co=lo.slice(0,-1),fo=co.slice(0,-1),ho=[hu,pu],po=[hu],mo=[[so,1,1e3],[so,5,5e3],[so,15,15e3],[so,30,3e4],[lo,1,6e4],[lo,5,3e5],[lo,15,9e5],[lo,30,18e5],[co,1,36e5],[co,3,108e5],[co,6,216e5],[co,12,432e5],[fo,1,864e5],[[hu,mu],1,6048e5],[ho,1,2592e6],[ho,3,7776e6],[po,1,31536e6]];function vo(t){var e,n,r=t.extent,i=t.maxbins||40,a=Math.abs(mt(r))/i,u=oi(t=>t[2]).right(mo,a);return u===mo.length?(e=po,n=mi(r[0]/31536e6,r[1]/31536e6,i)):u?(e=(u=mo[a/mo[u-1][2]<mo[u][2]/a?u-1:u])[0],n=u[1]):(e=oo,n=Math.max(mi(r[0],r[1],i),1)),{units:e,step:n}}function go(t){Yr.call(this,null,t)}var yo=["unit0","unit1"];go.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:xu,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:yo}]};var _o=rt(go,Yr);function bo(t){Yr.call(this,et(),t)}function xo(t){Yr.call(this,null,t)}_o.transform=function(t,e){var n=t.field,i=!1!==t.interval,a="utc"===t.timezone,u=this._floor(t,e),o=(a?Xu:Wu)(u.unit).offset,s=t.as||yo,l=s[0],c=s[1],f=u.start||1/0,h=u.stop||-1/0,d=u.step,p=e.ADD;return(t.modified()||e.modified(r(n)))&&(p=(e=e.reflow(!0)).SOURCE,f=1/0,h=-1/0),e.visit(p,(function(t){var e,r,a=n(t);null==a?(t[l]=null,i&&(t[c]=null)):(t[l]=e=r=u(a),i&&(t[c]=r=o(e,d)),e<f&&(f=e),r>h&&(h=r))})),u.start=f,u.stop=h,e.modifies(i?s:l)},_o._floor=function(t,e){var n="utc"===t.timezone,{units:r,step:i}=t.units?{units:t.units,step:t.step||1}:vo({extent:t.extent||J(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins});r=Au(r);var a=this.value||{},u=(n?Yu:ju)(r,i);return u.unit=M(r),u.units=r,u.step=i,u.start=a.start,u.stop=a.stop,this.value=u},rt(bo,Yr).transform=function(t,e){var n=e.dataflow,r=t.field,i=this.value,a=!0;function u(t){i.set(r(t),t)}return t.modified("field")||e.modified(r.fields)?(i.clear(),e.visit(e.SOURCE,u)):e.changed()?(e.visit(e.REM,(function(t){i.delete(r(t))})),e.visit(e.ADD,u)):a=!1,this.modified(a),i.empty>n.cleanThreshold&&n.runAfter(i.clean),e.fork()},rt(xo,Yr).transform=function(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(zt(t.sort)):e.source).map(t.field))};var wo={row_number:function(){return{next:t=>t.index+1}},rank:function(){var t;return{init:()=>t=1,next:e=>{var n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?t=n+1:t}}},dense_rank:function(){var t;return{init:()=>t=1,next:e=>{var n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?++t:t}}},percent_rank:function(){var t=wo.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){var t;return{init:()=>t=0,next:e=>{var n=e.index,r=e.data,i=e.compare;if(t<n){for(;n+1<r.length&&!i(r[n],r[n+1]);)++n;t=n}return(1+t)/r.length}}},ntile:function(t,e){(e=+e)>0||i("ntile num must be greater than zero.");var n=wo.cume_dist(),r=n.next;return{init:n.init,next:t=>Math.ceil(e*r(t))}},lag:function(t,e){return e=+e||1,{next:n=>{var r=n.index-e;return r>=0?t(n.data[r]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{var r=n.index+e,i=n.data;return r<i.length?t(i[r]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||i("nth_value nth must be greater than zero."),{next:n=>{var r=n.i0+(e-1);return r<n.i1?t(n.data[r]):null}}},prev_value:function(t){var e;return{init:()=>e=null,next:n=>{var r=t(n.data[n.index]);return null!=r?e=r:e}}},next_value:function(t){var e,n;return{init:()=>(e=null,n=-1),next:r=>{var i=r.data;return r.index<=n?e:(n=function(t,e,n){for(var r=e.length;n<r;++n){if(null!=t(e[n]))return n}return-1}(t,i,r.index))<0?(n=i.length,e=null):e=t(i[n])}}}};var Ao=Object.keys(wo);function Mo(t){var e=$(t.ops),a=$(t.fields),u=$(t.params),o=$(t.as),s=this.outputs=[],l=this.windows=[],c={},f={},h=!0,d=[],m=[];function v(t){$(r(t)).forEach(t=>c[t]=1)}v(t.sort),e.forEach((function(t,e){var r=a[e],c=n(r),g=Qr(t,c,o[e]);if(v(r),s.push(g),K(wo,t))l.push(function(t,e,n,r){var i=wo[t](e,n);return{init:i.init||p,update:function(t,e){e[r]=i.next(t)}}}(t,a[e],u[e],g));else{if(null==r&&"count"!==t&&i("Null aggregate field specified."),"count"===t)return void d.push(g);h=!1;var y=f[c];y||((y=f[c]=[]).field=r,m.push(y)),y.push(ei(t,g))}})),(d.length||m.length)&&(this.cell=function(t,e,n){t=t.map(t=>ii(t,t.field));var r={num:0,agg:null,store:!1,count:e};if(!n)for(var i=t.length,a=r.agg=Array(i),u=0;u<i;++u)a[u]=new t[u](r);if(r.store)var o=r.data=new aa;return r.add=function(t){if(r.num+=1,!n){o&&o.add(t);for(var e=0;e<i;++e)a[e].add(a[e].get(t),t)}},r.rem=function(t){if(r.num-=1,!n){o&&o.rem(t);for(var e=0;e<i;++e)a[e].rem(a[e].get(t),t)}},r.set=function(t){var i,u;for(o&&o.values(),i=0,u=e.length;i<u;++i)t[e[i]]=r.num;if(!n)for(i=0,u=a.length;i<u;++i)a[i].set(t)},r.init=function(){r.num=0,o&&o.reset();for(var t=0;t<i;++t)a[t].init()},r}(m,d,h)),this.inputs=Object.keys(c)}var ko=Mo.prototype;function Co(t){Yr.call(this,{},t),this._mlen=0,this._mods=[]}ko.init=function(){this.windows.forEach(t=>t.init()),this.cell&&this.cell.init()},ko.update=function(t,e){var n,r=this.cell,i=this.windows,a=t.data,u=i&&i.length;if(r){for(n=t.p0;n<t.i0;++n)r.rem(a[n]);for(n=t.p1;n<t.i1;++n)r.add(a[n]);r.set(e)}for(n=0;n<u;++n)i[n].update(t,e)},Co.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ao.concat(ti)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var Do=rt(Co,Yr);function Eo(t,e,n,r){var i=r.sort,a=i&&!r.ignorePeers,u=r.frame||[null,0],o=t.data(n),s=o.length,l=0,c=a?oi(i):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:i||G(-1)};for(e.init();l<s;++l)Fo(f,u,l,s),a&&Bo(f,c),e.update(f,o[l])}function Fo(t,e,n,r){t.p0=t.i0,t.p1=t.i1,t.i0=null==e[0]?0:Math.max(0,n-Math.abs(e[0])),t.i1=null==e[1]?r:Math.min(r,n+Math.abs(e[1])+1),t.index=n}function Bo(t,e){var n=t.i0,r=t.i1-1,i=t.compare,a=t.data,u=a.length-1;n>0&&!i(a[n],a[n-1])&&(t.i0=e.left(a,a[n])),r<u&&!i(a[r],a[r+1])&&(t.i1=e.right(a,a[r]))}Do.transform=function(t,e){var n,r,i=this,a=i.state,u=t.modified(),o=zt(t.sort);this.stamp=e.stamp,a&&!u||(a=i.state=new Mo(t));var s=Zr(t.groupby);function l(t){return i.group(s(t))}for(u||e.modified(a.inputs)?(i.value={},e.visit(e.SOURCE,(function(t){l(t).add(t)}))):(e.visit(e.REM,(function(t){l(t).remove(t)})),e.visit(e.ADD,(function(t){l(t).add(t)}))),n=0,r=i._mlen;n<r;++n)Eo(i._mods[n],a,o,t);return i._mlen=0,i._mods=[],e.reflow(u).modifies(a.outputs)},Do.group=function(t){var e=this.value[t];return e||((e=this.value[t]=fa(Ft)).stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e};var To=Object.freeze({__proto__:null,aggregate:oa,bin:la,collect:ha,compare:da,countpattern:ma,cross:ga,density:_a,dotbin:Ma,expression:ka,extent:Da,facet:Ba,field:Sa,filter:Oa,flatten:za,fold:Ra,formula:Ua,generate:qa,impute:Ia,joinaggregate:ja,kde:Ha,key:Ya,load:Ga,lookup:Xa,multiextent:Ja,multivalues:Qa,params:tu,pivot:eu,prefacet:ru,project:iu,proxy:au,quantile:uu,relay:su,sample:lu,sequence:cu,sieve:fu,subflow:Ea,timeunit:go,tupleindex:bo,values:xo,window:Co}),So="top",No="left",Oo="right",zo="end",Ro="row";function Uo(t){this.clear(),t&&this.union(t)}var qo=Uo.prototype;qo.clone=function(){return new Uo(this)},qo.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},qo.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},qo.equals=function(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},qo.set=function(t,e,n,r){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this},qo.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},qo.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},qo.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},qo.scale=function(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},qo.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},qo.rotate=function(t,e,n){var r=this.rotatedPoints(t,e,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},qo.rotatedPoints=function(t,e,n){var{x1:r,y1:i,x2:a,y2:u}=this,o=Math.cos(t),s=Math.sin(t),l=e-e*o+n*s,c=n-e*s-n*o;return[o*r-s*i+l,s*r+o*i+c,o*r-s*u+l,s*r+o*u+c,o*a-s*i+l,s*a+o*i+c,o*a-s*u+l,s*a+o*u+c]},qo.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},qo.intersect=function(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},qo.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},qo.alignsWith=function(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},qo.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},qo.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},qo.width=function(){return this.x2-this.x1},qo.height=function(){return this.y2-this.y1};var Lo=0;function Po(t){return t&&t.gradient}function Io(t,e,n){var r=t.id,i=t.gradient,a="radial"===i?"p_":"";return r||(r=t.id="gradient_"+Lo++,"radial"===i?(t.x1=jo(t.x1,.5),t.y1=jo(t.y1,.5),t.r1=jo(t.r1,0),t.x2=jo(t.x2,.5),t.y2=jo(t.y2,.5),t.r2=jo(t.r2,.5),a="p_"):(t.x1=jo(t.x1,0),t.y1=jo(t.y1,0),t.x2=jo(t.x2,1),t.y2=jo(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+a+r+")"}function jo(t,e){return null!=t?t:e}function $o(t,e){var n,r=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:r,stop:function(t,e){return r.push({offset:t,color:e}),n}}}function Ho(t){this.mark=t,this.bounds=this.bounds||new Uo}function Yo(t){Ho.call(this,t),this.items=this.items||[]}function Vo(t,e){if("undefined"!=typeof document&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}function Go(){return"undefined"!=typeof Image?Image:null}function Wo(t){this._pending=0,this._loader=t||kr()}rt(Yo,Ho);var Xo=Wo.prototype;function Jo(t){t._pending+=1}function Zo(t){t._pending-=1}Xo.pending=function(){return this._pending},Xo.sanitizeURL=function(t){var e=this;return Jo(e),e._loader.sanitize(t,{context:"href"}).then((function(t){return Zo(e),t})).catch((function(){return Zo(e),null}))},Xo.loadImage=function(t){var e=this,n=Go();return Jo(e),e._loader.sanitize(t,{context:"image"}).then((function(t){var r=t.href;if(!r||!n)throw{url:r};var i=new n,a=K(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>Zo(e),i.onerror=()=>Zo(e),i.src=r,i})).catch((function(t){return Zo(e),{complete:!1,width:0,height:0,src:t&&t.url||""}}))},Xo.ready=function(){var t=this;return new Promise((function(e){!function n(r){t.pending()?setTimeout((function(){n(!0)}),10):e(r)}(!1)}))};var Qo=Math.PI,Ko=2*Qo,ts=Ko-1e-6;function es(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ns(){return new es}function rs(t){return function(){return t}}es.prototype=ns.prototype={constructor:es,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,a){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var a=this._x1,u=this._y1,o=n-t,s=r-e,l=a-t,c=u-e,f=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(f>1e-6)if(Math.abs(c*o-s*l)>1e-6&&i){var h=n-a,d=r-u,p=o*o+s*s,m=h*h+d*d,v=Math.sqrt(p),g=Math.sqrt(f),y=i*Math.tan((Qo-Math.acos((p+f-m)/(2*v*g)))/2),_=y/g,b=y/v;Math.abs(_-1)>1e-6&&(this._+="L"+(t+_*l)+","+(e+_*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>l*d)+","+(this._x1=t+b*o)+","+(this._y1=e+b*s)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,i,a){t=+t,e=+e,a=!!a;var u=(n=+n)*Math.cos(r),o=n*Math.sin(r),s=t+u,l=e+o,c=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+s+","+l:(Math.abs(this._x1-s)>1e-6||Math.abs(this._y1-l)>1e-6)&&(this._+="L"+s+","+l),n&&(f<0&&(f=f%Ko+Ko),f>ts?this._+="A"+n+","+n+",0,1,"+c+","+(t-u)+","+(e-o)+"A"+n+","+n+",0,1,"+c+","+(this._x1=s)+","+(this._y1=l):f>1e-6&&(this._+="A"+n+","+n+",0,"+ +(f>=Qo)+","+c+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var is=Math.abs,as=Math.atan2,us=Math.cos,os=Math.max,ss=Math.min,ls=Math.sin,cs=Math.sqrt,fs=Math.PI,hs=fs/2,ds=2*fs;function ps(t){return t>1?0:t<-1?fs:Math.acos(t)}function ms(t){return t>=1?hs:t<=-1?-hs:Math.asin(t)}function vs(t){return t.innerRadius}function gs(t){return t.outerRadius}function ys(t){return t.startAngle}function _s(t){return t.endAngle}function bs(t){return t&&t.padAngle}function xs(t,e,n,r,i,a,u,o){var s=n-t,l=r-e,c=u-i,f=o-a,h=f*s-c*l;if(!(h*h<1e-12))return[t+(h=(c*(e-a)-f*(t-i))/h)*s,e+h*l]}function ws(t,e,n,r,i,a,u){var o=t-n,s=e-r,l=(u?a:-a)/cs(o*o+s*s),c=l*s,f=-l*o,h=t+c,d=e+f,p=n+c,m=r+f,v=(h+p)/2,g=(d+m)/2,y=p-h,_=m-d,b=y*y+_*_,x=i-a,w=h*m-p*d,A=(_<0?-1:1)*cs(os(0,x*x*b-w*w)),M=(w*_-y*A)/b,k=(-w*y-_*A)/b,C=(w*_+y*A)/b,D=(-w*y+_*A)/b,E=M-v,F=k-g,B=C-v,T=D-g;return E*E+F*F>B*B+T*T&&(M=C,k=D),{cx:M,cy:k,x01:-c,y01:-f,x11:M*(i/x-1),y11:k*(i/x-1)}}function As(t){this._context=t}function Ms(t){return new As(t)}function ks(t){return t[0]}function Cs(t){return t[1]}function Ds(){var t=ks,e=Cs,n=rs(!0),r=null,i=Ms,a=null;function u(u){var o,s,l,c=u.length,f=!1;for(null==r&&(a=i(l=ns())),o=0;o<=c;++o)!(o<c&&n(s=u[o],o,u))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+t(s,o,u),+e(s,o,u));if(l)return a=null,l+""||null}return u.x=function(e){return arguments.length?(t="function"==typeof e?e:rs(+e),u):t},u.y=function(t){return arguments.length?(e="function"==typeof t?t:rs(+t),u):e},u.defined=function(t){return arguments.length?(n="function"==typeof t?t:rs(!!t),u):n},u.curve=function(t){return arguments.length?(i=t,null!=r&&(a=i(r)),u):i},u.context=function(t){return arguments.length?(null==t?r=a=null:a=i(r=t),u):r},u}function Es(){var t=ks,e=null,n=rs(0),r=Cs,i=rs(!0),a=null,u=Ms,o=null;function s(s){var l,c,f,h,d,p=s.length,m=!1,v=new Array(p),g=new Array(p);for(null==a&&(o=u(d=ns())),l=0;l<=p;++l){if(!(l<p&&i(h=s[l],l,s))===m)if(m=!m)c=l,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),f=l-1;f>=c;--f)o.point(v[f],g[f]);o.lineEnd(),o.areaEnd()}m&&(v[l]=+t(h,l,s),g[l]=+n(h,l,s),o.point(e?+e(h,l,s):v[l],r?+r(h,l,s):g[l]))}if(d)return o=null,d+""||null}function l(){return Ds().defined(i).curve(u).context(a)}return s.x=function(n){return arguments.length?(t="function"==typeof n?n:rs(+n),e=null,s):t},s.x0=function(e){return arguments.length?(t="function"==typeof e?e:rs(+e),s):t},s.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:rs(+t),s):e},s.y=function(t){return arguments.length?(n="function"==typeof t?t:rs(+t),r=null,s):n},s.y0=function(t){return arguments.length?(n="function"==typeof t?t:rs(+t),s):n},s.y1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:rs(+t),s):r},s.lineX0=s.lineY0=function(){return l().x(t).y(n)},s.lineY1=function(){return l().x(t).y(r)},s.lineX1=function(){return l().x(e).y(n)},s.defined=function(t){return arguments.length?(i="function"==typeof t?t:rs(!!t),s):i},s.curve=function(t){return arguments.length?(u=t,null!=a&&(o=u(a)),s):u},s.context=function(t){return arguments.length?(null==t?a=o=null:o=u(a=t),s):a},s}As.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var Fs={draw:function(t,e){var n=Math.sqrt(e/fs);t.moveTo(n,0),t.arc(0,0,n,0,ds)}};function Bs(){}function Ts(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function Ss(t){this._context=t}function Ns(t){this._context=t}function Os(t){this._context=t}function zs(t,e){this._basis=new Ss(t),this._beta=e}Ss.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ts(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ts(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Ns.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Ts(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Os.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Ts(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},zs.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],a=e[0],u=t[n]-i,o=e[n]-a,s=-1;++s<=n;)r=s/n,this._basis.point(this._beta*t[s]+(1-this._beta)*(i+r*u),this._beta*e[s]+(1-this._beta)*(a+r*o));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var Rs=function t(e){function n(t){return 1===e?new Ss(t):new zs(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function Us(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function qs(t,e){this._context=t,this._k=(1-e)/6}qs.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Us(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Us(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Ls=function t(e){function n(t){return new qs(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Ps(t,e){this._context=t,this._k=(1-e)/6}Ps.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Us(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Is=function t(e){function n(t){return new Ps(t,e)}return n.tension=function(e){return t(+e)},n}(0);function js(t,e){this._context=t,this._k=(1-e)/6}js.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Us(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var $s=function t(e){function n(t){return new js(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Hs(t,e,n){var r=t._x1,i=t._y1,a=t._x2,u=t._y2;if(t._l01_a>1e-12){var o=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,s=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*o-t._x0*t._l12_2a+t._x2*t._l01_2a)/s,i=(i*o-t._y0*t._l12_2a+t._y2*t._l01_2a)/s}if(t._l23_a>1e-12){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*l+t._x1*t._l23_2a-e*t._l12_2a)/c,u=(u*l+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(r,i,a,u,t._x2,t._y2)}function Ys(t,e){this._context=t,this._alpha=e}Ys.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Hs(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Vs=function t(e){function n(t){return e?new Ys(t,e):new qs(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Gs(t,e){this._context=t,this._alpha=e}Gs.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Hs(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Ws=function t(e){function n(t){return e?new Gs(t,e):new Ps(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Xs(t,e){this._context=t,this._alpha=e}Xs.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Hs(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Js=function t(e){function n(t){return e?new Xs(t,e):new js(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Zs(t){this._context=t}function Qs(t){return t<0?-1:1}function Ks(t,e,n){var r=t._x1-t._x0,i=e-t._x1,a=(t._y1-t._y0)/(r||i<0&&-0),u=(n-t._y1)/(i||r<0&&-0),o=(a*i+u*r)/(r+i);return(Qs(a)+Qs(u))*Math.min(Math.abs(a),Math.abs(u),.5*Math.abs(o))||0}function tl(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function el(t,e,n){var r=t._x0,i=t._y0,a=t._x1,u=t._y1,o=(a-r)/3;t._context.bezierCurveTo(r+o,i+o*e,a-o,u-o*n,a,u)}function nl(t){this._context=t}function rl(t){this._context=new il(t)}function il(t){this._context=t}function al(t){this._context=t}function ul(t){var e,n,r=t.length-1,i=new Array(r),a=new Array(r),u=new Array(r);for(i[0]=0,a[0]=2,u[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,a[e]=4,u[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,a[r-1]=7,u[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/a[e-1],a[e]-=n,u[e]-=n*u[e-1];for(i[r-1]=u[r-1]/a[r-1],e=r-2;e>=0;--e)i[e]=(u[e]-i[e+1])/a[e];for(a[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)a[e]=2*t[e+1]-i[e+1];return[i,a]}function ol(t,e){this._context=t,this._t=e}Zs.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},nl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:el(this,this._t0,tl(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,el(this,tl(this,n=Ks(this,t,e)),n);break;default:el(this,this._t0,n=Ks(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(rl.prototype=Object.create(nl.prototype)).point=function(t,e){nl.prototype.point.call(this,e,t)},il.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,a){this._context.bezierCurveTo(e,t,r,n,a,i)}},al.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=ul(t),i=ul(e),a=0,u=1;u<n;++a,++u)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],t[u],e[u]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},ol.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var sl={basis:{curve:function(t){return new Ss(t)}},"basis-closed":{curve:function(t){return new Ns(t)}},"basis-open":{curve:function(t){return new Os(t)}},bundle:{curve:Rs,tension:"beta",value:.85},cardinal:{curve:Ls,tension:"tension",value:0},"cardinal-open":{curve:$s,tension:"tension",value:0},"cardinal-closed":{curve:Is,tension:"tension",value:0},"catmull-rom":{curve:Vs,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Ws,tension:"alpha",value:.5},"catmull-rom-open":{curve:Js,tension:"alpha",value:.5},linear:{curve:Ms},"linear-closed":{curve:function(t){return new Zs(t)}},monotone:{horizontal:function(t){return new rl(t)},vertical:function(t){return new nl(t)}},natural:{curve:function(t){return new al(t)}},step:{curve:function(t){return new ol(t,.5)}},"step-after":{curve:function(t){return new ol(t,1)}},"step-before":{curve:function(t){return new ol(t,0)}}};function ll(t,e,n){var r=K(sl,t)&&sl[t],i=null;return r&&(i=r.curve||r[e||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}var cl={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},fl=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function hl(t){var e,n,r,i,a,u,o,s,l,c,f,h=[];for(s=0,c=(e=t.slice().replace(fl[0],"###$1").split(fl[1]).slice(1)).length;s<c;++s){for(r=(n=e[s]).slice(1).trim().replace(fl[2],"$1###$2").split(fl[3]),i=[u=n.charAt(0)],l=0,f=r.length;l<f;++l)(a=+r[l])===a&&i.push(a);if(o=cl[u.toLowerCase()],i.length-1>o)for(l=1,f=i.length;l<f;l+=o)h.push([u].concat(i.slice(l,l+o)));else h.push(i)}return h}var dl=Math.PI/180,pl=Math.PI/2,ml=2*Math.PI,vl=Math.sqrt(3)/2,gl={},yl={},_l=[].join;function bl(t){var e=_l.call(t);if(yl[e])return yl[e];var n=t[0],r=t[1],i=t[2],a=t[3],u=t[4],o=t[5],s=t[6],l=t[7],c=l*u,f=-s*o,h=s*u,d=l*o,p=Math.cos(i),m=Math.sin(i),v=Math.cos(a),g=Math.sin(a),y=.5*(a-i),_=Math.sin(.5*y),b=8/3*_*_/Math.sin(y),x=n+p-b*m,w=r+m+b*p,A=n+v,M=r+g,k=A+b*g,C=M-b*v;return yl[e]=[c*x+f*w,h*x+d*w,c*k+f*C,h*k+d*C,c*A+f*M,h*A+d*M]}var xl=["l",0,0,0,0,0,0,0];function wl(t,e,n){var r=xl[0]=t[0];if("a"===r||"A"===r)xl[1]=e*t[1],xl[2]=n*t[2],xl[3]=t[3],xl[4]=t[4],xl[5]=t[5],xl[6]=e*t[6],xl[7]=n*t[7];else if("h"===r||"H"===r)xl[1]=e*t[1];else if("v"===r||"V"===r)xl[1]=n*t[1];else for(var i=1,a=t.length;i<a;++i)xl[i]=(i%2==1?e:n)*t[i];return xl}function Al(t,e,n,r,i,a){var u,o,s,l,c,f=null,h=0,d=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),t.beginPath&&t.beginPath();for(var v=0,g=e.length;v<g;++v){switch(u=e[v],1===i&&1===a||(u=wl(u,i,a)),u[0]){case"l":h+=u[1],d+=u[2],t.lineTo(h+n,d+r);break;case"L":h=u[1],d=u[2],t.lineTo(h+n,d+r);break;case"h":h+=u[1],t.lineTo(h+n,d+r);break;case"H":h=u[1],t.lineTo(h+n,d+r);break;case"v":d+=u[1],t.lineTo(h+n,d+r);break;case"V":d=u[1],t.lineTo(h+n,d+r);break;case"m":h+=u[1],d+=u[2],t.moveTo(h+n,d+r);break;case"M":h=u[1],d=u[2],t.moveTo(h+n,d+r);break;case"c":o=h+u[5],s=d+u[6],p=h+u[3],m=d+u[4],t.bezierCurveTo(h+u[1]+n,d+u[2]+r,p+n,m+r,o+n,s+r),h=o,d=s;break;case"C":h=u[5],d=u[6],p=u[3],m=u[4],t.bezierCurveTo(u[1]+n,u[2]+r,p+n,m+r,h+n,d+r);break;case"s":o=h+u[3],s=d+u[4],p=2*h-p,m=2*d-m,t.bezierCurveTo(p+n,m+r,h+u[1]+n,d+u[2]+r,o+n,s+r),p=h+u[1],m=d+u[2],h=o,d=s;break;case"S":o=u[3],s=u[4],p=2*h-p,m=2*d-m,t.bezierCurveTo(p+n,m+r,u[1]+n,u[2]+r,o+n,s+r),h=o,d=s,p=u[1],m=u[2];break;case"q":o=h+u[3],s=d+u[4],p=h+u[1],m=d+u[2],t.quadraticCurveTo(p+n,m+r,o+n,s+r),h=o,d=s;break;case"Q":o=u[3],s=u[4],t.quadraticCurveTo(u[1]+n,u[2]+r,o+n,s+r),h=o,d=s,p=u[1],m=u[2];break;case"t":o=h+u[1],s=d+u[2],null===f[0].match(/[QqTt]/)?(p=h,m=d):"t"===f[0]?(p=2*h-l,m=2*d-c):"q"===f[0]&&(p=2*h-p,m=2*d-m),l=p,c=m,t.quadraticCurveTo(p+n,m+r,o+n,s+r),d=s,p=(h=o)+u[1],m=d+u[2];break;case"T":o=u[1],s=u[2],p=2*h-p,m=2*d-m,t.quadraticCurveTo(p+n,m+r,o+n,s+r),h=o,d=s;break;case"a":Ml(t,h+n,d+r,[u[1],u[2],u[3],u[4],u[5],u[6]+h+n,u[7]+d+r]),h+=u[6],d+=u[7];break;case"A":Ml(t,h+n,d+r,[u[1],u[2],u[3],u[4],u[5],u[6]+n,u[7]+r]),h=u[6],d=u[7];break;case"z":case"Z":t.closePath()}f=u}}function Ml(t,e,n,r){for(var i=function(t,e,n,r,i,a,u,o,s){var l=_l.call(arguments);if(gl[l])return gl[l];var c=u*dl,f=Math.sin(c),h=Math.cos(c),d=h*(o-t)*.5+f*(s-e)*.5,p=h*(s-e)*.5-f*(o-t)*.5,m=d*d/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(n*=m=Math.sqrt(m),r*=m);var v=h/n,g=f/n,y=-f/r,_=h/r,b=v*o+g*s,x=y*o+_*s,w=v*t+g*e,A=y*t+_*e,M=(w-b)*(w-b)+(A-x)*(A-x),k=1/M-.25;k<0&&(k=0);var C=Math.sqrt(k);a==i&&(C=-C);var D=.5*(b+w)-C*(A-x),E=.5*(x+A)+C*(w-b),F=Math.atan2(x-E,b-D),B=Math.atan2(A-E,w-D),T=B-F;T<0&&1===a?T+=ml:T>0&&0===a&&(T-=ml);for(var S=Math.ceil(Math.abs(T/(pl+.001))),N=[],O=0;O<S;++O){var z=F+O*T/S,R=F+(O+1)*T/S;N[O]=[D,E,z,R,n,r,f,h]}return gl[l]=N}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,n),a=0;a<i.length;++a){var u=bl(i[a]);t.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5])}}var kl=.5773502691896257,Cl={circle:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,ml)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/2.5;t.moveTo(-n,-r),t.lineTo(-n,r),t.lineTo(-r,r),t.lineTo(-r,n),t.lineTo(r,n),t.lineTo(r,r),t.lineTo(n,r),t.lineTo(n,-r),t.lineTo(r,-r),t.lineTo(r,-n),t.lineTo(-r,-n),t.lineTo(-r,-r),t.closePath()}},diamond:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),r=-n/2;t.rect(r,r,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/7,i=n/2.5,a=n/8;t.moveTo(-r,n),t.lineTo(r,n),t.lineTo(r,-a),t.lineTo(i,-a),t.lineTo(0,-n),t.lineTo(-i,-a),t.lineTo(-r,-a),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,r=vl*n,i=r-n*kl,a=n/4;t.moveTo(0,-r-i),t.lineTo(-a,r-i),t.lineTo(a,r-i),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,r=vl*n,i=r-n*kl;t.moveTo(0,-r-i),t.lineTo(-n,r-i),t.lineTo(n,r-i),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,r=vl*n;t.moveTo(0,-r),t.lineTo(-n,r),t.lineTo(n,r),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,r=vl*n;t.moveTo(0,r),t.lineTo(-n,-r),t.lineTo(n,-r),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,r=vl*n;t.moveTo(r,0),t.lineTo(-r,-n),t.lineTo(-r,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,r=vl*n;t.moveTo(-r,0),t.lineTo(r,-n),t.lineTo(r,n),t.closePath()}},stroke:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function Dl(t){return K(Cl,t)?Cl[t]:function(t){if(!K(El,t)){var e=hl(t);El[t]={draw:function(t,n){Al(t,e,0,0,Math.sqrt(n)/2)}}}return El[t]}(t)}var El={};var Fl=.448084975506;function Bl(t){return t.x}function Tl(t){return t.y}function Sl(t){return t.width}function Nl(t){return t.height}function Ol(t){return"function"==typeof t?t:()=>+t}function zl(t,e,n){return Math.max(e,Math.min(t,n))}function Rl(){var t=Bl,e=Tl,n=Sl,r=Nl,i=Ol(0),a=i,u=i,o=i,s=null;function l(l,c,f){var h,d=null!=c?c:+t.call(this,l),p=null!=f?f:+e.call(this,l),m=+n.call(this,l),v=+r.call(this,l),g=Math.min(m,v)/2,y=zl(+i.call(this,l),0,g),_=zl(+a.call(this,l),0,g),b=zl(+u.call(this,l),0,g),x=zl(+o.call(this,l),0,g);if(s||(s=h=ns()),y<=0&&_<=0&&b<=0&&x<=0)s.rect(d,p,m,v);else{var w=d+m,A=p+v;s.moveTo(d+y,p),s.lineTo(w-_,p),s.bezierCurveTo(w-Fl*_,p,w,p+Fl*_,w,p+_),s.lineTo(w,A-x),s.bezierCurveTo(w,A-Fl*x,w-Fl*x,A,w-x,A),s.lineTo(d+b,A),s.bezierCurveTo(d+Fl*b,A,d,A-Fl*b,d,A-b),s.lineTo(d,p+y),s.bezierCurveTo(d,p+Fl*y,d+Fl*y,p,d+y,p),s.closePath()}if(h)return s=null,h+""||null}return l.x=function(e){return arguments.length?(t=Ol(e),l):t},l.y=function(t){return arguments.length?(e=Ol(t),l):e},l.width=function(t){return arguments.length?(n=Ol(t),l):n},l.height=function(t){return arguments.length?(r=Ol(t),l):r},l.cornerRadius=function(t,e,n,r){return arguments.length?(i=Ol(t),a=null!=e?Ol(e):i,o=null!=n?Ol(n):i,u=null!=r?Ol(r):a,l):i},l.context=function(t){return arguments.length?(s=null==t?null:t,l):s},l}function Ul(){var t,e,n,r,i,a,u,o,s=null;function l(t,e,n){var r=n/2;if(i){var l=u-e,c=t-a;if(l||c){var f=Math.sqrt(l*l+c*c),h=(l/=f)*o,d=(c/=f)*o,p=Math.atan2(c,l);s.moveTo(a-h,u-d),s.lineTo(t-l*r,e-c*r),s.arc(t,e,r,p-Math.PI,p),s.lineTo(a+h,u+d),s.arc(a,u,o,p,p+Math.PI)}else s.arc(t,e,r,0,ml);s.closePath()}else i=1;a=t,u=e,o=r}function c(a){var u,o,c,f=a.length,h=!1;for(null==s&&(s=c=ns()),u=0;u<=f;++u)!(u<f&&r(o=a[u],u,a))===h&&(h=!h)&&(i=0),h&&l(+t(o,u,a),+e(o,u,a),+n(o,u,a));if(c)return s=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(r=t,c):r},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}function ql(t,e){return null!=t?t:e}var Ll=t=>t.x||0,Pl=t=>t.y||0,Il=t=>!(!1===t.defined),jl=function(){var t=vs,e=gs,n=rs(0),r=null,i=ys,a=_s,u=bs,o=null;function s(){var s,l,c=+t.apply(this,arguments),f=+e.apply(this,arguments),h=i.apply(this,arguments)-hs,d=a.apply(this,arguments)-hs,p=is(d-h),m=d>h;if(o||(o=s=ns()),f<c&&(l=f,f=c,c=l),f>1e-12)if(p>ds-1e-12)o.moveTo(f*us(h),f*ls(h)),o.arc(0,0,f,h,d,!m),c>1e-12&&(o.moveTo(c*us(d),c*ls(d)),o.arc(0,0,c,d,h,m));else{var v,g,y=h,_=d,b=h,x=d,w=p,A=p,M=u.apply(this,arguments)/2,k=M>1e-12&&(r?+r.apply(this,arguments):cs(c*c+f*f)),C=ss(is(f-c)/2,+n.apply(this,arguments)),D=C,E=C;if(k>1e-12){var F=ms(k/c*ls(M)),B=ms(k/f*ls(M));(w-=2*F)>1e-12?(b+=F*=m?1:-1,x-=F):(w=0,b=x=(h+d)/2),(A-=2*B)>1e-12?(y+=B*=m?1:-1,_-=B):(A=0,y=_=(h+d)/2)}var T=f*us(y),S=f*ls(y),N=c*us(x),O=c*ls(x);if(C>1e-12){var z,R=f*us(_),U=f*ls(_),q=c*us(b),L=c*ls(b);if(p<fs&&(z=xs(T,S,q,L,R,U,N,O))){var P=T-z[0],I=S-z[1],j=R-z[0],$=U-z[1],H=1/ls(ps((P*j+I*$)/(cs(P*P+I*I)*cs(j*j+$*$)))/2),Y=cs(z[0]*z[0]+z[1]*z[1]);D=ss(C,(c-Y)/(H-1)),E=ss(C,(f-Y)/(H+1))}}A>1e-12?E>1e-12?(v=ws(q,L,T,S,f,E,m),g=ws(R,U,N,O,f,E,m),o.moveTo(v.cx+v.x01,v.cy+v.y01),E<C?o.arc(v.cx,v.cy,E,as(v.y01,v.x01),as(g.y01,g.x01),!m):(o.arc(v.cx,v.cy,E,as(v.y01,v.x01),as(v.y11,v.x11),!m),o.arc(0,0,f,as(v.cy+v.y11,v.cx+v.x11),as(g.cy+g.y11,g.cx+g.x11),!m),o.arc(g.cx,g.cy,E,as(g.y11,g.x11),as(g.y01,g.x01),!m))):(o.moveTo(T,S),o.arc(0,0,f,y,_,!m)):o.moveTo(T,S),c>1e-12&&w>1e-12?D>1e-12?(v=ws(N,O,R,U,c,-D,m),g=ws(T,S,q,L,c,-D,m),o.lineTo(v.cx+v.x01,v.cy+v.y01),D<C?o.arc(v.cx,v.cy,D,as(v.y01,v.x01),as(g.y01,g.x01),!m):(o.arc(v.cx,v.cy,D,as(v.y01,v.x01),as(v.y11,v.x11),!m),o.arc(0,0,c,as(v.cy+v.y11,v.cx+v.x11),as(g.cy+g.y11,g.cx+g.x11),m),o.arc(g.cx,g.cy,D,as(g.y11,g.x11),as(g.y01,g.x01),!m))):o.arc(0,0,c,x,b,m):o.lineTo(N,O)}else o.moveTo(0,0);if(o.closePath(),s)return o=null,s+""||null}return s.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-fs/2;return[us(r)*n,ls(r)*n]},s.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:rs(+e),s):t},s.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:rs(+t),s):e},s.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:rs(+t),s):n},s.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:rs(+t),s):r},s.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:rs(+t),s):i},s.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:rs(+t),s):a},s.padAngle=function(t){return arguments.length?(u="function"==typeof t?t:rs(+t),s):u},s.context=function(t){return arguments.length?(o=null==t?null:t,s):o},s}().startAngle(t=>t.startAngle||0).endAngle(t=>t.endAngle||0).padAngle(t=>t.padAngle||0).innerRadius(t=>t.innerRadius||0).outerRadius(t=>t.outerRadius||0).cornerRadius(t=>t.cornerRadius||0),$l=Es().x(Ll).y1(Pl).y0(t=>(t.y||0)+(t.height||0)).defined(Il),Hl=Es().y(Pl).x1(Ll).x0(t=>(t.x||0)+(t.width||0)).defined(Il),Yl=Ds().x(Ll).y(Pl).defined(Il),Vl=Rl().x(Ll).y(Pl).width(t=>t.width||0).height(t=>t.height||0).cornerRadius(t=>ql(t.cornerRadiusTopLeft,t.cornerRadius)||0,t=>ql(t.cornerRadiusTopRight,t.cornerRadius)||0,t=>ql(t.cornerRadiusBottomRight,t.cornerRadius)||0,t=>ql(t.cornerRadiusBottomLeft,t.cornerRadius)||0),Gl=function(){var t=rs(Fs),e=rs(64),n=null;function r(){var r;if(n||(n=r=ns()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return r.type=function(e){return arguments.length?(t="function"==typeof e?e:rs(e),r):t},r.size=function(t){return arguments.length?(e="function"==typeof t?t:rs(+t),r):e},r.context=function(t){return arguments.length?(n=null==t?null:t,r):n},r}().type(t=>Dl(t.shape||"circle")).size(t=>ql(t.size,64)),Wl=Ul().x(Ll).y(Pl).defined(Il).size(t=>t.size||1);function Xl(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function Jl(t,e,n,r){return Vl.context(t)(e,n,r)}function Zl(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){var r=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(r+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,r):0))}return t}var Ql,Kl,tc,ec=ml-1e-8;function nc(t){return Ql=t,nc}function rc(){}function ic(t,e){Ql.add(t,e)}function ac(t,e){ic(Kl=t,tc=e)}function uc(t){ic(t,Ql.y1)}function oc(t){ic(Ql.x1,t)}function sc(t,e,n,r){var i=(t-e)/(t+n-2*e);0<i&&i<1&&r(t+(e-t)*i)}function lc(t,e,n,r,i){var a,u=r-t+3*e-3*n,o=t+n-2*e,s=t-e,l=0,c=0;Math.abs(u)>1e-14?(a=o*o+s*u)>=0&&(l=(-o+(a=Math.sqrt(a)))/u,c=(-o-a)/u):l=.5*s/o,0<l&&l<1&&i(cc(l,t,e,n,r)),0<c&&c<1&&i(cc(c,t,e,n,r))}function cc(t,e,n,r,i){var a=1-t,u=a*a,o=t*t;return u*a*e+3*u*t*n+3*a*o*r+o*t*i}nc.beginPath=rc,nc.closePath=rc,nc.moveTo=ac,nc.lineTo=ac,nc.rect=function(t,e,n,r){ic(t+n,e+r),ac(t,e)},nc.quadraticCurveTo=function(t,e,n,r){sc(Kl,t,n,uc),sc(tc,e,r,oc),ac(n,r)},nc.bezierCurveTo=function(t,e,n,r,i,a){lc(Kl,t,n,i,uc),lc(tc,e,r,a,oc),ac(i,a)},nc.arc=function(t,e,n,r,i,a){if(Kl=n*Math.cos(i)+t,tc=n*Math.sin(i)+e,Math.abs(i-r)>ec)ic(t-n,e-n),ic(t+n,e+n);else{var u,o,s=r=>ic(n*Math.cos(r)+t,n*Math.sin(r)+e);if(s(r),s(i),i!==r)if((r%=ml)<0&&(r+=ml),(i%=ml)<0&&(i+=ml),i<r&&(a=!a,u=r,r=i,i=u),a)for(i-=ml,u=r-r%pl,o=0;o<4&&u>i;++o,u-=pl)s(u);else for(u=r-r%pl+pl,o=0;o<4&&u<i;++o,u+=pl)s(u)}};var fc=(fc=Vo(1,1))?fc.getContext("2d"):null,hc=new Uo;function dc(t){return function(e,n){if(!fc)return!0;t(fc,e),hc.clear().union(e.bounds).intersect(n).round();for(var{x1:r,y1:i,x2:a,y2:u}=hc,o=i;o<=u;++o)for(var s=r;s<=a;++s)if(fc.isPointInPath(s,o))return!0;return!1}}function pc(t,e){return e.contains(t.x||0,t.y||0)}function mc(t,e){var n=t.x||0,r=t.y||0,i=t.width||0,a=t.height||0;return e.intersects(hc.set(n,r,n+i,r+a))}function vc(t,e){var n=t.x||0,r=t.y||0;return gc(e,n,r,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r)}function gc(t,e,n,r,i){var a,u,o,s,{x1:l,y1:c,x2:f,y2:h}=t,d=r-e,p=i-n,m=0,v=1;for(s=0;s<4;++s){if(0===s&&(a=-d,u=-(l-e)),1===s&&(a=d,u=f-e),2===s&&(a=-p,u=-(c-n)),3===s&&(a=p,u=h-n),Math.abs(a)<1e-10&&u<0)return!1;if(o=u/a,a<0){if(o>v)return!1;o>m&&(m=o)}else if(a>0){if(o<m)return!1;o<v&&(v=o)}}return!0}function yc(t,e){t.globalCompositeOperation=e.blend||"source-over"}function _c(t,e){return null==t?e:t}function bc(t,e){for(var n=e.length,r=0;r<n;++r)t.addColorStop(e[r].offset,e[r].color);return t}function xc(t,e,n){return Po(n)?function(t,e,n){var r,i=n.width(),a=n.height();if("radial"===e.gradient)r=t.createRadialGradient(n.x1+_c(e.x1,.5)*i,n.y1+_c(e.y1,.5)*a,Math.max(i,a)*_c(e.r1,0),n.x1+_c(e.x2,.5)*i,n.y1+_c(e.y2,.5)*a,Math.max(i,a)*_c(e.r2,.5));else{var u=_c(e.x1,0),o=_c(e.y1,0),s=_c(e.x2,1),l=_c(e.y2,0);if(u!==s&&o!==l&&i!==a){var c=Vo(Math.ceil(i),Math.ceil(a)),f=c.getContext("2d");return f.scale(i,a),f.fillStyle=bc(f.createLinearGradient(u,o,s,l),e.stops),f.fillRect(0,0,i,a),t.createPattern(c,"no-repeat")}r=t.createLinearGradient(n.x1+u*i,n.y1+o*a,n.x1+s*i,n.y1+l*a)}return bc(r,e.stops)}(t,n,e.bounds):n}function wc(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=xc(t,e,e.fill),!0)}var Ac=[];function Mc(t,e,n){var r=null!=(r=e.strokeWidth)?r:1;return!(r<=0)&&((n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=xc(t,e,e.stroke),t.lineWidth=r,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||Ac),t.lineDashOffset=e.strokeDashOffset||0),!0))}function kc(t,e){return t.zindex-e.zindex||t.index-e.index}function Cc(t){if(!t.zdirty)return t.zitems;var e,n,r,i=t.items,a=[];for(n=0,r=i.length;n<r;++n)(e=i[n]).index=n,e.zindex&&a.push(e);return t.zdirty=!1,t.zitems=a.sort(kc)}function Dc(t,e){var n,r,i=t.items;if(i&&i.length){var a=Cc(t);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||e(i[n]);i=a}for(n=0,r=i.length;n<r;++n)e(i[n])}}function Ec(t,e){var n,r,i=t.items;if(!i||!i.length)return null;var a=Cc(t);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=e(i[r]))return n;if(i===a)for(r=(i=t.items).length;--r>=0;)if(!i[r].zindex&&(n=e(i[r])))return n;return null}function Fc(t){return function(e,n,r){Dc(n,(function(n){r&&!r.intersects(n.bounds)||Tc(t,e,n,n)}))}}function Bc(t){return function(e,n,r){!n.items.length||r&&!r.intersects(n.bounds)||Tc(t,e,n.items[0],n.items)}}function Tc(t,e,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(t(e,r)||(yc(e,n),n.fill&&wc(e,n,i)&&e.fill(),n.stroke&&Mc(e,n,i)&&e.stroke()))}function Sc(t){return t=t||v,function(e,n,r,i,a,u){return r*=e.pixelRatio,i*=e.pixelRatio,Ec(n,(function(n){var o=n.bounds;if((!o||o.contains(a,u))&&o)return t(e,n,r,i,a,u)?n:void 0}))}}function Nc(t,e){return function(n,r,i,a){var u,o,s=Array.isArray(r)?r[0]:r,l=null==e?s.fill:e,c=s.stroke&&n.isPointInStroke;return c&&(u=s.strokeWidth,o=s.strokeCap,n.lineWidth=null!=u?u:1,n.lineCap=null!=o?o:"butt"),!t(n,r)&&(l&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function Oc(t){return Sc(Nc(t))}function zc(t,e){return"translate("+t+","+e+")"}function Rc(t){return"rotate("+t+")"}function Uc(t){return zc(t.x||0,t.y||0)}function qc(t){return zc(t.x||0,t.y||0)+(t.angle?" "+Rc(t.angle):"")+(t.scaleX||t.scaleY?" "+(e=t.scaleX||1,n=t.scaleY||1,"scale("+e+","+n+")"):"");var e,n}function Lc(t,e,n){function r(t,n){var r=n.x||0,i=n.y||0,a=n.angle||0;t.translate(r,i),a&&t.rotate(a*=dl),t.beginPath(),e(t,n),a&&t.rotate(-a),t.translate(-r,-i)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",qc(n)),t("d",e(null,n))},bound:function(t,n){var r=n.x||0,i=n.y||0;return e(nc(t),n),Zl(t,n).translate(r,i),n.angle&&t.rotate(n.angle*dl,r,i),t},draw:Fc(r),pick:Oc(r),isect:n||dc(r)}}var Pc=Lc("arc",(function(t,e){return jl.context(t)(e)}));function Ic(t,e,n){function r(t,n){t.beginPath(),e(t,n)}var i=Nc(r);return{type:t,tag:"path",nested:!0,attr:function(t,n){var r=n.mark.items;r.length&&t("d",e(null,r))},bound:function(t,n){var r=n.items;return 0===r.length?t:(e(nc(t),r),Zl(t,r[0]))},draw:Bc(r),pick:function(t,e,n,r,a,u){var o=e.items,s=e.bounds;return!o||!o.length||s&&!s.contains(a,u)?null:(n*=t.pixelRatio,r*=t.pixelRatio,i(t,o,n,r)?o[0]:null)},isect:pc,tip:n}}var jc=Ic("area",(function(t,e){var n=e[0],r=n.interpolate||"linear";return("horizontal"===n.orient?Hl:$l).curve(ll(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i="horizontal"===t[0].orient?e[1]:e[0],a="horizontal"===t[0].orient?"y":"x",u=t.length,o=1/0;--u>=0;)!1!==t[u].defined&&(r=Math.abs(t[u][a]-i))<o&&(o=r,n=t[u]);return n}));function $c(t,e){t.beginPath(),Xl(e)?Jl(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}var Hc=1;function Yc(t,e,n){var r=e.clip,i=t._defs,a=e.clip_id||(e.clip_id="clip"+Hc++),u=i.clipping[a]||(i.clipping[a]={id:a});return Y(r)?u.path=r(null):Xl(n)?u.path=Jl(null,n,0,0):(u.width=n.width||0,u.height=n.height||0),"url(#"+a+")"}function Vc(t){var e=null!=(e=t.strokeWidth)?e:1;return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function Gc(t,e){var n=Vc(e);t("d",Jl(null,e,n,n))}function Wc(t,e,n,r){var i=Vc(e);t.beginPath(),Jl(t,e,(n||0)+i,(r||0)+i)}var Xc=Nc(Wc),Jc=Nc(Wc,!1);var Zc={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",Uc(e))},bound:function(t,e){if(!e.clip&&e.items)for(var n=e.items,r=0,i=n.length;r<i;++r)t.union(n[r].bounds);return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Zl(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n){var r=this;Dc(e,(function(e){var i=e.x||0,a=e.y||0,u=e.strokeForeground,o=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&o&&(Wc(t,e,i,a),yc(t,e),e.fill&&wc(t,e,o)&&t.fill(),e.stroke&&!u&&Mc(t,e,o)&&t.stroke()),t.save(),t.translate(i,a),e.clip&&$c(t,e),n&&n.translate(-i,-a),Dc(e,(function(e){r.draw(t,e,n)})),n&&n.translate(i,a),t.restore(),u&&e.stroke&&o&&(Wc(t,e,i,a),yc(t,e),Mc(t,e,o)&&t.stroke())}))},pick:function(t,e,n,r,i,a){if(e.bounds&&!e.bounds.contains(i,a)||!e.items)return null;var u=this,o=n*t.pixelRatio,s=r*t.pixelRatio;return Ec(e,(function(l){var c,f,h,d,p,m,v,g,y;if((!(g=l.bounds)||g.contains(i,a))&&(d=l.x||0,p=l.y||0,m=d+(l.width||0),v=p+(l.height||0),!(y=l.clip)||!(i<d||i>m||a<d||a>v)))return t.save(),t.translate(d,p),d=i-d,p=a-p,y&&Xl(l)&&!Xc(t,l,o,s)?(t.restore(),null):(f=l.strokeForeground,(h=!1!==e.interactive)&&f&&l.stroke&&Jc(t,l,o,s)?(t.restore(),l):(!(c=Ec(l,(function(t){return function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,d,p)?u.pick(t,n,r,d,p):null})))&&h&&(l.fill||!f&&l.stroke)&&Xc(t,l,o,s)&&(c=l),t.restore(),c||null))}))},isect:mc,content:function(t,e,n){t("clip-path",e.clip?Yc(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),Gc(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?Gc(t,e):t("d","")}};function Qc(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then(e=>{t.image=e,t.image.url=t.url})),n}function Kc(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function tf(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function ef(t,e){return"center"===t?e/2:"right"===t?e:0}function nf(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var rf={type:"image",tag:"image",nested:!1,attr:function(t,e,n){var r=Qc(e,n),i=e.x||0,a=e.y||0,u=Kc(e,r),o=tf(e,r),s=!1===e.aspect?"none":"xMidYMid";i-=ef(e.align,u),a-=nf(e.baseline,o),!r.src&&r.toDataURL?t("href",r.toDataURL(),"http://www.w3.org/1999/xlink","xlink:href"):t("href",r.src||"","http://www.w3.org/1999/xlink","xlink:href"),t("transform",zc(i,a)),t("width",u),t("height",o),t("preserveAspectRatio",s)},bound:function(t,e){var n=e.image,r=e.x||0,i=e.y||0,a=Kc(e,n),u=tf(e,n);return r-=ef(e.align,a),i-=nf(e.baseline,u),t.set(r,i,r+a,i+u)},draw:function(t,e,n){var r=this;Dc(e,(function(e){if(!n||n.intersects(e.bounds)){var i,a,u,o,s=Qc(e,r),l=e.x||0,c=e.y||0,f=Kc(e,s),h=tf(e,s);l-=ef(e.align,f),c-=nf(e.baseline,h),!1!==e.aspect&&(a=s.width/s.height,u=e.width/e.height,a==a&&u==u&&a!==u&&(u<a?(c+=(h-(o=f/a))/2,h=o):(l+=(f-(o=h*a))/2,f=o))),(s.complete||s.toDataURL)&&(yc(t,e),t.globalAlpha=null!=(i=e.opacity)?i:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(s,l,c,f,h))}}))},pick:Sc(),isect:v,get:Qc,xOffset:ef,yOffset:nf},af=Ic("line",(function(t,e){var n=e[0],r=n.interpolate||"linear";return Yl.curve(ll(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i=Math.pow(t[0].strokeWidth||1,2),a=t.length;--a>=0;)if(!1!==t[a].defined&&(n=t[a].x-e[0])*n+(r=t[a].y-e[1])*r<i)return t[a];return null}));function uf(t,e){var n=e.path;if(null==n)return!0;var r=e.x||0,i=e.y||0,a=e.scaleX||1,u=e.scaleY||1,o=(e.angle||0)*dl,s=e.pathCache;s&&s.path===n||((e.pathCache=s=hl(n)).path=n),o&&t.rotate&&t.translate?(t.translate(r,i),t.rotate(o),Al(t,s,0,0,a,u),t.rotate(-o),t.translate(-r,-i)):Al(t,s,r,i,a,u)}var of={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,r=e.scaleY||1;1===n&&1===r||t("vector-effect","non-scaling-stroke"),t("transform",qc(e)),t("d",e.path)},bound:function(t,e){return uf(nc(t),e)?t.set(0,0,0,0):Zl(t,e,!0),e.angle&&t.rotate(e.angle*dl,e.x||0,e.y||0),t},draw:Fc(uf),pick:Oc(uf),isect:dc(uf)};function sf(t,e){t.beginPath(),Jl(t,e)}var lf={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",Jl(null,e))},bound:function(t,e){var n,r;return Zl(t.set(n=e.x||0,r=e.y||0,n+e.width||0,r+e.height||0),e)},draw:Fc(sf),pick:Oc(sf),isect:mc};function cf(t,e,n){var r,i,a,u;return!(!e.stroke||!Mc(t,e,n))&&(r=e.x||0,i=e.y||0,a=null!=e.x2?e.x2:r,u=null!=e.y2?e.y2:i,t.beginPath(),t.moveTo(r,i),t.lineTo(a,u),!0)}var ff={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",Uc(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,r;return Zl(t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e)},draw:function(t,e,n){Dc(e,(function(e){if(!n||n.intersects(e.bounds)){var r=null==e.opacity?1:e.opacity;r&&cf(t,e,r)&&(yc(t,e),t.stroke())}}))},pick:Sc((function(t,e,n,r){return!!t.isPointInStroke&&(cf(t,e,1)&&t.isPointInStroke(n,r))})),isect:vc},hf=Lc("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),df=Lc("symbol",(function(t,e){return Gl.context(t)(e)}),pc),pf=ft(),mf={height:xf,measureWidth:_f,estimateWidth:gf,width:gf,canvas:vf};function vf(t){mf.width=t&&fc?_f:gf}function gf(t,e){return yf(kf(t,e),xf(t))}function yf(t,e){return~~(.8*t.length*e)}function _f(t,e){return xf(t)<=0||!(e=kf(t,e))?0:bf(e,Df(t))}function bf(t,e){var n=`(${e}) ${t}`,r=pf.get(n);return void 0===r&&(fc.font=e,r=fc.measureText(t).width,pf.set(n,r)),r}function xf(t){return null!=t.fontSize?+t.fontSize||0:11}function wf(t){return null!=t.lineHeight?t.lineHeight:xf(t)+2}function Af(t){return e=t.lineBreak&&t.text&&!u(t.text)?t.text.split(t.lineBreak):t.text,u(e)?e.length>1?e:e[0]:e;var e}function Mf(t){var e=Af(t);return(u(e)?e.length-1:0)*wf(t)}function kf(t,e){var n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,r=function(t){if(mf.width===_f){var e=Df(t);return t=>bf(t,e)}var n=xf(t);return t=>yf(t,n)}(t);if(r(e)<n)return e;var i,a=t.ellipsis||"
",u="rtl"===t.dir,o=0,s=e.length;if(n-=r(a),u){for(;o<s;)i=o+s>>>1,r(e.slice(i))>n?o=i+1:s=i;return a+e.slice(o)}for(;o<s;)i=1+(o+s>>>1),r(e.slice(0,i))<n?o=i:s=i-1;return e.slice(0,o)+a}(t,n):n}function Cf(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function Df(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+xf(t)+"px "+Cf(t,e)}function Ef(t){var e=t.baseline,n=xf(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*wf(t):"line-bottom"===e?.29*n-.5*wf(t):0)}vf(!0);var Ff={left:"start",center:"middle",right:"end"},Bf=new Uo;function Tf(t){var e,n=t.x||0,r=t.y||0,i=t.radius||0;return i&&(e=(t.theta||0)-pl,n+=i*Math.cos(e),r+=i*Math.sin(e)),Bf.x1=n,Bf.y1=r,Bf}function Sf(t,e,n){var r,i=mf.height(e),a=e.align,o=Tf(e),s=o.x1,l=o.y1,c=e.dx||0,f=(e.dy||0)+Ef(e)-Math.round(.8*i),h=Af(e);if(u(h)?(i+=wf(e)*(h.length-1),r=h.reduce((t,n)=>Math.max(t,mf.width(e,n)),0)):r=mf.width(e,h),"center"===a?c-=r/2:"right"===a&&(c-=r),t.set(c+=s,f+=l,c+r,f+i),e.angle&&!n)t.rotate(e.angle*dl,s,l);else if(2===n)return t.rotatedPoints(e.angle*dl,s,l);return t}var Nf={arc:Pc,area:jc,group:Zc,image:rf,line:af,path:of,rect:lf,rule:ff,shape:hf,symbol:df,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,r=e.dx||0,i=(e.dy||0)+Ef(e),a=Tf(e),u=a.x1,o=a.y1,s=e.angle||0;t("text-anchor",Ff[e.align]||"start"),s?(n=zc(u,o)+" "+Rc(s),(r||i)&&(n+=" "+zc(r,i))):n=zc(u+r,o+i),t("transform",n)},bound:Sf,draw:function(t,e,n){Dc(e,(function(e){var r,i,a,o,s,l,c,f=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===f||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=Df(e),t.textAlign=e.align||"left",i=(r=Tf(e)).x1,a=r.y1,e.angle&&(t.save(),t.translate(i,a),t.rotate(e.angle*dl),i=a=0),i+=e.dx||0,a+=(e.dy||0)+Ef(e),l=Af(e),yc(t,e),u(l))for(s=wf(e),o=0;o<l.length;++o)c=kf(e,l[o]),e.fill&&wc(t,e,f)&&t.fillText(c,i,a),e.stroke&&Mc(t,e,f)&&t.strokeText(c,i,a),a+=s;else c=kf(e,l),e.fill&&wc(t,e,f)&&t.fillText(c,i,a),e.stroke&&Mc(t,e,f)&&t.strokeText(c,i,a);e.angle&&t.restore()}}))},pick:Sc((function(t,e,n,r,i,a){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var u=Tf(e),o=u.x1,s=u.y1,l=Sf(Bf,e,1),c=-e.angle*dl,f=Math.cos(c),h=Math.sin(c),d=f*i-h*a+(o-f*o+h*s),p=h*i+f*a+(s-h*o-f*s);return l.contains(d,p)})),isect:function(t,e){var n=Sf(Bf,t,2);return gc(e,n[0],n[1],n[2],n[3])||gc(e,n[0],n[1],n[4],n[5])||gc(e,n[4],n[5],n[6],n[7])||gc(e,n[2],n[3],n[6],n[7])}},trail:Ic("trail",(function(t,e){return Wl.context(t)(e)}),(function(t,e){for(var n,r,i=t.length;--i>=0;)if(!1!==t[i].defined&&(n=t[i].x-e[0])*n+(r=t[i].y-e[1])*r<(n=t[i].size||1)*n)return t[i];return null}))};function Of(t,e,n){var r=Nf[t.mark.marktype],i=e||r.bound;return r.nested&&(t=t.mark),i(t.bounds||(t.bounds=new Uo),t,n)}var zf={mark:null};function Rf(t,e,n){var r,i,a,u,o=Nf[t.marktype],s=o.bound,l=t.items,c=l&&l.length;if(o.nested)return c?a=l[0]:(zf.mark=t,a=zf),u=Of(a,s,n),e=e&&e.union(u)||u;if(e=e||t.bounds&&t.bounds.clear()||new Uo,c)for(r=0,i=l.length;r<i;++r)e.union(Of(l[r],s,n));return t.bounds=e}var Uf=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function qf(t,e){return JSON.stringify(t,Uf,e)}function Lf(t){return function t(e){var n,r,i,a=e.marktype,u=e.items;if(u)for(r=0,i=u.length;r<i;++r)n=a?"mark":"group",u[r][n]=e,u[r].zindex&&(u[r][n].zdirty=!0),"group"===(a||n)&&t(u[r]);a&&Rf(e);return e}("string"==typeof t?JSON.parse(t):t)}function Pf(t){arguments.length?this.root=Lf(t):(this.root=jf({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Yo(this.root)])}var If=Pf.prototype;function jf(t,e){var n={bounds:new Uo,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function $f(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function Hf(t,e){e=e.toLowerCase();for(var n=t.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===e)return n[r]}function Yf(t,e,n,r){var i,a=t.childNodes[e];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=$f(t.ownerDocument,n,r),t.insertBefore(a,i)),a}function Vf(t,e){for(var n=t.childNodes,r=n.length;r>e;)t.removeChild(n[--r]);return t}function Gf(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function Wf(t,e){var n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function Xf(t,e){this._active=null,this._handlers={},this._loader=t||kr(),this._tooltip=e||Jf}function Jf(t,e,n,r){t.element().setAttribute("title",r||"")}If.toJSON=function(t){return qf(this.root,t||0)},If.mark=function(t,e,n){var r=jf(t,e=e||this.root.items[0]);return e.items[n]=r,r.zindex&&(r.group.zdirty=!0),r};var Zf=Xf.prototype;function Qf(t){this._el=null,this._bgcolor=null,this._loader=new Wo(t)}Zf.initialize=function(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},Zf.element=function(){return this._el},Zf.canvas=function(){return this._el&&this._el.firstChild},Zf.origin=function(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},Zf.scene=function(t){return arguments.length?(this._scene=t,this):this._scene},Zf.on=function(){},Zf.off=function(){},Zf._handlerIndex=function(t,e,n){for(var r=t?t.length:0;--r>=0;)if(t[r].type===e&&(!n||t[r].handler===n))return r;return-1},Zf.handlers=function(t){var e,n=this._handlers,r=[];if(t)r.push.apply(r,n[this.eventName(t)]);else for(e in n)r.push.apply(r,n[e]);return r},Zf.eventName=function(t){var e=t.indexOf(".");return e<0?t:t.slice(0,e)},Zf.handleHref=function(t,e,n){this._loader.sanitize(n,{context:"href"}).then((function(e){var n=new MouseEvent(t.type,t),r=$f(null,"a");for(var i in e)r.setAttribute(i,e[i]);r.dispatchEvent(n)})).catch((function(){}))},Zf.handleTooltip=function(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,r){var i,a,u=t&&t.mark;if(u&&(i=Nf[u.marktype]).tip){for((a=Wf(e,n))[0]-=r[0],a[1]-=r[1];t=t.mark.group;)a[0]-=t.x||0,a[1]-=t.y||0;t=i.tip(u.items,a)}return t}(e,t,this.canvas(),this._origin);var r=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,r)}},Zf.getItemBoundingClientRect=function(t){if(e=this.canvas()){for(var e,n=e.getBoundingClientRect(),r=this._origin,i=t.bounds,a=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top,o=i.width(),s=i.height();t.mark&&(t=t.mark.group);)a+=t.x||0,u+=t.y||0;return{x:a,y:u,width:o,height:s,left:a,top:u,right:a+o,bottom:u+s}}};var Kf=Qf.prototype;Kf.initialize=function(t,e,n,r,i){return this._el=t,this.resize(e,n,r,i)},Kf.element=function(){return this._el},Kf.canvas=function(){return this._el&&this._el.firstChild},Kf.background=function(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},Kf.resize=function(t,e,n,r){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=r||1,this},Kf.dirty=function(){},Kf.render=function(t){var e=this;return e._call=function(){e._render(t)},e._call(),e._call=null,e},Kf._render=function(){},Kf.renderAsync=function(t){var e=this.render(t);return this._ready?this._ready.then((function(){return e})):Promise.resolve(e)},Kf._load=function(t,e){var n=this,r=n._loader[t](e);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then((function(t){t&&i(),n._ready=null}))}return r},Kf.sanitizeURL=function(t){return this._load("sanitizeURL",t)},Kf.loadImage=function(t){return this._load("loadImage",t)};function th(t,e){Xf.call(this,t,e),this._down=null,this._touch=null,this._first=!0}var eh=rt(th,Xf);function nh(t,e,n){return function(r){var i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(e,r)),this.fire(t,r)}}function rh(t){return function(e){this.fire(t,e),this._active=null}}eh.initialize=function(t,e,n){var r=this._canvas=t&&Hf(t,"canvas");if(r){var i=this;this.events.forEach((function(t){r.addEventListener(t,(function(e){eh[t]?eh[t].call(i,e):i.fire(t,e)}))}))}return Xf.prototype.initialize.call(this,t,e,n)},eh.canvas=function(){return this._canvas},eh.context=function(){return this._canvas.getContext("2d")},eh.events=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],eh.DOMMouseScroll=function(t){this.fire("mousewheel",t)},eh.mousemove=nh("mousemove","mouseover","mouseout"),eh.dragover=nh("dragover","dragenter","dragleave"),eh.mouseout=rh("mouseout"),eh.dragleave=rh("dragleave"),eh.mousedown=function(t){this._down=this._active,this.fire("mousedown",t)},eh.click=function(t){this._down===this._active&&(this.fire("click",t),this._down=null)},eh.touchstart=function(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",t,!0)},eh.touchmove=function(t){this.fire("touchmove",t,!0)},eh.touchend=function(t){this.fire("touchend",t,!0),this._touch=null},eh.fire=function(t,e,n){var r,i,a=n?this._touch:this._active,u=this._handlers[t];if(e.vegaType=t,"click"===t&&a&&a.href?this.handleHref(e,a,a.href):"mousemove"!==t&&"mouseout"!==t||this.handleTooltip(e,a,"mouseout"!==t),u)for(r=0,i=u.length;r<i;++r)u[r].handler.call(this._obj,e,a)},eh.on=function(t,e){var n=this.eventName(t),r=this._handlers;return this._handlerIndex(r[n],t,e)<0&&(r[n]||(r[n]=[])).push({type:t,handler:e}),this},eh.off=function(t,e){var n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&r.splice(i,1),this},eh.pickEvent=function(t){var e=Wf(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},eh.pick=function(t,e,n,r,i){var a=this.context();return Nf[t.marktype].pick.call(this,a,t,e,n,r,i)};var ih="undefined"!=typeof window&&window.devicePixelRatio||1;function ah(t){Qf.call(this,t),this._redraw=!1,this._dirty=new Uo}var uh=rt(ah,Qf),oh=Qf.prototype,sh=new Uo;function lh(t,e,n){return sh.set(0,0,e,n).translate(-t[0],-t[1])}function ch(t,e){Xf.call(this,t,e);var n=this;n._hrefHandler=hh(n,(function(t,e){e&&e.href&&n.handleHref(t,e,e.href)})),n._tooltipHandler=hh(n,(function(t,e){n.handleTooltip(t,e,"mouseout"!==t.type)}))}uh.initialize=function(t,e,n,r,i,a){return this._options=a,this._canvas=Vo(1,1,a&&a.type),t&&(Vf(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),oh.initialize.call(this,t,e,n,r,i)},uh.resize=function(t,e,n,r){return oh.resize.call(this,t,e,n,r),function(t,e,n,r,i,a){var u="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,o=t.getContext("2d"),s=u?ih:i;for(var l in t.width=e*s,t.height=n*s,a)o[l]=a[l];u&&1!==s&&(t.style.width=e+"px",t.style.height=n+"px"),o.pixelRatio=s,o.setTransform(s,0,0,s,s*r[0],s*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options&&this._options.context),this._redraw=!0,this},uh.canvas=function(){return this._canvas},uh.context=function(){return this._canvas?this._canvas.getContext("2d"):null},uh.dirty=function(t){var e=function(t,e){if(null==e)return t;for(var n=sh.clear().union(t);null!=e;e=e.mark.group)n.translate(e.x||0,e.y||0);return n}(t.bounds,t.mark.group);this._dirty.union(e)},uh._render=function(t){var e=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty;return e.save(),this._redraw||a.empty()?(this._redraw=!1,a=lh(n,r,i).expand(1)):a=function(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(e,a.intersect(lh(n,r,i)),n),this.clear(-n[0],-n[1],r,i),this.draw(e,t,a),e.restore(),this._dirty.clear(),this},uh.draw=function(t,e,n){var r=Nf[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),Y(n)?(t.beginPath(),n(t),t.clip()):$c(t,e.group)}(t,e),r.draw.call(this,t,e,n),e.clip&&t.restore()},uh.clear=function(t,e,n,r){var i=this.context();i.clearRect(t,e,n,r),null!=this._bgcolor&&(i.fillStyle=this._bgcolor,i.fillRect(t,e,n,r))};var fh=rt(ch,Xf);function hh(t,e){return function(n){var r=n.target.__data__;n.vegaType=n.type,r=Array.isArray(r)?r[0]:r,e.call(t._obj,n,r)}}function dh(t,e,n){var r=t-e+2*n;return t?r>0?r:1:0}fh.initialize=function(t,e,n){var r=this._svg;return r&&(r.removeEventListener("click",this._hrefHandler),r.removeEventListener("mousemove",this._tooltipHandler),r.removeEventListener("mouseout",this._tooltipHandler)),this._svg=r=t&&Hf(t,"svg"),r&&(r.addEventListener("click",this._hrefHandler),r.addEventListener("mousemove",this._tooltipHandler),r.addEventListener("mouseout",this._tooltipHandler)),Xf.prototype.initialize.call(this,t,e,n)},fh.canvas=function(){return this._svg},fh.on=function(t,e){var n=this.eventName(t),r=this._handlers;if(this._handlerIndex(r[n],t,e)<0){var i={type:t,handler:e,listener:hh(this,e)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},fh.off=function(t,e){var n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this};var ph="log",mh="pow",vh="time",gh="utc",yh="continuous";function _h(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function bh(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}var xh=Symbol("implicit");function wh(){var t=new Map,e=[],n=[],r=xh;function i(i){var a=i+"",u=t.get(a);if(!u){if(r!==xh)return r;t.set(a,u=e.push(i))}return n[(u-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();for(var r of(e=[],t=new Map,n)){var a=r+"";t.has(a)||t.set(a,e.push(r))}return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return wh(e,n).unknown(r)},_h.apply(i,arguments),i}function Ah(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Mh(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function kh(){}var Ch="\\s*([+-]?\\d+)\\s*",Dh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Eh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fh=/^#([0-9a-f]{3,8})$/,Bh=new RegExp("^rgb\\("+[Ch,Ch,Ch]+"\\)$"),Th=new RegExp("^rgb\\("+[Eh,Eh,Eh]+"\\)$"),Sh=new RegExp("^rgba\\("+[Ch,Ch,Ch,Dh]+"\\)$"),Nh=new RegExp("^rgba\\("+[Eh,Eh,Eh,Dh]+"\\)$"),Oh=new RegExp("^hsl\\("+[Dh,Eh,Eh]+"\\)$"),zh=new RegExp("^hsla\\("+[Dh,Eh,Eh,Dh]+"\\)$"),Rh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Uh(){return this.rgb().formatHex()}function qh(){return this.rgb().formatRgb()}function Lh(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Fh.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Ph(e):3===n?new Hh(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Ih(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Ih(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Bh.exec(t))?new Hh(e[1],e[2],e[3],1):(e=Th.exec(t))?new Hh(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Sh.exec(t))?Ih(e[1],e[2],e[3],e[4]):(e=Nh.exec(t))?Ih(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Oh.exec(t))?Wh(e[1],e[2]/100,e[3]/100,1):(e=zh.exec(t))?Wh(e[1],e[2]/100,e[3]/100,e[4]):Rh.hasOwnProperty(t)?Ph(Rh[t]):"transparent"===t?new Hh(NaN,NaN,NaN,0):null}function Ph(t){return new Hh(t>>16&255,t>>8&255,255&t,1)}function Ih(t,e,n,r){return r<=0&&(t=e=n=NaN),new Hh(t,e,n,r)}function jh(t){return t instanceof kh||(t=Lh(t)),t?new Hh((t=t.rgb()).r,t.g,t.b,t.opacity):new Hh}function $h(t,e,n,r){return 1===arguments.length?jh(t):new Hh(t,e,n,null==r?1:r)}function Hh(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Yh(){return"#"+Gh(this.r)+Gh(this.g)+Gh(this.b)}function Vh(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Gh(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Wh(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Zh(t,e,n,r)}function Xh(t){if(t instanceof Zh)return new Zh(t.h,t.s,t.l,t.opacity);if(t instanceof kh||(t=Lh(t)),!t)return new Zh;if(t instanceof Zh)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),u=NaN,o=a-i,s=(a+i)/2;return o?(u=e===a?(n-r)/o+6*(n<r):n===a?(r-e)/o+2:(e-n)/o+4,o/=s<.5?a+i:2-a-i,u*=60):o=s>0&&s<1?0:u,new Zh(u,o,s,t.opacity)}function Jh(t,e,n,r){return 1===arguments.length?Xh(t):new Zh(t,e,n,null==r?1:r)}function Zh(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Qh(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Ah(kh,Lh,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Uh,formatHex:Uh,formatHsl:function(){return Xh(this).formatHsl()},formatRgb:qh,toString:qh}),Ah(Hh,$h,Mh(kh,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Hh(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Hh(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yh,formatHex:Yh,formatRgb:Vh,toString:Vh})),Ah(Zh,Jh,Mh(kh,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Zh(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Zh(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Hh(Qh(t>=240?t-240:t+120,i,r),Qh(t,i,r),Qh(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var Kh=Math.PI/180,td=180/Math.PI,ed=6/29*3*(6/29);function nd(t){if(t instanceof id)return new id(t.l,t.a,t.b,t.opacity);if(t instanceof fd)return hd(t);t instanceof Hh||(t=jh(t));var e,n,r=sd(t.r),i=sd(t.g),a=sd(t.b),u=ad((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?e=n=u:(e=ad((.4360747*r+.3850649*i+.1430804*a)/.96422),n=ad((.0139322*r+.0971045*i+.7141733*a)/.82521)),new id(116*u-16,500*(e-u),200*(u-n),t.opacity)}function rd(t,e,n,r){return 1===arguments.length?nd(t):new id(t,e,n,null==r?1:r)}function id(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function ad(t){return t>6/29*(6/29)*(6/29)?Math.pow(t,1/3):t/ed+4/29}function ud(t){return t>6/29?t*t*t:ed*(t-4/29)}function od(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function sd(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ld(t){if(t instanceof fd)return new fd(t.h,t.c,t.l,t.opacity);if(t instanceof id||(t=nd(t)),0===t.a&&0===t.b)return new fd(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*td;return new fd(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function cd(t,e,n,r){return 1===arguments.length?ld(t):new fd(t,e,n,null==r?1:r)}function fd(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function hd(t){if(isNaN(t.h))return new id(t.l,0,0,t.opacity);var e=t.h*Kh;return new id(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Ah(id,rd,Mh(kh,{brighter:function(t){return new id(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new id(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new Hh(od(3.1338561*(e=.96422*ud(e))-1.6168667*(t=1*ud(t))-.4906146*(n=.82521*ud(n))),od(-.9787684*e+1.9161415*t+.033454*n),od(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),Ah(fd,cd,Mh(kh,{brighter:function(t){return new fd(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new fd(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return hd(this).rgb()}}));var dd=-.14861,pd=1.78277,md=-.29227,vd=-.90649,gd=1.97294,yd=gd*vd,_d=gd*pd,bd=pd*md-vd*dd;function xd(t){if(t instanceof Ad)return new Ad(t.h,t.s,t.l,t.opacity);t instanceof Hh||(t=jh(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(bd*r+yd*e-_d*n)/(bd+yd-_d),a=r-i,u=(gd*(n-i)-md*a)/vd,o=Math.sqrt(u*u+a*a)/(gd*i*(1-i)),s=o?Math.atan2(u,a)*td-120:NaN;return new Ad(s<0?s+360:s,o,i,t.opacity)}function wd(t,e,n,r){return 1===arguments.length?xd(t):new Ad(t,e,n,null==r?1:r)}function Ad(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Md(t,e,n,r,i){var a=t*t,u=a*t;return((1-3*t+3*a-u)*e+(4-6*a+3*u)*n+(1+3*t+3*a-3*u)*r+u*i)/6}function kd(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],u=r>0?t[r-1]:2*i-a,o=r<e-1?t[r+2]:2*a-i;return Md((n-r/e)*e,u,i,a,o)}}function Cd(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],a=t[r%e],u=t[(r+1)%e],o=t[(r+2)%e];return Md((n-r/e)*e,i,a,u,o)}}function Dd(t){return function(){return t}}function Ed(t,e){return function(n){return t+n*e}}function Fd(t,e){var n=e-t;return n?Ed(t,n>180||n<-180?n-360*Math.round(n/360):n):Dd(isNaN(t)?e:t)}function Bd(t){return 1==(t=+t)?Td:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Dd(isNaN(e)?n:e)}}function Td(t,e){var n=e-t;return n?Ed(t,n):Dd(isNaN(t)?e:t)}Ah(Ad,wd,Mh(kh,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ad(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ad(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Kh,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new Hh(255*(e+n*(dd*r+pd*i)),255*(e+n*(md*r+vd*i)),255*(e+n*(gd*r)),this.opacity)}}));var Sd=function t(e){var n=Bd(e);function r(t,e){var r=n((t=$h(t)).r,(e=$h(e)).r),i=n(t.g,e.g),a=n(t.b,e.b),u=Td(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=a(e),t.opacity=u(e),t+""}}return r.gamma=t,r}(1);function Nd(t){return function(e){var n,r,i=e.length,a=new Array(i),u=new Array(i),o=new Array(i);for(n=0;n<i;++n)r=$h(e[n]),a[n]=r.r||0,u[n]=r.g||0,o[n]=r.b||0;return a=t(a),u=t(u),o=t(o),r.opacity=1,function(t){return r.r=a(t),r.g=u(t),r.b=o(t),r+""}}}var Od=Nd(kd),zd=Nd(Cd);function Rd(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(a){for(n=0;n<r;++n)i[n]=t[n]*(1-a)+e[n]*a;return i}}function Ud(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function qd(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,a=new Array(i),u=new Array(r);for(n=0;n<i;++n)a[n]=Yd(t[n],e[n]);for(;n<r;++n)u[n]=e[n];return function(t){for(n=0;n<i;++n)u[n]=a[n](t);return u}}function Ld(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Pd(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Id(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Yd(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var jd=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$d=new RegExp(jd.source,"g");function Hd(t,e){var n,r,i,a=jd.lastIndex=$d.lastIndex=0,u=-1,o=[],s=[];for(t+="",e+="";(n=jd.exec(t))&&(r=$d.exec(e));)(i=r.index)>a&&(i=e.slice(a,i),o[u]?o[u]+=i:o[++u]=i),(n=n[0])===(r=r[0])?o[u]?o[u]+=r:o[++u]=r:(o[++u]=null,s.push({i:u,x:Pd(n,r)})),a=$d.lastIndex;return a<e.length&&(i=e.slice(a),o[u]?o[u]+=i:o[++u]=i),o.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)o[(n=s[r]).i]=n.x(t);return o.join("")})}function Yd(t,e){var n,r=typeof e;return null==e||"boolean"===r?Dd(e):("number"===r?Pd:"string"===r?(n=Lh(e))?(e=n,Sd):Hd:e instanceof Lh?Sd:e instanceof Date?Ld:Ud(e)?Rd:Array.isArray(e)?qd:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Id:Pd)(t,e)}function Vd(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Gd,Wd,Xd,Jd,Zd=180/Math.PI,Qd={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Kd(t,e,n,r,i,a){var u,o,s;return(u=Math.sqrt(t*t+e*e))&&(t/=u,e/=u),(s=t*n+e*r)&&(n-=t*s,r-=e*s),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,s/=o),t*r<e*n&&(t=-t,e=-e,s=-s,u=-u),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Zd,skewX:Math.atan(s)*Zd,scaleX:u,scaleY:o}}function tp(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(a,u){var o=[],s=[];return a=t(a),u=t(u),function(t,r,i,a,u,o){if(t!==i||r!==a){var s=u.push("translate(",null,e,null,n);o.push({i:s-4,x:Pd(t,i)},{i:s-2,x:Pd(r,a)})}else(i||a)&&u.push("translate("+i+e+a+n)}(a.translateX,a.translateY,u.translateX,u.translateY,o,s),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Pd(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(a.rotate,u.rotate,o,s),function(t,e,n,a){t!==e?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Pd(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(a.skewX,u.skewX,o,s),function(t,e,n,r,a,u){if(t!==n||e!==r){var o=a.push(i(a)+"scale(",null,",",null,")");u.push({i:o-4,x:Pd(t,n)},{i:o-2,x:Pd(e,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,u.scaleX,u.scaleY,o,s),a=u=null,function(t){for(var e,n=-1,r=s.length;++n<r;)o[(e=s[n]).i]=e.x(t);return o.join("")}}}var ep=tp((function(t){return"none"===t?Qd:(Gd||(Gd=document.createElement("DIV"),Wd=document.documentElement,Xd=document.defaultView),Gd.style.transform=t,t=Xd.getComputedStyle(Wd.appendChild(Gd),null).getPropertyValue("transform"),Wd.removeChild(Gd),Kd(+(t=t.slice(7,-1).split(","))[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}),"px, ","px)","deg)"),np=tp((function(t){return null==t?Qd:(Jd||(Jd=document.createElementNS("http://www.w3.org/2000/svg","g")),Jd.setAttribute("transform",t),(t=Jd.transform.baseVal.consolidate())?Kd((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Qd)}),", ",")",")"),rp=Math.SQRT2;function ip(t){return((t=Math.exp(t))+1/t)/2}function ap(t){return function(e,n){var r=t((e=Jh(e)).h,(n=Jh(n)).h),i=Td(e.s,n.s),a=Td(e.l,n.l),u=Td(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=a(t),e.opacity=u(t),e+""}}}var up=ap(Fd),op=ap(Td);function sp(t){return function(e,n){var r=t((e=cd(e)).h,(n=cd(n)).h),i=Td(e.c,n.c),a=Td(e.l,n.l),u=Td(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=a(t),e.opacity=u(t),e+""}}}var lp=sp(Fd),cp=sp(Td);function fp(t){return function e(n){function r(e,r){var i=t((e=wd(e)).h,(r=wd(r)).h),a=Td(e.s,r.s),u=Td(e.l,r.l),o=Td(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=a(t),e.l=u(Math.pow(t,n)),e.opacity=o(t),e+""}}return n=+n,r.gamma=e,r}(1)}var hp=fp(Fd),dp=fp(Td);function pp(t,e){for(var n=0,r=e.length-1,i=e[0],a=new Array(r<0?0:r);n<r;)a[n]=t(i,i=e[++n]);return function(t){var e=Math.max(0,Math.min(r-1,Math.floor(t*=r)));return a[e](t-e)}}var mp=Object.freeze({__proto__:null,interpolate:Yd,interpolateArray:function(t,e){return(Ud(e)?Rd:qd)(t,e)},interpolateBasis:kd,interpolateBasisClosed:Cd,interpolateDate:Ld,interpolateDiscrete:function(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}},interpolateHue:function(t,e){var n=Fd(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}},interpolateNumber:Pd,interpolateNumberArray:Rd,interpolateObject:Id,interpolateRound:Vd,interpolateString:Hd,interpolateTransformCss:ep,interpolateTransformSvg:np,interpolateZoom:function(t,e){var n,r,i=t[0],a=t[1],u=t[2],o=e[0],s=e[1],l=e[2],c=o-i,f=s-a,h=c*c+f*f;if(h<1e-12)r=Math.log(l/u)/rp,n=function(t){return[i+t*c,a+t*f,u*Math.exp(rp*t*r)]};else{var d=Math.sqrt(h),p=(l*l-u*u+4*h)/(2*u*2*d),m=(l*l-u*u-4*h)/(2*l*2*d),v=Math.log(Math.sqrt(p*p+1)-p),g=Math.log(Math.sqrt(m*m+1)-m);r=(g-v)/rp,n=function(t){var e=t*r,n=ip(v),o=u/(2*d)*(n*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(rp*e+v)-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[i+o*c,a+o*f,u*n/ip(rp*e+v)]}}return n.duration=1e3*r,n},interpolateRgb:Sd,interpolateRgbBasis:Od,interpolateRgbBasisClosed:zd,interpolateHsl:up,interpolateHslLong:op,interpolateLab:function(t,e){var n=Td((t=rd(t)).l,(e=rd(e)).l),r=Td(t.a,e.a),i=Td(t.b,e.b),a=Td(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=r(e),t.b=i(e),t.opacity=a(e),t+""}},interpolateHcl:lp,interpolateHclLong:cp,interpolateCubehelix:hp,interpolateCubehelixLong:dp,piecewise:pp,quantize:function(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}});function vp(t){return+t}var gp=[0,1];function yp(t){return t}function _p(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function bp(t,e,n){var r=t[0],i=t[1],a=e[0],u=e[1];return i<r?(r=_p(i,r),a=n(u,a)):(r=_p(r,i),a=n(a,u)),function(t){return a(r(t))}}function xp(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),u=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++u<r;)i[u]=_p(t[u],t[u+1]),a[u]=n(e[u],e[u+1]);return function(e){var n=si(t,e,1,r)-1;return a[n](i[n](e))}}function wp(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ap(){var t,e,n,r,i,a,u=gp,o=gp,s=Yd,l=yp;function c(){var t=Math.min(u.length,o.length);return l!==yp&&(l=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(u[0],u[t-1])),r=t>2?xp:bp,i=a=null,f}function f(e){return isNaN(e=+e)?n:(i||(i=r(u.map(t),o,s)))(t(l(e)))}return f.invert=function(n){return l(e((a||(a=r(o,u.map(t),Pd)))(n)))},f.domain=function(t){return arguments.length?(u=Array.from(t,vp),c()):u.slice()},f.range=function(t){return arguments.length?(o=Array.from(t),c()):o.slice()},f.rangeRound=function(t){return o=Array.from(t),s=Vd,c()},f.clamp=function(t){return arguments.length?(l=!!t||yp,c()):l!==yp},f.interpolate=function(t){return arguments.length?(s=t,c()):s},f.unknown=function(t){return arguments.length?(n=t,f):n},function(n,r){return t=n,e=r,c()}}function Mp(){return Ap()(yp,yp)}function kp(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Cp(t){return(t=kp(Math.abs(t)))?t[1]:NaN}var Dp,Ep=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Fp(t){if(!(e=Ep.exec(t)))throw new Error("invalid format: "+t);var e;return new Bp({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Bp(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Tp(t,e){var n=kp(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Fp.prototype=Bp.prototype,Bp.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Sp={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Tp(100*t,e)},r:Tp,s:function(t,e){var n=kp(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(Dp=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,u=r.length;return a===u?r:a>u?r+new Array(a-u+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+kp(t,Math.max(0,e+a-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function Np(t){return t}var Op,zp,Rp,Up=Array.prototype.map,qp=["y","z","a","f","p","n","
","m","","k","M","G","T","P","E","Z","Y"];function Lp(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Np:(e=Up.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,a=[],u=0,o=e[0],s=0;i>0&&o>0&&(s+o+1>r&&(o=Math.max(1,r-s)),a.push(t.substring(i-=o,i+o)),!((s+=o+1)>r));)o=e[u=(u+1)%e.length];return a.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",a=void 0===t.currency?"":t.currency[1]+"",u=void 0===t.decimal?".":t.decimal+"",o=void 0===t.numerals?Np:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Up.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=Fp(t)).fill,n=t.align,f=t.sign,h=t.symbol,d=t.zero,p=t.width,m=t.comma,v=t.precision,g=t.trim,y=t.type;"n"===y?(m=!0,y="g"):Sp[y]||(void 0===v&&(v=12),g=!0,y="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var _="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===h?a:/[%p]/.test(y)?s:"",x=Sp[y],w=/[defgprs%]/.test(y);function A(t){var i,a,s,h=_,A=b;if("c"===y)A=x(t)+A,t="";else{var M=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:x(Math.abs(t),v),g&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),M&&0==+t&&"+"!==f&&(M=!1),h=(M?"("===f?f:l:"-"===f||"("===f?"":f)+h,A=("s"===y?qp[8+Dp/3]:"")+A+(M&&"("===f?")":""),w)for(i=-1,a=t.length;++i<a;)if(48>(s=t.charCodeAt(i))||s>57){A=(46===s?u+t.slice(i+1):t.slice(i))+A,t=t.slice(0,i);break}}m&&!d&&(t=r(t,1/0));var k=h.length+t.length+A.length,C=k<p?new Array(p-k+1).join(e):"";switch(m&&d&&(t=r(C+t,C.length?p-A.length:1/0),C=""),n){case"<":t=h+t+A+C;break;case"=":t=h+C+t+A;break;case"^":t=C.slice(0,k=C.length>>1)+h+t+A+C.slice(k);break;default:t=C+h+t+A}return o(t)}return v=void 0===v?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),A.toString=function(){return t+""},A}return{format:f,formatPrefix:function(t,e){var n=f(((t=Fp(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Cp(e)/3))),i=Math.pow(10,-r),a=qp[8+r/3];return function(t){return n(i*t)+a}}}}function Pp(t){return Op=Lp(t),zp=Op.format,Rp=Op.formatPrefix,Op}function Ip(t,e,n,r){var i,a=mi(t,e,n);switch((r=Fp(null==r?",f":r)).type){case"s":var u=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Cp(e)/3)))-Cp(Math.abs(t)))}(a,u))||(r.precision=i),Rp(r,u);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Cp(e)-Cp(t))+1}(a,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Cp(Math.abs(t)))}(a))||(r.precision=i-2*("%"===r.type))}return zp(r)}function jp(t){var e=t.domain;return t.ticks=function(t){var n=e();return di(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Ip(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),a=0,u=i.length-1,o=i[a],s=i[u];return s<o&&(r=o,o=s,s=r,r=a,a=u,u=r),(r=pi(o,s,n))>0?r=pi(o=Math.floor(o/r)*r,s=Math.ceil(s/r)*r,n):r<0&&(r=pi(o=Math.ceil(o*r)/r,s=Math.floor(s*r)/r,n)),r>0?(i[a]=Math.floor(o/r)*r,i[u]=Math.ceil(s/r)*r,e(i)):r<0&&(i[a]=Math.ceil(o*r)/r,i[u]=Math.floor(s*r)/r,e(i)),t},t}function $p(t,e){var n,r=0,i=(t=t.slice()).length-1,a=t[r],u=t[i];return u<a&&(n=r,r=i,i=n,n=a,a=u,u=n),t[r]=e.floor(a),t[i]=e.ceil(u),t}function Hp(t){return Math.log(t)}function Yp(t){return Math.exp(t)}function Vp(t){return-Math.log(-t)}function Gp(t){return-Math.exp(-t)}function Wp(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Xp(t){return function(e){return-t(-e)}}function Jp(t){var e,n,r=t(Hp,Yp),i=r.domain,a=10;function u(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(a),n=function(t){return 10===t?Wp:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(a),i()[0]<0?(e=Xp(e),n=Xp(n),t(Vp,Gp)):t(Hp,Yp),r}return r.base=function(t){return arguments.length?(a=+t,u()):a},r.domain=function(t){return arguments.length?(i(t),u()):i()},r.ticks=function(t){var r,u=i(),o=u[0],s=u[u.length-1];(r=s<o)&&(h=o,o=s,s=h);var l,c,f,h=e(o),d=e(s),p=null==t?10:+t,m=[];if(!(a%1)&&d-h<p){if(h=Math.floor(h),d=Math.ceil(d),o>0){for(;h<=d;++h)for(c=1,l=n(h);c<a;++c)if(!((f=l*c)<o)){if(f>s)break;m.push(f)}}else for(;h<=d;++h)for(c=a-1,l=n(h);c>=1;--c)if(!((f=l*c)<o)){if(f>s)break;m.push(f)}2*m.length<p&&(m=di(o,s,p))}else m=di(h,d,Math.min(d-h,p)).map(n);return r?m.reverse():m},r.tickFormat=function(t,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=zp(i)),t===1/0)return i;null==t&&(t=10);var u=Math.max(1,a*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*a<a-.5&&(r*=a),r<=u?i(t):""}},r.nice=function(){return i($p(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function Zp(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function Qp(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function Kp(t){var e=1,n=t(Zp(e),Qp(e));return n.constant=function(n){return arguments.length?t(Zp(e=+n),Qp(e)):e},jp(n)}function tm(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function em(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function nm(t){return t<0?-t*t:t*t}function rm(t){var e=t(yp,yp),n=1;function r(){return 1===n?t(yp,yp):.5===n?t(em,nm):t(tm(n),tm(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},jp(e)}function im(){var t=rm(Ap());return t.copy=function(){return wp(t,im()).exponent(t.exponent())},_h.apply(t,arguments),t}Pp({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function am(t){return new Date(t)}function um(t){return t instanceof Date?+t:+new Date(+t)}function om(t,e,n,r,i,a,u,o,s){var l=Mp(),c=l.invert,f=l.domain,h=s(".%L"),d=s(":%S"),p=s("%I:%M"),m=s("%I %p"),v=s("%a %d"),g=s("%b %d"),y=s("%B"),_=s("%Y"),b=[[u,1,1e3],[u,5,5e3],[u,15,15e3],[u,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function x(o){return(u(o)<o?h:a(o)<o?d:i(o)<o?p:r(o)<o?m:e(o)<o?n(o)<o?v:g:t(o)<o?y:_)(o)}function w(e,n,r){if(null==e&&(e=10),"number"==typeof e){var i,a=Math.abs(r-n)/e,u=oi((function(t){return t[2]})).right(b,a);return u===b.length?(i=mi(n/31536e6,r/31536e6,e),e=t):u?(i=(u=b[a/b[u-1][2]<b[u][2]/a?u-1:u])[1],e=u[0]):(i=Math.max(mi(n,r,e),1),e=o),e.every(i)}return e}return l.invert=function(t){return new Date(c(t))},l.domain=function(t){return arguments.length?f(Array.from(t,um)):f().map(am)},l.ticks=function(t){var e,n=f(),r=n[0],i=n[n.length-1],a=i<r;return a&&(e=r,r=i,i=e),e=(e=w(t,r,i))?e.range(r,i+1):[],a?e.reverse():e},l.tickFormat=function(t,e){return null==e?x:s(e)},l.nice=function(t){var e=f();return(t=w(t,e[0],e[e.length-1]))?f($p(e,t)):l},l.copy=function(){return wp(l,om(t,e,n,r,i,a,u,o,s))},l}function sm(){var t,e,n,r,i,a=0,u=1,o=yp,s=!1;function l(e){return isNaN(e=+e)?i:o(0===n?.5:(e=(r(e)-t)*n,s?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,r;return arguments.length?([n,r]=e,o=t(n,r),l):[o(0),o(1)]}}return l.domain=function(i){return arguments.length?([a,u]=i,t=r(a=+a),e=r(u=+u),n=t===e?0:1/(e-t),l):[a,u]},l.clamp=function(t){return arguments.length?(s=!!t,l):s},l.interpolator=function(t){return arguments.length?(o=t,l):o},l.range=c(Yd),l.rangeRound=c(Vd),l.unknown=function(t){return arguments.length?(i=t,l):i},function(i){return r=i,t=i(a),e=i(u),n=t===e?0:1/(e-t),l}}function lm(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function cm(){var t=jp(sm()(yp));return t.copy=function(){return lm(t,cm())},bh.apply(t,arguments)}function fm(){var t=rm(sm());return t.copy=function(){return lm(t,fm()).exponent(t.exponent())},bh.apply(t,arguments)}function hm(){var t,e,n,r,i,a,u,o=0,s=.5,l=1,c=1,f=yp,h=!1;function d(t){return isNaN(t=+t)?u:(t=.5+((t=+a(t))-e)*(c*t<c*e?r:i),f(h?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,r,i;return arguments.length?([n,r,i]=e,f=pp(t,[n,r,i]),d):[f(0),f(.5),f(1)]}}return d.domain=function(u){return arguments.length?([o,s,l]=u,t=a(o=+o),e=a(s=+s),n=a(l=+l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d):[o,s,l]},d.clamp=function(t){return arguments.length?(h=!!t,d):h},d.interpolator=function(t){return arguments.length?(f=t,d):f},d.range=p(Yd),d.rangeRound=p(Vd),d.unknown=function(t){return arguments.length?(u=t,d):u},function(u){return a=u,t=u(o),e=u(s),n=u(l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d}}function dm(){var t=rm(hm());return t.copy=function(){return lm(t,dm()).exponent(t.exponent())},bh.apply(t,arguments)}function pm(){var t,e,n=wh().unknown(void 0),r=n.domain,i=n.range,a=[0,1],u=!1,o=0,s=0,l=.5;function c(){var n=r().length,c=a[1]<a[0],f=a[c-0],h=a[1-c],d=dh(n,o,s);t=(h-f)/(d||1),u&&(t=Math.floor(t)),f+=(h-f-t*(n-o))*l,e=t*(1-o),u&&(f=Math.round(f),e=Math.round(e));var p=li(n).map((function(e){return f+t*e}));return i(c?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(r(t),c()):r()},n.range=function(t){return arguments.length?(a=[+t[0],+t[1]],c()):a.slice()},n.rangeRound=function(t){return a=[+t[0],+t[1]],u=!0,c()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(u=!!t,c()):u},n.padding=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),o=s,c()):o},n.paddingInner=function(t){return arguments.length?(o=Math.max(0,Math.min(1,t)),c()):o},n.paddingOuter=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),c()):s},n.align=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},n.invertRange=function(t){if(null!=t[0]&&null!=t[1]){var n,u,o,s=+t[0],l=+t[1],c=a[1]<a[0],f=c?i().reverse():i(),h=f.length-1;if(s==s&&l==l&&(l<s&&(o=s,s=l,l=o),!(l<f[0]||s>a[1-c])))return n=Math.max(0,si(f,s)-1),u=s===l?n:si(f,l)-1,s-f[n]>e+1e-10&&++n,c&&(o=n,n=h-u,u=h-o),n>u?void 0:r().slice(n,u+1)}},n.invert=function(t){var e=n.invertRange([t,t]);return e?e[0]:e},n.copy=function(){return pm().domain(r()).range(a).round(u).paddingInner(o).paddingOuter(s).align(l)},c()}var mm=Array.prototype.map;function vm(t){return mm.call(t,(function(t){return+t}))}var gm=Array.prototype.slice;var ym={};function _m(t,e,n){var r=function(){var n=e();return n.invertRange||(n.invertRange=n.invert?function(t){return function(e){var n,r=e[0],i=e[1];return i<r&&(n=r,r=i,i=n),[t.invert(r),t.invert(i)]}}(n):n.invertExtent?function(t){return function(e){var n,r,i,a,u=t.range(),o=e[0],s=e[1],l=-1;for(s<o&&(r=o,o=s,s=r),i=0,a=u.length;i<a;++i)u[i]>=o&&u[i]<=s&&(l<0&&(l=i),n=i);if(!(l<0))return o=t.invertExtent(u[l]),s=t.invertExtent(u[n]),[void 0===o[0]?o[1]:o[0],void 0===s[1]?s[0]:s[1]]}}(n):void 0),n.type=t,n};return r.metadata=bt($(n)),r}function bm(t,e,n){return arguments.length>1?(ym[t]=_m(t,e,n),this):xm(t)?ym[t]:void 0}function xm(t){return K(ym,t)}function wm(t,e){var n=ym[t];return n&&n.metadata[e]}function Am(t){return wm(t,yh)}function Mm(t){return wm(t,"discrete")}function km(t){return wm(t,"discretizing")}function Cm(t){return wm(t,ph)}function Dm(t){return wm(t,"temporal")}function Em(t){return wm(t,"interpolating")}bm("identity",(function t(e){var n;function r(t){return isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,vp),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,vp):[0,1],jp(r)})),bm("linear",(function t(){var e=Mp();return e.copy=function(){return wp(e,t())},_h.apply(e,arguments),jp(e)}),yh),bm(ph,(function t(){var e=Jp(Ap()).domain([1,10]);return e.copy=function(){return wp(e,t()).base(e.base())},_h.apply(e,arguments),e}),[yh,ph]),bm(mh,im,yh),bm("sqrt",(function(){return im.apply(null,arguments).exponent(.5)}),yh),bm("symlog",(function t(){var e=Kp(Ap());return e.copy=function(){return wp(e,t()).constant(e.constant())},_h.apply(e,arguments)}),yh),bm(vh,(function(){return _h.apply(om(Ge,Ve,$e,Ie,Pe,Le,qe,Ue,sn).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[yh,"temporal"]),bm(gh,(function(){return _h.apply(om(nn,en,Qe,Je,Xe,We,qe,Ue,cn).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[yh,"temporal"]),bm("sequential",cm,[yh,"interpolating"]),bm("sequential-linear",cm,[yh,"interpolating"]),bm("sequential-log",(function t(){var e=Jp(sm()).domain([1,10]);return e.copy=function(){return lm(e,t()).base(e.base())},bh.apply(e,arguments)}),[yh,"interpolating",ph]),bm("sequential-pow",fm,[yh,"interpolating"]),bm("sequential-sqrt",(function(){return fm.apply(null,arguments).exponent(.5)}),[yh,"interpolating"]),bm("sequential-symlog",(function t(){var e=Kp(sm());return e.copy=function(){return lm(e,t()).constant(e.constant())},bh.apply(e,arguments)}),[yh,"interpolating"]),bm("diverging-linear",(function t(){var e=jp(hm()(yp));return e.copy=function(){return lm(e,t())},bh.apply(e,arguments)}),[yh,"interpolating"]),bm("diverging-log",(function t(){var e=Jp(hm()).domain([.1,1,10]);return e.copy=function(){return lm(e,t()).base(e.base())},bh.apply(e,arguments)}),[yh,"interpolating",ph]),bm("diverging-pow",dm,[yh,"interpolating"]),bm("diverging-sqrt",(function(){return dm.apply(null,arguments).exponent(.5)}),[yh,"interpolating"]),bm("diverging-symlog",(function t(){var e=Kp(hm());return e.copy=function(){return lm(e,t()).constant(e.constant())},bh.apply(e,arguments)}),[yh,"interpolating"]),bm("quantile",(function t(){var e,n=[],r=[],i=[];function a(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=bi(n,t/e);return u}function u(t){return isNaN(t=+t)?e:r[si(i,t)]}return u.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},u.domain=function(t){if(!arguments.length)return n.slice();for(var e of(n=[],t))null==e||isNaN(e=+e)||n.push(e);return n.sort(ui),a()},u.range=function(t){return arguments.length?(r=Array.from(t),a()):r.slice()},u.unknown=function(t){return arguments.length?(e=t,u):e},u.quantiles=function(){return i.slice()},u.copy=function(){return t().domain(n).range(r).unknown(e)},_h.apply(u,arguments)}),["discretizing","quantile"]),bm("quantize",(function t(){var e,n=0,r=1,i=1,a=[.5],u=[0,1];function o(t){return t<=t?u[si(a,t,0,i)]:e}function s(){var t=-1;for(a=new Array(i);++t<i;)a[t]=((t+1)*r-(t-i)*n)/(i+1);return o}return o.domain=function(t){return arguments.length?([n,r]=t,n=+n,r=+r,s()):[n,r]},o.range=function(t){return arguments.length?(i=(u=Array.from(t)).length-1,s()):u.slice()},o.invertExtent=function(t){var e=u.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,a[0]]:e>=i?[a[i-1],r]:[a[e-1],a[e]]},o.unknown=function(t){return arguments.length?(e=t,o):o},o.thresholds=function(){return a.slice()},o.copy=function(){return t().domain([n,r]).range(u).unknown(e)},_h.apply(jp(o),arguments)}),"discretizing"),bm("threshold",(function t(){var e,n=[.5],r=[0,1],i=1;function a(t){return t<=t?r[si(n,t,0,i)]:e}return a.domain=function(t){return arguments.length?(n=Array.from(t),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(t){return arguments.length?(r=Array.from(t),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},a.unknown=function(t){return arguments.length?(e=t,a):e},a.copy=function(){return t().domain(n).range(r).unknown(e)},_h.apply(a,arguments)}),"discretizing"),bm("bin-ordinal",(function t(){var e=[],n=[];function r(t){return null==t||t!=t?void 0:n[(si(e,t)-1)%n.length]}return r.domain=function(t){return arguments.length?(e=vm(t),r):e.slice()},r.range=function(t){return arguments.length?(n=gm.call(t),r):n.slice()},r.tickFormat=function(t,n){return Ip(e[0],M(e),null==t?10:t,n)},r.copy=function(){return t().domain(r.domain()).range(r.range())},r}),["discrete","discretizing"]),bm("ordinal",wh,"discrete"),bm("band",pm,"discrete"),bm("point",(function(){return function t(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return t(n())},e}(pm().paddingInner(1))}),"discrete");var Fm=["clamp","base","constant","exponent"];function Bm(t,e){var n=e[0],r=M(e)-n;return function(e){return t(n+e*r)}}function Tm(t,e,n){return pp(Om(e||"rgb",n),t)}function Sm(t,e){for(var n=new Array(e),r=e+1,i=0;i<e;)n[i]=t(++i/r);return n}function Nm(t,e,n){var r,i,a,u=n-e;return u&&Number.isFinite(u)?(r=(i=t.type).indexOf("-"),i=r<0?i:i.slice(r+1),a=bm(i)().domain([e,n]).range([0,1]),Fm.forEach(e=>t[e]?a[e](t[e]()):0),a):G(.5)}function Om(t,e){var n=mp[function(t){return"interpolate"+t.toLowerCase().split("-").map((function(t){return t[0].toUpperCase()+t.slice(1)})).join("")}(t)];return null!=e&&n&&n.gamma?n.gamma(e):n}function zm(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}function Rm(t,e){for(var n in t)qm(n,e(t[n]))}var Um={};function qm(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(Um[t]=e,this):Um[t]}Rm({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},zm),Rm({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},t=>Tm(zm(t)));var Lm=t=>u(t)?t.map(t=>String(t)):String(t);function Pm(t,e,n){var r;return ot(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(mt(t.domain())/n||1)))),o(e)&&(r=e.step,e=e.interval),s(e)&&(e=t.type===vh?Wu(e):t.type==gh?Xu(e):i("Only time and utc scales accept interval strings."),r&&(e=e.every(r))),e}function Im(t,e,n){var r=t.range(),i=r[0],a=M(r);if(i>a&&(r=a,a=i,i=r),i=Math.floor(i),a=Math.ceil(a),e=e.filter(e=>(e=t(e),i<=e&&e<=a)),n>0&&e.length>1){for(var u=[e[0],M(e)];e.length>n&&e.length>=3;)e=e.filter((t,e)=>!(e%2));e.length<3&&(e=u)}return e}function jm(t,e){return t.bins?Im(t,t.bins):t.ticks?t.ticks(e):t.domain()}function $m(t,e,n,r,i){var a,u,o=t.type,s=o===vh||r===vh?io(n):o===gh||r===gh?ao(n):t.tickFormat?t.tickFormat(e,n):n?zp(n):Lm;if(Cm(o)){var l=function(t){var e=Fp(t||",");if(null==e.precision){switch(e.precision=12,e.type){case"%":e.precision-=2;break;case"e":e.precision-=1}return function(t,e){return n=>{var r,i,a=t(n),u=a.indexOf(e);if(u<0)return a;for(i=(r=function(t,e){var n,r=t.lastIndexOf("e");if(r>0)return r;for(r=t.length;--r>e;)if((n=t.charCodeAt(r))>=48&&n<=57)return r+1}(a,u))<a.length?a.slice(r):"";--r>u;)if("0"!==a[r]){++r;break}return a.slice(0,r)+i}}(zp(e),zp(".1f")(1)[1])}return zp(e)}(n);s=i||t.bins?l:(a=s,u=l,t=>a(t)?u(t):"")}return s}var Hm={quantile:"quantiles",quantize:"thresholds",threshold:"domain"},Ym={quantile:"quantiles",quantize:"domain"};function Vm(t,e){return t.bins?function(t){var e=t.slice(0,-1);return e.max=M(t),e}(t.bins):t.type===ph?function(t,e){var n=jm(t,e),r=t.base(),i=Math.log(r),a=Math.max(1,r*e/n.length);return n.filter(t=>{var e=t/Math.pow(r,Math.round(Math.log(t)/i));return e*r<r-.5&&(e*=r),e<=a})}(t,e):Hm[t.type]?function(t){var e=[-1/0].concat(t);return e.max=1/0,e}(t[Hm[t.type]]()):jm(t,e)}function Gm(t,e,n,r,i,a){var u=Ym[t.type]&&i!==vh&&i!==gh?function(t,e){var n,r=t[Ym[t.type]](),i=r.length,a=i>1?r[1]-r[0]:r[0];for(n=1;n<i;++n)a=Math.min(a,r[n]-r[n-1]);return Ip(0,a,30,e)}(t,r):$m(t,e,r,i,a);return"symbol"===n&&function(t){return Hm[t.type]||t.bins}(t)?function(t){return(e,n,r)=>{var i=Wm(r[n+1],Wm(r.max,1/0)),a=Xm(e,t),u=Xm(i,t);return a&&u?a+" 
 "+u:u?"< "+u:"
 "+a}}(u):"discrete"===n?function(t){return(e,n)=>n?t(e):null}(u):function(t){return e=>t(e)}(u)}function Wm(t,e){return null!=t?t:e}function Xm(t,e){return Number.isFinite(t)?e(t):null}function Jm(t){var e=t.domain(),n=e.length-1,r=+e[0],i=+M(e),a=i-r;if("threshold"===t.type){var u=n?a/n:.1;a=(i+=u)-(r-=u)}return t=>(t-r)/a}function Zm(t,e){e=e||{};var n=Math.max(3,e.maxlen||7),r=function(t,e,n){var r=n||t.type;return s(e)&&Dm(r)&&(e=e.replace(/%a/g,"%A").replace(/%b/g,"%B")),e||r!==vh?e||r!==gh?Gm(t,5,null,e,n,!0):ao("%A, %d %B %Y, %X UTC"):io("%A, %d %B %Y, %X")}(t,e.format,e.formatType);if(km(t.type)){var i=Vm(t).slice(1).map(r),a=i.length;return`${a} boundar${1===a?"y":"ies"}: ${i.join(", ")}`}if(Mm(t.type)){var u=t.domain(),o=u.length;return`${o} value${1===o?"":"s"}: ${o>n?u.slice(0,n-2).map(r).join(", ")+", ending with "+u.slice(-1).map(r):u.map(r).join(", ")}`}var l=t.domain();return`values from ${r(l[0])} to ${r(M(l))}`}var Qm=Object.freeze({__proto__:null,bandSpace:dh,Identity:"identity",Linear:"linear",Log:ph,Pow:mh,Sqrt:"sqrt",Symlog:"symlog",Time:vh,UTC:gh,Sequential:"sequential",Diverging:"diverging",Quantile:"quantile",Quantize:"quantize",Threshold:"threshold",BinOrdinal:"bin-ordinal",Ordinal:"ordinal",Band:"band",Point:"point",interpolate:Om,interpolateColors:Tm,interpolateRange:Bm,scaleCopy:function(t){var e=t.type,n=t.copy();return n.type=e,n},scaleFraction:Nm,quantizeInterpolator:Sm,scale:bm,isValidScaleType:xm,isContinuous:Am,isDiscrete:Mm,isDiscretizing:km,isInterpolating:Em,isLogarithmic:Cm,isQuantile:function(t){return wm(t,"quantile")},isTemporal:Dm,scheme:qm,SymbolLegend:"symbol",DiscreteLegend:"discrete",GradientLegend:"gradient",tickCount:Pm,tickFormat:$m,tickValues:jm,validTicks:Im,labelFormat:Gm,labelFraction:Jm,labelValues:Vm,domainCaption:Zm,scaleImplicit:xh}),Km=(t,e,n)=>({role:t,"aria-roledescription":e,"aria-label":n||void 0}),tv=bt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),ev={axis:{desc:"axis",caption:function(t){var e=t.datum,n=e.orient,r=e.title?uv(t):null,i=t.context.scales[e.scale].value,a=i.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(r?` titled '${r}'`:"")+` for a ${Mm(a)?"discrete":a} scale with `+Zm(i,t)}},legend:{desc:"legend",caption:function(t){var e=t.datum,n=e.title?uv(t):null,r=((e.type||"")+" legend").trim(),i=e.scales,a=Object.keys(i),u=t.context.scales[i[a[0]]].value;return o=r,(o.length?o[0].toUpperCase()+o.slice(1):o)+(n?` titled '${n}'`:"")+` for ${function(t){return(t=t.map(t=>t+("fill"===t||"stroke"===t?" color":""))).length<2?t[0]:t.slice(0,-1).join(", ")+" and "+M(t)}(a)} with ${Zm(u,t)}`;var o}},"title-text":{desc:"title",caption:t=>`Title text '${av(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${av(t)}'`}},nv={ariaRole:"role",ariaRoleDescription:"aria-roledescription",description:"aria-label"};function rv(t,e){var n=!1===e.aria;if(t("aria-hidden",n||void 0),n||null==e.description)for(var r in nv)t(nv[r],void 0);else{var i=e.mark.marktype;t("aria-label",e.description),t("role",e.ariaRole||("group"===i?"graphics-object":"graphics-symbol")),t("aria-roledescription",e.ariaRoleDescription||i+" mark")}}function iv(t){return!1===t.aria?{"aria-hidden":!0}:tv[t.role]?null:ev[t.role]?function(t,e){try{var n=t.items[0],r=e.caption||(()=>"");return Km(e.role||"graphics-symbol",e.desc,n.description||r(n))}catch(t){return null}}(t,ev[t.role]):function(t){var e=t.marktype,n="group"===e||"text"===e||t.items.some(t=>null!=t.description&&!1!==t.aria);return Km(n?"graphics-object":"graphics-symbol",e+" mark container",t.description)}(t)}function av(t){return $(t.text).join(" ")}function uv(t){try{return $(M(t.items).items[0].text).join(" ")}catch(t){return null}}function ov(t,e,n){var r,i,a="<"+t;if(e)for(r in e)null!=(i=e[r])&&(a+=" "+r+'="'+(i=(i+"").replace(/"/g,"&quot;"))+'"');return n&&(a+=" "+n),a+">"}function sv(t){return"</"+t+">"}var lv={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},cv={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},fv=lv.xmlns;function hv(t){Qf.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var dv=rt(hv,Qf),pv=Qf.prototype;function mv(t,e,n){var r,i,a;if("radial"===e.gradient){var u=Yf(t,n++,"pattern",fv);u.setAttribute("id","p_"+e.id),u.setAttribute("viewBox","0,0,1,1"),u.setAttribute("width","100%"),u.setAttribute("height","100%"),u.setAttribute("preserveAspectRatio","xMidYMid slice"),(u=Yf(u,0,"rect",fv)).setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","url("+kv()+"#"+e.id+")"),(t=Yf(t,n++,"radialGradient",fv)).setAttribute("id",e.id),t.setAttribute("fx",e.x1),t.setAttribute("fy",e.y1),t.setAttribute("fr",e.r1),t.setAttribute("cx",e.x2),t.setAttribute("cy",e.y2),t.setAttribute("r",e.r2)}else(t=Yf(t,n++,"linearGradient",fv)).setAttribute("id",e.id),t.setAttribute("x1",e.x1),t.setAttribute("x2",e.x2),t.setAttribute("y1",e.y1),t.setAttribute("y2",e.y2);for(r=0,i=e.stops.length;r<i;++r)(a=Yf(t,r,"stop",fv)).setAttribute("offset",e.stops[r].offset),a.setAttribute("stop-color",e.stops[r].color);return Vf(t,r),n}function vv(t,e,n){var r;return(t=Yf(t,n,"clipPath",fv)).setAttribute("id",e.id),e.path?(r=Yf(t,0,"path",fv)).setAttribute("d",e.path):((r=Yf(t,0,"rect",fv)).setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",e.width),r.setAttribute("height",e.height)),Vf(t,1),n+1}function gv(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function yv(t,e,n,r,i){var a,u=t._svg;if(!u&&(u=$f(a=e.ownerDocument,r,fv),t._svg=u,t.mark&&(u.__data__=t,u.__values__={fill:"default"},"g"===r))){var o=$f(a,"path",fv);u.appendChild(o),o.__data__=t;var s=$f(a,"g",fv);u.appendChild(s),s.__data__=t;var l=$f(a,"path",fv);u.appendChild(l),l.__data__=t,l.__values__={fill:"default"}}return(u.ownerSVGElement!==i||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(u,n))&&e.insertBefore(u,n?n.nextSibling:e.firstChild),u}dv.initialize=function(t,e,n,r){return t&&(this._svg=Yf(t,0,"svg",fv),this._svg.setAttribute("class","marks"),Vf(t,1),this._root=Yf(this._svg,0,"g",fv),Vf(this._svg,1)),this._defs={gradient:{},clipping:{}},this.background(this._bgcolor),pv.initialize.call(this,t,e,n,r)},dv.background=function(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),pv.background.apply(this,arguments)},dv.resize=function(t,e,n,r){return pv.resize.call(this,t,e,n,r),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},dv.canvas=function(){return this._svg},dv.svg=function(){if(!this._svg)return null;var t={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var e in lv)t[e]=lv[e];var n=this._bgcolor?ov("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+sv("rect"):"";return ov("svg",t)+n+this._svg.innerHTML+sv("svg")},dv._render=function(t){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,t),Vf(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},dv.updateDefs=function(){var t,e=this._svg,n=this._defs,r=n.el,i=0;for(t in n.gradient)r||(n.el=r=Yf(e,0,"defs",fv)),i=mv(r,n.gradient[t],i);for(t in n.clipping)r||(n.el=r=Yf(e,0,"defs",fv)),i=vv(r,n.clipping[t],i);r&&(0===i?(e.removeChild(r),n.el=null):Vf(r,i))},dv._resetDefs=function(){var t=this._defs;t.gradient={},t.clipping={}},dv.dirty=function(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},dv.isDirty=function(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},dv._dirtyCheck=function(){this._dirtyAll=!0;var t=this._dirty;if(!t.length||!this._dirtyID)return!0;var e,n,r,i,a,u,o,s=++this._dirtyID;for(a=0,u=t.length;a<u;++a)(n=(e=t[a]).mark).marktype!==r&&(r=n.marktype,i=Nf[r]),n.zdirty&&n.dirty!==s&&(this._dirtyAll=!1,gv(e,s),n.items.forEach((function(t){t.dirty=s}))),n.zdirty||(e.exit?(i.nested&&n.items.length?(o=n.items[0])._svg&&this._update(i,o._svg,o):e._svg&&(o=e._svg.parentNode)&&o.removeChild(e._svg),e._svg=null):(e=i.nested?n.items[0]:e)._update!==s&&(e._svg&&e._svg.ownerSVGElement?this._update(i,e._svg,e):(this._dirtyAll=!1,gv(e,s)),e._update=s));return!this._dirtyAll},dv.draw=function(t,e,n){if(!this.isDirty(e))return e._svg;var r,i=this,a=this._svg,u=Nf[e.marktype],o=!1===e.interactive?"none":null,s="g"===u.tag,l=null,c=0;(r=yv(e,t,n,"g",a)).setAttribute("class",Gf(e));var f=iv(e);for(var h in f)Mv(r,h,f[h]);function d(t){var e=i.isDirty(t),n=yv(t,r,l,u.tag,a);e&&(i._update(u,n,t),s&&function(t,e,n){e=e.lastChild.previousSibling;var r,i=0;Dc(n,(function(n){r=t.draw(e,n,r),++i})),Vf(e,1+i)}(i,n,t)),l=n,++c}return s||r.style.setProperty("pointer-events",o),Mv(r,"clip-path",e.clip?Yc(i,e,e.group):null),u.nested?e.items.length&&d(e.items[0]):Dc(e,d),Vf(r,c),r};var _v=null,bv=null,xv={group:function(t,e,n){var r,i;_v=r=e.childNodes[2],bv=r.__values__,t.foreground(Av,n,this),bv=e.__values__,_v=e.childNodes[1],t.content(Av,n,this),_v=i=e.childNodes[0],t.background(Av,n,this);var a=!1===n.mark.interactive?"none":null;if(a!==bv.events&&(r.style.setProperty("pointer-events",a),i.style.setProperty("pointer-events",a),bv.events=a),n.strokeForeground&&n.stroke){var u=n.fill;r.style.removeProperty("display"),this.style(i,n),i.style.removeProperty("stroke"),u&&(n.fill=null),bv=r.__values__,this.style(r,n),u&&(n.fill=u),_v=null}else r.style.setProperty("display","none"),r.style.setProperty("fill","none")},image:function(t,e,n){!1===n.smooth?(wv(e,"image-rendering","optimizeSpeed"),wv(e,"image-rendering","pixelated")):wv(e,"image-rendering",null)},text:function(t,e,n){var r,i,a,o,s=Af(n);u(s)?(r=(i=s.map(t=>kf(n,t))).join("\n"))!==bv.text&&(Vf(e,0),a=e.ownerDocument,o=wf(n),i.forEach((t,r)=>{var i=$f(a,"tspan",fv);i.__data__=n,i.textContent=t,r&&(i.setAttribute("x",0),i.setAttribute("dy",o)),e.appendChild(i)}),bv.text=r):(i=kf(n,s))!==bv.text&&(e.textContent=i,bv.text=i),wv(e,"font-family",Cf(n)),wv(e,"font-size",xf(n)+"px"),wv(e,"font-style",n.fontStyle),wv(e,"font-variant",n.fontVariant),wv(e,"font-weight",n.fontWeight)}};function wv(t,e,n){n!==bv[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),bv[e]=n)}function Av(t,e,n){e!==bv[t]&&(n?function(t,e,n,r){null!=n?t.setAttributeNS(r,e,n):t.removeAttributeNS(r,e)}(_v,t,e,n):Mv(_v,t,e),bv[t]=e)}function Mv(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function kv(){var t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function Cv(t){Qf.call(this,t),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}dv._update=function(t,e,n){_v=e,bv=e.__values__,rv(Av,n),t.attr(Av,n,this);var r=xv[t.type];r&&r.call(this,t,e,n),_v&&this.style(_v,n)},dv.style=function(t,e){if(null!=e)for(var n in cv){var r=e[n];if("font"===n&&(r=Cf(e)),r!==bv[n]){var i=cv[n];null==r?"fill"===i?t.style.setProperty(i,"none"):t.style.removeProperty(i):(Po(r)&&(r=Io(r,this._defs.gradient,kv())),t.style.setProperty(i,r+"")),bv[n]=r}}};var Dv,Ev=rt(Cv,Qf),Fv=Qf.prototype;function Bv(t,e,n,r){Dv[r||t]=e}function Tv(t,e,n,r){if(null==t)return"";var i="";for(var a in"bgrect"===n&&!1===e.interactive&&(i+="pointer-events: none; "),"bgfore"===n&&(!1===e.interactive&&(i+="pointer-events: none; "),i+="display: none; "),"image"===n&&!1===t.smooth&&(i+="image-rendering: optimizeSpeed; image-rendering: pixelated; "),"text"===n&&(i+="font-family: "+Cf(t)+"; ",i+="font-size: "+xf(t)+"px; ",t.fontStyle&&(i+="font-style: "+t.fontStyle+"; "),t.fontVariant&&(i+="font-variant: "+t.fontVariant+"; "),t.fontWeight&&(i+="font-weight: "+t.fontWeight+"; ")),cv){var u=t[a],o=cv[a];null==u?"fill"===o&&(i+="fill: none; "):"transparent"!==u||"fill"!==o&&"stroke"!==o?(Po(u)&&(u=Io(u,r.gradient,"")),i+=o+": "+u+"; "):i+=o+": none; "}return i?'style="'+i.trim()+'"':null}function Sv(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}Ev.resize=function(t,e,n,r){Fv.resize.call(this,t,e,n,r);var i=this._origin,a=this._text,u={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var o in lv)u[o]=lv[o];a.head=ov("svg",u);var s=this._bgcolor;return"transparent"!==s&&"none"!==s||(s=null),a.bg=s?ov("rect",{width:this._width,height:this._height,style:"fill: "+s+";"})+sv("rect"):"",a.root=ov("g",{transform:"translate("+i+")"}),a.foot=sv("g")+sv("svg"),this},Ev.background=function(){var t=Fv.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),t},Ev.svg=function(){var t=this._text;return t.head+t.bg+t.defs+t.root+t.body+t.foot},Ev._render=function(t){return this._text.body=this.mark(t),this._text.defs=this.buildDefs(),this},Ev.buildDefs=function(){var t,e,n,r,i,a=this._defs,u="";for(e in a.gradient){for(i=(n=a.gradient[e]).stops,"radial"===n.gradient?(u+=ov(r="pattern",{id:"p_"+e,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),u+=ov("rect",{width:"1",height:"1",fill:"url(#"+e+")"})+sv("rect"),u+=sv(r),u+=ov(r="radialGradient",{id:e,fx:n.x1,fy:n.y1,fr:n.r1,cx:n.x2,cy:n.y2,r:n.r2})):u+=ov(r="linearGradient",{id:e,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),t=0;t<i.length;++t)u+=ov("stop",{offset:i[t].offset,"stop-color":i[t].color})+sv("stop");u+=sv(r)}for(e in a.clipping)n=a.clipping[e],u+=ov("clipPath",{id:e}),n.path?u+=ov("path",{d:n.path})+sv("path"):u+=ov("rect",{x:0,y:0,width:n.width,height:n.height})+sv("rect"),u+=sv("clipPath");return u.length>0?ov("defs")+u+sv("defs"):""},Ev.attributes=function(t,e){return Dv={},Array.isArray(t)?t.forEach(t=>t(Bv,e,this)):t(Bv,e,this),Dv},Ev.href=function(t){var e,n=this,r=t.href;if(r){if(e=n._hrefs&&n._hrefs[r])return e;n.sanitizeURL(r).then(t=>{t["xlink:href"]=t.href,t.href=null,(n._hrefs||(n._hrefs={}))[r]=t})}return null},Ev.mark=function(t){var e,n=this,r=Nf[t.marktype],i=r.tag,a=this._defs,o="";function s(s){var l=n.href(s);if(l&&(o+=ov("a",l)),e="g"!==i?Tv(s,t,i,a):null,o+=ov(i,n.attributes([rv,r.attr],s),e),"text"===i){var c=Af(s);if(u(c))for(var f={x:0,dy:wf(s)},h=0;h<c.length;++h)o+=ov("tspan",h?f:null)+Sv(kf(s,c[h]))+sv("tspan");else o+=Sv(kf(s,c))}else if("g"===i){var d=s.strokeForeground,p=s.fill,m=s.stroke;d&&m&&(s.stroke=null),o+=ov("path",n.attributes(r.background,s),Tv(s,t,"bgrect",a))+sv("path"),o+=ov("g",n.attributes(r.content,s))+n.markGroup(s)+sv("g"),d&&m?(p&&(s.fill=null),s.stroke=m,o+=ov("path",n.attributes(r.foreground,s),Tv(s,t,"bgrect",a))+sv("path"),p&&(s.fill=p)):o+=ov("path",n.attributes(r.foreground,s),Tv({},t,"bgfore",a))+sv("path")}o+=sv(i),l&&(o+=sv("a"))}return"g"!==i&&!1===t.interactive&&(e='style="pointer-events: none;"'),o+=ov("g",Object.assign({class:Gf(t),"clip-path":t.clip?Yc(n,t,t.group):null},iv(t)),e),r.nested?t.items&&t.items.length&&s(t.items[0]):Dc(t,s),o+sv("g")},Ev.markGroup=function(t){var e=this,n="";return Dc(t,(function(t){n+=e.mark(t)})),n};var Nv={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},Ov={};function zv(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(Ov[t]=e,this):Ov[t]}function Rv(t,e,n){var r=[],a=(new Uo).union(e),u=t.marktype;return u?Uv(t,a,n,r):"group"===u?qv(t,a,n,r):i("Intersect scene must be mark node or group item.")}function Uv(t,e,n,r){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){var i=t.items,a=t.marktype,u=i.length,o=0;if("group"===a)for(;o<u;++o)qv(i[o],e,n,r);else for(var s=Nf[a].isect;o<u;++o){var l=i[o];Lv(l,e,s)&&r.push(l)}}return r}function qv(t,e,n,r){n&&n(t.mark)&&Lv(t,e,Nf.group.isect)&&r.push(t);var i=t.items,a=i&&i.length;if(a){var u=t.x||0,o=t.y||0;e.translate(-u,-o);for(var s=0;s<a;++s)Uv(i[s],e,n,r);e.translate(u,o)}return r}function Lv(t,e,n){var r=t.bounds;return e.encloses(r)||e.intersects(r)&&n(t,e)}Ov.canvas=Ov.png={renderer:ah,headless:ah,handler:th},Ov.svg={renderer:hv,headless:Cv,handler:ch},Ov.none={};var Pv=new Uo;function Iv(t){var e=t.clip;if(Y(e))e(nc(Pv.clear()));else{if(!e)return;Pv.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(Pv)}function jv(t,e,n){return t===e||("path"===n?$v(t,e):t instanceof Date&&e instanceof Date?+t==+e:ot(t)&&ot(e)?Math.abs(t-e)<=1e-9:t&&e&&(o(t)||o(e))?null!=t&&null!=e&&function(t,e){var n,r,i=Object.keys(t),a=Object.keys(e);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(n=i[r],!jv(t[n],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function $v(t,e){return jv(hl(t),hl(e))}function Hv(t){Yr.call(this,null,t)}function Yv(t,e,n){return e(t.bounds.clear(),t,n)}rt(Hv,Yr).transform=function(t,e){var n,r=e.dataflow,i=t.mark,a=i.marktype,u=Nf[a],o=u.bound,s=i.bounds;if(u.nested)i.items.length&&r.dirty(i.items[0]),s=Yv(i,o),i.items.forEach((function(t){t.bounds.clear().union(s)}));else if("group"===a||t.modified())switch(e.visit(e.MOD,t=>r.dirty(t)),s.clear(),i.items.forEach(t=>s.union(Yv(t,o))),i.role){case"axis":case"legend":case"title":e.reflow()}else n=e.changed(e.REM),e.visit(e.ADD,t=>{s.union(Yv(t,o))}),e.visit(e.MOD,t=>{n=n||s.alignsWith(t.bounds),r.dirty(t),s.union(Yv(t,o))}),n&&(s.clear(),i.items.forEach(t=>s.union(t.bounds)));return Iv(i),e.modifies("bounds")};function Vv(t){Yr.call(this,0,t)}function Gv(t){Yr.call(this,null,t)}function Wv(t){Yr.call(this,null,t)}Vv.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},rt(Vv,Yr).transform=function(t,e){var n=function(t){var e=t._signals[":vega_identifier:"];e||(t._signals[":vega_identifier:"]=e=t.add(0));return e}(e.dataflow),r=n.value,i=t.as;return e.visit(e.ADD,t=>{t[i]||(t[i]=++r)}),n.set(this.value=r),e},rt(Gv,Yr).transform=function(t,e){var n=this.value;n||((n=e.dataflow.scenegraph().mark(t.markdef,function(t){var e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index)).group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);var r="group"===n.marktype?Yo:Ho;return e.visit(e.ADD,t=>r.call(t,n)),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e};var Xv=rt(Wv,Yr),Jv={parity:t=>t.filter((t,e)=>e%2?t.opacity=0:1),greedy:(t,e)=>{var n;return t.filter((t,r)=>r&&Zv(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1))}};function Zv(t,e,n){return n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2)}function Qv(t,e){for(var n,r=1,i=t.length,a=t[0].bounds;r<i;a=n,++r)if(Zv(a,n=t[r].bounds,e))return!0}function Kv(t){var e=t.bounds;return e.width()>1&&e.height()>1}function tg(t){return t.forEach(t=>t.opacity=1),t}function eg(t,e){return t.reflow(e.modified()).modifies("opacity")}function ng(t){Yr.call(this,null,t)}Xv.transform=function(t,e){var n,r,i,a=Jv[t.method]||Jv.parity,u=e.materialize(e.SOURCE).source,o=t.separation||0;if(u&&u.length){if(!t.method)return t.modified("method")&&(tg(u),e=eg(e,t)),e;if((u=u.filter(Kv)).length){if(t.sort&&(u=u.slice().sort(t.sort)),n=tg(u),e=eg(e,t),n.length>=3&&Qv(n,o)){do{n=a(n,o)}while(n.length>=3&&Qv(n,o));n.length<3&&!M(u).opacity&&(n.length>1&&(M(n).opacity=0),M(u).opacity=1)}return t.boundScale&&t.boundTolerance>=0&&(r=function(t,e,n){var r=t.range(),i=new Uo;return e===So||"bottom"===e?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),t=>i.encloses(t.bounds)}(t.boundScale,t.boundOrient,+t.boundTolerance),u.forEach(t=>{r(t)||(t.opacity=0)})),i=n[0].mark.bounds.clear(),u.forEach(t=>{t.opacity&&i.union(t.bounds)}),e}}},rt(ng,Yr).transform=function(t,e){var n=e.dataflow;if(e.visit(e.ALL,t=>n.dirty(t)),e.fields&&e.fields.zindex){var r=e.source&&e.source[0];r&&(r.mark.zdirty=!0)}};var rg=new Uo;function ig(t,e,n){return t[e]===n?0:(t[e]=n,1)}function ag(t){var e=t.items[0].datum.orient;return e===No||e===Oo}function ug(t,e,n,r){var i,a,u=e.items[0],o=u.datum,s=o.orient,l=null!=o.translate?o.translate:.5,c=function(t){var e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(o),f=u.range,h=u.offset,d=u.position,p=u.minExtent,m=u.maxExtent,v=o.title&&u.items[c[2]].items[0],g=u.titlePadding,y=u.bounds,_=v&&Mf(v),b=0,x=0;switch(rg.clear().union(y),y.clear(),(i=c[0])>-1&&y.union(u.items[i].bounds),(i=c[1])>-1&&y.union(u.items[i].bounds),s){case So:b=d||0,x=-h,a=Math.max(p,Math.min(m,-y.y1)),y.add(0,-a).add(f,0),v&&og(t,v,a,g,_,0,-1,y);break;case No:b=-h,x=d||0,a=Math.max(p,Math.min(m,-y.x1)),y.add(-a,0).add(0,f),v&&og(t,v,a,g,_,1,-1,y);break;case Oo:b=n+h,x=d||0,a=Math.max(p,Math.min(m,y.x2)),y.add(0,0).add(a,f),v&&og(t,v,a,g,_,1,1,y);break;case"bottom":b=d||0,x=r+h,a=Math.max(p,Math.min(m,y.y2)),y.add(0,0).add(f,a),v&&og(t,v,a,g,0,0,1,y);break;default:b=u.x,x=u.y}return Zl(y.translate(b,x),u),ig(u,"x",b+l)|ig(u,"y",x+l)&&(u.bounds=rg,t.dirty(u),u.bounds=y,t.dirty(u)),u.mark.bounds.clear().union(y)}function og(t,e,n,r,i,a,u,o){var s=e.bounds;if(e.auto){var l=u*(n+i+r),c=0,f=0;t.dirty(e),a?c=(e.x||0)-(e.x=l):f=(e.y||0)-(e.y=l),e.mark.bounds.clear().union(s.translate(-c,-f)),t.dirty(e)}o.union(s)}var sg=(t,e)=>Math.floor(Math.min(t,e)),lg=(t,e)=>Math.ceil(Math.max(t,e));function cg(t){return(new Uo).set(0,0,t.width||0,t.height||0)}function fg(t){var e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function hg(t,e,n){var r=o(t)?t[e]:t;return null!=r?r:void 0!==n?n:0}function dg(t){return t<0?Math.ceil(-t):0}function pg(t,e,n){var r,i,a,u,o,s,l,c,f,h,d,p=!n.nodirty,m="flush"===n.bounds?cg:fg,v=rg.set(0,0,0,0),g=hg(n.align,"column"),y=hg(n.align,Ro),_=hg(n.padding,"column"),b=hg(n.padding,Ro),x=n.columns||e.length,w=x<0?1:Math.ceil(e.length/x),A=e.length,M=Array(A),k=Array(x),C=0,D=Array(A),E=Array(w),F=0,B=Array(A),T=Array(A),S=Array(A);for(i=0;i<x;++i)k[i]=0;for(i=0;i<w;++i)E[i]=0;for(i=0;i<A;++i)s=e[i],o=S[i]=m(s),s.x=s.x||0,B[i]=0,s.y=s.y||0,T[i]=0,a=i%x,u=~~(i/x),C=Math.max(C,l=Math.ceil(o.x2)),F=Math.max(F,c=Math.ceil(o.y2)),k[a]=Math.max(k[a],l),E[u]=Math.max(E[u],c),M[i]=_+dg(o.x1),D[i]=b+dg(o.y1),p&&t.dirty(e[i]);for(i=0;i<A;++i)i%x==0&&(M[i]=0),i<x&&(D[i]=0);if("each"===g)for(a=1;a<x;++a){for(d=0,i=a;i<A;i+=x)d<M[i]&&(d=M[i]);for(i=a;i<A;i+=x)M[i]=d+k[a-1]}else if("all"===g){for(d=0,i=0;i<A;++i)i%x&&d<M[i]&&(d=M[i]);for(i=0;i<A;++i)i%x&&(M[i]=d+C)}else for(g=!1,a=1;a<x;++a)for(i=a;i<A;i+=x)M[i]+=k[a-1];if("each"===y)for(u=1;u<w;++u){for(d=0,r=(i=u*x)+x;i<r;++i)d<D[i]&&(d=D[i]);for(i=u*x;i<r;++i)D[i]=d+E[u-1]}else if("all"===y){for(d=0,i=x;i<A;++i)d<D[i]&&(d=D[i]);for(i=x;i<A;++i)D[i]=d+F}else for(y=!1,u=1;u<w;++u)for(r=(i=u*x)+x;i<r;++i)D[i]+=E[u-1];for(f=0,i=0;i<A;++i)f=M[i]+(i%x?f:0),B[i]+=f-e[i].x;for(a=0;a<x;++a)for(h=0,i=a;i<A;i+=x)h+=D[i],T[i]+=h-e[i].y;if(g&&hg(n.center,"column")&&w>1)for(i=0;i<A;++i)(f=(o="all"===g?C:k[i%x])-S[i].x2-e[i].x-B[i])>0&&(B[i]+=f/2);if(y&&hg(n.center,Ro)&&1!==x)for(i=0;i<A;++i)(h=(o="all"===y?F:E[~~(i/x)])-S[i].y2-e[i].y-T[i])>0&&(T[i]+=h/2);for(i=0;i<A;++i)v.union(S[i].translate(B[i],T[i]));switch(f=hg(n.anchor,"x"),h=hg(n.anchor,"y"),hg(n.anchor,"column")){case zo:f-=v.width();break;case"middle":f-=v.width()/2}switch(hg(n.anchor,Ro)){case zo:h-=v.height();break;case"middle":h-=v.height()/2}for(f=Math.round(f),h=Math.round(h),v.clear(),i=0;i<A;++i)e[i].mark.bounds.clear();for(i=0;i<A;++i)(s=e[i]).x+=B[i]+=f,s.y+=T[i]+=h,v.union(s.mark.bounds.union(s.bounds.translate(B[i],T[i]))),p&&t.dirty(s);return v}function mg(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function vg(t,e){return t.bounds[e]}function gg(t,e,n,r,i,a,u,o,s,l,c,f,h,d){var p,m,v,g,y,_,b,x,w,A=n.length,M=0,k=0;if(!A)return M;for(p=c;p<A;p+=f)n[p]&&(M=u(M,s(n[p],l)));if(!e.length)return M;for(e.length>i&&(t.warn("Grid headers exceed limit: "+i),e=e.slice(0,i)),M+=a,m=0,g=e.length;m<g;++m)t.dirty(e[m]),e[m].mark.bounds.clear();for(p=c,m=0,g=e.length;m<g;++m,p+=f){for(y=(_=e[m]).mark.bounds,v=p;v>=0&&null==(b=n[v]);v-=h);o?(x=null==d?b.x:Math.round(b.bounds.x1+d*b.bounds.width()),w=M):(x=M,w=null==d?b.y:Math.round(b.bounds.y1+d*b.bounds.height())),y.union(_.bounds.translate(x-(_.x||0),w-(_.y||0))),_.x=x,_.y=w,t.dirty(_),k=u(k,y[l])}return k}function yg(t,e,n,r,i,a){if(e){t.dirty(e);var u=n,o=n;r?u=Math.round(i.x1+a*i.width()):o=Math.round(i.y1+a*i.height()),e.bounds.translate(u-(e.x||0),o-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=u,e.y=o,t.dirty(e)}}function _g(t,e,n,r,i,a,u){var o=function(t,e){var n=t[e]||{};return(e,r)=>null!=n[e]?n[e]:null!=t[e]?t[e]:r}(n,e),s=function(t,e){var n=-1/0;return t.forEach(t=>{null!=t.offset&&(n=Math.max(n,t.offset))}),n>-1/0?n:e}(t,o("offset",0)),l=o("anchor","start"),c=l===zo?1:"middle"===l?.5:0,f={align:"each",bounds:o("bounds","flush"),columns:"vertical"===o("direction")?1:t.length,padding:o("margin",8),center:o("center"),nodirty:!0};switch(e){case No:f.anchor={x:Math.floor(r.x1)-s,column:zo,y:c*(u||r.height()+2*r.y1),row:l};break;case Oo:f.anchor={x:Math.ceil(r.x2)+s,y:c*(u||r.height()+2*r.y1),row:l};break;case So:f.anchor={y:Math.floor(i.y1)-s,row:zo,x:c*(a||i.width()+2*i.x1),column:l};break;case"bottom":f.anchor={y:Math.ceil(i.y2)+s,x:c*(a||i.width()+2*i.x1),column:l};break;case"top-left":f.anchor={x:s,y:s};break;case"top-right":f.anchor={x:a-s,y:s,column:zo};break;case"bottom-left":f.anchor={x:s,y:u-s,row:zo};break;case"bottom-right":f.anchor={x:a-s,y:u-s,column:zo,row:zo}}return f}function bg(t,e){var n,r,i,a,u=e.items[0],o=u.datum,s=u.orient,l=u.bounds,c=u.x,f=u.y;return u._bounds?u._bounds.clear().union(l):u._bounds=l.clone(),l.clear(),function(t,e,n){var r=e.padding,i=r-n.x,a=r-n.y;if(e.datum.title){var u=e.items[1].items[0],o=u.anchor,s=e.titlePadding||0,l=r-u.x,c=r-u.y;switch(u.orient){case No:i+=Math.ceil(u.bounds.width())+s;break;case Oo:case"bottom":break;default:a+=u.bounds.height()+s}switch((i||a)&&wg(t,n,i,a),u.orient){case No:c+=xg(e,n,u,o,1,1);break;case Oo:l+=xg(e,n,u,zo,0,0)+s,c+=xg(e,n,u,o,1,1);break;case"bottom":l+=xg(e,n,u,o,0,0),c+=xg(e,n,u,zo,-1,0,1)+s;break;default:l+=xg(e,n,u,o,0,0)}(l||c)&&wg(t,u,l,c),(l=Math.round(u.bounds.x1-r))<0&&(wg(t,n,-l,0),wg(t,u,-l,0))}else(i||a)&&wg(t,n,i,a)}(t,u,u.items[0].items[0]),l=function(t,e){return t.items.forEach(t=>e.union(t.bounds)),e.x1=t.padding,e.y1=t.padding,e}(u,l),n=2*u.padding,r=2*u.padding,l.empty()||(n=Math.ceil(l.width()+n),r=Math.ceil(l.height()+r)),"symbol"===o.type&&(i=u.items[0].items[0].items[0].items,a=i.reduce((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t),{}),i.forEach(t=>{t.width=a[t.column],t.height=t.bounds.y2-t.y})),"none"!==s&&(u.x=c=0,u.y=f=0),u.width=n,u.height=r,Zl(l.set(c,f,c+n,f+r),u),u.mark.bounds.clear().union(l),u}function xg(t,e,n,r,i,a,u){var o="symbol"!==t.datum.type,s=n.datum.vgrad,l=(!o||!a&&s||u?e:e.items[0]).bounds[i?"y2":"x2"]-t.padding,c=s&&a?l:0,f=s&&a?0:l,h=i<=0?0:Mf(n);return Math.round("start"===r?c:r===zo?f-h:.5*(l-h))}function wg(t,e,n,r){e.x+=n,e.y+=r,e.bounds.translate(n,r),e.mark.bounds.translate(n,r),t.dirty(e)}function Ag(t){Yr.call(this,null,t)}rt(Ag,Yr).transform=function(t,e){var n=e.dataflow;return t.mark.items.forEach(e=>{t.layout&&function(t,e,n){var r,i,a,u,o,s,l,c=function(t){for(var e,n,r=t.items,i=r.length,a=0,u={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};a<i;++a)if(n=(e=r[a]).items,"group"===e.marktype)switch(e.role){case"axis":case"legend":case"title":break;case"row-header":u.rowheaders.push(...n);break;case"row-footer":u.rowfooters.push(...n);break;case"column-header":u.colheaders.push(...n);break;case"column-footer":u.colfooters.push(...n);break;case"row-title":u.rowtitle=n[0];break;case"column-title":u.coltitle=n[0];break;default:u.marks.push(...n)}return u}(e),f=c.marks,h="flush"===n.bounds?mg:vg,d=n.offset,p=n.columns||f.length,m=p<0?1:Math.ceil(f.length/p),v=m*p,g=pg(t,f,n);c.rowheaders&&(s=hg(n.headerBand,Ro,null),r=gg(t,c.rowheaders,f,p,m,-hg(d,"rowHeader"),sg,0,h,"x1",0,p,1,s)),c.colheaders&&(s=hg(n.headerBand,"column",null),i=gg(t,c.colheaders,f,p,p,-hg(d,"columnHeader"),sg,1,h,"y1",0,1,p,s)),c.rowfooters&&(s=hg(n.footerBand,Ro,null),a=gg(t,c.rowfooters,f,p,m,hg(d,"rowFooter"),lg,0,h,"x2",p-1,p,1,s)),c.colfooters&&(s=hg(n.footerBand,"column",null),u=gg(t,c.colfooters,f,p,p,hg(d,"columnFooter"),lg,1,h,"y2",v-p,1,p,s)),c.rowtitle&&(o=hg(n.titleAnchor,Ro),l=hg(d,"rowTitle"),l=o===zo?a+l:r-l,s=hg(n.titleBand,Ro,.5),yg(t,c.rowtitle,l,0,g,s)),c.coltitle&&(o=hg(n.titleAnchor,"column"),l=hg(d,"columnTitle"),l=o===zo?u+l:i-l,s=hg(n.titleBand,"column",.5),yg(t,c.coltitle,l,1,g,s))}(n,e,t.layout),function(t,e,n){var r,i,a,u,o,s=e.items,l=Math.max(0,e.width||0),c=Math.max(0,e.height||0),f=(new Uo).set(0,0,l,c),h=f.clone(),d=f.clone(),p=[];for(u=0,o=s.length;u<o;++u)switch((i=s[u]).role){case"axis":(ag(i)?h:d).union(ug(t,i,l,c));break;case"title":r=i;break;case"legend":p.push(bg(t,i));break;case"frame":case"scope":case"row-header":case"row-footer":case"row-title":case"column-header":case"column-footer":case"column-title":h.union(i.bounds),d.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){var m={};for(var v in p.forEach(t=>{"none"!==(a=t.orient||Oo)&&(m[a]||(m[a]=[])).push(t)}),m){var g=m[v];pg(t,g,_g(g,v,n.legends,h,d,l,c))}p.forEach(e=>{var r=e.bounds;if(r.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=r,t.dirty(e)),n.autosize&&"fit"===n.autosize.type)switch(e.orient){case No:case Oo:f.add(r.x1,0).add(r.x2,0);break;case So:case"bottom":f.add(0,r.y1).add(0,r.y2)}else f.union(r)})}f.union(h).union(d),r&&f.union(function(t,e,n,r,i){var a,u=e.items[0],o=u.frame,s=u.orient,l=u.anchor,c=u.offset,f=u.padding,h=u.items[0].items[0],d=u.items[1]&&u.items[1].items[0],p=s===No||s===Oo?r:n,m=0,v=0,g=0,y=0,_=0;if("group"!==o?s===No?(m=i.y2,p=i.y1):s===Oo?(m=i.y1,p=i.y2):(m=i.x1,p=i.x2):s===No&&(m=r,p=0),a="start"===l?m:l===zo?p:(m+p)/2,d&&d.text){switch(s){case So:case"bottom":_=h.bounds.height()+f;break;case No:y=h.bounds.width()+f;break;case Oo:y=-h.bounds.width()-f}rg.clear().union(d.bounds),rg.translate(y-(d.x||0),_-(d.y||0)),ig(d,"x",y)|ig(d,"y",_)&&(t.dirty(d),d.bounds.clear().union(rg),d.mark.bounds.clear().union(rg),t.dirty(d)),rg.clear().union(d.bounds)}else rg.clear();switch(rg.union(h.bounds),s){case So:v=a,g=i.y1-rg.height()-c;break;case No:v=i.x1-rg.width()-c,g=a;break;case Oo:v=i.x2+rg.width()+c,g=a;break;case"bottom":v=a,g=i.y2+c;break;default:v=u.x,g=u.y}return ig(u,"x",v)|ig(u,"y",g)&&(rg.translate(v,g),t.dirty(u),u.bounds.clear().union(rg),e.bounds.clear().union(rg),t.dirty(u)),u.bounds}(t,r,l,c,f));e.clip&&f.set(0,0,e.width||0,e.height||0);!function(t,e,n,r){var i=r.autosize||{},a=i.type;if(t._autosize<1||!a)return;var u=t._width,o=t._height,s=Math.max(0,e.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-s)),f=Math.max(0,e.height||0),h=Math.max(0,Math.ceil(-n.y1)),d=Math.max(0,Math.ceil(n.y2-f));if("padding"===i.contains){var p=t.padding();u-=p.left+p.right,o-=p.top+p.bottom}"none"===a?(l=0,h=0,s=u,f=o):"fit"===a?(s=Math.max(0,u-l-c),f=Math.max(0,o-h-d)):"fit-x"===a?(s=Math.max(0,u-l-c),o=f+h+d):"fit-y"===a?(u=s+l+c,f=Math.max(0,o-h-d)):"pad"===a&&(u=s+l+c,o=f+h+d);t._resizeView(u,o,s,f,[l,h],i.resize)}(t,e,f,n)}(n,e,t)}),t.modified()&&e.reflow(),e};var Mg=Object.freeze({__proto__:null,bound:Hv,identifier:Vv,mark:Gv,overlap:Wv,render:ng,viewlayout:Ag});function kg(t){Yr.call(this,null,t)}function Cg(t){Yr.call(this,null,t)}function Dg(){return Tt({})}function Eg(t){return t.exit}function Fg(t){Yr.call(this,null,t)}function Bg(t){Yr.call(this,[],t)}rt(kg,Yr).transform=function(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,i=t.scale,a=Pm(i,null==t.count?t.values?t.values.length:10:t.count,t.minstep),u=t.format||$m(i,a,t.formatSpecifier,t.formatType,!!t.values),o=t.values?Im(i,t.values,a):jm(i,a);return r&&(n.rem=r),r=o.map((function(t,e){return Tt({index:e/(o.length-1||1),value:t,label:u(t)})})),t.extra&&r.length&&r.push(Tt({index:-1,extra:{value:r[0].value},label:""})),n.source=r,n.add=r,this.value=r,n},rt(Cg,Yr).transform=function(t,e){var n=e.dataflow,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),a=t.item||Dg,o=t.key||Ft,s=this.value;return u(r.encode)&&(r.encode=null),s&&(t.modified("key")||e.modified(o))&&i("DataJoin does not support modified key function or fields."),s||(e=e.addAll(),this.value=s=et().test(Eg),s.lookup=function(t){return s.get(o(t))}),e.visit(e.ADD,(function(t){var e=o(t),n=s.get(e);n?n.exit?(s.empty--,r.add.push(n)):r.mod.push(n):(s.set(e,n=a(t)),r.add.push(n)),n.datum=t,n.exit=!1})),e.visit(e.MOD,(function(t){var e=o(t),n=s.get(e);n&&(n.datum=t,r.mod.push(n))})),e.visit(e.REM,(function(t){var e=o(t),n=s.get(e);t!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++s.empty)})),e.changed(e.ADD_MOD)&&r.modifies("datum"),t.clean&&s.empty>n.cleanThreshold&&n.runAfter(s.clean),r},rt(Fg,Yr).transform=function(t,e){var n=e.fork(e.ADD_REM),r=t.mod||!1,i=t.encoders,a=e.encode;if(u(a)){if(!n.changed()&&!a.every((function(t){return i[t]})))return e.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||g,l=i.enter||g,c=i.exit||g,f=(a&&!o?i[a]:s)||g;if(e.changed(e.ADD)&&(e.visit(e.ADD,(function(e){l(e,t),s(e,t)})),n.modifies(l.output),n.modifies(s.output),f!==g&&f!==s&&(e.visit(e.ADD,(function(e){f(e,t)})),n.modifies(f.output))),e.changed(e.REM)&&c!==g&&(e.visit(e.REM,(function(e){c(e,t)})),n.modifies(c.output)),o||f!==g){var h=e.MOD|(t.modified()?e.REFLOW:0);o?(e.visit(h,(function(e){var i=l(e,t)||r;(f(e,t)||i)&&n.mod.push(e)})),n.mod.length&&n.modifies(l.output)):e.visit(h,(function(e){(f(e,t)||r)&&n.mod.push(e)})),n.mod.length&&n.modifies(f.output)}return n.changed()?n:e.StopPropagation},rt(Bg,Yr).transform=function(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,r,i,a,u,o=e.fork(e.NO_SOURCE|e.NO_FIELDS),s=this.value,l=t.type||"symbol",c=t.scale,f=+t.limit,h=Pm(c,null==t.count?5:t.count,t.minstep),d=!!t.values||"symbol"===l,p=t.format||Gm(c,h,l,t.formatSpecifier,t.formatType,d),m=t.values||Vm(c,h);return s&&(o.rem=s),"symbol"===l?(f&&m.length>f?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),s=m.slice(0,f-1),u=!0):s=m,Y(i=t.size)?(t.values||0!==c(s[0])||(s=s.slice(1)),a=s.reduce((function(e,n){return Math.max(e,i(n,t))}),0)):i=G(a=i||8),s=s.map((function(e,n){return Tt({index:n,label:p(e,n,s),value:e,offset:a,size:i(e,t)})})),u&&(u=m[s.length],s.push(Tt({index:s.length,label:`
${m.length-s.length} entries`,value:u,offset:a,size:i(u,t)})))):"gradient"===l?(n=c.domain(),r=Nm(c,n[0],M(n)),m.length<3&&!t.values&&n[0]!==M(n)&&(m=[n[0],M(n)]),s=m.map((function(t,e){return Tt({index:e,label:p(t,e,m),value:t,perc:r(t)})}))):(i=m.length-1,r=Jm(c),s=m.map((function(t,e){return Tt({index:e,label:p(t,e,m),value:t,perc:e?r(t):0,perc2:e===i?1:r(m[e+1])})}))),o.source=s,o.add=s,this.value=s,o};var Tg=et({line:Ug,"line-radial":function(t,e,n,r){return Ug(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},arc:qg,"arc-radial":function(t,e,n,r){return qg(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},curve:Lg,"curve-radial":function(t,e,n,r){return Lg(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},"orthogonal-horizontal":function(t,e,n,r){return"M"+t+","+e+"V"+r+"H"+n},"orthogonal-vertical":function(t,e,n,r){return"M"+t+","+e+"H"+n+"V"+r},"orthogonal-radial":function(t,e,n,r){var i=Math.cos(t),a=Math.sin(t),u=Math.cos(n),o=Math.sin(n),s=Math.abs(n-t)>Math.PI?n<=t:n>t;return"M"+e*i+","+e*a+"A"+e+","+e+" 0 0,"+(s?1:0)+" "+e*u+","+e*o+"L"+r*u+","+r*o},"diagonal-horizontal":function(t,e,n,r){var i=(t+n)/2;return"M"+t+","+e+"C"+i+","+e+" "+i+","+r+" "+n+","+r},"diagonal-vertical":function(t,e,n,r){var i=(e+r)/2;return"M"+t+","+e+"C"+t+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":function(t,e,n,r){var i=Math.cos(t),a=Math.sin(t),u=Math.cos(n),o=Math.sin(n),s=(e+r)/2;return"M"+e*i+","+e*a+"C"+s*i+","+s*a+" "+s*u+","+s*o+" "+r*u+","+r*o}});function Sg(t){return t.source.x}function Ng(t){return t.source.y}function Og(t){return t.target.x}function zg(t){return t.target.y}function Rg(t){Yr.call(this,{},t)}function Ug(t,e,n,r){return"M"+t+","+e+"L"+n+","+r}function qg(t,e,n,r){var i=n-t,a=r-e,u=Math.sqrt(i*i+a*a)/2;return"M"+t+","+e+"A"+u+","+u+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r}function Lg(t,e,n,r){var i=n-t,a=r-e,u=.2*(i+a),o=.2*(a-i);return"M"+t+","+e+"C"+(t+u)+","+(e+o)+" "+(n+o)+","+(r-u)+" "+n+","+r}function Pg(t){Yr.call(this,null,t)}Rg.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},rt(Rg,Yr).transform=function(t,e){var n=t.sourceX||Sg,r=t.sourceY||Ng,a=t.targetX||Og,u=t.targetY||zg,o=t.as||"path",s=t.orient||"vertical",l=t.shape||"line",c=Tg.get(l+"-"+s)||Tg.get(l);return c||i("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,(function(t){t[o]=c(n(t),r(t),a(t),u(t))})),e.reflow(t.modified()).modifies(o)},Pg.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},rt(Pg,Yr).transform=function(t,e){var n,r,i,a=t.as||["startAngle","endAngle"],u=a[0],o=a[1],s=t.field||m,l=t.startAngle||0,c=null!=t.endAngle?t.endAngle:2*Math.PI,f=e.source,h=f.map(s),d=h.length,p=l,v=(c-l)/function(t,e){var n=0;if(void 0===e)for(var r of t)(r=+r)&&(n+=r);else{var i=-1;for(var a of t)(a=+e(a,++i,t))&&(n+=a)}return n}(h),g=li(d);for(t.sort&&g.sort((function(t,e){return h[t]-h[e]})),n=0;n<d;++n)i=h[g[n]],(r=f[g[n]])[u]=p,r[o]=p+=i*v;return this.value=h,e.reflow(t.modified()).modifies(a)};function Ig(t){return Am(t)&&"sequential"!==t}var jg=bt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function $g(t){Yr.call(this,null,t),this.modified(!0)}function Hg(t,e,n){Cm(t)&&(Math.abs(e.reduce((function(t,e){return t+(e<0?-1:e>0?1:0)}),0))!==e.length&&n.warn("Log scale domain includes zero: "+l(e)));return e}function Yg(t,e,n){return Y(t)&&(e||n)?Bm(t,Vg(e||[0,1],n)):t}function Vg(t,e){return e?t.slice().reverse():t}function Gg(t){Yr.call(this,null,t)}rt($g,Yr).transform=function(t,e){var n=e.dataflow,r=this.value,a=function(t){var e,n=t.type,r="";if("sequential"===n)return"sequential-linear";(function(t){var e=t.type;return Am(e)&&e!==vh&&e!==gh&&(t.scheme||t.range&&t.range.length&&t.range.every(s))})(t)&&(e=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0,r=2===e?"sequential-":3===e?"diverging-":"");return(r+n||"linear").toLowerCase()}(t);for(a in r&&a===r.type||(this.value=r=bm(a)()),t)if(!jg[a]){if("padding"===a&&Ig(r.type))continue;Y(r[a])?r[a](t[a]):n.warn("Unsupported scale property: "+a)}return function(t,e,n){var r=t.type,a=e.round||!1,o=e.range;if(null!=e.rangeStep)o=function(t,e,n){"band"!==t&&"point"!==t&&i("Only band and point scales support rangeStep.");var r=(null!=e.paddingOuter?e.paddingOuter:e.padding)||0,a="point"===t?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0;return[0,e.rangeStep*dh(n,a,r)]}(r,e,n);else if(e.scheme&&(o=function(t,e,n){var r,a,o=e.schemeExtent;u(e.scheme)?a=Tm(e.scheme,e.interpolate,e.interpolateGamma):(r=e.scheme.toLowerCase(),(a=qm(r))||i("Unrecognized scheme name: "+e.scheme));return n="threshold"===t?n+1:"bin-ordinal"===t?n-1:"quantile"===t||"quantize"===t?+e.schemeCount||5:n,Em(t)?Yg(a,o,e.reverse):Y(a)?Sm(Yg(a,o),n):"ordinal"===t?a:a.slice(0,n)}(r,e,n),Y(o))){if(t.interpolator)return t.interpolator(o);i(`Scale type ${r} does not support interpolating color schemes.`)}if(o&&Em(r))return t.interpolator(Tm(Vg(o,e.reverse),e.interpolate,e.interpolateGamma));o&&e.interpolate&&t.interpolate?t.interpolate(Om(e.interpolate,e.interpolateGamma)):Y(t.round)?t.round(a):Y(t.rangeRound)&&t.interpolate(a?Vd:Yd);o&&t.range(Vg(o,e.reverse))}(r,t,function(t,e,n){var r=e.bins;if(r&&!u(r)){var a=t.domain(),o=a[0],s=M(a),l=null==r.start?o:r.start,c=null==r.stop?s:r.stop,f=r.step;f||i("Scale bins parameter missing step property."),l<o&&(l=f*Math.ceil(o/f)),c>s&&(c=f*Math.floor(s/f)),r=li(l,c+f/2,f)}r?t.bins=r:t.bins&&delete t.bins;"bin-ordinal"===t.type&&(r?e.domain||e.domainRaw||(t.domain(r),n=r.length):t.bins=t.domain());return n}(r,t,function(t,e,n){var r=function(t,e,n){return e?(t.domain(Hg(t.type,e,n)),e.length):-1}(t,e.domainRaw,n);if(r>-1)return r;var i,a,u=e.domain,o=t.type,s=e.zero||void 0===e.zero&&function(t){var e=t.type;return!t.bins&&("linear"===e||e===mh||"sqrt"===e)}(t);if(!u)return 0;Ig(o)&&e.padding&&u[0]!==M(u)&&(u=function(t,e,n,r,i,a){var u=Math.abs(M(n)-n[0]),o=u/(u-2*r),s=t===ph?q(e,null,o):"sqrt"===t?L(e,null,o,.5):t===mh?L(e,null,o,i||1):"symlog"===t?P(e,null,o,a||1):U(e,null,o);return(e=e.slice())[0]=s[0],e[e.length-1]=s[1],e}(o,u,e.range,e.padding,e.exponent,e.constant));(s||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(i=(u=u.slice()).length-1||1,s&&(u[0]>0&&(u[0]=0),u[i]<0&&(u[i]=0)),null!=e.domainMin&&(u[0]=e.domainMin),null!=e.domainMax&&(u[i]=e.domainMax),null!=e.domainMid&&(((a=e.domainMid)<u[0]||a>u[i])&&n.warn("Scale domainMid exceeds domain min or max.",a),u.splice(i,0,a)));t.domain(Hg(o,u,n)),"ordinal"===o&&t.unknown(e.domainImplicit?xh:void 0);e.nice&&t.nice&&t.nice(!0!==e.nice&&Pm(t,e.nice)||null);return u.length}(r,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)},rt(Gg,Yr).transform=function(t,e){var n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(zt(t.sort)),this.modified(n),e};var Wg=["y0","y1"];function Xg(t){Yr.call(this,null,t)}function Jg(t,e,n,r,i){for(var a,u=(e-t.sum)/2,o=t.length,s=0;s<o;++s)(a=t[s])[r]=u,a[i]=u+=Math.abs(n(a))}function Zg(t,e,n,r,i){for(var a,u=1/t.sum,o=0,s=t.length,l=0,c=0;l<s;++l)(a=t[l])[r]=o,a[i]=o=u*(c+=Math.abs(n(a)))}function Qg(t,e,n,r,i){for(var a,u,o=0,s=0,l=t.length,c=0;c<l;++c)(a=+n(u=t[c]))<0?(u[r]=s,u[i]=s+=a):(u[r]=o,u[i]=o+=a)}Xg.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:Wg}]},rt(Xg,Yr).transform=function(t,e){var n,r,i,a,u=t.as||Wg,o=u[0],s=u[1],l=zt(t.sort),c=t.field||m,f="center"===t.offset?Jg:"normalize"===t.offset?Zg:Qg;for(n=function(t,e,n,r){var i,a,u,o,s,l,c,f,h,d=[],p=function(t){return t(s)};if(null==e)d.push(t.slice());else for(i={},a=0,u=t.length;a<u;++a)s=t[a],l=e.map(p),(c=i[l])||(i[l]=c=[],d.push(c)),c.push(s);for(l=0,h=0,o=d.length;l<o;++l){for(c=d[l],a=0,f=0,u=c.length;a<u;++a)f+=Math.abs(r(c[a]));c.sum=f,f>h&&(h=f),n&&c.sort(n)}return d.max=h,d}(e.source,t.groupby,l,c),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,c,o,s);return e.reflow(t.modified()).modifies(u)};var Kg=Object.freeze({__proto__:null,axisticks:kg,datajoin:Cg,encode:Fg,legendentries:Bg,linkpath:Rg,pie:Pg,scale:$g,sortitems:Gg,stack:Xg});function ty(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}function ey(t){var e=t._signals.cursor;e||(t._signals.cursor=e=t.add({user:"default",item:null})),t.on(t.events("view","mousemove"),e,(function(t,n){var r=e.value,i=r?s(r)?r:r.user:"default",a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),t.add(null,(function(t){var e=t.cursor,n=this.value;return s(e)||(n=e.item,e=e.user),function(t){"undefined"!=typeof document&&document.body&&(document.body.style.cursor=t)}(e&&"default"!==e?e:n||e),n}),{cursor:e})}function ny(t,e){var n=t._runtime.data;return K(n,e)||i("Unrecognized data set: "+e),n[e]}function ry(t,e){Rt(e)||i("Second argument to changes must be a changeset.");var n=ny(this,t);return n.modified=!0,this.pulse(n.input,e)}function iy(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function ay(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function uy(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}function oy(t,e,n){var r,i,a=t._renderer,u=a&&a.canvas();return u&&(i=uy(t),(r=Wf(e.changedTouches?e.changedTouches[0]:e,u))[0]-=i[0],r[1]-=i[1]),e.dataflow=t,e.item=n,e.vega=function(t,e,n){var r=e?"group"===e.mark.marktype?e:e.mark.group:null;function i(t){var n,i=r;if(t)for(n=e;n;n=n.mark.group)if(n.mark.name===t){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(t){if(!t)return n;s(t)&&(t=i(t));for(var e=n.slice();t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:G(t),item:G(e||{}),group:i,xy:a,x:function(t){return a(t)[0]},y:function(t){return a(t)[1]}}}(t,n,r),e}var sy={trap:!1};function ly(t,e,n){var r=t._eventConfig&&t._eventConfig[e];return!(!1===r||o(r)&&!r[n])||(t.warn(`Blocked ${e} ${n} event listener.`),!1)}function cy(t){return t.item}function fy(t){return t.item.mark.source}function hy(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function dy(t,e,n){var r=document.createElement(t);for(var i in e)r.setAttribute(i,e[i]);return null!=n&&(r.textContent=n),r}function py(t,e,n){if(e){var r=n.param,i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:e=>{e!==t.signal(r.signal)&&t.runAsync(null,(function(){i.source=!0,t.signal(r.signal,e)}))}},r.debounce&&(i.update=W(r.debounce,i.update))),function(t,e,n,r){var i=dy("div",{class:"vega-bind"}),a="radio"===n.input?i:i.appendChild(dy("label"));a.appendChild(dy("span",{class:"vega-bind-name"},n.name||n.signal)),e.appendChild(i);var u=my;switch(n.input){case"checkbox":u=vy;break;case"select":u=gy;break;case"radio":u=yy;break;case"range":u=_y}u(t,a,n,r)}(i,e,r,t.signal(r.signal)),i.active||(t.on(t._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(t.signal(r.signal))}),i.active=!0),i}}function my(t,e,n,r){var i=dy("input");for(var a in n)"signal"!==a&&"element"!==a&&i.setAttribute("input"===a?"type":a,n[a]);i.setAttribute("name",n.signal),i.value=r,e.appendChild(i),i.addEventListener("input",()=>t.update(i.value)),t.elements=[i],t.set=t=>i.value=t}function vy(t,e,n,r){var i={type:"checkbox",name:n.signal};r&&(i.checked=!0);var a=dy("input",i);e.appendChild(a),a.addEventListener("change",()=>t.update(a.checked)),t.elements=[a],t.set=t=>a.checked=!!t||null}function gy(t,e,n,r){var i=dy("select",{name:n.signal}),a=n.labels||[];n.options.forEach((t,e)=>{var n={value:t};by(t,r)&&(n.selected=!0),i.appendChild(dy("option",n,(a[e]||t)+""))}),e.appendChild(i),i.addEventListener("change",()=>{t.update(n.options[i.selectedIndex])}),t.elements=[i],t.set=t=>{for(var e=0,r=n.options.length;e<r;++e)if(by(n.options[e],t))return void(i.selectedIndex=e)}}function yy(t,e,n,r){var i=dy("span",{class:"vega-bind-radio"}),a=n.labels||[];e.appendChild(i),t.elements=n.options.map((e,u)=>{var o={type:"radio",name:n.signal,value:e};by(e,r)&&(o.checked=!0);var s=dy("input",o);s.addEventListener("change",()=>t.update(e));var l=dy("label",{},(a[u]||e)+"");return l.prepend(s),i.appendChild(l),s}),t.set=e=>{for(var n=t.elements,r=n.length,i=0;i<r;++i)by(n[i].value,e)&&(n[i].checked=!0)}}function _y(t,e,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;var i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,u=n.step||mi(a,i,100),o=dy("input",{type:"range",name:n.signal,min:a,max:i,step:u});o.value=r;var s=dy("span",{},+r);e.appendChild(o),e.appendChild(s);var l=()=>{s.textContent=o.value,t.update(+o.value)};o.addEventListener("input",l),o.addEventListener("change",l),t.elements=[o],t.set=t=>{o.value=t,s.textContent=t}}function by(t,e){return t===e||t+""==e+""}function xy(t,e,n,r,i,a){return(e=e||new r(t.loader())).initialize(n,iy(t),ay(t),uy(t),i,a).background(t.background())}function wy(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function Ay(t,e){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e)try{e.innerHTML=""}catch(n){e=null,t.error(n)}return e}var My=t=>+t||0;function ky(t){return o(t)?{top:My(t.top),bottom:My(t.bottom),left:My(t.left),right:My(t.right)}:(t=>({top:t,bottom:t,left:t,right:t}))(My(t))}async function Cy(t,e,n,r){var a=zv(e),u=a&&a.headless;return u||i("Unrecognized renderer type: "+e),await t.runAsync(),xy(t,null,null,u,n,r).renderAsync(t._scenegraph.root)}var Dy,Ey,Fy,By,Ty;function Sy(t){this.type=t}Sy.prototype.visit=function(t){var e,n,r;if(t(this))return 1;for(n=0,r=(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":var e=t.arguments.slice();return e.unshift(t.callee),e;case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;n<r;++n)if(e[n].visit(t))return 1};(Dy={})[1]="Boolean",Dy[2]="<end>",Dy[3]="Identifier",Dy[4]="Keyword",Dy[5]="Null",Dy[6]="Numeric",Dy[7]="Punctuator",Dy[8]="String",Dy[9]="RegularExpression";var Ny="ILLEGAL",Oy=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),zy=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Ry(t,e){if(!t)throw new Error("ASSERT: "+e)}function Uy(t){return t>=48&&t<=57}function qy(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function Ly(t){return"01234567".indexOf(t)>=0}function Py(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function Iy(t){return 10===t||13===t||8232===t||8233===t}function jy(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&Oy.test(String.fromCharCode(t))}function $y(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&zy.test(String.fromCharCode(t))}var Hy={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Yy(){for(var t;Fy<By&&(Py(t=Ey.charCodeAt(Fy))||Iy(t));)++Fy}function Vy(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e)Fy<By&&qy(Ey[Fy])?(r=Ey[Fy++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):s_({},"Unexpected token %0",Ny);return String.fromCharCode(i)}function Gy(){var t,e,n,r;for(e=0,"}"===(t=Ey[Fy])&&s_({},"Unexpected token %0",Ny);Fy<By&&qy(t=Ey[Fy++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&s_({},"Unexpected token %0",Ny),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),r=56320+(e-65536&1023),String.fromCharCode(n,r))}function Wy(){var t,e;for(t=Ey.charCodeAt(Fy++),e=String.fromCharCode(t),92===t&&(117!==Ey.charCodeAt(Fy)&&s_({},"Unexpected token %0",Ny),++Fy,(t=Vy("u"))&&"\\"!==t&&jy(t.charCodeAt(0))||s_({},"Unexpected token %0",Ny),e=t);Fy<By&&$y(t=Ey.charCodeAt(Fy));)++Fy,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==Ey.charCodeAt(Fy)&&s_({},"Unexpected token %0",Ny),++Fy,(t=Vy("u"))&&"\\"!==t&&$y(t.charCodeAt(0))||s_({},"Unexpected token %0",Ny),e+=t);return e}function Xy(){var t,e;return t=Fy,{type:1===(e=92===Ey.charCodeAt(Fy)?Wy():function(){var t,e;for(t=Fy++;Fy<By;){if(92===(e=Ey.charCodeAt(Fy)))return Fy=t,Wy();if(!$y(e))break;++Fy}return Ey.slice(t,Fy)}()).length?3:Hy.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:Fy}}function Jy(){var t,e,n,r,i=Fy,a=Ey.charCodeAt(Fy),u=Ey[Fy];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Fy,{type:7,value:String.fromCharCode(a),start:i,end:Fy};default:if(61===(t=Ey.charCodeAt(Fy+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Fy+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(t),start:i,end:Fy};case 33:case 61:return Fy+=2,61===Ey.charCodeAt(Fy)&&++Fy,{type:7,value:Ey.slice(i,Fy),start:i,end:Fy}}}return">>>="===(r=Ey.substr(Fy,4))?{type:7,value:r,start:i,end:Fy+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:Fy+=3}:u===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(u)>=0||"=>"===e?{type:7,value:e,start:i,end:Fy+=2}:"<>=!+-*%&|^/".indexOf(u)>=0?{type:7,value:u,start:i,end:++Fy}:void s_({},"Unexpected token %0",Ny)}function Zy(){var t,e,n;if(Ry(Uy((n=Ey[Fy]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=Fy,t="","."!==n){if(t=Ey[Fy++],n=Ey[Fy],"0"===t){if("x"===n||"X"===n)return++Fy,function(t){for(var e="";Fy<By&&qy(Ey[Fy]);)e+=Ey[Fy++];return 0===e.length&&s_({},"Unexpected token %0",Ny),jy(Ey.charCodeAt(Fy))&&s_({},"Unexpected token %0",Ny),{type:6,value:parseInt("0x"+e,16),start:t,end:Fy}}(e);if(Ly(n))return function(t){for(var e="0"+Ey[Fy++];Fy<By&&Ly(Ey[Fy]);)e+=Ey[Fy++];return(jy(Ey.charCodeAt(Fy))||Uy(Ey.charCodeAt(Fy)))&&s_({},"Unexpected token %0",Ny),{type:6,value:parseInt(e,8),octal:!0,start:t,end:Fy}}(e);n&&Uy(n.charCodeAt(0))&&s_({},"Unexpected token %0",Ny)}for(;Uy(Ey.charCodeAt(Fy));)t+=Ey[Fy++];n=Ey[Fy]}if("."===n){for(t+=Ey[Fy++];Uy(Ey.charCodeAt(Fy));)t+=Ey[Fy++];n=Ey[Fy]}if("e"===n||"E"===n)if(t+=Ey[Fy++],"+"!==(n=Ey[Fy])&&"-"!==n||(t+=Ey[Fy++]),Uy(Ey.charCodeAt(Fy)))for(;Uy(Ey.charCodeAt(Fy));)t+=Ey[Fy++];else s_({},"Unexpected token %0",Ny);return jy(Ey.charCodeAt(Fy))&&s_({},"Unexpected token %0",Ny),{type:6,value:parseFloat(t),start:e,end:Fy}}function Qy(){var t,e,n,r;return Ty=null,Yy(),t=Fy,e=function(){var t,e,n,r;for(Ry("/"===(t=Ey[Fy]),"Regular expression literal must start with a slash"),e=Ey[Fy++],n=!1,r=!1;Fy<By;)if(e+=t=Ey[Fy++],"\\"===t)Iy((t=Ey[Fy++]).charCodeAt(0))&&s_({},"Invalid regular expression: missing /"),e+=t;else if(Iy(t.charCodeAt(0)))s_({},"Invalid regular expression: missing /");else if(n)"]"===t&&(n=!1);else{if("/"===t){r=!0;break}"["===t&&(n=!0)}return r||s_({},"Invalid regular expression: missing /"),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";Fy<By&&$y((t=Ey[Fy]).charCodeAt(0));)++Fy,"\\"===t&&Fy<By?s_({},"Unexpected token %0",Ny):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&s_({},"Invalid regular expression",n),{value:n,literal:e}}(),r=function(t,e){var n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(t,e){if(parseInt(e,16)<=1114111)return"x";s_({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){s_({},"Invalid regular expression")}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:Fy}}function Ky(){var t;return Yy(),Fy>=By?{type:2,start:Fy,end:Fy}:jy(t=Ey.charCodeAt(Fy))?Xy():40===t||41===t||59===t?Jy():39===t||34===t?function(){var t,e,n,r,i="",a=!1;for(Ry("'"===(t=Ey[Fy])||'"'===t,"String literal must starts with a quote"),e=Fy,++Fy;Fy<By;){if((n=Ey[Fy++])===t){t="";break}if("\\"===n)if((n=Ey[Fy++])&&Iy(n.charCodeAt(0)))"\r"===n&&"\n"===Ey[Fy]&&++Fy;else switch(n){case"u":case"x":"{"===Ey[Fy]?(++Fy,i+=Gy()):i+=Vy(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:Ly(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),Fy<By&&Ly(Ey[Fy])&&(a=!0,r=8*r+"01234567".indexOf(Ey[Fy++]),"0123".indexOf(n)>=0&&Fy<By&&Ly(Ey[Fy])&&(r=8*r+"01234567".indexOf(Ey[Fy++]))),i+=String.fromCharCode(r)):i+=n}else{if(Iy(n.charCodeAt(0)))break;i+=n}}return""!==t&&s_({},"Unexpected token %0",Ny),{type:8,value:i,octal:a,start:e,end:Fy}}():46===t?Uy(Ey.charCodeAt(Fy+1))?Zy():Jy():Uy(t)?Zy():Jy()}function t_(){var t;return Fy=(t=Ty).end,Ty=Ky(),Fy=t.end,t}function e_(){var t;t=Fy,Ty=Ky(),Fy=t}function n_(t,e,n){var r=new Sy("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return r.operator=t,r.left=e,r.right=n,r}function r_(t,e){var n=new Sy("CallExpression");return n.callee=t,n.arguments=e,n}function i_(t){var e=new Sy("Identifier");return e.name=t,e}function a_(t){var e=new Sy("Literal");return e.value=t.value,e.raw=Ey.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function u_(t,e,n){var r=new Sy("MemberExpression");return r.computed="["===t,r.object=e,r.property=n,r.computed||(n.member=!0),r}function o_(t,e,n){var r=new Sy("Property");return r.key=e,r.value=n,r.kind=t,r}function s_(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,(function(t,e){return Ry(e<r.length,"Message reference must be in range"),r[e]}));throw(n=new Error(i)).index=Fy,n.description=i,n}function l_(t){2===t.type&&s_(t,"Unexpected end of input"),6===t.type&&s_(t,"Unexpected number"),8===t.type&&s_(t,"Unexpected string"),3===t.type&&s_(t,"Unexpected identifier"),4===t.type&&s_(t,"Unexpected reserved word"),s_(t,"Unexpected token %0",t.value)}function c_(t){var e=t_();7===e.type&&e.value===t||l_(e)}function f_(t){return 7===Ty.type&&Ty.value===t}function h_(t){return 4===Ty.type&&Ty.value===t}function d_(){var t=[];for(Fy=Ty.start,c_("[");!f_("]");)f_(",")?(t_(),t.push(null)):(t.push(k_()),f_("]")||c_(","));return t_(),function(t){var e=new Sy("ArrayExpression");return e.elements=t,e}(t)}function p_(){var t;return Fy=Ty.start,8===(t=t_()).type||6===t.type?(t.octal&&s_(t,"Octal literals are not allowed in strict mode."),a_(t)):i_(t.value)}function m_(){var t,e,n;return Fy=Ty.start,3===(t=Ty).type?(n=p_(),c_(":"),o_("init",n,k_())):2!==t.type&&7!==t.type?(e=p_(),c_(":"),o_("init",e,k_())):void l_(t)}function v_(){var t,e,n=[],r={},i=String;for(Fy=Ty.start,c_("{");!f_("}");)e="$"+("Identifier"===(t=m_()).key.type?t.key.name:i(t.key.value)),Object.prototype.hasOwnProperty.call(r,e)?s_({},"Duplicate data property in object literal not allowed in strict mode"):r[e]=!0,n.push(t),f_("}")||c_(",");return c_("}"),function(t){var e=new Sy("ObjectExpression");return e.properties=t,e}(n)}var g_={if:1,this:1};function y_(){var t,e,n;if(f_("("))return function(){var t;return c_("("),t=C_(),c_(")"),t}();if(f_("["))return d_();if(f_("{"))return v_();if(t=Ty.type,Fy=Ty.start,3===t||g_[Ty.value])n=i_(t_().value);else if(8===t||6===t)Ty.octal&&s_(Ty,"Octal literals are not allowed in strict mode."),n=a_(t_());else{if(4===t)throw new Error("Disabled.");1===t?((e=t_()).value="true"===e.value,n=a_(e)):5===t?((e=t_()).value=null,n=a_(e)):f_("/")||f_("/=")?(n=a_(Qy()),e_()):l_(t_())}return n}function __(){var t=[];if(c_("("),!f_(")"))for(;Fy<By&&(t.push(k_()),!f_(")"));)c_(",");return c_(")"),t}function b_(){return c_("."),Fy=Ty.start,function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(t=t_())||l_(t),i_(t.value);var t}function x_(){var t;return c_("["),t=C_(),c_("]"),t}function w_(){var t=function(){var t;for(t=y_();;)if(f_("."))t=u_(".",t,b_());else if(f_("("))t=r_(t,__());else{if(!f_("["))break;t=u_("[",t,x_())}return t}();if(7===Ty.type&&(f_("++")||f_("--")))throw new Error("Disabled.");return t}function A_(){var t,e,n,r,i;if(7!==Ty.type&&4!==Ty.type)e=w_();else{if(f_("++")||f_("--"))throw new Error("Disabled.");if(f_("+")||f_("-")||f_("~")||f_("!"))t=t_(),e=A_(),n=t.value,r=e,(i=new Sy("UnaryExpression")).operator=n,i.argument=r,i.prefix=!0,e=i;else{if(h_("delete")||h_("void")||h_("typeof"))throw new Error("Disabled.");e=w_()}}return e}function M_(t){var e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function k_(){var t,e;return t=function(){var t,e,n,r,i,a,u,o,s,l;if(t=Ty,s=A_(),0===(i=M_(r=Ty)))return s;for(r.prec=i,t_(),e=[t,Ty],a=[s,r,u=A_()];(i=M_(Ty))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)u=a.pop(),o=a.pop().value,s=a.pop(),e.pop(),n=n_(o,s,u),a.push(n);(r=t_()).prec=i,a.push(r),e.push(Ty),n=A_(),a.push(n)}for(n=a[l=a.length-1],e.pop();l>1;)e.pop(),n=n_(a[l-1].value,a[l-2],n),l-=2;return n}(),f_("?")&&(t_(),e=k_(),c_(":"),t=function(t,e,n){var r=new Sy("ConditionalExpression");return r.test=t,r.consequent=e,r.alternate=n,r}(t,e,k_())),t}function C_(){var t=k_();if(f_(","))throw new Error("Disabled.");return t}var D_={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function E_(t){function e(e,n,r){return function(i){return function(e,n,r,i){var a=t(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+e+(i<0?"":0===i?"()":"("+n.slice(1).map(t).join(",")+")")}(e,i,n,r)}}var n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&i("Missing arguments to clamp function."),e.length>3&&i("Too many arguments to clamp function.");var n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),join:e("join",null),indexof:e("indexOf",null),lastindexof:e("lastIndexOf",null),slice:e("slice",null),reverse:function(e){return"("+t(e[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase","String",0),lower:e("toLowerCase","String",0),substring:e("substring","String"),split:e("split","String"),replace:e("replace","String"),trim:e("trim","String",0),regexp:"RegExp",test:e("test","RegExp"),if:function(e){e.length<3&&i("Missing arguments to if function."),e.length>3&&i("Too many arguments to if function.");var n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function F_(t){var e=(t=t||{}).whitelist?bt(t.whitelist):{},n=t.blacklist?bt(t.blacklist):{},r=t.constants||D_,a=(t.functions||E_)(d),u=t.globalvar,o=t.fieldvar,l={},c={},f=0,h=Y(u)?u:function(t){return u+'["'+t+'"]'};function d(t){if(s(t))return t;var e=p[t.type];return null==e&&i("Unsupported type: "+t.type),e(t)}var p={Literal:function(t){return t.raw},Identifier:function(t){var a=t.name;return f>0?a:K(n,a)?i("Illegal identifier: "+a):K(r,a)?r[a]:K(e,a)?a:(l[a]=1,h(a))},MemberExpression:function(t){var e=!t.computed,n=d(t.object);e&&(f+=1);var r=d(t.property);return n===o&&(c[function(t){var e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(r)]=1),e&&(f-=1),n+(e?"."+r:"["+r+"]")},CallExpression:function(t){"Identifier"!==t.callee.type&&i("Illegal callee type: "+t.callee.type);var e=t.callee.name,n=t.arguments,r=K(a,e)&&a[e];return r||i("Unrecognized function: "+e),Y(r)?r(n):r+"("+n.map(d).join(",")+")"},ArrayExpression:function(t){return"["+t.elements.map(d).join(",")+"]"},BinaryExpression:function(t){return"("+d(t.left)+t.operator+d(t.right)+")"},UnaryExpression:function(t){return"("+t.operator+d(t.argument)+")"},ConditionalExpression:function(t){return"("+d(t.test)+"?"+d(t.consequent)+":"+d(t.alternate)+")"},LogicalExpression:function(t){return"("+d(t.left)+t.operator+d(t.right)+")"},ObjectExpression:function(t){return"{"+t.properties.map(d).join(",")+"}"},Property:function(t){f+=1;var e=d(t.key);return f-=1,e+":"+d(t.value)}};function m(t){var e={code:d(t),globals:Object.keys(l),fields:Object.keys(c)};return l={},c={},e}return m.functions=a,m.constants=r,m}var B_=Object.freeze({__proto__:null,RawCode:"RawCode",Literal:"Literal",Property:"Property",Identifier:"Identifier",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",UnaryExpression:"UnaryExpression",ASTNode:Sy,parse:function(t){Fy=0,By=(Ey=t).length,Ty=null,e_();var e=C_();if(2!==Ty.type)throw new Error("Unexpect token after expression.");return e},codegen:F_,functions:E_,constants:D_});function T_(t,e){for(var n,r,i=e.fields,a=e.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=c.getter||c(r.field),ut(n=r.getter(t))&&(n=k(n)),ut(a[s])&&(a[s]=k(a[s])),ut(a[s][0])&&(a[s]=a[s].map(k)),"E"===r.type){if(u(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!it(n,a[s]))return!1}else if("R-RE"===r.type){if(!it(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!it(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!it(n,a[s],!1,!0))return!1;return!0}var S_={E_union:function(t,e){if(!t.length)return e;for(var n=0,r=e.length;n<r;++n)t.indexOf(e[n])<0&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter((function(t){return e.indexOf(t)>=0})):e},R_union:function(t,e){var n=k(e[0]),r=k(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<r&&(t[1]=r),t):[n,r]},R_intersect:function(t,e){var n=k(e[0]),r=k(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?r<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>r&&(t[1]=r),t):[n,r]}};function N_(t,e,n,r){"Literal"!==e[0].type&&i("First argument to selection functions must be a string literal.");var a=e[0].value,u=":"+a;"intersect"!==(e.length>=2&&M(e).value)||K(r,"@unit")||(r["@unit"]=n.getData(a).indataRef(n,"unit")),K(r,u)||(r[u]=n.getData(a).tuplesRef())}function O_(t){var e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function z_(t){var e=$h(t);return.2126*O_(e.r)+.7152*O_(e.g)+.0722*O_(e.b)}function R_(t,e){var n=z_(t),r=z_(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function U_(t){var e=this.context.data[t];return e?e.values.value:[]}function q_(t,e,n){var r=this.context.data[t]["index:"+e],i=r?r.value.get(n):void 0;return i?i.count:i}function L_(t,e){var n=this.context.dataflow,r=this.context.data[t].input;return n.pulse(r,n.changeset().remove(v).insert(e)),1}function P_(t,e,n){if(t){var r=this.context.dataflow,i=t.mark.source;r.pulse(i,r.changeset().encode(t,e))}return void 0!==n?n:t}var I_={};function j_(t,e,n){var r=t+":"+n,i=I_[r];return i&&i[0]===e||(I_[r]=i=[e,e(n)]),i[1]}function $_(t,e){return j_("format",zp,e)(t)}function H_(t,e){return j_("timeFormat",io,e)(t)}function Y_(t,e){return j_("utcFormat",ao,e)(t)}function V_(t,e){return j_("timeParse",ln,e)(t)}function G_(t,e){return j_("utcParse",fn,e)(t)}var W_=new Date(2e3,0,1);function X_(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(W_.setYear(2e3),W_.setMonth(t),W_.setDate(e),H_(W_,n)):""}function J_(t){return X_(t,1,"%B")}function Z_(t){return X_(t,1,"%b")}function Q_(t){return X_(0,2+t,"%A")}function K_(t){return X_(0,2+t,"%a")}function tb(t,e){var n;return Y(t)?t:s(t)?(n=e.scales[t])&&n.value:void 0}function eb(t,e){var n=tb(t,(e||this).context);return n&&n.range?n.range():[]}function nb(t,e){var n=tb(t,(e||this).context);return n?n.domain():[]}function rb(t,e){var n=tb(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}function ib(t,e,n){return dh(t||0,e||0,n||0)}function ab(t,e){var n=tb(t,(e||this).context);return n?n.copy():void 0}function ub(t,e,n){var r=tb(t,(n||this).context);return r&&void 0!==e?r(e):void 0}function ob(t,e,n){var r=tb(t,(n||this).context);return r?u(e)?(r.invertRange||r.invert)(e):(r.invert||r.invertExtent)(e):void 0}function sb(){return new lb}function lb(){this.reset()}lb.prototype={constructor:lb,reset:function(){this.s=this.t=0},add:function(t){fb(cb,t,this.t),fb(this,cb.s,this.s),this.s?this.t+=cb.t:this.s=cb.t},valueOf:function(){return this.s}};var cb=new lb;function fb(t,e,n){var r=t.s=e+n,i=r-e,a=r-i;t.t=e-a+(n-i)}var hb=Math.PI,db=hb/2,pb=hb/4,mb=2*hb,vb=180/hb,gb=hb/180,yb=Math.abs,_b=Math.atan2,bb=Math.cos,xb=Math.sin,wb=Math.sqrt;function Ab(t){return t>1?db:t<-1?-db:Math.asin(t)}function Mb(){}function kb(t,e){t&&Db.hasOwnProperty(t.type)&&Db[t.type](t,e)}var Cb={Feature:function(t,e){kb(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)kb(n[r].geometry,e)}},Db={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Eb(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Eb(n[r],e,0)},Polygon:function(t,e){Fb(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Fb(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)kb(n[r],e)}};function Eb(t,e,n){var r,i=-1,a=t.length-n;for(e.lineStart();++i<a;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function Fb(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Eb(t[n],e,1);e.polygonEnd()}function Bb(t,e){t&&Cb.hasOwnProperty(t.type)?Cb[t.type](t,e):kb(t,e)}var Tb,Sb,Nb,Ob,zb,Rb=sb(),Ub=sb(),qb={point:Mb,lineStart:Mb,lineEnd:Mb,polygonStart:function(){Rb.reset(),qb.lineStart=Lb,qb.lineEnd=Pb},polygonEnd:function(){var t=+Rb;Ub.add(t<0?mb+t:t),this.lineStart=this.lineEnd=this.point=Mb},sphere:function(){Ub.add(mb)}};function Lb(){qb.point=Ib}function Pb(){jb(Tb,Sb)}function Ib(t,e){qb.point=jb,Tb=t,Sb=e,Nb=t*=gb,Ob=bb(e=(e*=gb)/2+pb),zb=xb(e)}function jb(t,e){var n=(t*=gb)-Nb,r=n>=0?1:-1,i=r*n,a=bb(e=(e*=gb)/2+pb),u=xb(e),o=zb*u,s=Ob*a+o*bb(i),l=o*r*xb(i);Rb.add(_b(l,s)),Nb=t,Ob=a,zb=u}function $b(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}var Hb,Yb,Vb,Gb,Wb,Xb,Jb,Zb,Qb,Kb,tx,ex,nx,rx,ix,ax,ux,ox,sx,lx,cx,fx,hx,dx,px,mx,vx=sb(),gx={point:yx,lineStart:bx,lineEnd:xx,polygonStart:function(){gx.point=wx,gx.lineStart=Ax,gx.lineEnd=Mx,vx.reset(),qb.polygonStart()},polygonEnd:function(){qb.polygonEnd(),gx.point=yx,gx.lineStart=bx,gx.lineEnd=xx,Rb<0?(Hb=-(Vb=180),Yb=-(Gb=90)):vx>1e-6?Gb=90:vx<-1e-6&&(Yb=-90),Kb[0]=Hb,Kb[1]=Vb},sphere:function(){Hb=-(Vb=180),Yb=-(Gb=90)}};function yx(t,e){Qb.push(Kb=[Hb=t,Vb=t]),e<Yb&&(Yb=e),e>Gb&&(Gb=e)}function _x(t,e){var n,r,i=function(t){var e=t[0],n=t[1],r=bb(n);return[r*bb(e),r*xb(e),xb(n)]}([t*gb,e*gb]);if(Zb){var a=$b(Zb,i),u=$b([a[1],-a[0],0],a);r=wb((n=u)[0]*n[0]+n[1]*n[1]+n[2]*n[2]),n[0]/=r,n[1]/=r,n[2]/=r,u=function(t){return[_b(t[1],t[0]),Ab(t[2])]}(u);var o,s=t-Wb,l=s>0?1:-1,c=u[0]*vb*l,f=yb(s)>180;f^(l*Wb<c&&c<l*t)?(o=u[1]*vb)>Gb&&(Gb=o):f^(l*Wb<(c=(c+360)%360-180)&&c<l*t)?(o=-u[1]*vb)<Yb&&(Yb=o):(e<Yb&&(Yb=e),e>Gb&&(Gb=e)),f?t<Wb?kx(Hb,t)>kx(Hb,Vb)&&(Vb=t):kx(t,Vb)>kx(Hb,Vb)&&(Hb=t):Vb>=Hb?(t<Hb&&(Hb=t),t>Vb&&(Vb=t)):t>Wb?kx(Hb,t)>kx(Hb,Vb)&&(Vb=t):kx(t,Vb)>kx(Hb,Vb)&&(Hb=t)}else Qb.push(Kb=[Hb=t,Vb=t]);e<Yb&&(Yb=e),e>Gb&&(Gb=e),Zb=i,Wb=t}function bx(){gx.point=_x}function xx(){Kb[0]=Hb,Kb[1]=Vb,gx.point=yx,Zb=null}function wx(t,e){if(Zb){var n=t-Wb;vx.add(yb(n)>180?n+(n>0?360:-360):n)}else Xb=t,Jb=e;qb.point(t,e),_x(t,e)}function Ax(){qb.lineStart()}function Mx(){wx(Xb,Jb),qb.lineEnd(),yb(vx)>1e-6&&(Hb=-(Vb=180)),Kb[0]=Hb,Kb[1]=Vb,Zb=null}function kx(t,e){return(e-=t)<0?e+360:e}function Cx(t,e){return t[0]-e[0]}function Dx(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var Ex={sphere:Mb,point:Fx,lineStart:Tx,lineEnd:Ox,polygonStart:function(){Ex.lineStart=zx,Ex.lineEnd=Rx},polygonEnd:function(){Ex.lineStart=Tx,Ex.lineEnd=Ox}};function Fx(t,e){t*=gb;var n=bb(e*=gb);Bx(n*bb(t),n*xb(t),xb(e))}function Bx(t,e,n){++tx,nx+=(t-nx)/tx,rx+=(e-rx)/tx,ix+=(n-ix)/tx}function Tx(){Ex.point=Sx}function Sx(t,e){t*=gb;var n=bb(e*=gb);dx=n*bb(t),px=n*xb(t),mx=xb(e),Ex.point=Nx,Bx(dx,px,mx)}function Nx(t,e){t*=gb;var n=bb(e*=gb),r=n*bb(t),i=n*xb(t),a=xb(e),u=_b(wb((u=px*a-mx*i)*u+(u=mx*r-dx*a)*u+(u=dx*i-px*r)*u),dx*r+px*i+mx*a);ex+=u,ax+=u*(dx+(dx=r)),ux+=u*(px+(px=i)),ox+=u*(mx+(mx=a)),Bx(dx,px,mx)}function Ox(){Ex.point=Fx}function zx(){Ex.point=Ux}function Rx(){qx(fx,hx),Ex.point=Fx}function Ux(t,e){fx=t,hx=e,t*=gb,e*=gb,Ex.point=qx;var n=bb(e);dx=n*bb(t),px=n*xb(t),mx=xb(e),Bx(dx,px,mx)}function qx(t,e){t*=gb;var n=bb(e*=gb),r=n*bb(t),i=n*xb(t),a=xb(e),u=px*a-mx*i,o=mx*r-dx*a,s=dx*i-px*r,l=wb(u*u+o*o+s*s),c=Ab(l),f=l&&-c/l;sx+=f*u,lx+=f*o,cx+=f*s,ex+=c,ax+=c*(dx+(dx=r)),ux+=c*(px+(px=i)),ox+=c*(mx+(mx=a)),Bx(dx,px,mx)}function Lx(t,e){return function(n,r,i){if(n){var a=tb(n,(i||this).context);return a&&a.path[t](r)}return e(r)}}var Px=Lx("area",(function(t){return Ub.reset(),Bb(t,qb),2*Ub})),Ix=Lx("bounds",(function(t){var e,n,r,i,a,u,o;if(Gb=Vb=-(Hb=Yb=1/0),Qb=[],Bb(t,gx),n=Qb.length){for(Qb.sort(Cx),e=1,a=[r=Qb[0]];e<n;++e)Dx(r,(i=Qb[e])[0])||Dx(r,i[1])?(kx(r[0],i[1])>kx(r[0],r[1])&&(r[1]=i[1]),kx(i[0],r[1])>kx(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(u=-1/0,e=0,r=a[n=a.length-1];e<=n;r=i,++e)i=a[e],(o=kx(r[1],i[0]))>u&&(u=o,Hb=i[0],Vb=r[1])}return Qb=Kb=null,Hb===1/0||Yb===1/0?[[NaN,NaN],[NaN,NaN]]:[[Hb,Yb],[Vb,Gb]]})),jx=Lx("centroid",(function(t){tx=ex=nx=rx=ix=ax=ux=ox=sx=lx=cx=0,Bb(t,Ex);var e=sx,n=lx,r=cx,i=e*e+n*n+r*r;return i<1e-12&&(e=ax,n=ux,r=ox,ex<1e-6&&(e=nx,n=rx,r=ix),(i=e*e+n*n+r*r)<1e-12)?[NaN,NaN]:[_b(n,e)*vb,Ab(r/wb(i))*vb]}));function $x(t){var e=this.context.group,n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n}function Hx(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function Yx(){return Hx(this.context.dataflow,"warn",arguments)}function Vx(){return Hx(this.context.dataflow,"info",arguments)}function Gx(){return Hx(this.context.dataflow,"debug",arguments)}function Wx(){var t=[].slice.call(arguments);return t.unshift({}),X.apply(null,t)}function Xx(t,e){return t===e||t!=t&&e!=e||(u(t)?!(!u(e)||t.length!==e.length)&&function(t,e){for(var n=0,r=t.length;n<r;++n)if(!Xx(t[n],e[n]))return!1;return!0}(t,e):!(!o(t)||!o(e))&&Jx(t,e))}function Jx(t,e){for(var n in t)if(!Xx(t[n],e[n]))return!1;return!0}function Zx(t){return e=>Jx(t,e)}function Qx(t,e,n,r,i,a){var o,s,l=this.context.dataflow,c=this.context.data[t],f=c.input,h=c.changes,d=l.stamp();if(!1===l._trigger||!(f.value.length||e||r))return 0;if((!h||h.stamp<d)&&(c.changes=h=l.changeset(),h.stamp=d,l.runAfter((function(){c.modified=!0,l.pulse(f,h).run()}),!0,1)),n&&(o=!0===n?v:u(n)||Et(n)?n:Zx(n),h.remove(o)),e&&h.insert(e),r&&(o=Zx(r),f.value.some(o)?h.remove(o):h.insert(r)),i)for(s in a)h.modify(i,s,a[s]);return 1}function Kx(t){var e=t.touches,n=e[0].clientX-e[1].clientX,r=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+r*r)}function tw(t){var e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)}function ew(t,e,n,r,i){t=tb(t,(i||this).context);var a=$o(e,n),u=t.domain(),o=u[0],s=M(u),l=d;return s-o?l=Nm(t,o,s):t=(t.interpolator?bm("sequential")().interpolator(t.interpolator()):bm("linear")().interpolate(t.interpolate()).range(t.range())).domain([o=0,s=1]),t.ticks&&(o!==(u=t.ticks(+r||15))[0]&&u.unshift(o),s!==M(u)&&u.push(s)),u.forEach(e=>a.stop(l(e),t(e))),a}function nw(t,e,n){var r=tb(t,(n||this).context);return function(t){return r?r.path.context(t)(e):""}}function rw(t){var e=null;return function(n){return n?Al(n,e=e||hl(t)):t}}var iw={};function aw(t){return t.data}function uw(t,e){var n=U_.call(e,t);return n.root&&n.root.lookup||iw}function ow(t,e,n){var r=uw(t,this),i=r[e],a=r[n];return i&&a?i.path(a).map(aw):void 0}function sw(t,e){var n=uw(t,this)[e];return n?n.ancestors().map(aw):void 0}var lw="undefined"!=typeof window&&window||null;function cw(){return lw?lw.screen:{}}function fw(){return lw?[lw.innerWidth,lw.innerHeight]:[void 0,void 0]}function hw(){var t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]}function dw(t,e,n,r){"Literal"!==e[0].type&&i("First argument to data functions must be a string literal.");var a=e[0].value,u=":"+a;if(!K(u,r))try{r[u]=n.getData(a).tuplesRef()}catch(t){}}function pw(t,e,n,r){"Literal"!==e[0].type&&i("First argument to indata must be a string literal."),"Literal"!==e[1].type&&i("Second argument to indata must be a string literal.");var a=e[0].value,u=e[1].value,o="@"+u;K(o,r)||(r[o]=n.getData(a).indataRef(n,u))}function mw(t,e,n,r){if("Literal"===e[0].type)vw(n,r,e[0].value);else if("Identifier"===e[0].type)for(t in n.scales)vw(n,r,t)}function vw(t,e,n){var r="%"+n;if(!K(e,r))try{e[r]=t.scaleRef(n)}catch(t){}}var gw={random:function(){return t.random()},cumulativeNormal:Ni,cumulativeLogNormal:Li,cumulativeUniform:Yi,densityNormal:Si,densityLogNormal:qi,densityUniform:Hi,quantileNormal:Oi,quantileLogNormal:Pi,quantileUniform:Vi,sampleNormal:Ti,sampleLogNormal:Ui,sampleUniform:$i,isArray:u,isBoolean:at,isDate:ut,isDefined:function(t){return void 0!==t},isNumber:ot,isObject:o,isRegExp:st,isString:s,isTuple:Et,isValid:function(t){return null!=t&&t==t},toBoolean:vt,toDate:yt,toNumber:k,toString:_t,flush:nt,lerp:ct,merge:Wx,pad:pt,peek:M,span:mt,inrange:it,truncate:xt,rgb:$h,lab:rd,hcl:cd,hsl:Jh,luminance:z_,contrast:R_,sequence:li,format:$_,utcFormat:Y_,utcParse:G_,utcOffset:Qu,utcSequence:eo,timeFormat:H_,timeParse:V_,timeOffset:Zu,timeSequence:to,timeUnitSpecifier:ro,monthFormat:J_,monthAbbrevFormat:Z_,dayFormat:Q_,dayAbbrevFormat:K_,quarter:I,utcquarter:j,week:Du,utcweek:Nu,dayofyear:Cu,utcdayofyear:Su,warn:Yx,info:Vx,debug:Gx,extent:J,inScope:$x,intersect:function(t,e,n){if(!t)return[];var[r,i]=t,a=(new Uo).set(r[0],r[1],i[0],i[1]);return Rv(n||this.context.dataflow.scenegraph().root,a,function(t){var e=null;if(t){var n=$(t.marktype),r=$(t.markname);e=t=>(!n.length||n.some(e=>t.marktype===e))&&(!r.length||r.some(e=>t.name===e))}return e}(e))},clampRange:H,pinchDistance:Kx,pinchAngle:tw,screen:cw,containerSize:hw,windowSize:fw,bandspace:ib,setdata:L_,pathShape:rw,panLinear:S,panLog:N,panPow:O,panSymlog:z,zoomLinear:U,zoomLog:q,zoomPow:L,zoomSymlog:P,encode:P_,modify:Qx},yw=["view","item","group","xy","x","y"],_w={};function bw(t,e,n){return 1===arguments.length?gw[t]:(gw[t]=e,n&&(_w[t]=n),ww&&(ww.functions[t]="this."+t),this)}bw("bandwidth",rb,mw),bw("copy",ab,mw),bw("domain",nb,mw),bw("range",eb,mw),bw("invert",ob,mw),bw("scale",ub,mw),bw("gradient",ew,mw),bw("geoArea",Px,mw),bw("geoBounds",Ix,mw),bw("geoCentroid",jx,mw),bw("geoShape",nw,mw),bw("indata",q_,pw),bw("data",U_,dw),bw("treePath",ow,dw),bw("treeAncestors",sw,dw),bw("vlSelectionTest",(function(t,e,n){for(var r,i,a,u,o,s=this.context.data[t],l=s?s.values.value:[],c=s?s["index:unit"]&&s["index:unit"].value:void 0,f="intersect"===n,h=l.length,d=0;d<h;++d)if(r=l[d],c&&f){if(-1===(a=(i=i||{})[u=r.unit]||0))continue;if(o=T_(e,r),i[u]=o?-1:++a,o&&1===c.size)return!0;if(!o&&a===c.get(u).count)return!1}else if(f^(o=T_(e,r)))return o;return h&&f}),N_),bw("vlSelectionResolve",(function(t,e,n){for(var r,i,a,u,o,s,l,c,f,h,d,p=this.context.data[t],m=p?p.values.value:[],v={},g={},y={},_=m.length,b=0;b<_;++b){for(u=(r=m[b]).unit,i=r.fields,a=r.values,h=0,d=i.length;h<d;++h)o=i[h],l=(s=v[o.field]||(v[o.field]={}))[u]||(s[u]=[]),y[o.field]=c=o.type.charAt(0),f=S_[c+"_union"],s[u]=f(l,$(a[h]));n&&(l=g[u]||(g[u]=[])).push($(a).reduce((t,e,n)=>(t[i[n].field]=e,t),{}))}return e=e||"union",Object.keys(v).forEach((function(t){v[t]=Object.keys(v[t]).map(e=>v[t][e]).reduce((n,r)=>void 0===n?r:S_[y[t]+"_"+e](n,r))})),m=Object.keys(g),n&&m.length&&(v.vlMulti="union"===e?{or:m.reduce((t,e)=>(t.push.apply(t,g[e]),t),[])}:{and:m.map(t=>({or:g[t]}))}),v}),N_);var xw={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(t){return"_["+l("$"+t)+"]"},functions:function(t){var e=E_(t);for(var n in yw.forEach(t=>e[t]="event.vega."+t),gw)e[n]="this."+n;return e},constants:D_,visitors:_w},ww=F_(xw),Aw=Object.freeze({__proto__:null,codegenParams:xw,codeGenerator:ww,expressionFunction:bw,functionContext:gw,data:U_,indata:q_,setdata:L_,encode:P_,format:$_,utcFormat:Y_,timeFormat:H_,utcParse:G_,timeParse:V_,monthFormat:J_,monthAbbrevFormat:Z_,dayFormat:Q_,dayAbbrevFormat:K_,geoArea:Px,geoBounds:Ix,geoCentroid:jx,inScope:$x,warn:Yx,info:Vx,debug:Gx,luminance:z_,contrast:R_,merge:Wx,modify:Qx,pinchDistance:Kx,pinchAngle:tw,DataPrefix:":",IndexPrefix:"@",ScalePrefix:"%",SignalPrefix:"$",range:eb,domain:nb,bandwidth:rb,bandspace:ib,copy:ab,scale:ub,invert:ob,scaleGradient:ew,geoShape:nw,pathShape:rw,treePath:ow,treeAncestors:sw,containerSize:hw,screen:cw,windowSize:fw,dataVisitor:dw,indataVisitor:pw,scaleVisitor:mw,formatLocale:Pp,timeFormatLocale:Ar});function Mw(t,e,n){";"!==e[e.length-1]&&(e="return("+e+");");var r=Function.apply(null,t.concat(e));return n&&n.functions?r.bind(n.functions):r}function kw(t,e){return Mw(["event"],t,e)}function Cw(t,e){return Mw(["item","_"],t,e)}function Dw(t,e,n){var r,i;for(r in n=n||{},t)i=t[r],n[r]=u(i)?i.map((function(t){return Ew(t,e,n)})):Ew(i,e,n);return n}function Ew(t,e,n){if(!t||!o(t))return t;for(var r,i=0,a=Fw.length;i<a;++i)if(K(t,(r=Fw[i]).key))return r.parse(t,e,n);return t}var Fw=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||i("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){var n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=lt(t.$key,t.$flat))}},{key:"$expr",parse:function(t,n,r){t.$params&&Dw(t.$params,n,r);var i="e:"+t.$expr+"_"+t.$name;return n.fn[i]||(n.fn[i]=e(function(t,e){return Mw(["datum","_"],t,e)}(t.$expr,n),t.$fields,t.$name))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;var n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=c(t.$field,t.$name))}},{key:"$encode",parse:function(t,n){var r,i,a=t.$encode,u={};for(r in a)i=a[r],u[r]=e(Cw(i.$expr,n),i.$fields),u[r].output=i.$output;return u}},{key:"$compare",parse:function(t,e){var n="c:"+t.$compare+"_"+t.$order,r=$(t.$compare).map((function(t){return t&&t.$tupleid?Ft:t}));return e.fn[n]||(e.fn[n]=V(r,t.$order))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){var n=t.$subflow;return function(t,r,i){var a=Nw(n,e.fork()),u=a.get(n.operators[0].id),o=a.signals.parent;return o&&o.set(i),u}}},{key:"$tupleid",parse:function(){return Ft}}];function Bw(t){return(t+"").toLowerCase()}function Tw(t,e){!function(t){return"operator"===Bw(t)}(t.type)&&t.type?e.transform(t,t.type):e.operator(t,t.update?function(t,e){return Mw(["_"],t,e)}(t.update,e):null)}function Sw(t,e){var n=o(n=t.source)?n.$ref:n,r=e.get(n),a=null,u=t.update,s=void 0;r||i("Source not defined: "+t.source),a=t.target&&t.target.$expr?kw(t.target.$expr,e):e.get(t.target),u&&u.$expr&&(u.$params&&(s=Dw(u.$params,e)),u=function(t,e){return Mw(["_","event"],t,e)}(u.$expr,e)),e.update(t,r,a,u,s)}function Nw(t,e){var n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),n.forEach((function(t){Tw(t,e)})),n.forEach((function(t){!function(t,e){if(t.params){var n=e.get(t.id);n||i("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(Dw(t.params,e),t.react,t.initonly))}}(t,e)})),(t.streams||[]).forEach((function(t){!function(t,e){var n,r=null!=t.filter?kw(t.filter,e):void 0,a=null!=t.stream?e.get(t.stream):void 0;t.source?a=e.events(t.source,t.type,r):t.merge&&(a=(n=t.merge.map(e.get.bind(e)))[0].merge.apply(n[0],n.slice(1))),t.between&&(n=t.between.map(e.get.bind(e)),a=a.between(n[0],n[1])),t.filter&&(a=a.filter(r)),null!=t.throttle&&(a=a.throttle(+t.throttle)),null!=t.debounce&&(a=a.debounce(+t.debounce)),null==a&&i("Invalid stream definition: "+JSON.stringify(t)),t.consume&&a.consume(!0),e.stream(t,a)}(t,e)})),(t.updates||[]).forEach((function(t){Sw(t,e)})),e.resolve()}var Ow={skip:!0};function zw(t,e,n){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function Rw(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.functions=t.functions,this.events=t.events,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}function Uw(t,e,n){return Nw(e,function(t,e,n){return new zw(t,e,n)}(t,Gr,n||gw))}zw.prototype=Rw.prototype={fork:function(){var t=new Rw(this);return(this.subcontext||(this.subcontext=[])).push(t),t},get:function(t){return this.nodes[t]},set:function(t,e){return this.nodes[t]=e},add:function(t,e){var n,r=this,i=r.dataflow;if(r.set(t.id,e),function(t){return"collect"===Bw(t)}(t.type)&&(n=t.value)&&(n.$ingest?i.ingest(e,n.$ingest,n.$format):n.$request?i.preload(e,n.$request,n.$format):i.pulse(e,i.changeset().insert(n))),t.root&&(r.root=e),t.parent){var a=r.get(t.parent.$ref);a?(i.connect(a,[e]),e.targets().add(a)):(r.unresolved=r.unresolved||[]).push((function(){a=r.get(t.parent.$ref),i.connect(a,[e]),e.targets().add(a)}))}if(t.signal&&(r.signals[t.signal]=e),t.scale&&(r.scales[t.scale]=e),t.data)for(var u in t.data)n=r.data[u]||(r.data[u]={}),t.data[u].forEach((function(t){n[t]=e}))},resolve:function(){return(this.unresolved||[]).forEach((function(t){t()})),delete this.unresolved,this},operator:function(t,e){this.add(t,this.dataflow.add(t.value,e))},transform:function(t,e){this.add(t,this.dataflow.add(this.transforms[Bw(e)]))},stream:function(t,e){this.set(t.id,e)},update:function(t,e,n,r,i){this.dataflow.on(e,n,r,i,t.options)},getState:function(t){var e=this,n={};if(t.signals){var r=n.signals={};Object.keys(e.signals).forEach((function(n){var i=e.signals[n];t.signals(n,i)&&(r[n]=i.value)}))}if(t.data){var i=n.data={};Object.keys(e.data).forEach((function(n){var r=e.data[n];t.data(n,r)&&(i[n]=r.input.value)}))}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map((function(e){return e.getState(t)}))),n},setState:function(t){var e=this,n=e.dataflow,r=t.data,i=t.signals;Object.keys(i||{}).forEach((function(t){n.update(e.signals[t],i[t],Ow)})),Object.keys(r||{}).forEach((function(t){n.pulse(e.data[t].input,n.changeset().remove(v).insert(r[t]))})),(t.subcontext||[]).forEach((function(t,n){var r=e.subcontext[n];r&&r.setState(t)}))}};var qw={skip:!0};function Lw(t,e){var n=t.autosize(),r=t.padding();return e-(n&&"padding"===n.contains?r.left+r.right:0)}function Pw(t,e){var n=t.autosize(),r=t.padding();return e-(n&&"padding"===n.contains?r.top+r.bottom:0)}function Iw(t,e){return e.modified&&u(e.input.value)&&t.indexOf("_:vega:_")}function jw(t,e){return!("parent"===t||e instanceof Gr.proxy)}var $w,Hw,Yw=0,Vw=0,Gw=0,Ww=0,Xw=0,Jw=0,Zw="object"==typeof performance&&performance.now?performance:Date,Qw="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Kw(){return Xw||(Qw(tA),Xw=Zw.now()+Jw)}function tA(){Xw=0}function eA(){this._call=this._time=this._next=null}function nA(){Xw=(Ww=Zw.now())+Jw,Yw=Vw=0;try{!function(){Kw(),++Yw;for(var t,e=$w;e;)(t=Xw-e._time)>=0&&e._call.call(null,t),e=e._next;--Yw}()}finally{Yw=0,function(){var t,e,n=$w,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:$w=e);Hw=t,iA(r)}(),Xw=0}}function rA(){var t=Zw.now(),e=t-Ww;e>1e3&&(Jw-=e,Ww=t)}function iA(t){Yw||(Vw&&(Vw=clearTimeout(Vw)),t-Xw>24?(t<1/0&&(Vw=setTimeout(nA,t-Zw.now()-Jw)),Gw&&(Gw=clearInterval(Gw))):(Gw||(Ww=Zw.now(),Gw=setInterval(rA,1e3)),Yw=1,Qw(nA)))}function aA(t,e,n,r){var i=t.element();i&&i.setAttribute("title",function(t){return null==t?"":u(t)?uA(t):o(t)&&!ut(t)?(e=t,Object.keys(e).map((function(t){var n=e[t];return t+": "+(u(n)?uA(n):oA(n))})).join("\n")):t+"";var e}(r))}function uA(t){return"["+t.map(oA).join(", ")+"]"}function oA(t){return u(t)?"[
]":o(t)&&!ut(t)?"{
}":t}function sA(t,e){e=e||{},jr.call(this),e.loader&&this.loader(e.loader),e.logger&&this.logger(e.logger),null!=e.logLevel&&this.logLevel(e.logLevel),this._el=null,this._elBind=null,this._renderType=e.renderer||Nv.Canvas,this._scenegraph=new Pf;var n=this._scenegraph.root;this._renderer=null,this._tooltip=e.tooltip||aA,this._redraw=!0,this._handler=(new th).scene(n),this._preventDefault=!1,this._timers=[],this._eventListeners=[],this._resizeListeners=[],this._eventConfig=function(t){var e=X({defaults:{}},t),n=(t,e)=>{e.forEach(e=>{u(t[e])&&(t[e]=bt(t[e]))})};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig);var r=Uw(this,t,e.functions);this._runtime=r,this._signals=r.signals,this._bind=(t.bindings||[]).map((function(t){return{state:null,param:X({},t)}})),r.root&&r.root.set(n),n.source=r.data.root.input,this.pulse(r.data.root.input,this.changeset().insert(n.items)),this._width=this.width(),this._height=this.height(),this._viewWidth=Lw(this,this._width),this._viewHeight=Pw(this,this._height),this._origin=[0,0],this._resize=0,this._autosize=1,function(t){var e=t._signals,n=e.width,r=e.height,i=e.padding;function a(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(function(e){t._width=e.size,t._viewWidth=Lw(t,e.size),a()}),{size:n}),t._resizeHeight=t.add(null,(function(e){t._height=e.size,t._viewHeight=Pw(t,e.size),a()}),{size:r});var u=t.add(null,a,{pad:i});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=r.rank+1,u.rank=i.rank+1}(this),function(t){t.add(null,e=>(t._background=e.bg,t._resize=1,e.bg),{bg:t._signals.background})}(this),ey(this),this.description(t.description),e.hover&&this.hover(),e.container&&this.initialize(e.container,e.bind)}eA.prototype=function(t,e,n){var r=new eA;return r.restart(t,e,n),r}.prototype={constructor:eA,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Kw():+n)+(null==e?0:+e),this._next||Hw===this||(Hw?Hw._next=this:$w=this,Hw=this),this._call=t,this._time=n,iA()},stop:function(){this._call&&(this._call=null,this._time=1/0,iA())}};var lA=rt(sA,jr);function cA(t,e){return K(t._signals,e)?t._signals[e]:i("Unrecognized signal name: "+l(e))}function fA(t,e){var n=(t._targets||[]).filter((function(t){var n=t._update;return n&&n.handler===e}));return n.length?n[0]:null}function hA(t,e,n,r){var i=fA(n,r);return i||((i=wy(this,(function(){r(e,n.value)}))).handler=r,t.on(n,null,i)),t}function dA(t,e,n){var r=fA(e,n);return r&&e._targets.remove(r),t}lA.evaluate=async function(t,e,n){if(await jr.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(t){var e=uy(t),n=iy(t),r=ay(t);t._renderer.background(t.background()),t._renderer.resize(n,r,e),t._handler.origin(e),t._resizeListeners.forEach((function(e){try{e(n,r)}catch(e){t.error(e)}}))}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(t){this.error(t)}return n&&kt(this,n),this},lA.dirty=function(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},lA.description=function(t){if(arguments.length){var e=null!=t?t+"":null;return e!==this._desc&&ty(this._el,this._desc=e),this}return this._desc},lA.container=function(){return this._el},lA.scenegraph=function(){return this._scenegraph},lA.origin=function(){return this._origin.slice()},lA.signal=function(t,e,n){var r=cA(this,t);return 1===arguments.length?r.value:this.update(r,e,n)},lA.width=function(t){return arguments.length?this.signal("width",t):this.signal("width")},lA.height=function(t){return arguments.length?this.signal("height",t):this.signal("height")},lA.padding=function(t){return arguments.length?this.signal("padding",ky(t)):ky(this.signal("padding"))},lA.autosize=function(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},lA.background=function(t){return arguments.length?this.signal("background",t):this.signal("background")},lA.renderer=function(t){return arguments.length?(zv(t)||i("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},lA.tooltip=function(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},lA.loader=function(t){return arguments.length?(t!==this._loader&&(jr.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},lA.resize=function(){return this._autosize=1,this.touch(cA(this,"autosize"))},lA._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},lA._resizeView=function(t,e,n,r,i,a){this.runAfter((function(u){var o=0;u._autosize=0,u.width()!==n&&(o=1,u.signal("width",n,qw),u._resizeWidth.skip(!0)),u.height()!==r&&(o=1,u.signal("height",r,qw),u._resizeHeight.skip(!0)),u._viewWidth!==t&&(u._resize=1,u._viewWidth=t),u._viewHeight!==e&&(u._resize=1,u._viewHeight=e),u._origin[0]===i[0]&&u._origin[1]===i[1]||(u._resize=1,u._origin=i),o&&u.run("enter"),a&&u.runAfter(t=>t.resize())}),!1,1)},lA.addEventListener=function(t,e,n){var r=e;return n&&!1===n.trap||((r=wy(this,e)).raw=e),this._handler.on(t,r),this},lA.removeEventListener=function(t,e){for(var n,r,i=this._handler.handlers(t),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,t===r&&(e===n||e===n.raw)){this._handler.off(r,n);break}return this},lA.addResizeListener=function(t){var e=this._resizeListeners;return e.indexOf(t)<0&&e.push(t),this},lA.removeResizeListener=function(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},lA.addSignalListener=function(t,e){return hA(this,t,cA(this,t),e)},lA.removeSignalListener=function(t,e){return dA(this,cA(this,t),e)},lA.addDataListener=function(t,e){return hA(this,t,ny(this,t).values,e)},lA.removeDataListener=function(t,e){return dA(this,ny(this,t).values,e)},lA.preventDefault=function(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},lA.timer=function(t,e){this._timers.push(function(t,e,n){var r=new eA,i=e;return null==e?(r.restart(t,e,n),r):(e=+e,n=null==n?Kw():+n,r.restart((function a(u){u+=i,r.restart(a,i+=e,n),t(u)}),e,n),r)}((function(e){t({timestamp:Date.now(),elapsed:e})}),e))},lA.events=function(t,e,n){var r,i=this,a=new Gt(n),u=function(n,r){i.runAsync(null,()=>{"view"===t&&function(t,e){var n=t._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[e]:i?!i[e]:t.preventDefault()))}(i,e)&&n.preventDefault(),a.receive(oy(i,n,r))})};if("timer"===t)ly(i,"timer",e)&&i.timer(u,e);else if("view"===t)ly(i,"view",e)&&i.addEventListener(e,u,sy);else if("window"===t?ly(i,"window",e)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&ly(i,"selector",e)&&(r=document.querySelectorAll(t)),r){for(var o=0,s=r.length;o<s;++o)r[o].addEventListener(e,u);i._eventListeners.push({type:e,sources:r,handler:u})}else i.warn("Can not resolve event source: "+t);return a},lA.finalize=function(){var t,e,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(t=i.length;--t>=0;)i[t].stop();for(t=a.length;--t>=0;)for(e=(n=a[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},lA.hover=function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","mouseover",cy),fy,hy(t)),this.on(this.events("view","mouseout",cy),fy,hy(e)),this},lA.data=function(t,e){return arguments.length<2?ny(this,t).values.value:ry.call(this,t,Ut().remove(v).insert(e))},lA.change=ry,lA.insert=function(t,e){return ry.call(this,t,Ut().insert(e))},lA.remove=function(t,e){return ry.call(this,t,Ut().remove(e))},lA.scale=function(t){var e=this._runtime.scales;return K(e,t)||i("Unrecognized scale or projection: "+t),e[t].value},lA.initialize=function(t,e){var n=this,r=n._renderType,i=n._eventConfig.bind,a=zv(r);t=n._el=t?Ay(n,t):null,function(t){var e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),ty(e,t.description()))}(n),a||n.error("Unrecognized renderer type: "+r);var u=a.handler||th,o=t?a.renderer:a.headless;return n._renderer=o?xy(n,n._renderer,t,o):null,n._handler=function(t,e,n,r){var i=new r(t.loader(),wy(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,uy(t),t);return e&&e.handlers().forEach((function(t){i.on(t.type,t.handler)})),i}(n,n._handler,t,u),n._redraw=!0,t&&"none"!==i&&(e=e?n._elBind=Ay(n,e):t.appendChild(dy("form",{class:"vega-bindings"})),n._bind.forEach((function(t){t.param.element&&"container"!==i&&(t.element=Ay(n,t.param.element))})),n._bind.forEach((function(t){py(n,t.element||e,t)}))),n},lA.toImageURL=async function(t,e){t!==Nv.Canvas&&t!==Nv.SVG&&t!==Nv.PNG&&i("Unrecognized image type: "+t);var n=await Cy(this,t,e);return t===Nv.SVG?function(t,e){var n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},lA.toCanvas=async function(t,e){return(await Cy(this,Nv.Canvas,t,e)).canvas()},lA.toSVG=async function(t){return(await Cy(this,Nv.SVG,t)).svg()},lA.getState=function(t){return this._runtime.getState(t||{data:Iw,signals:jw,recurse:!0})},lA.setState=function(t){return this.runAsync(null,e=>{e._trigger=!1,e._runtime.setState(t)},t=>{t._trigger=!0}),this};var pA,mA,vA="view",gA=/[[\]{}]/,yA={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function _A(t,e,n,r,i){for(var a,u=0,o=t.length;e<o;++e){if(a=t[e],!u&&a===n)return e;i&&i.indexOf(a)>=0?--u:r&&r.indexOf(a)>=0&&++u}return e}function bA(t){for(var e=[],n=0,r=t.length,i=0;i<r;)i=_A(t,i,",","[{","]}"),e.push(t.substring(n,i).trim()),n=++i;if(0===e.length)throw"Empty event selector: "+t;return e}function xA(t){return"["===t[0]?function(t){var e,n,r=t.length,i=1;if((i=_A(t,i,"]","[","]"))===r)throw"Empty between selector: "+t;if(2!==(e=bA(t.substring(1,i))).length)throw"Between selector must have two elements: "+t;if(">"!==(t=t.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+t;if(e=e.map(xA),(n=xA(t.slice(1).trim())).between)return{between:e,stream:n};n.between=e;return n}(t):function(t){var e,n,r={source:pA},i=[],a=[0,0],u=0,o=0,s=t.length,l=0;if("}"===t[s-1]){if(!((l=t.lastIndexOf("{"))>=0))throw"Unmatched right brace: "+t;try{a=function(t){var e=t.split(",");if(!t.length||e.length>2)throw t;return e.map((function(e){var n=+e;if(n!=n)throw t;return n}))}(t.substring(l+1,s-1))}catch(e){throw"Invalid throttle specification: "+t}t=t.slice(0,l).trim(),s=t.length,l=0}if(!s)throw t;"@"===t[0]&&(u=++l);(e=_A(t,l,":"))<s&&(i.push(t.substring(o,e).trim()),o=l=++e);if((l=_A(t,l,"["))===s)i.push(t.substring(o,s).trim());else if(i.push(t.substring(o,l).trim()),n=[],(o=++l)===s)throw"Unmatched left bracket: "+t;for(;l<s;){if((l=_A(t,l,"]"))===s)throw"Unmatched left bracket: "+t;if(n.push(t.substring(o,l).trim()),l<s-1&&"["!==t[++l])throw"Expected left bracket: "+t;o=++l}if(!(s=i.length)||gA.test(i[s-1]))throw"Invalid event selector: "+t;s>1?(r.type=i[1],u?r.markname=i[0].slice(1):!function(t){return mA[t]}(i[0])?r.source=i[0]:r.marktype=i[0]):r.type=i[0];"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1));null!=n&&(r.filter=n);a[0]&&(r.throttle=a[0]);a[1]&&(r.debounce=a[1]);return r}(t)}var wA=Object.freeze({__proto__:null,selector:function(t,e,n){return pA=e||vA,mA=n||yA,bA(t.trim()).map(xA)}});return X(Gr,To,Mg,Kg),t.Bounds=Uo,t.CanvasHandler=th,t.CanvasRenderer=ah,t.Dataflow=jr,t.Debug=4,t.Error=1,t.EventStream=Gt,t.Gradient=$o,t.GroupItem=Yo,t.Handler=Xf,t.Info=3,t.Item=Ho,t.Marks=Nf,t.MultiPulse=Rr,t.None=0,t.Operator=$t,t.Parameters=Lt,t.Pulse=Tr,t.RenderType=Nv,t.Renderer=Qf,t.ResourceLoader=Wo,t.SVGHandler=ch,t.SVGRenderer=hv,t.SVGStringRenderer=Cv,t.Scenegraph=Pf,t.TIME_UNITS=xu,t.Transform=Yr,t.View=sA,t.Warn=2,t.accessor=e,t.accessorFields=r,t.accessorName=n,t.array=$,t.bandwidthNRD=Mi,t.bin=ki,t.bootstrapCI=Ci,t.boundClip=Iv,t.boundContext=nc,t.boundItem=Of,t.boundMark=Rf,t.boundStroke=Zl,t.changeset=Ut,t.clampRange=H,t.closeTag=sv,t.compare=V,t.constant=G,t.cumulativeLogNormal=Li,t.cumulativeNormal=Ni,t.cumulativeUniform=Yi,t.dayofyear=Cu,t.debounce=W,t.definition=Wr,t.densityLogNormal=qi,t.densityNormal=Si,t.densityUniform=Hi,t.domChild=Yf,t.domClear=Vf,t.domCreate=$f,t.domFind=Hf,t.dotbin=Di,t.error=i,t.expressionFunction=bw,t.extend=X,t.extent=J,t.extentIndex=Z,t.falsy=g,t.fastmap=et,t.field=c,t.flush=nt,t.font=Df,t.fontFamily=Cf,t.fontSize=xf,t.format=Te,t.formats=Se,t.hasOwnProperty=K,t.id=h,t.identity=d,t.inferType=se,t.inferTypes=le,t.ingest=Tt,t.inherits=rt,t.inrange=it,t.intersect=Rv,t.intersectBoxLine=gc,t.intersectPath=dc,t.intersectPoint=pc,t.intersectRule=vc,t.isArray=u,t.isBoolean=at,t.isDate=ut,t.isFunction=Y,t.isNumber=ot,t.isObject=o,t.isRegExp=st,t.isString=s,t.isTuple=Et,t.key=lt,t.lerp=ct,t.lineHeight=wf,t.loader=kr,t.logger=_,t.lruCache=ft,t.merge=ht,t.mergeConfig=x,t.multiLineOffset=Mf,t.one=m,t.openTag=ov,t.pad=pt,t.panLinear=S,t.panLog=N,t.panPow=O,t.panSymlog=z,t.pathCurves=ll,t.pathEqual=$v,t.pathParse=hl,t.pathRectangle=Rl,t.pathRender=Al,t.pathSymbols=Dl,t.pathTrail=Ul,t.peek=M,t.point=Wf,t.quantileLogNormal=Pi,t.quantileNormal=Oi,t.quantileUniform=Vi,t.quantiles=wi,t.quarter=I,t.quartiles=Ai,t.randomInteger=function(e,n){null==n&&(n=e,e=0);var r,i,a,u={};return u.min=function(t){return arguments.length?(a=i-(r=t||0),u):r},u.max=function(t){return arguments.length?(a=(i=t||0)-r,u):i},u.sample=function(){return r+Math.floor(a*t.random())},u.pdf=function(t){return t===Math.floor(t)&&t>=r&&t<i?1/a:0},u.cdf=function(t){var e=Math.floor(t);return e<r?0:e>=i?1:(e-r+1)/a},u.icdf=function(t){return t>=0&&t<=1?r-1+Math.floor(t*a):NaN},u.min(e).max(n)},t.randomKDE=Ri,t.randomLCG=function(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}},t.randomLogNormal=Ii,t.randomMixture=ji,t.randomNormal=zi,t.randomUniform=Gi,t.read=Mr,t.regressionExp=function(t,e,n){var r,i,a,[u,o,s,l]=Xi(t,e,n),c=0,f=0,h=0,d=0,p=0;Ji(t,e,n,(t,e)=>{r=u[p++],i=Math.log(e),c+=(e*i-c)/p,f+=((a=r*e)-f)/p,h+=(a*i-h)/p,d+=(r*a-d)/p});var[m,v]=Wi(f/l,c/l,h/l,d/l),g=t=>Math.exp(m+v*(t-s));return{coef:[Math.exp(m-v*s),v],predict:g,rSquared:Zi(t,e,n,l,g)}},t.regressionLinear=Qi,t.regressionLoess=function(t,e,n,r){for(var[i,a,u,o]=Xi(t,e,n,!0),s=i.length,l=Math.max(2,~~(r*s)),c=new Float64Array(s),f=new Float64Array(s),h=new Float64Array(s).fill(1),d=-1;++d<=2;){for(var p=[0,l-1],m=0;m<s;++m){for(var v=i[m],g=p[0],y=p[1],_=v-i[g]>i[y]-v?g:y,b=0,x=0,w=0,A=0,M=0,k=1/Math.abs(i[_]-v||1),C=g;C<=y;++C){var D=i[C],E=a[C],F=ea(Math.abs(v-D)*k)*h[C],B=D*F;b+=F,x+=B,w+=E*F,A+=E*B,M+=D*B}var[T,S]=Wi(x/b,w/b,A/b,M/b);c[m]=T+S*v,f[m]=Math.abs(a[m]-c[m]),na(i,m+1,p)}if(2===d)break;var N=xi(f);if(Math.abs(N)<1e-12)break;for(var O,z,R=0;R<s;++R)O=f[R]/(6*N),h[R]=O>=1?1e-12:(z=1-O*O)*z}return function(t,e,n,r){for(var i,a=t.length,u=[],o=0,s=0,l=[];o<a;++o)i=t[o]+n,l[0]===i?l[1]+=(e[o]-l[1])/++s:(s=0,l[1]+=r,l=[i,e[o]],u.push(l));return l[1]+=r,u}(i,c,u,o)},t.regressionLog=function(t,e,n){var r=0,i=0,a=0,u=0,o=0;Ji(t,e,n,(t,e)=>{++o,t=Math.log(t),r+=(t-r)/o,i+=(e-i)/o,a+=(t*e-a)/o,u+=(t*t-u)/o});var s=Wi(r,i,a,u),l=t=>s[0]+s[1]*Math.log(t);return{coef:s,predict:l,rSquared:Zi(t,e,n,i,l)}},t.regressionPoly=function(t,e,n,r){if(1===r)return Qi(t,e,n);if(2===r)return Ki(t,e,n);var i,a,u,o,s,[l,c,f,h]=Xi(t,e,n),d=l.length,p=[],m=[],v=r+1;for(i=0;i<v;++i){for(u=0,o=0;u<d;++u)o+=Math.pow(l[u],i)*c[u];for(p.push(o),s=new Float64Array(v),a=0;a<v;++a){for(u=0,o=0;u<d;++u)o+=Math.pow(l[u],i+a);s[a]=o}m.push(s)}m.push(p);var g=function(t){var e,n,r,i,a,u=t.length-1,o=[];for(e=0;e<u;++e){for(i=e,n=e+1;n<u;++n)Math.abs(t[e][n])>Math.abs(t[e][i])&&(i=n);for(r=e;r<u+1;++r)a=t[r][e],t[r][e]=t[r][i],t[r][i]=a;for(n=e+1;n<u;++n)for(r=u;r>=e;r--)t[r][n]-=t[r][e]*t[e][n]/t[e][e]}for(n=u-1;n>=0;--n){for(a=0,r=n+1;r<u;++r)a+=t[r][n]*o[r];o[n]=(t[u][n]-a)/t[n][n]}return o}(m),y=t=>{t-=f;var e=h+g[0]+g[1]*t+g[2]*t*t;for(i=3;i<v;++i)e+=g[i]*Math.pow(t,i);return e};return{coef:ta(v,g,-f,h),predict:y,rSquared:Zi(t,e,n,h,y)}},t.regressionPow=function(t,e,n){var r=0,i=0,a=0,u=0,o=0,s=0;Ji(t,e,n,(t,e)=>{var n=Math.log(t),l=Math.log(e);++s,r+=(n-r)/s,i+=(l-i)/s,a+=(n*l-a)/s,u+=(n*n-u)/s,o+=(e-o)/s});var l=Wi(r,i,a,u),c=t=>l[0]*Math.pow(t,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:Zi(t,e,n,o,c)}},t.regressionQuad=Ki,t.renderModule=zv,t.repeat=dt,t.resetSVGClipId=function(){Hc=1},t.responseType=Ne,t.sampleCurve=ia,t.sampleLogNormal=Ui,t.sampleNormal=Ti,t.sampleUniform=$i,t.sceneEqual=jv,t.sceneFromJSON=Lf,t.scenePickVisit=Ec,t.sceneToJSON=qf,t.sceneVisit=Dc,t.sceneZOrder=Cc,t.setRandom=function(e){t.random=e},t.span=mt,t.splitAccessPath=a,t.stringValue=l,t.textMetrics=mf,t.timeBin=vo,t.timeFloor=ju,t.timeFormat=io,t.timeInterval=Wu,t.timeOffset=Zu,t.timeSequence=to,t.timeUnitSpecifier=ro,t.timeUnits=Au,t.toBoolean=vt,t.toDate=yt,t.toNumber=k,t.toSet=bt,t.toString=_t,t.transform=Xr,t.transforms=Gr,t.truncate=xt,t.truthy=v,t.tupleid=Ft,t.typeParsers=ae,t.utcFloor=Yu,t.utcFormat=ao,t.utcInterval=Xu,t.utcOffset=Qu,t.utcSequence=eo,t.utcdayofyear=Su,t.utcquarter=j,t.utcweek=Nu,t.vegaDataflow=Jr,t.vegaEventSelector=wA,t.vegaExpression=B_,t.vegaFunctions=Aw,t.vegaScale=Qm,t.vegaUtil=At,t.version="5.11.1",t.visitArray=wt,t.week=Du,t.writeConfig=w,t.zero=p,t.zoomLinear=U,t.zoomLog=q,t.zoomPow=L,t.zoomSymlog=P,t}({});
var vegaParser=function(e,t,n,i,a,r,o){"use strict";function l(e){return t.isObject(e)?e:{type:e||"pad"}}var s=e=>+e||0;function u(e){return t.isObject(e)?e.signal?e:{top:s(e.top),bottom:s(e.bottom),left:s(e.left),right:s(e.right)}:{top:n=s(e),bottom:n,left:n,right:n};var n}var d=["value","update","init","react","bind"];function c(e,n){t.error(e+' for "outer" push: '+t.stringValue(n))}function f(e,t){var n=e.name;if("outer"===e.push)t.signals[n]||c("No prior signal definition",n),d.forEach((function(t){void 0!==e[t]&&c("Invalid property ",t)}));else{var i=t.addSignal(n,e.value);!1===e.react&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function p(e,a,r){var o,l,s={};try{e=t.isString(e)?e:t.stringValue(e)+"",o=n.parse(e)}catch(n){t.error("Expression parse error: "+e)}return o.visit((function(e){if(e.type===n.CallExpression){var t=e.callee.name,r=i.codegenParams.visitors[t];r&&r(t,e.arguments,a,s)}})),(l=i.codeGenerator(o)).globals.forEach((function(e){var n=i.SignalPrefix+e;!t.hasOwnProperty(s,n)&&a.getSignal(e)&&(s[n]=a.signalRef(e))})),{$expr:r?r+"return("+l.code+");":l.code,$fields:l.fields,$params:s}}function g(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function m(e,t,n,i){return new g(e,t,n,i)}function h(e,t){return m("operator",e,t)}function y(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function v(e,t){return t?{$field:e,$name:t}:{$field:e}}var b=v("key");function x(e,t){return{$compare:e,$order:t}}function k(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function S(e){return e&&e.signal}function $(e){if(S(e))return!0;if(t.isObject(e))for(var n in e)if($(e[n]))return!0;return!1}function O(e,t){return null!=e?e:t}function R(e){return e&&e.signal||e}function w(e,n){return(e.merge?j:e.stream?z:e.type?V:t.error("Invalid stream specification: "+t.stringValue(e)))(e,n)}function j(e,t){var n=P({merge:e.merge.map(e=>w(e,t))},e,t);return t.addStream(n).id}function z(e,t){var n=P({stream:w(e.stream,t)},e,t);return t.addStream(n).id}function V(e,t){var n,i,a;return"timer"===e.type?(n=t.event("timer",e.throttle),e={between:e.between,filter:e.filter}):n=t.event("scope"===(a=e.source)?"view":a||"view",e.type),i=P({stream:n},e,t),1===Object.keys(i).length?n:t.addStream(i).id}function P(e,n,i){var a,r,o,l,s=n.between;return s&&(2!==s.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[w(s[0],i),w(s[1],i)]),s=n.filter?[].concat(n.filter):[],(n.marktype||n.markname||n.markrole)&&s.push((a=n.marktype,r=n.markname,o=n.markrole,(l="event.item")+(a&&"*"!==a?"&&"+l+".mark.marktype==='"+a+"'":"")+(o?"&&"+l+".mark.role==='"+o+"'":"")+(r?"&&"+l+".mark.name==='"+r+"'":""))),"scope"===n.source&&s.push("inScope(event.item)"),s.length&&(e.filter=p("("+s.join(")&&(")+")").$expr),null!=(s=n.throttle)&&(e.throttle=+s),null!=(s=n.debounce)&&(e.debounce=+s),n.consume&&(e.consume=!0),e}var D="var datum=event.item&&event.item.datum;";function C(e,n,i){var r=e.events,o=e.update,l=e.encode,s=[],u={target:i};r||t.error("Signal update missing events specification."),t.isString(r)&&(r=a.selector(r,n.isSubscope()?"scope":"view")),r=t.array(r).filter(e=>e.signal||e.scale?(s.push(e),0):1),s.length>1&&(s=[W(s)]),r.length&&s.push(r.length>1?{merge:r}:r[0]),null!=l&&(o&&t.error("Signal encode and update are mutually exclusive."),o="encode(item(),"+t.stringValue(l)+")"),u.update=t.isString(o)?p(o,n,D):null!=o.expr?p(o.expr,n,D):null!=o.value?o.value:null!=o.signal?{$expr:"_.value",$params:{value:n.signalRef(o.signal)}}:t.error("Invalid signal update specification."),e.force&&(u.options={force:!0}),s.forEach((function(e){n.addUpdate(t.extend(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):w(e,t)}}(e,n),u))}))}function W(e){return{signal:"["+e.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}function _(e){return function(t,n,i){return m(e,n,t||void 0,i)}}var E=_("aggregate"),F=_("axisticks"),L=_("bound"),A=_("collect"),T=_("compare"),B=_("datajoin"),U=_("encode"),M=_("expression"),H=_("facet"),q=_("field"),I=_("key"),N=_("legendentries"),X=_("load"),Y=_("mark"),G=_("multiextent"),Q=_("multivalues"),J=_("overlap"),K=_("params"),Z=_("prefacet"),ee=_("projection"),te=_("proxy"),ne=_("relay"),ie=_("render"),ae=_("scale"),re=_("sieve"),oe=_("sortitems"),le=_("viewlayout"),se=_("values"),ue=0,de={min:"min",max:"max",count:"sum"};function ce(e,n){var i,a,o=n.getScale(e.name).params;for(i in o.domain=me(e.domain,e,n),null!=e.range&&(o.range=function e(n,i,a){var o=n.range,l=i.config.range;if(o.signal)return i.signalRef(o.signal);if(t.isString(o)){if(l&&t.hasOwnProperty(l,o))return n=t.extend({},n,{range:l[o]}),e(n,i,a);"width"===o?o=[0,{signal:"width"}]:"height"===o?o=r.isDiscrete(n.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(o))}else{if(o.scheme)return a.scheme=t.isArray(o.scheme)?pe(o.scheme,i):fe(o.scheme,i),o.extent&&(a.schemeExtent=pe(o.extent,i)),void(o.count&&(a.schemeCount=fe(o.count,i)));if(o.step)return void(a.rangeStep=fe(o.step,i));if(r.isDiscrete(n.type)&&!t.isArray(o))return me(o,n,i);t.isArray(o)||t.error("Unsupported range type: "+t.stringValue(o))}return o.map(e=>(t.isArray(e)?pe:fe)(e,i))}(e,n,o)),null!=e.interpolate&&function(e,t){t.interpolate=fe(e.type||e),null!=e.gamma&&(t.interpolateGamma=fe(e.gamma))}(e.interpolate,o),null!=e.nice&&(o.nice=(a=e.nice,t.isObject(a)?{interval:fe(a.interval),step:fe(a.step)}:fe(a))),null!=e.bins&&(o.bins=function(e,n){return e.signal||t.isArray(e)?pe(e,n):n.objectProperty(e)}(e.bins,n)),e)t.hasOwnProperty(o,i)||"name"===i||(o[i]=fe(e[i],n))}function fe(e,n){return t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function pe(e,t){return e.signal?t.signalRef(e.signal):e.map(e=>fe(e,t))}function ge(e){t.error("Can not find data set: "+t.stringValue(e))}function me(e,n,i){if(e)return e.signal?i.signalRef(e.signal):(t.isArray(e)?he:e.fields?ve:ye)(e,n,i);null==n.domainMin&&null==n.domainMax||t.error("No scale domain defined for domainMin/domainMax to override.")}function he(e,t,n){return e.map((function(e){return fe(e,n)}))}function ye(e,t,n){var i=n.getData(e.data);return i||ge(e.data),r.isDiscrete(t.type)?i.valuesRef(n,e.field,xe(e.sort,!1)):r.isQuantile(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function ve(e,n,i){var a=e.data,o=e.fields.reduce((function(e,n){return n=t.isString(n)?{data:a,field:n}:t.isArray(n)||n.signal?function(e,n){var i="_:vega:_"+ue++,a=A({});if(t.isArray(e))a.value={$ingest:e};else if(e.signal){var r="setdata("+t.stringValue(i)+","+e.signal+")";a.params.input=n.signalRef(r)}return n.addDataPipeline(i,[a,re({})]),{data:i,field:"data"}}(n,i):n,e.push(n),e}),[]);return(r.isDiscrete(n.type)?be:r.isQuantile(n.type)?ke:Se)(e,i,o)}function be(e,t,n){var i,a,r,o,l,s=xe(e.sort,!0);return i=n.map((function(e){var n=t.getData(e.data);return n||ge(e.data),n.countsRef(t,e.field,s)})),a={groupby:b,pulse:i},s&&(r=s.op||"count",l=s.field?k(r,s.field):"count",a.ops=[de[r]],a.fields=[t.fieldRef(l)],a.as=[l]),r=t.add(E(a)),o=t.add(A({pulse:y(r)})),l=t.add(se({field:b,sort:t.sortRef(s),pulse:y(o)})),y(l)}function xe(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field&&e.op&&!de[e.op]&&t.error("Multiple domain scales can not be sorted using "+e.op):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function ke(e,t,n){var i=n.map((function(e){var n=t.getData(e.data);return n||ge(e.data),n.domainRef(t,e.field)}));return y(t.add(Q({values:i})))}function Se(e,t,n){var i=n.map((function(e){var n=t.getData(e.data);return n||ge(e.data),n.extentRef(t,e.field)}));return y(t.add(G({extents:i})))}function $e(e,n,i){return t.isArray(e)?e.map((function(e){return $e(e,n,i)})):t.isObject(e)?e.signal?i.signalRef(e.signal):"fit"===n?e:t.error("Unsupported parameter object: "+t.stringValue(e)):e}var Oe="top",Re="left",we="value",je=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],ze={name:1,style:1,interactive:1},Ve={value:0},Pe={value:1},De=t.toSet(["rule"]),Ce=t.toSet(["group","image","rect"]);function We(e,n,i,a){var r=p(e,n);return r.$fields.forEach((function(e){a[e]=1})),t.extend(i,r.$params),r.$expr}function _e(e,n,i,a){return function e(n,i,a,r){var o,l,s;if(n.signal)o="datum",s=We(n.signal,i,a,r);else if(n.group||n.parent){for(l=Math.max(1,n.level||1),o="item";l-- >0;)o+=".mark.group";n.parent?(s=n.parent,o+=".datum"):s=n.group}else n.datum?(o="datum",s=n.datum):t.error("Invalid field reference: "+t.stringValue(n));n.signal||(t.isString(s)?(r[s]=1,s=t.splitAccessPath(s).map(t.stringValue).join("][")):s=e(s,i,a,r));return o+"["+s+"]"}(t.isObject(e)?e:{datum:e},n,i,a)}function Ee(e,n,i,a){return t.isObject(e)?"("+Ae(null,e,n,i,a)+")":e}function Fe(e,n,i,a,r){var o,l,s,u=Le(e.scale,i,a,r);return null!=e.range?(l=u+".range()",n=0===(o=+e.range)?l+"[0]":"($="+l+","+(1===o?"$[$.length-1]":"$[0]+"+o+"*($[$.length-1]-$[0])")+")"):(void 0!==n&&(n=u+"("+n+")"),e.band&&(s=function(e,n){if(!t.isString(e))return-1;var i=n.scaleType(e);return"band"===i||"point"===i?1:0}(e.scale,i))&&(l=u+".bandwidth",o=e.band.signal?l+"()*"+Ee(e.band,i,a,r):l+"()"+(1===(o=+e.band)?"":"*"+o),s<0&&(o="("+l+"?"+o+":0)"),n=(n?n+"+":"")+o,e.extra&&(n="(datum.extra?"+u+"(datum.extra.value):"+n+")")),null==n&&(n="0")),n}function Le(e,n,a,r){var o;if(t.isString(e))o=i.ScalePrefix+e,t.hasOwnProperty(a,o)||(a[o]=n.scaleRef(e)),o=t.stringValue(o);else{for(o in n.scales)a[i.ScalePrefix+o]=n.scaleRef(o);o=t.stringValue(i.ScalePrefix)+"+"+(e.signal?"("+We(e.signal,n,a,r)+")":_e(e,n,a,r))}return"_["+o+"]"}function Ae(e,n,i,a,r){if(null!=n.gradient)return function(e,n,i,a){return"this.gradient("+Le(e.gradient,n,i,a)+","+t.stringValue(e.start)+","+t.stringValue(e.stop)+","+t.stringValue(e.count)+")"}(n,i,a,r);var o=n.signal?We(n.signal,i,a,r):n.color?function(e,t,n,i){function a(e,a,r,o){return"this."+e+"("+[Ae(null,a,t,n,i),Ae(null,r,t,n,i),Ae(null,o,t,n,i)].join(",")+").toString()"}return e.c?a("hcl",e.h,e.c,e.l):e.h||e.s?a("hsl",e.h,e.s,e.l):e.l||e.a?a("lab",e.l,e.a,e.b):e.r||e.g||e.b?a("rgb",e.r,e.g,e.b):null}(n.color,i,a,r):null!=n.field?_e(n.field,i,a,r):void 0!==n.value?t.stringValue(n.value):void 0;return null!=n.scale&&(o=Fe(n,o,i,a,r)),void 0===o&&(o=null),null!=n.exponent&&(o="Math.pow("+o+","+Ee(n.exponent,i,a,r)+")"),null!=n.mult&&(o+="*"+Ee(n.mult,i,a,r)),null!=n.offset&&(o+="+"+Ee(n.offset,i,a,r)),n.round&&(o="Math.round("+o+")"),o}function Te(e,n,i){var a=e+"["+t.stringValue(n)+"]";return`$=${i};if(${a}!==$)${a}=$,m=1;`}function Be(e,n,i,a,r){var o="";return n.forEach((function(e){var t=Ae(0,e,i,a,r);o+=e.test?We(e.test,i,a,r)+"?"+t+":":t})),":"===t.peek(o)&&(o+="null"),Te("o",e,o)}function Ue(e,n,i,a){var r,o,l={},s="var o=item,datum=o.datum,m=0,$;";for(r in e)o=e[r],t.isArray(o)?s+=Be(r,o,a,i,l):s+=Te("o",r,Ae(0,o,a,i,l));return s+=function(e,t){var n="";return De[t]||(e.x2&&(e.x?(Ce[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(Ce[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(e,n),{$expr:s+="return m;",$fields:Object.keys(l),$output:Object.keys(e)}}function Me(e){return t.isObject(e)&&!t.isArray(e)?t.extend({},e):{value:e}}function He(e,n,i,a){return null!=i?(t.isObject(i)&&!t.isArray(i)?e.update[n]=i:e[a||"enter"][n]={value:i},1):0}function qe(e,t,n){for(var i in t)He(e,i,t[i]);for(var a in n)He(e,a,n[a],"update")}function Ie(e,n,i){for(var a in n)i&&t.hasOwnProperty(i,a)||(e[a]=t.extend(e[a]||{},n[a]));return e}function Ne(e,n,i,a,r,o){var l,s;for(s in(o=o||{}).encoders={$encode:l={}},e=function(e,n,i,a,r){var o,l,s,u={},d={};l="lineBreak","text"!==n||null==r[l]||Ye(l,e)||Xe(u,l,r[l]);("legend"==i||String(i).startsWith("axis"))&&(i=null);for(l in s="frame"===i?r.group:"mark"===i?t.extend({},r.mark,r[n]):null)Ye(l,e)||("fill"===l||"stroke"===l)&&(Ye("fill",e)||Ye("stroke",e))||Xe(u,l,s[l]);for(l in t.array(a).forEach((function(t){var n=r.style&&r.style[t];for(var i in n)Ye(i,e)||Xe(u,i,n[i])})),e=t.extend({},e),u)(s=u[l]).signal?(o=o||{})[l]=s:d[l]=s;e.enter=t.extend(d,e.enter),o&&(e.update=t.extend(o,e.update));return e}(e,n,i,a,r.config))l[s]=Ue(e[s],n,o,r);return o}function Xe(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}function Ye(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}function Ge(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Ie(e.encode,t,ze)):e.interactive=!1,e}function Qe(e,t){var n=(n,i)=>O(e[n],O(t[n],i));return n.isVertical=n=>"vertical"===O(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>O(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>O(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>O(e.columns,O(t.columns,+n.isVertical(!0))),n}function Je(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Ke(e,t,n){return`item.anchor === "start" ? ${e} : item.anchor === "end" ? ${t} : ${n}`}var Ze=Ke(t.stringValue(Re),t.stringValue("right"),t.stringValue("center"));function et(e,n){return n?e?t.isObject(e)?{...e,offset:et(e.offset,n)}:{value:e,offset:n}:n:e}function tt(e,n,i,a){var r,o,l,s,u,d,c=Qe(e,i),f=c.isVertical(),p=c.gradientThickness(),g=c.gradientLength();return f?(l=[0,1],s=[0,0],u=p,d=g):(l=[0,0],s=[1,0],u=g,d=p),qe(r={enter:o={opacity:Ve,x:Ve,y:Ve,width:Me(u),height:Me(d)},update:t.extend({},o,{opacity:Pe,fill:{gradient:n,start:l,stop:s}}),exit:{opacity:Ve}},{stroke:c("gradientStrokeColor"),strokeWidth:c("gradientStrokeWidth")},{opacity:c("gradientOpacity")}),Ge({type:"rect",role:"legend-gradient",encode:r},a)}function nt(e,n,i,a,r){var o,l,s,u,d,c,f=Qe(e,i),p=f.isVertical(),g=f.gradientThickness(),m=f.gradientLength(),h="";return p?(s="y",d="y2",u="x",c="width",h="1-"):(s="x",d="x2",u="y",c="height"),(l={opacity:Ve,fill:{scale:n,field:we}})[s]={signal:h+"datum.perc",mult:m},l[u]=Ve,l[d]={signal:h+"datum.perc2",mult:m},l[c]=Me(g),qe(o={enter:l,update:t.extend({},l,{opacity:Pe}),exit:{opacity:Ve}},{stroke:f("gradientStrokeColor"),strokeWidth:f("gradientStrokeWidth")},{opacity:f("gradientOpacity")}),Ge({type:"rect",role:"legend-band",key:we,from:r,encode:o},a)}function it(e,t,n,i){var a,r,o,l,s,u=Qe(e,t),d=u.isVertical(),c=Me(u.gradientThickness()),f=u.gradientLength(),p=u("labelOverlap"),g="";return qe(a={enter:r={opacity:Ve},update:o={opacity:Pe,text:{field:"label"}},exit:{opacity:Ve}},{fill:u("labelColor"),fillOpacity:u("labelOpacity"),font:u("labelFont"),fontSize:u("labelFontSize"),fontStyle:u("labelFontStyle"),fontWeight:u("labelFontWeight"),limit:O(e.labelLimit,t.gradientLabelLimit)}),d?(r.align={value:"left"},r.baseline=o.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},l="y",s="x",g="1-"):(r.align=o.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},r.baseline={value:"top"},l="x",s="y"),r[l]=o[l]={signal:g+"datum.perc",mult:f},r[s]=o[s]=c,c.offset=O(e.labelOffset,t.gradientLabelOffset)||0,p=p?{separation:u("labelSeparation"),method:p,order:"datum.index"}:void 0,Ge({type:"text",role:"legend-label",style:"guide-label",key:we,from:i,encode:a,overlap:p},n)}function at(e){return e.type="group",e.interactive=e.interactive||!1,e}function rt(e,t,n,i,a){var r,o,l,s,u,d,c,f=Qe(e,t),p=n.entries,g=!(!p||!p.interactive),m=p?p.name:void 0,h=f("clipHeight"),y=f("symbolOffset"),v={data:"value"},b={},x=`(${a}) ? datum.offset : datum.size`,k=h?Me(h):{field:"size"},S="datum.index",$=`max(1, ${a})`;k.mult=.5,b={enter:r={opacity:Ve,x:{signal:x,mult:.5,offset:y},y:k},update:o={opacity:Pe,x:r.x,y:r.y},exit:{opacity:Ve}};var O=null,R=null;return e.fill||(O=t.symbolBaseFillColor,R=t.symbolBaseStrokeColor),qe(b,{fill:f("symbolFillColor",O),shape:f("symbolType"),size:f("symbolSize"),stroke:f("symbolStrokeColor",R),strokeDash:f("symbolDash"),strokeDashOffset:f("symbolDashOffset"),strokeWidth:f("symbolStrokeWidth")},{opacity:f("symbolOpacity")}),je.forEach((function(t){e[t]&&(o[t]=r[t]={scale:e[t],field:we})})),s=Ge({type:"symbol",role:"legend-symbol",key:we,from:v,clip:!!h||void 0,encode:b},n.symbols),(l=Me(y)).offset=f("labelOffset"),qe(b={enter:r={opacity:Ve,x:{signal:x,offset:l},y:k},update:o={opacity:Pe,text:{field:"label"},x:r.x,y:r.y},exit:{opacity:Ve}},{align:f("labelAlign"),baseline:f("labelBaseline"),fill:f("labelColor"),fillOpacity:f("labelOpacity"),font:f("labelFont"),fontSize:f("labelFontSize"),fontStyle:f("labelFontStyle"),fontWeight:f("labelFontWeight"),limit:f("labelLimit")}),u=Ge({type:"text",role:"legend-label",style:"guide-label",key:we,from:v,encode:b},n.labels),b={enter:{noBound:{value:!h},width:Ve,height:h?Me(h):Ve,opacity:Ve},exit:{opacity:Ve},update:o={opacity:Pe,row:{signal:null},column:{signal:null}}},f.isVertical(!0)?(d=`ceil(item.mark.items.length / ${$})`,o.row.signal=`${S}%${d}`,o.column.signal=`floor(${S} / ${d})`,c={field:["row",S]}):(o.row.signal=`floor(${S} / ${$})`,o.column.signal=`${S} % ${$}`,c={field:S}),o.column.signal=`(${a})?${o.column.signal}:${S}`,at({role:"scope",from:i={facet:{data:i,name:"value",groupby:"index"}},encode:Ie(b,p,ze),marks:[s,u],name:m,interactive:g,sort:c})}var ot='item.orient === "left"',lt='item.orient === "right"',st=`(${ot} || ${lt})`,ut="datum.vgrad && "+st,dt=Ke('"top"','"bottom"','"middle"'),ct=`datum.vgrad && ${lt} ? (${Ke('"right"','"left"','"center"')}) : (${st} && !(datum.vgrad && ${ot})) ? "left" : ${Ze}`,ft=`item._anchor || (${st} ? "middle" : "start")`,pt=`${ut} ? (${ot} ? -90 : 90) : 0`,gt=`${st} ? (datum.vgrad ? (${lt} ? "bottom" : "top") : ${dt}) : "top"`;function mt(e,n){var i;return t.isObject(e)&&(e.signal?i=e.signal:e.path?i="pathShape("+ht(e.path)+")":e.sphere&&(i="geoShape("+ht(e.sphere)+', {type: "Sphere"})')),i?n.signalRef(i):!!e}function ht(e){return t.isObject(e)&&e.signal?e.signal:t.stringValue(e)}function yt(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?"group"===e.type?"scope":t||"mark":t}function vt(e){return{marktype:e.type,name:e.name||void 0,role:e.role||yt(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function bt(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function xt(e,n){var i=o.definition(e.type);i||t.error("Unrecognized transform type: "+t.stringValue(e.type));var a=m(i.type.toLowerCase(),null,kt(i,e,n));return e.signal&&n.addSignal(e.signal,n.proxy(a)),a.metadata=i.metadata||{},a}function kt(e,t,n){var i,a,r,o={};for(a=0,r=e.params.length;a<r;++a)o[(i=e.params[a]).name]=St(i,t,n);return o}function St(e,n,i){var a=e.type,r=n[e.name];return"index"===a?function(e,n,i){t.isString(n.from)||t.error('Lookup "from" parameter must be a string literal.');return i.getData(n.from).lookupRef(i,n.key)}(0,n,i):void 0!==r?"param"===a?function(e,n,i){var a=n[e.name];return e.array?(t.isArray(a)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(a)),a.map((function(t){return Ot(e,t,i)}))):Ot(e,a,i)}(e,n,i):"projection"===a?i.projectionRef(n[e.name]):e.array&&!S(r)?r.map((function(t){return $t(e,t,i)})):$t(e,r,i):void(e.required&&t.error("Missing required "+t.stringValue(n.type)+" parameter: "+t.stringValue(e.name)))}function $t(e,n,i){var a=e.type;if(S(n))return Rt(a)?t.error("Expression references can not be signals."):wt(a)?i.fieldRef(n):jt(a)?i.compareRef(n):i.signalRef(n.signal);var r,o=e.expr||wt(a);return o&&((r=n)&&r.expr)?i.exprRef(n.expr,n.as):o&&function(e){return e&&e.field}(n)?v(n.field,n.as):Rt(a)?p(n,i):function(e){return"data"===e}(a)?y(i.getData(n).values):wt(a)?v(n):jt(a)?i.compareRef(n):n}function Ot(e,n,i){var a,r,o,l,s;for(l=0,s=e.params.length;l<s;++l){for(o in(r=e.params[l]).key)if(r.key[o]!==n[o]){r=null;break}if(r)break}return r||t.error("Unsupported parameter: "+t.stringValue(n)),a=t.extend(kt(r,n,i),r.key),y(i.add(K(a)))}function Rt(e){return"expr"===e}function wt(e){return"field"===e}function jt(e){return"compare"===e}function zt(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:y(t.getData(e.data).output)}function Vt(e,t,n,i,a){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=a,this.index={}}Vt.fromEntries=function(e,t){var n=t.length,i=1,a=t[0],r=t[n-1],o=t[n-2],l=null;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);i<n;++i)t[i].params.pulse=y(t[i-1]),e.add(t[i]),"aggregate"===t[i].type&&(l=t[i]);return new Vt(e,a,o,r,l)};var Pt=Vt.prototype;function Dt(e){return t.isString(e)?e:null}function Ct(e,t,n){var i,a=k(n.op,n.field);if(t.ops){for(var r=0,o=t.as.length;r<o;++r)if(t.as[r]===a)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(a))}function Wt(e,n,i,a,r,o,l){var s,u,d=n[i]||(n[i]={}),c=function(e){return t.isObject(e)?("descending"===e.order?"-":"+")+k(e.op,e.field):""}(o),f=Dt(r);if(null!=f&&(e=n.scope,s=d[f+=c?"|"+c:""]),!s){var p=o?{field:b,pulse:n.countsRef(e,r,o)}:{field:e.fieldRef(r),pulse:y(n.output)};c&&(p.sort=e.sortRef(o)),u=e.add(m(a,void 0,p)),l&&(n.index[r]=u),s=y(u),null!=f&&(d[f]=s)}return s}function _t(e,t,n){var i,a=e.remove,r=e.insert,o=e.toggle,l=e.modify,s=e.values,u=t.add(h());i=p("if("+e.trigger+',modify("'+n+'",'+[r,a,o,l,s].map((function(e){return null==e?"null":e})).join(",")+"),0)",t),u.update=i.$expr,u.params=i.$params}function Et(e,n){var i,a,r,o,l,s,u,d,c,f,p,g,m,h,b=yt(e),x="group"===e.type,k=e.from&&e.from.facet,$=e.layout||"scope"===b||"frame"===b,O="mark"===b||$||k,R=e.overlap;r=function(e,n,i){var a,r,o,l,s;return e?(a=e.facet)&&(n||t.error("Only group marks can be faceted."),null!=a.field?l=s=zt(a,i):(e.data?s=y(i.getData(e.data).aggregate):((o=xt(t.extend({type:"aggregate",groupby:t.array(a.groupby)},a.aggregate),i)).params.key=i.keyRef(a.groupby),o.params.pulse=zt(a,i),l=s=y(i.add(o))),r=i.keyRef(a.groupby,!0))):l=y(i.add(A(null,[{}]))),l||(l=zt(e,i)),{key:r,pulse:l,parent:s}}(e.from,x,n),f=y(a=n.add(B({key:r.key||(e.key?v(e.key):void 0),pulse:r.pulse,clean:!x}))),a=o=n.add(A({pulse:f})),a=n.add(Y({markdef:vt(e),interactive:bt(e.interactive,n),clip:mt(e.clip,n),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:y(a)})),p=y(a),(a=l=n.add(U(Ne(e.encode,e.type,b,e.style,n,{mod:!1,pulse:p})))).params.parent=n.encode(),e.transform&&e.transform.forEach((function(e){var i=xt(e,n),r=i.metadata;(r.generates||r.changes)&&t.error("Mark transforms should not generate new data."),r.nomod||(l.params.mod=!0),i.params.pulse=y(a),n.add(a=i)})),e.sort&&(a=n.add(oe({sort:n.compareRef(e.sort),pulse:y(a)}))),g=y(a),(k||$)&&(m=y($=n.add(le({layout:n.objectProperty(e.layout),legends:n.legends,mark:p,pulse:g})))),h=y(s=n.add(L({mark:p,pulse:m||g}))),x&&(O&&((i=n.operators).pop(),$&&i.pop()),n.pushState(g,m||h,f),k?function(e,n,i){var a,r,o,l,s=e.from.facet,u=s.name,d=zt(s,n);s.name||t.error("Facet must have a name: "+t.stringValue(s)),s.data||t.error("Facet must reference a data set: "+t.stringValue(s)),s.field?l=n.add(Z({field:n.fieldRef(s.field),pulse:d})):s.groupby?l=n.add(H({key:n.keyRef(s.groupby),group:y(n.proxy(i.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(s)),r=(a=n.fork()).add(A()),o=a.add(re({pulse:y(r)})),a.addData(u,new Vt(a,r,r,o)),a.addSignal("parent",null),l.params.subflow={$subflow:Xt(e,a).toRuntime()}}(e,n,r):O?function(e,t,n){var i=t.add(Z({pulse:n.pulse})),a=t.fork();a.add(re()),a.addSignal("parent",null),i.params.subflow={$subflow:Xt(e,a).toRuntime()}}(e,n,r):Xt(e,n),n.popState(),O&&($&&i.push($),i.push(s))),R&&(h=function(e,t,n){var i,a=e.method,r=e.bound,o=e.separation,l={separation:S(o)?n.signalRef(o.signal):o,method:S(a)?n.signalRef(a.signal):a,pulse:t};e.order&&(l.sort=n.compareRef({field:e.order}));r&&(i=r.tolerance,l.boundTolerance=S(i)?n.signalRef(i.signal):+i,l.boundScale=n.scaleRef(r.scale),l.boundOrient=r.orient);return y(n.add(J(l)))}(R,h,n)),u=n.add(ie({pulse:h})),d=n.add(re({pulse:y(u)},void 0,n.parent())),null!=e.name&&(c=e.name,n.addData(c,new Vt(n,o,u,d)),e.on&&e.on.forEach((function(e){(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),_t(e,n,c)})))}function Ft(e,n){var i,a,o,l,s,u,d,c,f=n.config.legend,g=e.encode||{},m=g.legend||{},h=m.name||void 0,v=m.interactive,b=m.style,x=Qe(e,f),k={},S=0;return je.forEach(t=>e[t]?(k[t]=e[t],S=S||e[t]):0),S||t.error("Missing valid scale for legend."),s=function(e,t){var n=e.type||"symbol";e.type||1!==function(e){return je.reduce((function(t,n){return t+(e[n]?1:0)}),0)}(e)||!e.fill&&!e.stroke||(n=r.isContinuous(t)?"gradient":r.isDiscretizing(t)?"discrete":"symbol");return"gradient"!==n?n:r.isDiscretizing(t)?"discrete":"gradient"}(e,n.scaleType(S)),u={title:null!=e.title,scales:k,type:s,vgrad:"symbol"!==s&&x.isVertical()},d=y(n.add(A(null,[u]))),m=Ie(function(e,t,n){var i={enter:{},update:{}};return qe(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}(x,e,f),m,ze),i={enter:{x:{value:0},y:{value:0}}},c=y(n.add(N(o={type:s,scale:n.scaleRef(S),count:n.objectProperty(x("tickCount")),limit:n.property(x("symbolLimit")),values:n.objectProperty(e.values),minstep:n.property(e.tickMinStep),formatType:n.property(e.formatType),formatSpecifier:n.property(e.format)}))),"gradient"===s?(l=[tt(e,S,f,g.gradient),it(e,f,g.labels,c)],o.count=o.count||n.signalRef(`max(2,2*floor((${R(x.gradientLength())})/100))`)):"discrete"===s?l=[nt(e,S,f,g.gradient,c),it(e,f,g.labels,c)]:(a=function(e,t){var n=Qe(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,f),l=[rt(e,f,g,c,R(a.columns))],o.size=function(e,t,n){var i=R(Lt("size",e,n)),a=R(Lt("strokeWidth",e,n)),r=R(function(e,t,n){return Je("fontSize",e)||function(e,t,n){var i=t.config.style[n];return i&&i[e]}("fontSize",t,n)}(n[1].encode,t,"guide-label"));return p(`max(ceil(sqrt(${i})+${a}),${r})`,t)}(e,n,l[0].marks)),l=[at({role:"legend-entry",from:d,encode:i,marks:l,layout:a,interactive:v})],u.title&&l.push(function(e,t,n,i){var a,r=Qe(e,t);return qe(a={enter:{opacity:Ve},update:{opacity:Pe,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Ve}},{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:ft},angle:{signal:pt},align:{signal:ct},baseline:{signal:gt},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Ge({type:"text",role:"legend-title",style:"guide-title",from:i,encode:a},n)}(e,f,g.title,d)),Et(at({role:"legend",from:d,encode:m,marks:l,aria:x("aria"),description:x("description"),zindex:x("zindex"),name:h,interactive:v,style:b}),n)}function Lt(e,t,n){return t[e]?`scale("${t[e]}",datum)`:Je(e,n[0].encode)}Pt.countsRef=function(e,t,n){var i,a,r,o=this.counts||(this.counts={}),l=Dt(t);return null!=l&&(e=this.scope,i=o[l]),i?n&&n.field&&Ct(e,i.agg.params,n):(r={groupby:e.fieldRef(t,"key"),pulse:y(this.output)},n&&n.field&&Ct(e,r,n),a=e.add(E(r)),i=e.add(A({pulse:y(a)})),i={agg:a,ref:y(i)},null!=l&&(o[l]=i)),i.ref},Pt.tuplesRef=function(){return y(this.values)},Pt.extentRef=function(e,t){return Wt(e,this,"extent","extent",t,!1)},Pt.domainRef=function(e,t){return Wt(e,this,"domain","values",t,!1)},Pt.valuesRef=function(e,t,n){return Wt(e,this,"vals","values",t,n||!0)},Pt.lookupRef=function(e,t){return Wt(e,this,"lookup","tupleindex",t,!1)},Pt.indataRef=function(e,t){return Wt(e,this,"indata","tupleindex",t,!0,!0)};function At(e,n){var i,a,r=Qe(e=t.isString(e)?{text:e}:e,n.config.title),o=e.encode||{},l=o.group||{},s=l.name||void 0,u=l.interactive,d=l.style,c=[];return i={},a=y(n.add(A(null,[i]))),c.push(function(e,t,n,i){var a={value:0},r=e.text,o={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return qe(o,{text:r,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Ge({type:"text",role:"title-text",style:"group-title",from:i,encode:o},n)}(e,r,function(e){var n=e.encode;return n&&n.title||t.extend({name:e.name,interactive:e.interactive,style:e.style},n)}(e),a)),e.subtitle&&c.push(function(e,t,n,i){var a={value:0},r=e.subtitle,o={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return qe(o,{text:r,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Ge({type:"text",role:"title-subtitle",style:"group-subtitle",from:i,encode:o},n)}(e,r,o.subtitle,a)),Et(at({role:"title",from:a,encode:Tt(r,l),marks:c,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:s,interactive:u,style:d}),n)}function Tt(e,t){var n={enter:{},update:{}};return qe(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:Ze},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Ie(n,t,ze)}function Bt(e,n){var i=[];e.transform&&e.transform.forEach((function(e){i.push(xt(e,n))})),e.on&&e.on.forEach((function(t){_t(t,n,e.name)})),n.addDataPipeline(e.name,function(e,n,i){var a,r,o,l,s,u=[],d=null,c=!1,f=!1;e.values?$(e.values)||$(e.format)?(u.push(Mt(n,e)),u.push(d=Ut())):u.push(d=Ut({$ingest:e.values,$format:e.format})):e.url?$(e.url)||$(e.format)?(u.push(Mt(n,e)),u.push(d=Ut())):u.push(d=Ut({$request:e.url,$format:e.format})):e.source&&(d=a=t.array(e.source).map((function(e){return y(n.getData(e).output)})),u.push(null));for(r=0,o=i.length;r<o;++r)l=i[r],s=l.metadata,d||s.source||u.push(d=Ut()),u.push(l),s.generates&&(f=!0),s.modifies&&!f&&(c=!0),s.source?d=l:s.changes&&(d=null);a&&(o=a.length-1,u[0]=ne({derive:c,pulse:o?a:a[0]}),(c||o)&&u.splice(1,0,Ut()));d||u.push(Ut());return u.push(re({})),u}(e,n,i))}function Ut(e){var t=A({},e);return t.metadata={source:!0},t}function Mt(e,t){return X({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}function Ht(e,t){return{scale:e.scale,range:t}}function qt(e,n,i,a,r){var o,l,s,u,d,c,f,p,g,m=Qe(e,n),h=e.orient,y=e.gridScale,v=h===Re||h===Oe?1:-1,b=function(e,n){if(1===n);else if(t.isObject(e)){for(var i=e=t.extend({},e);null!=i.mult;){if(!t.isObject(i.mult))return i.mult*=n,e;i=i.mult=t.extend({},i.mult)}i.mult=n}else e=n*(e||0);return e}(e.offset,v);return qe(o={enter:l={opacity:Ve},update:u={opacity:Pe},exit:s={opacity:Ve}},{stroke:m("gridColor"),strokeCap:m("gridCap"),strokeDash:m("gridDash"),strokeDashOffset:m("gridDashOffset"),strokeOpacity:m("gridOpacity"),strokeWidth:m("gridWidth")}),d={scale:e.scale,field:we,band:r.band,extra:r.extra,offset:r.offset,round:m("tickRound")},h===Oe||"bottom"===h?(c="x",f="y",g="height"):(c="y",f="x",g="width"),p=f+"2",u[c]=l[c]=s[c]=d,y?(u[f]=l[f]={scale:y,range:0,mult:v,offset:b},u[p]=l[p]={scale:y,range:1,mult:v,offset:b}):(u[f]=l[f]={value:0,offset:b},u[p]=l[p]={signal:g,mult:v,offset:b}),Ge({type:"rule",role:"axis-grid",key:we,from:a,encode:o},i)}function It(e,t,n,i,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+a+")"}}function Nt(e,n){var i,a,r,o,l,s=function(e,n){var i=n.config,a=e.orient,r=a===Oe||"bottom"===a?i.axisX:i.axisY,o=i["axis"+a[0].toUpperCase()+a.slice(1)],l="band"===n.scaleType(e.scale)&&i.axisBand;return r||o||l?t.extend({},i.axis,r,o,l):i.axis}(e,n),u=e.encode||{},d=u.axis||{},c=d.name||void 0,f=d.interactive,p=d.style,g=Qe(e,s),m=function(e){var n,i,a=e("tickBand"),r=e("tickOffset");return a?a.signal?(n={signal:`(${a.signal})==='extent'?1:0.5`},i={signal:`(${a.signal})==='extent'?true:false`},t.isObject(r)||(r={signal:`(${a.signal})==='extent'?0:${r}`})):"extent"===a?(n=1,i=!0,r=0):(n=.5,i=!1):(n=e("bandPosition"),i=e("tickExtra")),{extra:i,band:n,offset:r}}(g);return i={orient:e.orient,scale:e.scale,ticks:!!g("ticks"),labels:!!g("labels"),grid:!!g("grid"),domain:!!g("domain"),title:null!=e.title,translate:g("translate")},a=y(n.add(A({},[i]))),d=Ie(function(e,t){var n={enter:{},update:{}};return qe(n,{offset:e("offset")||0,position:O(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},format:t.format,formatType:t.formatType}),n}(g,e),d,ze),r=y(n.add(F({scale:n.scaleRef(e.scale),extra:n.property(m.extra),count:n.objectProperty(e.tickCount),values:n.objectProperty(e.values),minstep:n.property(e.tickMinStep),formatType:n.property(e.formatType),formatSpecifier:n.property(e.format)}))),l=[],i.grid&&l.push(qt(e,s,u.grid,r,m)),i.ticks&&(o=g("tickSize"),l.push(function(e,t,n,i,a,r){var o,l,s,u,d,c,f=Qe(e,t),p=e.orient,g=p===Re||p===Oe?-1:1;return qe(o={enter:l={opacity:Ve},update:u={opacity:Pe},exit:s={opacity:Ve}},{stroke:f("tickColor"),strokeCap:f("tickCap"),strokeDash:f("tickDash"),strokeDashOffset:f("tickDashOffset"),strokeOpacity:f("tickOpacity"),strokeWidth:f("tickWidth")}),(d=Me(a)).mult=g,c={scale:e.scale,field:we,band:r.band,extra:r.extra,offset:r.offset,round:f("tickRound")},p===Oe||"bottom"===p?(u.y=l.y=Ve,u.y2=l.y2=d,u.x=l.x=s.x=c):(u.x=l.x=Ve,u.x2=l.x2=d,u.y=l.y=s.y=c),Ge({type:"rule",role:"axis-tick",key:we,from:i,encode:o},n)}(e,s,u.ticks,r,o,m))),i.labels&&(o=i.ticks?o:0,l.push(function(e,t,n,i,a,r){var o,l,s,u,d,c,f,p,g,m=Qe(e,t),h=e.orient,y=h===Re||h===Oe?-1:1,v=h===Oe||"bottom"===h,b=e.scale,x=R(m("labelFlush")),k=R(m("labelFlushOffset")),S=0===x||!!x,$=m("labelAlign"),O=m("labelBaseline");return(s=Me(a)).mult=y,s.offset=Me(m("labelPadding")||0),s.offset.mult=y,u={scale:b,field:we,band:.5,offset:et(r.offset,m("labelOffset"))},v?(d=$||(S?It(b,x,'"left"','"right"','"center"'):"center"),c=O||(h===Oe?"bottom":"top"),f=!$):(d=$||("right"===h?"left":"right"),c=O||(S?It(b,x,'"top"','"bottom"','"middle"'):"middle"),f=!O),f=f&&S&&k?It(b,x,"-("+k+")",k,0):null,qe(o={enter:l={opacity:Ve,x:v?u:s,y:v?s:u},update:{opacity:Pe,text:{field:"label"},x:l.x,y:l.y},exit:{opacity:Ve,x:l.x,y:l.y}},{[v?"dx":"dy"]:f,align:d,baseline:c,angle:m("labelAngle"),fill:m("labelColor"),fillOpacity:m("labelOpacity"),font:m("labelFont"),fontSize:m("labelFontSize"),fontWeight:m("labelFontWeight"),fontStyle:m("labelFontStyle"),limit:m("labelLimit"),lineHeight:m("labelLineHeight")}),p=m("labelBound"),g=(g=m("labelOverlap"))||p?{separation:m("labelSeparation"),method:g,order:"datum.index",bound:p?{scale:b,orient:h,tolerance:p}:null}:void 0,Ge({type:"text",role:"axis-label",style:"guide-label",key:we,from:i,encode:o,overlap:g},n)}(e,s,u.labels,r,o,m))),i.domain&&l.push(function(e,t,n,i){var a,r,o,l,s,u,d=Qe(e,t),c=e.orient;return qe(a={enter:r={opacity:Ve},update:o={opacity:Pe},exit:{opacity:Ve}},{stroke:d("domainColor"),strokeCap:d("domainCap"),strokeDash:d("domainDash"),strokeDashOffset:d("domainDashOffset"),strokeWidth:d("domainWidth"),strokeOpacity:d("domainOpacity")}),c===Oe||"bottom"===c?(l="x",u="y"):(l="y",u="x"),s=l+"2",r[u]=Ve,o[l]=r[l]=Ht(e,0),o[s]=r[s]=Ht(e,1),Ge({type:"rule",role:"axis-domain",from:i,encode:a},n)}(e,s,u.domain,a)),i.title&&l.push(function(e,n,i,a){var r,o,l,s,u=Qe(e,n),d=e.orient,c=d===Re||d===Oe?-1:1,f=d===Oe||"bottom"===d;return r={enter:o={opacity:Ve,anchor:Me(u("titleAnchor")),align:{signal:Ze}},update:l=t.extend({},o,{opacity:Pe,text:Me(e.title)}),exit:{opacity:Ve}},s={signal:`lerp(range("${e.scale}"), ${Ke(0,1,.5)})`},f?(l.x=s,o.angle={value:0},o.baseline={value:d===Oe?"bottom":"top"}):(l.y=s,o.angle={value:90*c},o.baseline={value:"bottom"}),qe(r,{angle:u("titleAngle"),baseline:u("titleBaseline"),fill:u("titleColor"),fillOpacity:u("titleOpacity"),font:u("titleFont"),fontSize:u("titleFontSize"),fontStyle:u("titleFontStyle"),fontWeight:u("titleFontWeight"),limit:u("titleLimit"),lineHeight:u("titleLineHeight")},{align:u("titleAlign")}),!He(r,"x",u("titleX"),"update")&&!f&&!Ye("x",i)&&(r.enter.auto={value:!0}),!He(r,"y",u("titleY"),"update")&&f&&!Ye("y",i)&&(r.enter.auto={value:!0}),Ge({type:"text",role:"axis-title",style:"guide-title",from:a,encode:r},i)}(e,s,u.title,a)),Et(at({role:"axis",from:a,encode:d,marks:l,aria:g("aria"),description:g("description"),zindex:g("zindex"),name:c,interactive:f,style:p}),n)}function Xt(e,n,i){var a=t.array(e.signals),o=t.array(e.scales);return i||a.forEach(e=>f(e,n)),t.array(e.projections).forEach(e=>function(e,t){var n=t.config.projection||{},i={};for(var a in e)"name"!==a&&(i[a]=$e(e[a],a,t));for(a in n)null==i[a]&&(i[a]=$e(n[a],a,t));t.addProjection(e.name,i)}(e,n)),o.forEach(e=>function(e,n){var i=e.type||"linear";r.isValidScaleType(i)||t.error("Unrecognized scale type: "+t.stringValue(i)),n.addScale(e.name,{type:i,domain:void 0})}(e,n)),t.array(e.data).forEach(e=>Bt(e,n)),o.forEach(e=>ce(e,n)),(i||a).forEach(e=>function(e,n){var i=n.getSignal(e.name),a=e.update;e.init&&(a?t.error("Signals can not include both init and update expressions."):(a=e.init,i.initonly=!0)),a&&(a=p(a,n),i.update=a.$expr,i.params=a.$params),e.on&&e.on.forEach((function(e){C(e,n,i.id)}))}(e,n)),t.array(e.axes).forEach(e=>Nt(e,n)),t.array(e.marks).forEach(e=>Et(e,n)),t.array(e.legends).forEach(e=>Ft(e,n)),e.title&&At(e.title,n),n.parseLambdas(),n}function Yt(e,n){var i,a,r,o,s,d,c=n.config;return s=y(n.root=n.add(h())),(d=function(e,n){var i=t=>O(e[t],n[t]),a=[Gt("background",i("background")),Gt("autosize",l(i("autosize"))),Gt("padding",u(i("padding"))),Gt("width",i("width")||0),Gt("height",i("height")||0)],r=a.reduce((e,t)=>(e[t.name]=t,e),{}),o={};return t.array(e.signals).forEach(e=>{t.hasOwnProperty(r,e.name)?e=t.extend(r[e.name],e):a.push(e),o[e.name]=e}),t.array(n.signals).forEach(e=>{t.hasOwnProperty(o,e.name)||t.hasOwnProperty(r,e.name)||a.push(e)}),a}(e,c)).forEach(e=>f(e,n)),n.description=e.description||c.description,n.eventConfig=c.events,n.legends=n.objectProperty(c.legend&&c.legend.layout),a=n.add(A()),r=Ie({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),r=n.add(U(Ne(r,"group","frame",e.style,n,{pulse:y(a)}))),o=n.add(le({layout:n.objectProperty(e.layout),legends:n.legends,autosize:n.signalRef("autosize"),mark:s,pulse:y(r)})),n.operators.pop(),n.pushState(y(r),y(o),null),Xt(e,n,d),n.operators.push(o),i=n.add(L({mark:s,pulse:y(o)})),i=n.add(ie({pulse:y(i)})),i=n.add(re({pulse:y(i)})),n.addData("root",new Vt(n,a,a,i)),n}function Gt(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Qt(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Jt(e){this.config=e.config,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var Kt=Qt.prototype=Jt.prototype;function Zt(e){return(t.isArray(e)?en:tn)(e)}function en(e){for(var n,i="[",a=0,r=e.length;a<r;++a)n=e[a],i+=(a>0?",":"")+(t.isObject(n)?n.signal||Zt(n):t.stringValue(n));return i+"]"}function tn(e){var n,i,a="{",r=0;for(n in e)i=e[n],a+=(++r>1?",":"")+t.stringValue(n)+":"+(t.isObject(i)?i.signal||Zt(i):t.stringValue(i));return a+"}"}Kt.fork=function(){return new Jt(this)},Kt.isSubscope=function(){return this._subid>0},Kt.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}},Kt.id=function(){return(this._subid?this._subid+":":0)+this._id++},Kt.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((function(t){t.$ref=e.id})),e.refs=null),e},Kt.proxy=function(e){var t=e instanceof g?y(e):e;return this.add(te({value:t}))},Kt.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},Kt.addUpdate=function(e){return this.updates.push(e),e},Kt.finish=function(){var e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){var i;e&&((i=e.data||(e.data={}))[t]||(i[t]=[])).push(n)}for(e in this.data)for(var i in n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values"),t.index)n(t.index[i],e,"index:"+i);return this},Kt.pushState=function(e,t,n){this._encode.push(y(this.add(re({pulse:e})))),this._parent.push(t),this._lookup.push(n?y(this.proxy(n)):null),this._markpath.push(-1)},Kt.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},Kt.parent=function(){return t.peek(this._parent)},Kt.encode=function(){return t.peek(this._encode)},Kt.lookup=function(){return t.peek(this._lookup)},Kt.markpath=function(){var e=this._markpath;return++e[e.length-1]},Kt.fieldRef=function(e,n){if(t.isString(e))return v(e,n);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));var i,a=e.signal,r=this.field[a];return r||(i={name:this.signalRef(a)},n&&(i.as=n),this.field[a]=r=y(this.add(q(i)))),r},Kt.compareRef=function(e){function n(e){return S(e)?(a=!0,i.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(a=!0,i.exprRef(e.expr)):e}var i=this,a=!1,r=t.array(e.field).map(n),o=t.array(e.order).map(n);return a?y(this.add(T({fields:r,orders:o}))):x(r,o)},Kt.keyRef=function(e,n){var i=this.signals,a=!1;return e=t.array(e).map((function(e){return S(e)?(a=!0,y(i[e.signal])):e})),a?y(this.add(I({fields:e,flat:n}))):function(e,t){var n={$key:e};return t&&(n.$flat=!0),n}(e,n)},Kt.sortRef=function(e){if(!e)return e;var t=k(e.op,e.field),n=e.order||"ascending";return n.signal?y(this.add(T({fields:t,orders:this.signalRef(n.signal)}))):x(t,n)},Kt.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},Kt.hasOwnSignal=function(e){return t.hasOwnProperty(this.signals,e)},Kt.addSignal=function(e,n){this.hasOwnSignal(e)&&t.error("Duplicate signal name: "+t.stringValue(e));var i=n instanceof g?n:this.add(h(n));return this.signals[e]=i},Kt.getSignal=function(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},Kt.signalRef=function(e){return this.signals[e]?y(this.signals[e]):(t.hasOwnProperty(this.lambdas,e)||(this.lambdas[e]=this.add(h(null))),y(this.lambdas[e]))},Kt.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var i=e[t],a=p(i,this),r=this.lambdas[i];r.params=a.$params,r.update=a.$expr}},Kt.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},Kt.objectProperty=function(e){return e&&t.isObject(e)?this.signalRef(e.signal||Zt(e)):e},Kt.exprRef=function(e,t){var n={expr:p(e,this)};return t&&(n.expr.$name=t),y(this.add(M(n)))},Kt.addBinding=function(e,n){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},n))},Kt.addScaleProj=function(e,n){t.hasOwnProperty(this.scales,e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(n)},Kt.addScale=function(e,t){this.addScaleProj(e,ae(t))},Kt.addProjection=function(e,t){this.addScaleProj(e,ee(t))},Kt.getScale=function(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},Kt.projectionRef=Kt.scaleRef=function(e){return y(this.getScale(e))},Kt.projectionType=Kt.scaleType=function(e){return this.getScale(e).params.type},Kt.addData=function(e,n){return t.hasOwnProperty(this.data,e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=n},Kt.getData=function(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},Kt.addDataPipeline=function(e,n){return t.hasOwnProperty(this.data,e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,Vt.fromEntries(this,n))};return e.parse=function(e,n){return t.isObject(e)||t.error("Input Vega specification must be an object."),Yt(e,new Qt(n=t.mergeConfig({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},n,e.config))).toRuntime()},e}({},vega.vegaUtil,vega.vegaExpression,vega.vegaFunctions,vega.vegaEventSelector,vega.vegaScale,vega.vegaDataflow);
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).vegaLite={})}(this,(function(e){"use strict";var t="4.13.1";function n(e,t,n){return e.fields=t||[],e.fname=n,e}function i(e){return 1===e.length?r(e[0]):o(e)}const r=e=>function(t){return t[e]},o=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function s(e){throw Error(e)}function a(e){var t,n,i,r=[],o=null,a=0,u=e.length,l="";function c(){r.push(l+e.substring(t,n)),l="",t=n+1}for(e+="",t=n=0;n<u;++n)if("\\"===(i=e[n]))l+=e.substring(t,n),l+=e.substring(++n,++n),t=n;else if(i===o)c(),o=null,a=-1;else{if(o)continue;t===a&&'"'===i||t===a&&"'"===i?(t=n+1,o=i):"."!==i||a?"["===i?(n>t&&c(),a=t=n+1):"]"===i&&(a||s("Access path missing open bracket: "+e),a>0&&c(),a=0,t=n+1):n>t?c():t=n+1}return a&&s("Access path missing closing bracket: "+e),o&&s("Access path missing closing quote: "+e),n>t&&(n++,c()),r}var u=[],l=(function(e,t,r){const o=a(e);e=1===o.length?o[0]:e,n((r&&r.get||i)(o),[e],t||e)}("id"),n((function(e){return e}),u,"identity"));n((function(){return 0}),u,"zero"),n((function(){return 1}),u,"one"),n((function(){return!0}),u,"true"),n((function(){return!1}),u,"false");function c(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var f=Array.isArray;function d(e){return e===Object(e)}const g=e=>"__proto__"!==e;function p(...e){return e.reduce((e,t)=>{for(var n in t)if("signals"===n)e.signals=h(e.signals,t.signals);else{var i="legend"===n?{layout:1}:"style"===n||null;m(e,n,t[n],i)}return e},{})}function m(e,t,n,i){var r,o;if(g(t))if(d(n)&&!f(n))for(r in o=d(e[t])?e[t]:e[t]={},n)i&&(!0===i||i[r])?m(o,r,n[r]):g(r)&&(o[r]=n[r]);else e[t]=n}function h(e,t){if(null==e)return t;const n={},i=[];function r(e){n[e.name]||(n[e.name]=1,i.push(e))}return t.forEach(r),e.forEach(r),i}function b(e){return null!=e?f(e)?e:[e]:[]}const v=Object.prototype.hasOwnProperty;function y(e,t){return v.call(e,t)}function x(e){return"boolean"==typeof e}function O(e){return"number"==typeof e}function w(e){return"string"==typeof e}function j(e){return f(e)?"["+e.map(j)+"]":d(e)||w(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function A(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function D(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var F=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,i;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{i=Promise}catch(e){i=function(){}}function r(o,a,u,l,c){"object"==typeof a&&(u=a.depth,l=a.prototype,c=a.includeNonEnumerable,a=a.circular);var f=[],d=[],g="undefined"!=typeof Buffer;return void 0===a&&(a=!0),void 0===u&&(u=1/0),function o(u,p){if(null===u)return null;if(0===p)return u;var m,h;if("object"!=typeof u)return u;if(e(u,t))m=new t;else if(e(u,n))m=new n;else if(e(u,i))m=new i((function(e,t){u.then((function(t){e(o(t,p-1))}),(function(e){t(o(e,p-1))}))}));else if(r.__isArray(u))m=[];else if(r.__isRegExp(u))m=new RegExp(u.source,s(u)),u.lastIndex&&(m.lastIndex=u.lastIndex);else if(r.__isDate(u))m=new Date(u.getTime());else{if(g&&Buffer.isBuffer(u))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(m),m;e(u,Error)?m=Object.create(u):void 0===l?(h=Object.getPrototypeOf(u),m=Object.create(h)):(m=Object.create(l),h=l)}if(a){var b=f.indexOf(u);if(-1!=b)return d[b];f.push(u),d.push(m)}for(var v in e(u,t)&&u.forEach((function(e,t){var n=o(t,p-1),i=o(e,p-1);m.set(n,i)})),e(u,n)&&u.forEach((function(e){var t=o(e,p-1);m.add(t)})),u){var y;h&&(y=Object.getOwnPropertyDescriptor(h,v)),y&&null==y.set||(m[v]=o(u[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(u);for(v=0;v<x.length;v++){var O=x[v];(!(j=Object.getOwnPropertyDescriptor(u,O))||j.enumerable||c)&&(m[O]=o(u[O],p-1),j.enumerable||Object.defineProperty(m,O,{enumerable:!1}))}}if(c){var w=Object.getOwnPropertyNames(u);for(v=0;v<w.length;v++){var j,A=w[v];(j=Object.getOwnPropertyDescriptor(u,A))&&j.enumerable||(m[A]=o(u[A],p-1),Object.defineProperty(m,A,{enumerable:!1}))}}return m}(o,u)}function o(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return r.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},r.__objToStr=o,r.__isDate=function(e){return"object"==typeof e&&"[object Date]"===o(e)},r.__isArray=function(e){return"object"==typeof e&&"[object Array]"===o(e)},r.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===o(e)},r.__getRegExpFlags=s,r}();e.exports&&(e.exports=t)})),k=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(n=t.cmp,function(e){return function(t,i){var r={key:t,value:e[t]},o={key:i,value:e[i]};return n(r,o)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,s;if(Array.isArray(t)){for(s="[",n=0;n<t.length;n++)n&&(s+=","),s+=e(t[n])||"null";return s+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(t)-1,u=Object.keys(t).sort(r&&r(t));for(s="",n=0;n<u.length;n++){var l=u[n],c=e(t[l]);c&&(s&&(s+=","),s+=JSON.stringify(l)+":"+c)}return o.splice(a,1),"{"+s+"}"}}(e)};function C(e){return!!e.or}function E(e){return!!e.and}function $(e){return!!e.not}function S(e,t){return $(e)?{not:S(e.not,t)}:E(e)?{and:e.and.map(e=>S(e,t))}:C(e)?{or:e.or.map(e=>S(e,t))}:t(e)}const B=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,r,o;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(r=i;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,o[r]))return!1;for(r=i;0!=r--;){var s=o[r];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n},_=F;function z(e,t){const n={};for(const i of t)y(e,i)&&(n[i]=e[i]);return n}function P(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>k(e)).join(",")})`};const N=k;function L(e){if(O(e))return e;const t=w(e)?e:k(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}function T(e){return!1===e||null===e}function M(e,t){return e.indexOf(t)>-1}function q(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function R(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function U(e,t){for(const n of J(t))m(e,n,t[n],!0)}function W(e,t){const n=[],i={};let r;for(const o of e)r=t(o),r in i||(i[r]=1,n.push(o));return n}function I(e,t){for(const n of e)if(t.has(n))return!0;return!1}function H(e){const t=new Set;for(const n of e){const e=a(n).map((e,t)=>0===t?e:`[${e}]`),i=e.map((t,n)=>e.slice(0,n+1).join(""));for(const e of i)t.add(e)}return t}function G(e,t){return void 0===e||void 0===t||I(H(e),H(t))}function V(e){return 0===J(e).length}const J=Object.keys,Y=Object.values;function X(e){const t=[];for(const n in e)y(e,n)&&t.push({key:n,value:e[n]});return t}function Q(e){return!0===e||!1===e}function K(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Z(e,t){return $(e)?"!("+Z(e.not,t)+")":E(e)?"("+e.and.map(e=>Z(e,t)).join(") && (")+")":C(e)?"("+e.or.map(e=>Z(e,t)).join(") || (")+")":t(e)}function ee(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&ee(e[n],t)&&delete e[n],V(e)}function te(e){return e.charAt(0).toUpperCase()+e.substr(1)}function ne(e,t="datum"){const n=a(e),i=[];for(let e=1;e<=n.length;e++){const r=`[${n.slice(0,e).map(j).join("][")}]`;i.push(`${t}${r}`)}return i.join(" && ")}function ie(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function re(e){return""+a(e).map(ie).join("\\.")}function oe(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function se(e){return""+a(e).join(".")}function ae(e){return e?a(e).length:0}function ue(...e){for(const t of e)if(void 0!==t)return t}let le=42;function ce(e){if(void 0!==e)return(e%360+360)%360}function fe(e){return!!O(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const de={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function ge(e){return e&&e.condition}const pe=["domain","grid","labels","ticks","title"],me={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},he={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},be=Object.assign(Object.assign({},he),{style:1,labelExpr:1,encoding:1});function ve(e){return!!be[e]}const ye={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},xe=ye.arc,Oe=ye.area,we=ye.bar,je=ye.image,Ae=ye.line,De=ye.point,Fe=ye.rect,ke=ye.rule,Ce=ye.text,Ee=ye.tick,$e=ye.trail,Se=ye.circle,Be=ye.square,_e=ye.geoshape;function ze(e){return M(["line","area","trail"],e)}function Pe(e){return M(["rect","bar","image","arc"],e)}const Ne=J(ye);function Le(e){return e.type}A(Ne);const Te=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],Me=J({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),qe={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Re={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},Ue={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function We(e){return"mark"in e}class Ie{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!We(e)&&(Le(t=e.mark)?t.type:t)===this.name;var t}}const He={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Ge={count:1,min:1,max:1};function Ve(e){return!!e&&!!e.argmin}function Je(e){return!!e&&!!e.argmax}function Ye(e){return w(e)&&!!He[e]}const Xe=["count","valid","missing","distinct"];function Qe(e){return w(e)&&M(Xe,e)}const Ke=["count","sum","distinct","valid","missing"],Ze=A(["mean","average","median","q1","q3","min","max"]),et="row",tt="column",nt="x",it="y",rt="x2",ot="y2",st="radius",at="theta",ut="theta2",lt="color",ct="fill",ft="stroke",dt="shape",gt="size",pt={theta:1,theta2:1,radius:1,radius2:1};function mt(e){return e in pt}const ht={longitude:1,longitude2:1,latitude:1,latitude2:1};const bt=J(ht),vt=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),pt),ht),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function yt(e){return e===lt||e===ct||e===ft}const xt={row:1,column:1,facet:1},Ot=J(xt),wt=Object.assign(Object.assign({},vt),xt),jt=J(wt),At=D(wt,["order","detail","tooltip"]),Dt=D(At,["row","column","facet"]);function Ft(e){return!!wt[e]}const kt=[rt,ot,"latitude2","longitude2",ut,"radius2"];function Ct(e){return Et(e)!==e}function Et(e){switch(e){case rt:return nt;case ot:return it;case"latitude2":return"latitude";case"longitude2":return"longitude";case ut:return at;case"radius2":return st}return e}function $t(e){if(mt(e))switch(e){case at:return"startAngle";case ut:return"endAngle";case st:return"outerRadius";case"radius2":return"innerRadius"}return e}function St(e){switch(e){case nt:return rt;case it:return ot;case"latitude":return"latitude2";case"longitude":return"longitude2";case at:return ut;case st:return"radius2"}}function Bt(e){switch(e){case nt:case rt:return"width";case it:case ot:return"height"}}const _t=D(vt,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),zt=J(_t),Pt={x:1,y:1},Nt=J(Pt);function Lt(e){return e in Pt}const Tt={theta:1,radius:1},Mt=J(Tt);function qt(e){return"width"===e?nt:it}const Rt=D(_t,["text","tooltip","href","url","description","detail","key","order"]),Ut=J(Rt);const Wt=Object.assign(Object.assign(Object.assign({},Pt),Tt),Rt),It=J(Wt);function Ht(e){return!!Wt[e]}function Gt(e,t){return function(e){switch(e){case lt:case ct:case ft:case"description":case"detail":case"key":case"tooltip":case"href":case"order":case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"facet":case et:case tt:return Vt;case nt:case it:case"latitude":case"longitude":return Jt;case rt:case ot:case"latitude2":case"longitude2":return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case gt:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case"strokeDash":return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case dt:return{point:"always",geoshape:"always"};case"text":return{text:"always"};case"angle":return{point:"always",square:"always",text:"always"};case"url":return{image:"always"};case at:case st:return{text:"always",arc:"always"};case ut:case"radius2":return{arc:"always"}}}(e)[t]}const Vt={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Jt=D(Vt,["geoshape"]);function Yt(e){switch(e){case nt:case it:case at:case st:case gt:case"angle":case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case rt:case ot:case ut:case"radius2":return;case"facet":case et:case tt:case dt:case"strokeDash":case"text":case"tooltip":case"href":case"url":case"description":return"discrete";case lt:case ct:case ft:return"flexible";case"latitude":case"longitude":case"latitude2":case"longitude2":case"detail":case"key":case"order":return}}function Xt(e){return x(e)&&(e=lo(e,void 0)),"bin"+J(e).map(t=>en(e[t])?K(`_${t}_${Object.entries(e[t])}`):K(`_${t}_${e[t]}`)).join("")}function Qt(e){return!0===e||Zt(e)&&!e.binned}function Kt(e){return"binned"===e||Zt(e)&&!0===e.binned}function Zt(e){return d(e)}function en(e){return null==e?void 0:e.selection}function tn(e){switch(e){case et:case tt:case gt:case lt:case ct:case ft:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case dt:return 6;case"strokeDash":return 4;default:return 10}}function nn(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}function rn(e){return("width"==e?"Width":"Height")+' "container" only works for single views and layered views.'}function on(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function sn(e){return e?`Dropping "fit-${e}" because spec has discrete ${Bt(e)}.`:'Dropping "fit" because spec has discrete size.'}function an(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function un(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function ln(e){return`Selection not supported for ${e} yet.`}function cn(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function fn(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function dn(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function gn(e){return`Invalid field type "${e}".`}function pn(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function mn(e,t){return`Dropping ${N(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function hn(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?" when "+n:""}.`}function bn(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function vn(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function yn(e){return`Using unaggregated domain with raw field has no effect (${N(e)}).`}function xn(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function On(e){return`Unaggregated domain is currently unsupported for log scale (${N(e)}).`}function wn(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function jn(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const An="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function Dn(e,t){return`Invalid ${e}: ${N(t)}.`}function Fn(e){return`1D error band does not support ${e}.`}function kn(e){return`Channel ${e} is required for "binned" bin.`}const Cn=($n=2||0,{level:function(e){return arguments.length?($n=+e,this):$n},error:function(){return $n>=1&&c(En||"error","ERROR",arguments),this},warn:function(){return $n>=2&&c(En||"warn","WARN",arguments),this},info:function(){return $n>=3&&c(En||"log","INFO",arguments),this},debug:function(){return $n>=4&&c(En||"log","DEBUG",arguments),this}});var En,$n;let Sn=Cn;function Bn(...e){Sn.warn(...e)}function _n(e){if(e&&d(e))for(const t of Rn)if(t in e)return!0;return!1}const zn=["january","february","march","april","may","june","july","august","september","october","november","december"],Pn=zn.map(e=>e.substr(0,3)),Nn=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Ln=Nn.map(e=>e.substr(0,3));function Tn(e,t){const n=[];if(t&&void 0!==e.day&&J(e).length>1&&(Bn(function(e){return`Dropping day from datetime ${N(e)} as day cannot be combined with other units.`}(e)),delete(e=_(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const i=t?function(e){if(fe(e)&&(e=+e),O(e))return e-1;{const t=e.toLowerCase(),n=zn.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=Pn.indexOf(i);if(-1!==r)return r;throw new Error(Dn("month",e))}}(e.month):e.month;n.push(i)}else if(void 0!==e.quarter){const i=t?function(e){if(fe(e)&&(e=+e),O(e))return e>4&&Bn(Dn("quarter",e)),e-1;throw new Error(Dn("quarter",e))}(e.quarter):e.quarter;n.push(O(i)?3*i:i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const i=t?function(e){if(fe(e)&&(e=+e),O(e))return e%7;{const t=e.toLowerCase(),n=Nn.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=Ln.indexOf(i);if(-1!==r)return r;throw new Error(Dn("day",e))}}(e.day):e.day;n.push(O(i)?i+1:i+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const i=e[t];n.push(void 0===i?0:i)}return n}function Mn(e){const t=Tn(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const qn={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Rn=J(qn);function Un(e){return e.startsWith("utc")}const Wn={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function In(e){const t=[];for(const n of Rn)Hn(e,n)&&t.push(n);return t}function Hn(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function Gn(e,t,{end:n}={end:!1}){const i=ne(t),r=Un(e)?"utc":"";let o;const s={};for(const t of Rn)Hn(e,t)&&(s[t]="quarter"===(a=t)?`(${r}quarter(${i})-1)`:`${r}${a}(${i})`,o=t);var a;return n&&(s[o]+="+1"),function(e){const t=Tn(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(s)}function Vn(e){if(!e)return;const t=In(e);return`timeUnitSpecifier(${k(t)}, ${k(Wn)})`}function Jn(e){if(!e)return;let t;return w(e)?t={unit:e}:d(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Un(t.unit)&&(t.utc=!0,t.unit=t.unit.substr(3)),t}function Yn(e){return e&&!!e.signal}function Xn(e){return!!e.step}function Qn(e){return!f(e)&&("field"in e&&"data"in e)}const Kn=J({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),Zn={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},ei=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function ti(e){return e&&!!e.field&&void 0!==e.equal}function ni(e){return e&&!!e.field&&void 0!==e.lt}function ii(e){return e&&!!e.field&&void 0!==e.lte}function ri(e){return e&&!!e.field&&void 0!==e.gt}function oi(e){return e&&!!e.field&&void 0!==e.gte}function si(e){if(e&&e.field){if(f(e.range)&&2===e.range.length)return!0;if(Yn(e.range))return!0}return!1}function ai(e){return e&&!!e.field&&(f(e.oneOf)||f(e.in))}function ui(e){return ai(e)||ti(e)||si(e)||ni(e)||ri(e)||ii(e)||oi(e)}function li(e,t){return go(e,{timeUnit:t,wrapTime:!0})}function ci(e,t=!0){var n;const{field:i}=e,r=null===(n=Jn(e.timeUnit))||void 0===n?void 0:n.unit,o=r?"time("+Gn(r,i)+")":Jr(e,{expr:"datum"});if(ti(e))return o+"==="+li(e.equal,r);if(ni(e)){return`${o}<${li(e.lt,r)}`}if(ri(e)){return`${o}>${li(e.gt,r)}`}if(ii(e)){return`${o}<=${li(e.lte,r)}`}if(oi(e)){return`${o}>=${li(e.gte,r)}`}if(ai(e))return`indexof([${function(e,t){return e.map(e=>li(e,t))}(e.oneOf,r).join(",")}], ${o}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return fi(o,e.valid);if(si(e)){const{range:n}=e,i=Yn(n)?{signal:n.signal+"[0]"}:n[0],s=Yn(n)?{signal:n.signal+"[1]"}:n[1];if(null!==i&&null!==s&&t)return"inrange("+o+", ["+li(i,r)+", "+li(s,r)+"])";const a=[];return null!==i&&a.push(`${o} >= ${li(i,r)}`),null!==s&&a.push(`${o} <= ${li(s,r)}`),a.length>0?a.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function fi(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function di(e){var t;return ui(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=Jn(e.timeUnit))||void 0===t?void 0:t.unit}):e}const gi={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},pi=gi.quantitative,mi=gi.ordinal,hi=gi.temporal,bi=gi.nominal,vi=gi.geojson,yi=J(gi);const xi="linear",Oi="log",wi="pow",ji="sqrt",Ai="symlog",Di="time",Fi="utc",ki="quantile",Ci="quantize",Ei="threshold",$i="point",Si="band",Bi={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},_i=J(Bi);function zi(e,t){const n=Bi[e],i=Bi[t];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}const Pi={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Ni(e){return Pi[e]}const Li=["linear","log","pow","sqrt","symlog","time","utc"],Ti=A(Li),Mi=A(["linear","log","pow","sqrt","symlog"]);const qi=A(["quantile","quantize","threshold"]),Ri=A(Li.concat(["quantile","quantize","threshold","sequential","identity"])),Ui=A(["ordinal","bin-ordinal","point","band"]);function Wi(e){return e in Ui}function Ii(e){return e in Ri}function Hi(e){return e in Ti}function Gi(e){return e in qi}function Vi(e){return null==e?void 0:e.selection}const Ji=D({type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","scheme"]),Yi=J(Ji);!function(){var e;const t={};for(const n of jt)for(const i of yi)for(const r of _i){const o=er(n,i);Zi(n,r)&&Ki(r,i)&&(t[o]=null!==(e=t[o])&&void 0!==e?e:[],t[o].push(r))}}();function Xi(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!M(["point","band","identity"],e);case"bins":return!M(["point","band","identity","ordinal"],e);case"round":return Hi(e)||"band"===e||"point"===e;case"padding":return Hi(e)||M(["point","band"],e);case"paddingOuter":case"align":return M(["point","band"],e);case"paddingInner":return"band"===e;case"domainMid":case"clamp":return Hi(e);case"nice":return Hi(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return Ii(e)&&!M(["log","time","utc","threshold","quantile"],e)}}function Qi(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return yt(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function Ki(e,t){return M([mi,bi],t)?void 0===e||Wi(e):t===hi?M([Di,Fi,void 0],e):t!==pi||M([Oi,wi,ji,Ai,ki,Ci,Ei,xi,void 0],e)}function Zi(e,t){if(!Ht(e))return!1;switch(e){case nt:case it:case at:case st:return Hi(t)||M(["band","point"],t);case gt:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case"angle":return Hi(t)||Gi(t)||M(["band","point","ordinal"],t);case lt:case ct:case ft:return"band"!==t;case"strokeDash":return"ordinal"===t||Gi(t);case dt:return"ordinal"===t}}function er(e,t){return e+"_"+t}function tr(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:o}=e,s=ar(e);return Nr(n)&&!Qe(n.aggregate)&&r&&Hi(r.get("type"))&&!1===r.get("zero")?nr({fieldDef:n,channel:t,markDef:i,ref:s,config:o}):s}function nr({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(ze(n.type))return i;return null===wo("invalid",n,r)?i:[ir(e,t),i]}function ir(e,t){const n=rr(e,!0),i="y"===Et(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function rr(e,t=!0){return fi(w(e)?e:Jr(e,{expr:"datum"}),!t)}function or(e,t,n,i){const r={};if(t&&(r.scale=t),Tr(e)){const{datum:t}=e;_n(t)?r.signal=Mn(t):Yn(t)?r.signal=t.signal:r.value=t}else r.field=Jr(e,n);if(i){const{offset:e,band:t}=i;e&&(r.offset=e),t&&(r.band=t)}return r}function sr({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:o=.5}){const s=0<o&&o<1?"datum":void 0,a=Jr(t,{expr:s,suffix:r}),u=void 0!==n?Jr(n,{expr:s}):Jr(t,{suffix:"end",expr:s}),l={};if(0===o||1===o){l.scale=e;const t=0===o?a:u;l.field=t}else{const t=`${o} * ${a} + ${1-o} * ${u}`;l.signal=`scale("${e}", ${t})`}return i&&(l.offset=i),l}function ar({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l,band:c}){var f;if(t){if(Rr(t)){if(Ur(t)){c=null!=c?c:Sr({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:a,config:r,isMidPoint:!0});const{bin:s,timeUnit:l,type:f}=t;if(Qt(s)||c&&l&&f===hi)return a&&a.impute?or(t,o,{binSuffix:"mid"},{offset:u}):c?sr({scaleName:o,fieldOrDatumDef:t,band:c,offset:u}):or(t,o,mo(t,e)?{binSuffix:"range"}:{},{offset:u});if(Kt(s)){if(Nr(n))return sr({scaleName:o,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});Bn(kn(e===nt?rt:ot))}}const l=null==s?void 0:s.get("type");return or(t,o,Wi(l)?{binSuffix:"range"}:{},{offset:u,band:"band"===l?null!==(f=null!=c?c:t.band)&&void 0!==f?f:.5:void 0})}if(Wr(t)){const n=t.value,i=u?{offset:u}:{};return Object.assign(Object.assign({},ur(e,n)),i)}}return function(e){return"function"==typeof e}(l)&&(l=l()),l?Object.assign(Object.assign({},l),u?{offset:u}:{}):l}function ur(e,t){return M(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:M(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:vo(t)}function lr(e){return e&&"number"!==e&&"time"!==e}function cr(e,t,n){return`${e}(${t}${n?", "+JSON.stringify(n):""})`}function fr({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o}){var s,a;if(lr(n))return gr({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:o});const u=dr(e,i,r);if(fo(e)){const n=function(e,t,n,i,r){return!t||n?(n=w(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):function(e,t,n){if(!e)return;const i=Vn(e);return`${n||Un(e)?"utc":"time"}Format(${t}, ${i})`}(t,e,r)}(u,Nr(e)?null===(s=Jn(e.timeUnit))||void 0===s?void 0:s.unit:void 0,t,o.timeFormat,Ir(e)&&(null===(a=e.scale)||void 0===a?void 0:a.type)===Fi);return n?{signal:n}:void 0}if(t=hr(Lr(e),t,o),Nr(e)&&Qt(e.bin)){return{signal:yr(u,Jr(e,{expr:i,binSuffix:"end"}),t,n,o)}}return t||"quantitative"===Lr(e)?{signal:""+br(u,t)}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function dr(e,t,n){return Nr(e)?n?`${Jr(e,{expr:t,suffix:"end"})}-${Jr(e,{expr:t,suffix:"start"})}`:Jr(e,{expr:t}):function(e){const{datum:t}=e;return _n(t)?Mn(t):""+JSON.stringify(t)}(e)}function gr({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o,field:s}){if(s=null!=s?s:dr(e,i,r),Nr(e)&&Qt(e.bin)){return{signal:yr(s,Jr(e,{expr:i,binSuffix:"end"}),t,n,o)}}return{signal:cr(n,s,t)}}function pr(e,t,n,i,r,o){var s;if(!lr(i)){if(fo(e)){return function(e,t,n,i){if(e)return e;if(t)return{signal:Vn(t)};return i?void 0:n.timeFormat}(n,Nr(e)?null===(s=Jn(e.timeUnit))||void 0===s?void 0:s.unit:void 0,r,o)}return hr(t,n,r)}}function mr(e,t,n){return e&&(Yn(e)||"number"===e||"time"===e)?e:fo(t)&&"time"!==n&&"utc"!==n?"time":void 0}function hr(e,t,n){return w(t)?t:e===pi?n.numberFormat:void 0}function br(e,t){return`format(${e}, "${t||""}")`}function vr(e,t,n,i){var r;return lr(n)?cr(n,e,t):br(e,null!==(r=w(t)?t:void 0)&&void 0!==r?r:i.numberFormat)}function yr(e,t,n,i,r){const o=vr(e,n,i,r),s=vr(t,n,i,r);return`${fi(e,!1)} ? "null" : ${o} + " 
 " + ${s}`}const xr="min",Or={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function wr(e){return e in Or}function jr(e){return!!e&&!!e.encoding}function Ar(e){return!(!e||"count"!==e.op&&!e.field)}function Dr(e){return!!e&&f(e)}function Fr(e){return"row"in e||"column"in e}function kr(e){return!!e&&"header"in e}function Cr(e){return"facet"in e}function Er(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function $r(e){return Ur(e)&&"sort"in e}function Sr({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:o,isMidPoint:s}){if(Rr(t)&&void 0!==t.band)return t.band;if(Nr(t)){const{timeUnit:e,bin:r}=t;if(e&&!n)return s?jo("timeUnitBandPosition",i,o):Pe(i.type)?jo("timeUnitBand",i,o):0;if(Qt(r))return Pe(i.type)&&!s?1:.5}return(null==r?void 0:r.fieldChannel)===e&&s?.5:void 0}function Br(e,t,n,i,r,o){return!!(Qt(t.bin)||t.timeUnit&&Ur(t)&&"temporal"===t.type)&&!!Sr({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:o})}function _r(e){return!!e&&"condition"in e}function zr(e){const t=e&&e.condition;return!!t&&!f(t)&&Nr(t)}function Pr(e){const t=e&&e.condition;return!!t&&!f(t)&&Rr(t)}function Nr(e){return!(!e||!e.field&&"count"!==e.aggregate)}function Lr(e){return e&&e.type}function Tr(e){return!!e&&"datum"in e}function Mr(e){return Ur(e)&&Xr(e)||qr(e)}function qr(e){return Tr(e)&&O(e.datum)}function Rr(e){return Nr(e)||Tr(e)}function Ur(e){return!!e&&("field"in e&&"type"in e||"count"===e.aggregate)}function Wr(e){return e&&"value"in e&&"value"in e}function Ir(e){return!!e&&("scale"in e||"sort"in e)}function Hr(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Gr(e){return!!e&&"legend"in e}function Vr(e){return!!e&&("format"in e||"formatType"in e)}function Jr(e,t={}){var n,i,r;let o=e.field;const s=t.prefix;let u=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))o=function(e){return function(e){return 0===e.indexOf("__")}(e)?e:"__"+e}("count");else{let s;if(!t.nofn)if(function(e){return"op"in e}(e))s=e.op;else{const{bin:a,aggregate:c,timeUnit:f}=e;Qt(a)?(s=Xt(a),u=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(i=t.suffix)&&void 0!==i?i:"")):c?Je(c)?(l=`["${o}"]`,o="argmax_"+c.argmax):Ve(c)?(l=`["${o}"]`,o="argmin_"+c.argmin):s=String(c):f&&(s=function(e){const t=Jn(e),{utc:n}=t,i=D(t,["utc"]);return i.unit?(n?"utc":"")+J(i).map(e=>K(`${"unit"===e?"":`_${e}_`}${i[e]}`)).join(""):(n?"utc":"")+"timeunit"+J(i).map(e=>K(`_${e}_${i[e]}`)).join("")}(f),u=(!M(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(r=t.suffix)&&void 0!==r?r:""))}s&&(o=o?`${s}_${o}`:s)}return u&&(o=`${o}_${u}`),s&&(o=`${s}_${o}`),t.forAs?se(o):t.expr?function(e,t="datum"){return`${t}[${j(a(e).join("."))}]`}(o,t.expr)+l:re(o)+l}function Yr(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Nr(e)&&!!e.bin;case"temporal":return!1}throw new Error(gn(e.type))}function Xr(e){return!Yr(e)}const Qr=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(Je(t))return`${r} for argmax(${t.argmax})`;if(Ve(t))return`${r} for argmin(${t.argmin})`;const o=Jn(i),s=t||(null==o?void 0:o.unit)||(null==o?void 0:o.maxbins)&&"timeunit"||Qt(n)&&"bin";return s?s.toUpperCase()+"("+r+")":r}(e);default:return function(e,t){var n;const{field:i,bin:r,timeUnit:o,aggregate:s}=e;if("count"===s)return t.countTitle;if(Qt(r))return i+" (binned)";if(o){const e=null===(n=Jn(o))||void 0===n?void 0:n.unit;if(e)return`${i} (${In(e).join("-")})`}else if(s)return Je(s)?`${i} for max ${s.argmax}`:Ve(s)?`${i} for min ${s.argmin}`:`${te(s)} of ${i}`;return i}(e,t)}};let Kr=Qr;function Zr(e){Kr=e}function eo(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,o;const s=(null!==(r=to(e))&&void 0!==r?r:{}).title;if(!Nr(e))return s;const a=e,u=i?no(a,t):void 0;return n?ue(s,a.title,u):null!==(o=null!=s?s:a.title)&&void 0!==o?o:u}function to(e){return Hr(e)&&e.axis?e.axis:Gr(e)&&e.legend?e.legend:kr(e)&&e.header?e.header:void 0}function no(e,t){return Kr(e,t)}function io(e){var t;if(Vr(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=to(e))&&void 0!==t?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function ro(e){return Nr(e)?e:zr(e)?e.condition:void 0}function oo(e){return Rr(e)?e:Pr(e)?e.condition:void 0}function so(e,t,n){if(w(e)||O(e)||x(e)){return Bn(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${N(n)}}.`}(t,w(e)?"string":O(e)?"number":"boolean",e)),{value:e}}return Rr(e)?ao(e,t,n):Pr(e)?Object.assign(Object.assign({},e),{condition:ao(e.condition,t,n)}):e}function ao(e,t,n){if(Vr(e)){const{format:i,formatType:r}=e,o=D(e,["format","formatType"]);if(lr(r)&&!n.customFormatTypes)return Bn(dn(t)),ao(o,t,n)}else{const i=Hr(e)?"axis":Gr(e)?"legend":kr(e)?"header":null;if(i&&e[i]){const r=e[i],{format:o,formatType:s}=r,a=D(r,["format","formatType"]);if(lr(s)&&!n.customFormatTypes)return Bn(dn(t)),ao(Object.assign(Object.assign({},e),{[i]:a}),t,n)}}return Nr(e)?uo(e,t):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=O(n)?"quantitative":w(n)?"nominal":_n(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function uo(e,t){const{aggregate:n,timeUnit:i,bin:r,field:o}=e,s=Object.assign({},e);if(!n||Ye(n)||Je(n)||Ve(n)||(Bn(function(e){return`Invalid aggregation operator "${e}".`}(n)),delete s.aggregate),i&&(s.timeUnit=Jn(i)),o&&(s.field=""+o),Qt(r)&&(s.bin=lo(r,t)),Kt(r)&&!Lt(t)&&Bn(`Channel ${t} should not be used with "binned" bin.`),Ur(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case pi:return"quantitative";case"t":case hi:return"temporal";case"o":case mi:return"ordinal";case"n":case bi:return"nominal";case vi:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&Qe(n)&&(Bn(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,n)),s.type="quantitative")}else if(!Ct(t)){const e=function(e,t){if(e.timeUnit)return"temporal";if(Qt(e.bin))return"quantitative";switch(Yt(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(s,t);Bn(function(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}(t,e)),s.type=e}if(Ur(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case et:case tt:case"facet":return Xr(e)?{compatible:!1,warning:bn(t)}:co;case nt:case it:case lt:case ct:case ft:case"text":case"detail":case"key":case"tooltip":case"href":case"url":case"angle":case at:case st:case"description":return co;case"longitude":case"longitude2":case"latitude":case"latitude2":return n!==pi?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:co;case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case gt:case ut:case"radius2":case rt:case ot:return"nominal"!==n||e.sort?co:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case"strokeDash":return M(["ordinal","nominal"],e.type)?co:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case dt:return M(["ordinal","nominal","geojson"],e.type)?co:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==e.type||"sort"in e?co:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t);e||Bn(n)}if($r(s)&&w(s.sort)){const{sort:e}=s;if(wr(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&wr(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(kr(s)){const{header:e}=s,{orient:t}=e,n=D(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function lo(e,t){return x(e)?{maxbins:tn(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:tn(t)})}const co={compatible:!0};function fo(e){const{formatType:t}=io(e);return"time"===t||!t&&((n=e)&&("temporal"===n.type||Nr(n)&&!!n.timeUnit));var n}function go(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var o;const s=t&&(null===(o=Jn(t))||void 0===o?void 0:o.unit);let a,u=s||"temporal"===n;return Yn(e)?a=e.signal:_n(e)?(u=!0,a=Mn(e)):(w(e)||O(e))&&u&&(a=`datetime(${JSON.stringify(e)})`,function(e){return!!qn[e]}(s)&&(O(e)&&e<1e4||w(e)&&isNaN(Date.parse(e)))&&(a=Mn({[s]:e}))),a?i&&u?`time(${a})`:a:r?void 0:JSON.stringify(e)}function po(e,t){const{type:n}=e;return t.map(t=>{const i=go(t,{timeUnit:Nr(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==i?{signal:i}:t})}function mo(e,t){return Qt(e.bin)?Ht(t)&&M(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function ho(e){const{anchor:t,frame:n,offset:i,orient:r,color:o,subtitleColor:s,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,g=D(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},g),o?{fill:o}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),h=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s?{subtitleColor:s}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:z(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:h}}function bo(e){return w(e)||f(e)&&w(e[0])}function vo(e){return Yn(e)?e:void 0!==e?{value:e}:void 0}function yo(e){return Yn(e)?e.signal:j(e.value)}function xo(e){return Yn(e)?e.signal:null==e?null:j(e)}function Oo(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function wo(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:o}=i;return r&&void 0!==t[r]?t[r]:void 0!==t[e]?t[e]:!o||r&&r!==e?jo(e,t,n,i):void 0}function jo(e,t,n,{vgChannel:i}={}){return ue(i?Ao(e,t,n.style):void 0,Ao(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Ao(e,t,n){return Do(e,Oo(t),n)}function Do(e,t,n){let i;t=b(t);for(const r of t){const t=n[r];t&&void 0!==t[e]&&(i=t[e])}return i}function Fo(e,t){return b(e).reduce((e,n)=>{var i;return e.field.push(Jr(n,t)),e.order.push(null!==(i=n.sort)&&void 0!==i?i:"ascending"),e},{field:[],order:[]})}function ko(e,t){const n=[...e];return t.forEach(e=>{for(const t of n)if(B(t,e))return;n.push(e)}),n}function Co(e,t){return B(e,t)||!t?e:e?[...b(e),...b(t)].join(", "):t}function Eo(e,t){const n=e.value,i=t.value;if(null==n||null===i)return{explicit:e.explicit,value:null};if((bo(n)||Yn(n))&&(bo(i)||Yn(i)))return{explicit:e.explicit,value:Co(n,i)};if(bo(n)||Yn(n))return{explicit:e.explicit,value:n};if(bo(i)||Yn(i))return{explicit:e.explicit,value:i};if(!(bo(n)||Yn(n)||bo(i)||Yn(i)))return{explicit:e.explicit,value:ko(n,i)};throw new Error("It should never reach here")}function $o(e,t){const n=e&&e[t];return!!n&&(f(n)?q(n,e=>!!e.field):Nr(n)||zr(n))}function So(e){return q(jt,t=>{if($o(e,t)){const n=e[t];if(f(n))return q(n,e=>!!e.aggregate);{const e=ro(n);return e&&!!e.aggregate}}return!1})}function Bo(e,t){const n=[],i=[],r=[],o=[],s={};return Po(e,(a,u)=>{if(Nr(a)){const{field:l,aggregate:c,bin:f,timeUnit:d}=a,g=D(a,["field","aggregate","bin","timeUnit"]);if(c||d||f){const e=to(a),p=e&&e.title;let m=Jr(a,{forAs:!0});const h=Object.assign(Object.assign(Object.assign({},p?[]:{title:eo(a,t,{allowDisabling:!0})}),g),{field:m});if(c){let e;if(Je(c)?(e="argmax",m=Jr({op:"argmax",field:c.argmax},{forAs:!0}),h.field=`${m}.${l}`):Ve(c)?(e="argmin",m=Jr({op:"argmin",field:c.argmin},{forAs:!0}),h.field=`${m}.${l}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};l&&(t.field=l),o.push(t)}}else if(n.push(m),Ur(a)&&Qt(f)){if(i.push({bin:f,field:l,as:m}),n.push(Jr(a,{binSuffix:"end"})),mo(a,u)&&n.push(Jr(a,{binSuffix:"range"})),Lt(u)){const e={field:m+"_end"};s[u+"2"]=e}h.bin="binned",Ct(u)||(h.type=pi)}else if(d){r.push({timeUnit:d,field:l,as:m});const e=Ur(a)&&a.type!==hi&&"time";e&&("text"===u||"tooltip"===u?h.formatType=e:!function(e){return!!_t[e]}(u)?Lt(u)&&(h.axis=Object.assign({formatType:e},h.axis)):h.legend=Object.assign({formatType:e},h.legend))}s[u]=h}else n.push(l),s[u]=e[u]}else s[u]=e[u]}),{bins:i,timeUnits:r,aggregate:o,groupby:n,encoding:s}}function _o(e,t,n){const i=t.type;return J(e).reduce((r,o)=>{if(!Ft(o))return Bn(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(o)),r;const s=e[o];if("angle"!==o||"arc"!==i||e.theta||(Bn("Arc marks uses theta channel rather than angle, replacing angle with theta."),o=at),!function(e,t,n){const i=Gt(t,n);if(!i)return!1;if("binned"===i){const n=e[t===rt?nt:it];return!!(Nr(n)&&Nr(e[t])&&Kt(n.bin))}return!0}(e,o,i))return Bn(hn(o,i)),r;if(o===gt&&"line"===i){const t=ro(e[o]);if(null==t?void 0:t.aggregate)return Bn("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),r}if(o===lt&&(t.filled?"fill"in e:"stroke"in e))return Bn(pn("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if("detail"===o||"order"===o&&!f(s)&&!Wr(s)||"tooltip"===o&&f(s))s&&(r[o]=b(s).reduce((e,t)=>(Nr(t)?e.push(uo(t,o)):Bn(mn(t,o)),e),[]));else{if("tooltip"===o&&null===s)r[o]=null;else if(!(Nr(s)||Tr(s)||Wr(s)||_r(s)||Yn(s)))return Bn(mn(s,o)),r;r[o]=so(s,o,n)}return r},{})}function zo(e){const t=[];for(const n of J(e))if($o(e,n)){const i=b(e[n]);for(const e of i)Nr(e)?t.push(e):zr(e)&&t.push(e.condition)}return t}function Po(e,t,n){if(e)for(const i of J(e)){const r=e[i];if(f(r))for(const e of r)t.call(n,e,i);else t.call(n,r,i)}}function No(e,t,n,i){return e?J(e).reduce((n,r)=>{const o=e[r];return f(o)?o.reduce((e,n)=>t.call(i,e,n,r),n):t.call(i,n,o,r)},n):n}function Lo(e,t){return J(t).reduce((n,i)=>{switch(i){case nt:case it:case"href":case"description":case"url":case rt:case ot:case at:case ut:case st:case"radius2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case dt:case"angle":case"tooltip":return n;case"order":if("line"===e||"trail"===e)return n;case"detail":case"key":{const e=t[i];if(f(e)||Nr(e))for(const t of b(e))t.aggregate||n.push(Jr(t,{}));return n}case gt:if("trail"===e)return n;case lt:case ct:case ft:case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeDash":case"strokeWidth":{const e=ro(t[i]);return e&&!e.aggregate&&n.push(Jr(e,{})),n}}},[])}function To(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};return{tooltip:[...e.map(({fieldPrefix:e,titlePrefix:n})=>{const r=i?" of "+t.field:"";return{field:e+t.field,type:t.type,title:Yn(n)?{signal:n+`"${escape(r)}"`}:n+r}}),...zo(n)]}}function Mo(e){const{axis:t,title:n,field:i}=e;return t&&void 0!==t.title?void 0:ue(n,i)}function qo(e,t,n,i,r){const{scale:o,axis:s}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c,aria:f,extraEncoding:d={}})=>{const g=Mo(n);return Ro(e,a,r,f,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},void 0!==g?{title:g}:{}),void 0!==o?{scale:o}:{}),void 0!==s?{axis:s}:{})},w(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),d)})}}function Ro(e,t,n,i,r){const{clip:o,color:s,opacity:a}=e,u=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),o?{clip:o}:{}),s?{color:s}:{}),a?{opacity:a}:{}),Le(r.mark)?r.mark:{type:r.mark}),{style:`${u}-${t}`}),x(e[t])?{}:e[t]),!1===i?{aria:i}:{})})]:[]}function Uo(e,t,n){const{encoding:i}=e,r="vertical"===t?"y":"x",o=i[r],s=i[r+"2"],a=i[r+"Error"],u=i[r+"Error2"];return{continuousAxisChannelDef:Wo(o,n),continuousAxisChannelDef2:Wo(s,n),continuousAxisChannelDefError:Wo(a,n),continuousAxisChannelDefError2:Wo(u,n),continuousAxis:r}}function Wo(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=D(e,["aggregate"]);return n!==t&&Bn(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),i}return e}function Io(e,t){const{mark:n,encoding:i}=e,{x:r,y:o}=i;if(Mr(r)){if(Mr(o)){const e=Nr(r)&&r.aggregate,i=Nr(o)&&o.aggregate;if(e||i!==t){if(i||e!==t){if(e===t&&i===t)throw new Error("Both x and y cannot have aggregate");return Le(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(Mr(o))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const Ho=new Ie("boxplot",Vo);function Go(e){return O(e)?"tukey":e}function Vo(e,{config:t}){var n,i;const{mark:r,encoding:o,selection:s,projection:a}=e,u=D(e,["mark","encoding","selection","projection"]),l=Le(r)?r:{type:r};s&&Bn(ln("boxplot"));const c=null!==(n=l.extent)&&void 0!==n?n:t.boxplot.extent,g=wo("size",l,t),p=Go(c),{transform:m,continuousAxisChannelDef:h,continuousAxis:b,groupby:v,aggregate:y,encodingWithoutContinuousAxis:x,ticksOrient:O,boxOrient:w,customTooltipWithoutAggregatedField:j}=function(e,t,n){const i=Io(e,"boxplot"),{continuousAxisChannelDef:r,continuousAxis:o}=Uo(e,i,"boxplot"),s=r.field,a=Go(t),u=[...Jo(s),{op:"median",field:s,as:"mid_box_"+s},{op:"min",field:s,as:("min-max"===a?"lower_whisker_":"min_")+s},{op:"max",field:s,as:("min-max"===a?"upper_whisker_":"max_")+s}],l="min-max"===a||"tukey"===a?[]:[{calculate:`datum["upper_box_${s}"] - datum["lower_box_${s}"]`,as:"iqr_"+s},{calculate:`min(datum["upper_box_${s}"] + datum["iqr_${s}"] * ${t}, datum["max_${s}"])`,as:"upper_whisker_"+s},{calculate:`max(datum["lower_box_${s}"] - datum["iqr_${s}"] * ${t}, datum["min_${s}"])`,as:"lower_whisker_"+s}],c=e.encoding,d=o,g=(c[d],D(c,["symbol"==typeof d?d:d+""])),{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=function(e){const{tooltip:t}=e,n=D(e,["tooltip"]);if(!t)return{filteredEncoding:e};let i,r;if(f(t)){for(const e of t)e.aggregate?(i||(i=[]),i.push(e)):(r||(r=[]),r.push(e));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return f(r)&&1===r.length&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}(g),{bins:h,timeUnits:b,aggregate:v,groupby:y,encoding:x}=Bo(m,n),O="vertical"===i?"horizontal":"vertical",w=i;return{transform:[...h,...b,{aggregate:[...v,...u],groupby:y},...l],groupby:y,aggregate:v,continuousAxisChannelDef:r,continuousAxis:o,encodingWithoutContinuousAxis:x,ticksOrient:O,boxOrient:w,customTooltipWithoutAggregatedField:p}}(e,c,t),{color:A,size:F}=x,k=D(x,["color","size"]),C=e=>qo(l,b,h,e,t.boxplot),E=C(k),$=C(x),S=C(Object.assign(Object.assign({},k),F?{size:F}:{})),B=To([{fieldPrefix:"min-max"===p?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===p?"lower_whisker_":"min_",titlePrefix:"Min"}],h,x),_={type:"tick",color:"black",opacity:1,orient:O,invalid:null},z="min-max"===p?B:To([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,x),P=[...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:z}),...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:z}),...E({partName:"ticks",mark:_,positionPrefix:"lower_whisker",aria:!1,extraEncoding:z}),...E({partName:"ticks",mark:_,positionPrefix:"upper_whisker",aria:!1,extraEncoding:z})],N=[..."tukey"!==p?P:[],...$({partName:"box",mark:Object.assign(Object.assign({type:"bar"},g?{size:g}:{}),{orient:w,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:B}),...S({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},d(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),g?{size:g}:{}),{orient:O,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:B})];let L;if("min-max"!==p){const e=`datum["lower_box_${h.field}"]`,n=`datum["upper_box_${h.field}"]`,i=`(${n} - ${e})`,r=`${e} - ${c} * ${i}`,o=`${n} + ${c} * ${i}`,s=`datum["${h.field}"]`,a={joinaggregate:Jo(h.field),groupby:v};let u=void 0;"tukey"===p&&(u={transform:[{filter:`(${r} <= ${s}) && (${s} <= ${o})`},{aggregate:[{op:"min",field:h.field,as:"lower_whisker_"+h.field},{op:"max",field:h.field,as:"upper_whisker_"+h.field},{op:"min",field:"lower_box_"+h.field,as:"lower_box_"+h.field},{op:"max",field:"upper_box_"+h.field,as:"upper_box_"+h.field},...y],groupby:v}],layer:P});const f=D(k,["tooltip"]),{scale:d,axis:g}=h,m=Mo(h),x=Ro(l,"outliers",t.boxplot,!0,{transform:[{filter:`(${s} < ${r}) || (${s} > ${o})`}],mark:"point",encoding:Object.assign(Object.assign({[b]:Object.assign(Object.assign(Object.assign({field:h.field,type:h.type},void 0!==m?{title:m}:{}),void 0!==d?{scale:d}:{}),void 0!==g?{axis:g}:{})},f),j?{tooltip:j}:{})})[0];x&&u?L={transform:[a],layer:[x,u]}:x?(L=x,L.transform.unshift(a)):u&&(L=u,L.transform.unshift(a))}return L?Object.assign(Object.assign({},u),{layer:[L,{transform:m,layer:N}]}):Object.assign(Object.assign({},u),{transform:(null!==(i=u.transform)&&void 0!==i?i:[]).concat(m),layer:N})}function Jo(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const Yo=new Ie("errorbar",Xo);function Xo(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,ticksOrient:s,markDef:a,outerSpec:u,tooltipEncoding:l}=Ko(e,"errorbar",t),c=qo(a,r,i,o,t.errorbar),f={type:"tick",orient:s},d=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),d.length>1?{layer:d}:Object.assign({},d[0]))}function Qo(e,t){const{encoding:n}=e;if(function(e){return(Rr(e.x)||Rr(e.y))&&!Rr(e.x2)&&!Rr(e.y2)&&!Rr(e.xError)&&!Rr(e.xError2)&&!Rr(e.yError)&&!Rr(e.yError2)}(n))return{orient:Io(e,t),inputType:"raw"};const i=function(e){return Rr(e.x2)||Rr(e.y2)}(n),r=function(e){return Rr(e.xError)||Rr(e.xError2)||Rr(e.yError)||Rr(e.yError2)}(n),o=n.x,s=n.y;if(i){if(r)throw new Error(t+" cannot be both type aggregated-upper-lower and aggregated-error");const e=n.x2,i=n.y2;if(Rr(e)&&Rr(i))throw new Error(t+" cannot have both x2 and y2");if(Rr(e)){if(Mr(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in "+t)}if(Rr(i)){if(Mr(s))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in "+t)}throw new Error("No ranged axis")}{const e=n.xError,i=n.xError2,r=n.yError,a=n.yError2;if(Rr(i)&&!Rr(e))throw new Error(t+" cannot have xError2 without xError");if(Rr(a)&&!Rr(r))throw new Error(t+" cannot have yError2 without yError");if(Rr(e)&&Rr(r))throw new Error(t+" cannot have both xError and yError with both are quantiative");if(Rr(e)){if(Mr(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Rr(r)){if(Mr(s))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Ko(e,t,n){var i;const{mark:r,encoding:o,selection:s,projection:a}=e,u=D(e,["mark","encoding","selection","projection"]),l=Le(r)?r:{type:r};s&&Bn(ln(t));const{orient:c,inputType:f}=Qo(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:h}=Uo(e,c,t),{errorBarSpecificAggregate:b,postAggregateCalculates:v,tooltipSummary:y,tooltipTitleWithFieldName:x}=function(e,t,n,i,r,o,s,a){let u=[],l=[];const c=t.field;let f,d=!1;if("raw"===o){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":a.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&Bn(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,s)),"stderr"===n||"stdev"===n)u=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:te(t)},{fieldPrefix:"upper_",titlePrefix:Zo(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:Zo(t,n,"-")}],d=!0;else{let t,i,r;e.center&&e.extent&&Bn(function(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}(e.extent,s)),"ci"===n?(t="mean",i="ci0",r="ci1"):(t="median",i="q1",r="q3"),u=[{op:i,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:t,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:eo({field:c,aggregate:r,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:eo({field:c,aggregate:i,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:eo({field:c,aggregate:t,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&Bn((g=e.center,`${(p=e.extent)?"extent ":""}${p&&g?"and ":""}${g?"center ":""}${p&&g?"are ":"is "}not needed when data are aggregated.`)),"aggregated-upper-lower"===o?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===o&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const e of l)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:oe(oe(e.calculate,'datum["',""),'"]',"")})}var g,p;return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}(l,d,g,p,m,f,t,n),O=o,w=h,j=(O[w],"x"===h?"x2":"y2"),A=(O[j],"x"===h?"xError":"yError"),F=(O[A],"x"===h?"xError2":"yError2"),k=(O[F],D(O,["symbol"==typeof w?w:w+"","symbol"==typeof j?j:j+"","symbol"==typeof A?A:A+"","symbol"==typeof F?F:F+""])),{bins:C,timeUnits:E,aggregate:$,groupby:S,encoding:B}=Bo(k,n),_=[...$,...b],z="raw"!==f?[]:S,P=To(y,d,B,x);return{transform:[...null!==(i=u.transform)&&void 0!==i?i:[],...C,...E,...0===_.length?[]:[{aggregate:_,groupby:z}],...v],groupby:z,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:B,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:P}}function Zo(e,t,n){return te(e)+" "+n+" "+t}const es=new Ie("errorband",ts);function ts(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,markDef:s,outerSpec:a,tooltipEncoding:u}=Ko(e,"errorband",t),l=s,c=qo(l,r,i,o,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign({},g),p)):l.interpolate?Bn(Fn("interpolate")):l.tension&&Bn(Fn("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:g,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:g,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const ns={};function is(e,t,n){const i=new Ie(e,t);ns[e]={normalizer:i,parts:n}}is("boxplot",Vo,["box","median","outliers","rule","ticks"]),is("errorbar",Xo,["ticks","rule"]),is("errorband",ts,["band","borders"]);const rs=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],os=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],ss={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},as={single:{on:"click",fields:["_vgsid_"],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:["_vgsid_"],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function us(e){return!(!e||"legend"!==e&&!e.legend)}function ls(e){return us(e)&&d(e)}function cs(e){return"concat"in e}function fs(e){return"vconcat"in e}function ds(e){return"hconcat"in e}function gs(e){return d(e)&&void 0!==e.step}function ps(e){return e.view||e.width||e.height}const ms=J({align:1,bounds:1,center:1,columns:1,spacing:1});function hs(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function bs(e,t){const n=vs(e,t);return gs(n)?n.step:ys}function vs(e,t){var n;return ue(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const ys=20,xs={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:ys},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:Re,circle:{},geoshape:{},image:{},line:{},point:{},rect:Ue,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:as,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},Os=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],ws={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},js={blue:Os[0],orange:Os[1],red:Os[2],teal:Os[3],green:Os[4],yellow:Os[5],purple:Os[6],pink:Os[7],brown:Os[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function As(e={}){const{color:t,font:n,fontSize:i}=e,r=D(e,["color","font","fontSize"]);return p({},xs,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:d(e)?Object.assign(Object.assign({},js),e):js}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},i?function(e){return{signals:[{name:"fontSize",value:d(e)?Object.assign(Object.assign({},ws),e):ws}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(i):{},r||{})}const Ds=["view",...Ne],Fs=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],ks=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function Cs(e){e=_(e);for(const t of Fs)delete e[t];if(e.axis)for(const t in e.axis)ge(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of rs)delete e.legend[t];if(e.mark){for(const t of Me)delete e.mark[t];e.mark.tooltip&&d(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of Ds){for(const n of Me)delete e[t][n];const n=ks[t];if(n)for(const i of n)delete e[t][i];Es(e,t)}for(const t of J(ns))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=ho(e.title);V(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t));V(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n));V(i)?delete e.title:e.title=i}(e);for(const t in e)d(e[t])&&V(e[t])&&delete e[t];return V(e)?void 0:e}function Es(e,t,n,i){const r=i?e[t][i]:e[t];"view"===t&&(n="cell");const o=Object.assign(Object.assign({},r),e.style[null!=n?n:t]);V(o)||(e.style[null!=n?n:t]=o),i||delete e[t]}function $s(e){return"layer"in e}class Ss{map(e,t){return Cr(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):ds(e)?this.mapHConcat(e,t):fs(e)?this.mapVConcat(e,t):cs(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if($s(e))return this.mapLayer(e,t);if(We(e))return this.mapUnit(e,t);throw new Error(nn(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(e=>this.mapLayerOrUnit(e,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(e=>this.map(e,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(e=>this.map(e,t))})}mapConcat(e,t){const{concat:n}=e,i=D(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map(e=>this.map(e,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const Bs={zero:1,center:1,normalize:1};const _s=new Set([xe,we,Oe,ke,De,Se,Be,Ae,Ce,Ee]),zs=new Set([we,Oe,xe]);function Ps(e,t){var n,i;const r="x"===t?"y":"radius",o=e[t],s=e[r];if(Nr(o)&&Nr(s))if("quantitative"===Lr(o)&&"quantitative"===Lr(s)){if(o.stack)return t;if(s.stack)return r;const e=Nr(o)&&!!o.aggregate;if(e!==(Nr(s)&&!!s.aggregate))return e?t:r;{const e=null===(n=o.scale)||void 0===n?void 0:n.type,a=null===(i=s.scale)||void 0===i?void 0:i.type;if(e&&"linear"!==e)return r;if(a&&"linear"!==a)return t}}else{if("quantitative"===Lr(o))return t;if("quantitative"===Lr(s))return r}else{if("quantitative"===Lr(o))return t;if("quantitative"===Lr(s))return r}}function Ns(e,t,n={}){const i=Le(e)?e.type:e;if(!_s.has(i))return null;const r=Ps(t,"x")||Ps(t,"theta");if(!r)return null;const o=t[r],s=Nr(o)?Jr(o,{}):void 0;let a=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(r),u=t[a],l=Nr(u)?Jr(u,{}):void 0;l===s&&(l=void 0,u=void 0,a=void 0);const c=zt.reduce((e,n)=>{if("tooltip"!==n&&$o(t,n)){const i=t[n];for(const t of b(i)){const i=ro(t);if(i.aggregate)continue;const r=Jr(i,{});r&&r===l||e.push({channel:n,fieldDef:i})}}return e},[]);let f;if(void 0!==o.stack?f=x(o.stack)?o.stack?"zero":null:o.stack:c.length>0&&zs.has(i)&&(f="zero"),!f||!(f in Bs))return null;var d;if(So(t)&&0===c.length)return null;if(o.scale&&o.scale.type&&o.scale.type!==xi){if(n.disallowNonLinearStack)return null;Bn(function(e){return`Cannot stack non-linear scale (${e}).`}(o.scale.type))}return Rr(t[St(r)])?(void 0!==o.stack&&Bn(`Cannot stack "${d=r}" if there is already "${d}2".`),null):(Nr(o)&&o.aggregate&&!M(Ke,o.aggregate)&&Bn(`Stacking is applied even though the aggregate function is non-summative ("${o.aggregate}").`),{groupbyChannel:u?a:void 0,groupbyField:l,fieldChannel:r,impute:null!==o.impute&&ze(i),stackBy:c,offset:f})}function Ls(e){const t=D(e,["point","line"]);return J(t).length>1?t:t.type}function Ts(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:P(e[t],["point","line"])}));return e}function Ms(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?d(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?d(t.point)?t.point:{}:void 0}function qs(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class Rs{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(We(e)){const{mark:n,encoding:i}=e,r=Le(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!Ms(r,t[r.type],i);case"area":return!!Ms(r,t[r.type],i)||!!qs(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:o,encoding:s,mark:a}=e,u=D(e,["selection","projection","encoding","mark"]),l=Le(a)?a:{type:a},c=Ms(l,i[l.type],s),f="area"===l.type&&qs(l,i[l.type]),d=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:Ls(Object.assign(Object.assign({},"area"===l.type&&void 0===l.opacity&&void 0===l.fillOpacity?{opacity:.7}:{}),l)),encoding:P(s,["shape"])})],g=Ns(l,s);let p=s;if(g){const{fieldChannel:e,offset:t}=g;p=Object.assign(Object.assign({},s),{[e]:Object.assign(Object.assign({},s[e]),t?{stack:t}:{})})}return f&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},z(l,["clip","interpolate","tension","tooltip"])),f),encoding:p})),c&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},z(l,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},u),{layer:d}),Object.assign(Object.assign({},t),{config:Ts(i)}))}}class Us{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(We(e)&&e.encoding)for(const n of Nt){const i=e.encoding[n];if(i&&Rr(i)&&(null===(t=null==i?void 0:i.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const e of Nt){const r=Bt(e),o=i[e];if(o&&Rr(o)&&(null===(t=null==o?void 0:o.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=o,s=D(o,["scale"]),a=D(t,["rangeStep"]);n[r]={step:t.rangeStep},Bn('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),i=Object.assign(Object.assign({},i),{[e]:Object.assign(Object.assign({},s),V(a)?{}:{scale:a})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}function Ws(e,t){return t?Fr(e)?Ys(e,t):Gs(e,t):e}function Is(e,t){return t?Ys(e,t):e}function Hs(e,t,n){const i=t[e];return function(e){return e&&!w(e)&&"repeat"in e}(i)?i.repeat in n?Object.assign(Object.assign({},t),{[e]:n[i.repeat]}):void Bn(function(e){return`Unknown repeated value "${e}".`}(i.repeat)):t}function Gs(e,t){if(void 0!==(e=Hs("field",e,t))){if(null===e)return null;if($r(e)&&Ar(e.sort)){const n=Hs("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function Vs(e,t){if(Nr(e))return Gs(e,t);{const n=Hs("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function Js(e,t){if(!Rr(e)){if(Pr(e)){const n=Vs(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});return D(e,["condition"])}return e}{const n=Vs(e,t);if(n)return n;if(_r(e))return{condition:e.condition}}}function Ys(e,t){const n={};for(const i in e)if(y(e,i)){const r=e[i];if(f(r))n[i]=r.map(e=>Js(e,t)).filter(e=>e);else{const e=Js(r,t);void 0!==e&&(n[i]=e)}}return n}class Xs{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(We(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of kt){const n=t[Et(e)];if(t[e]&&(Nr(n)&&!Kt(n.bin)||Tr(n)))return!0}}return!1}run(e,t,n){const{encoding:i}=e;var r,o;return Bn((r=!!i.x2,o=!!i.y2,`Line mark is for continuous lines and thus cannot be used with ${r&&o?"x2 and y2":r?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}function Qs(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const e=J(t).reduce((e,t)=>(n[t]&&e.push(t),e),[]);e.length>0&&Bn(`Layer's shared ${(i=e).join(",")} channel ${1===i.length?"is":"are"} overriden.`)}var i;const r=Object.assign(Object.assign({},null!=t?t:{}),null!=n?n:{});return V(r)?void 0:r}function Ks(e){const{parentProjection:t,projection:n}=e;return t&&n&&Bn(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${N(t)} is overridden by a child projection ${N(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function Zs(e,t){void 0===t&&(t=As(e.config));const n=function(e,t={}){return ea.map(e,{config:t})}(e,t),{width:i,height:r}=e,o=function(e,t,n){let{width:i,height:r}=t;const o=We(e)||$s(e),s={};o?"container"==i&&"container"==r?(s.type="fit",s.contains="padding"):"container"==i?(s.type="fit-x",s.contains="padding"):"container"==r&&(s.type="fit-y",s.contains="padding"):("container"==i&&(Bn(rn("width")),i=void 0),"container"==r&&(Bn(rn("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},s),n?ta(n.autosize):{}),ta(e.autosize));"fit"!==a.type||o||(Bn('Autosize "fit" only works for single views and layered views.'),a.type="pad");"container"==i&&"fit"!=a.type&&"fit-x"!=a.type&&Bn(on("width"));"container"==r&&"fit"!=a.type&&"fit-y"!=a.type&&Bn(on("height"));if(B(a,{type:"pad"}))return;return a}(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),o?{autosize:o}:{})}const ea=new class extends Ss{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[Ho,Yo,es,new Rs,new Xs,new Us]}map(e,t){if(We(e)){const n=$o(e.encoding,et),i=$o(e.encoding,tt),r=$o(e.encoding,"facet");if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,r=Object.assign(Object.assign({},e),{encoding:Is(e.encoding,t.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,t);const o=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(r,t.config))return e.run(r,t,o);return r}mapRepeat(e,t){return function(e){return!f(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,r=D(e,["repeat","spec"]),{row:o,column:s,layer:a}=n,{repeater:u={},repeaterPrefix:l=""}=t;return o||s?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),s?{column:s}:{}),spec:{repeat:{layer:a},spec:i}}),t):Object.assign(Object.assign({},r),{layer:a.map(e=>{const n=Object.assign(Object.assign({},u),{layer:e}),r=(i.name||"")+l+"child__layer_"+K(e),o=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:r}));return o.name=r,o})})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:r,data:o}=e,s=D(e,["repeat","spec","data"]);!f(i)&&e.columns&&(e=P(e,["columns"]),Bn(cn("repeat")));const a=[],{repeater:u={},repeaterPrefix:l=""}=t,c=!f(i)&&i.row||[u?u.row:null],d=!f(i)&&i.column||[u?u.column:null],g=f(i)&&i||[u?u.repeat:null];for(const e of g)for(const n of c)for(const o of d){const s={repeat:e,row:n,column:o,layer:u.layer},c=(r.name||"")+l+"child__"+(f(i)?""+K(e):(i.row?"row_"+K(n):"")+(i.column?"column_"+K(o):"")),d=this.map(r,Object.assign(Object.assign({},t),{repeater:s,repeaterPrefix:c}));d.name=c,a.push(P(d,["data"]))}const p=f(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:null!==(n=r.data)&&void 0!==n?n:o,align:"all"},s),{columns:p,concat:a})}mapFacet(e,t){const{facet:n}=e;return Fr(n)&&e.columns&&(e=P(e,["columns"]),Bn(cn("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:o,config:s}=t,a=Ks({parentProjection:o,projection:i}),u=Qs({parentEncoding:r,encoding:Is(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),a?{projection:a}:{}),u?{encoding:u}:{}),{config:s})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:o}=n,s=D(n,["row","column","facet"]),{mark:a,width:u,projection:l,height:c,view:f,selection:d,encoding:g}=e,p=D(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:h}=this.getFacetMappingAndLayout({row:i,column:r,facet:o},t),b=Is(s,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),h),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),c?{height:c}:{}),f?{view:f}:{}),l?{projection:l}:{}),{mark:a,encoding:b}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:r,facet:o}=e;if(i||r){o&&Bn(`Facet encoding dropped as ${(s=[...i?[et]:[],...r?[tt]:[]]).join(" and ")} ${s.length>1?"are":"is"} also specified.`);const t={},a={};for(const i of[et,tt]){const r=e[i];if(r){const e=D(r,["align","center","spacing","columns"]);t[i]=e;for(const e of["align","center","spacing"])void 0!==r[e]&&(a[e]=null!==(n=a[e])&&void 0!==n?n:{},a[e][i]=r[e])}}return{facetMapping:t,layout:a}}{const{align:e,center:n,spacing:i,columns:r}=o;return{facetMapping:Ws(D(o,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),i?{spacing:i}:{}),r?{columns:r}:{})}}var s}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=D(t,["parentEncoding","parentProjection"]);const{encoding:o,projection:s}=e,a=D(e,["encoding","projection"]),u=Object.assign(Object.assign({},r),{parentEncoding:Qs({parentEncoding:n,encoding:o}),parentProjection:Ks({parentProjection:i,projection:s})});return super.mapLayer(a,u)}};function ta(e){return w(e)?{type:e}:null!=e?e:{}}const na=["background","padding"];function ia(e){return na.reduce((t,n)=>(e&&void 0!==e[n]&&(t[n]=e[n]),t),{})}class ra{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new ra(_(this.explicit),_(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return ue(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of J(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function oa(e){return{explicit:!0,value:e}}function sa(e){return{explicit:!1,value:e}}function aa(e){return(t,n,i,r)=>{const o=e(t.value,n.value);return o>0?t:o<0?n:ua(t,n,i,r)}}function ua(e,t,n,i){return e.explicit&&t.explicit&&Bn(function(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${N(n)} and ${N(i)}). Using ${N(n)}.`}(n,i,e.value,t.value)),e}function la(e,t,n,i,r=ua){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:B(e.value,t.value)?e:r(e,t,n,i)}class ca extends ra{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function fa(e){return"url"in e}function da(e){return"values"in e}function ga(e){return"name"in e&&!fa(e)&&!da(e)&&!pa(e)}function pa(e){return e&&(ma(e)||ha(e)||ba(e))}function ma(e){return"sequence"in e}function ha(e){return"sphere"in e}function ba(e){return"graticule"in e}const va="main";function ya(e){return"filter"in e}function xa(e){return"lookup"in e}function Oa(e){return"pivot"in e}function wa(e){return"density"in e}function ja(e){return"quantile"in e}function Aa(e){return"regression"in e}function Da(e){return"loess"in e}function Fa(e){return"sample"in e}function ka(e){return"window"in e}function Ca(e){return"joinaggregate"in e}function Ea(e){return"flatten"in e}function $a(e){return"calculate"in e}function Sa(e){return"bin"in e}function Ba(e){return"impute"in e}function _a(e){return"timeUnit"in e}function za(e){return"aggregate"in e}function Pa(e){return"stack"in e}function Na(e){return"fold"in e}function La(e,t,n){return Ta=t||qa,Ma=n||Ua,Ia(e.trim()).map(Ha)}var Ta,Ma,qa="view",Ra=/[[\]{}]/,Ua={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function Wa(e,t,n,i,r){for(var o,s=0,a=e.length;t<a;++t){if(o=e[t],!s&&o===n)return t;r&&r.indexOf(o)>=0?--s:i&&i.indexOf(o)>=0&&++s}return t}function Ia(e){for(var t=[],n=0,i=e.length,r=0;r<i;)r=Wa(e,r,",","[{","]}"),t.push(e.substring(n,r).trim()),n=++r;if(0===t.length)throw"Empty event selector: "+e;return t}function Ha(e){return"["===e[0]?function(e){var t,n,i=e.length,r=1;if((r=Wa(e,r,"]","[","]"))===i)throw"Empty between selector: "+e;if(2!==(t=Ia(e.substring(1,r))).length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;if(t=t.map(Ha),(n=Ha(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t;return n}(e):function(e){var t,n,i={source:Ta},r=[],o=[0,0],s=0,a=0,u=e.length,l=0;if("}"===e[u-1]){if(!((l=e.lastIndexOf("{"))>=0))throw"Unmatched right brace: "+e;try{o=function(e){var t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((function(t){var n=+t;if(n!=n)throw e;return n}))}(e.substring(l+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,l).trim(),u=e.length,l=0}if(!u)throw e;"@"===e[0]&&(s=++l);(t=Wa(e,l,":"))<u&&(r.push(e.substring(a,t).trim()),a=l=++t);if((l=Wa(e,l,"["))===u)r.push(e.substring(a,u).trim());else if(r.push(e.substring(a,l).trim()),n=[],(a=++l)===u)throw"Unmatched left bracket: "+e;for(;l<u;){if((l=Wa(e,l,"]"))===u)throw"Unmatched left bracket: "+e;if(n.push(e.substring(a,l).trim()),l<u-1&&"["!==e[++l])throw"Expected left bracket: "+e;a=++l}if(!(u=r.length)||Ra.test(r[u-1]))throw"Invalid event selector: "+e;u>1?(i.type=r[1],s?i.markname=r[0].slice(1):(c=r[0],Ma[c]?i.marktype=r[0]:i.source=r[0])):i.type=r[0];var c;"!"===i.type.slice(-1)&&(i.consume=!0,i.type=i.type.slice(0,-1));null!=n&&(i.filter=n);o[0]&&(i.throttle=o[0]);o[1]&&(i.debounce=o[1]);return i}(e)}function Ga(e,t,n,i){const r=_r(t)&&t.condition,o=i(t);if(r){return{[n]:[...b(r).map(t=>{const n=i(t),r=function(e){return e.selection}(t)?nc(e,t.selection):rc(e,t.test);return Object.assign({test:r},n)}),...void 0!==o?[o]:[]]}}return void 0!==o?{[n]:o}:{}}function Va(e,t="text"){const n=e.encoding[t];return Ga(e,n,t,t=>Ja(t,e.config))}function Ja(e,t,n="datum"){if(e){if(Wr(e))return vo(e.value);if(Rr(e)){const{format:i,formatType:r}=io(e);return fr({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function Ya(e,t={}){const{encoding:n,markDef:i,config:r,stack:o}=e,s=n.tooltip;if(f(s))return{tooltip:Qa({tooltip:s},o,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return Ga(e,s,"tooltip",e=>{const s=Ja(e,r,a);if(s)return s;if(null===e)return;let u=wo("tooltip",i,r);return!0===u&&(u={content:"encoding"}),w(u)?{value:u}:d(u)?"encoding"===u.content?Qa(n,o,r,t):{signal:a}:void 0})}}function Xa(e,t,n,{reactiveGeom:i}={}){const r={},o=i?"datum.datum":"datum",s=[];function a(i,a){const u=Et(a),l=Ur(i)?i:Object.assign(Object.assign({},i),{type:e[u].type}),c=b(eo(l,n,{allowDisabling:!1})).join(", ");let f;if(Lt(a)){const i="x"===a?"x2":"y2",s=ro(e[i]);if(Kt(l.bin)&&s){const e=Jr(l,{expr:o}),t=Jr(s,{expr:o}),{format:a,formatType:u}=io(l);f=yr(e,t,a,u,n),r[i]=!0}else if(t&&t.fieldChannel===a&&"normalize"===t.offset){const{format:e,formatType:t}=io(l);f=fr({fieldOrDatumDef:l,format:e,formatType:t,expr:o,config:n,normalizeStack:!0}).signal}}f=null!=f?f:Ja(l,n,o).signal,s.push({channel:a,key:c,value:f})}Po(e,(e,t)=>{Nr(e)?a(e,t):zr(e)&&a(e.condition,t)});const u={};for(const{channel:e,key:t,value:n}of s)r[e]||u[t]||(u[j(t)]=n);return u}function Qa(e,t,n,{reactiveGeom:i}={}){const r=X(Xa(e,t,n,{reactiveGeom:i})).map(({key:e,value:t})=>`${e}: ${t}`);return r.length>0?{signal:`{${r.join(", ")}}`}:void 0}function Ka(e){const{markDef:t,config:n}=e,i=wo("aria",t,n);return!1===i?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),function(e){const{mark:t,markDef:n,config:i}=e;if(!1===i.aria)return{};const r=wo("ariaRoleDescription",n,i);if(null!=r)return{ariaRoleDescription:{value:r}};return t in Zn?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:i,stack:r}=e,o=t.description;if(o)return Ga(e,o,"description",t=>Ja(t,e.config));const s=wo("description",n,i);if(null!=s)return{description:vo(s)};if(!1===i.aria)return{};const a=Xa(t,r,i);if(V(a))return;return{description:{signal:X(a).map(({key:e,value:t})=>`${e} + ": " + (${t})`).join(' + "; " + ')}}}(e))}function Za(e,t,n={}){const{markDef:i,encoding:r,config:o}=t,{vgChannel:s}=n;let{defaultRef:a,defaultValue:u}=n;void 0===a&&(u=null!=u?u:wo(e,i,o,{vgChannel:s,ignoreVgConfig:!0}),void 0!==u&&(a=vo(u)));const l=r[e];return Ga(t,l,null!=s?s:e,n=>ar({channel:e,channelDef:n,markDef:i,config:o,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function eu(e,t={filled:void 0}){var n,i,r,o;const{markDef:s,encoding:a,config:u}=e,{type:l}=s,c=null!==(n=t.filled)&&void 0!==n?n:wo("filled",s,u),f=M(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=null!==(r=null!==(i=wo(!0===c?"color":void 0,s,u,{vgChannel:"fill"}))&&void 0!==i?i:u.mark[!0===c&&"color"])&&void 0!==r?r:f,g=null!==(o=wo(!1===c?"color":void 0,s,u,{vgChannel:"stroke"}))&&void 0!==o?o:u.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:vo(d)}:{}),g?{stroke:vo(g)}:{});return s.color&&(c?s.fill:s.stroke)&&Bn(pn("property",{fill:"fill"in s,stroke:"stroke"in s})),Object.assign(Object.assign(Object.assign(Object.assign({},m),Za("color",e,{vgChannel:p,defaultValue:c?d:g})),Za("fill",e,{defaultValue:a.fill?d:void 0})),Za("stroke",e,{defaultValue:a.stroke?g:void 0}))}function tu(e,t){const n=t[function(e){switch(e){case nt:return"xOffset";case it:return"yOffset";case rt:return"x2Offset";case ot:return"y2Offset";case at:return"thetaOffset";case st:return"radiusOffset";case ut:return"theta2Offset";case"radius2":return"radius2Offset"}}(e)];if(n)return n}function nu(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:o,markDef:s,config:a,stack:u}=t,l=o[e],c=o[St(e)],f=t.scaleName(e),d=t.getScaleComponent(e),g=tu(e,s),p=iu({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!l&&Lt(e)&&(o.latitude||o.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:o,offset:s,markDef:a,config:u}=e;if(Rr(n)&&o&&t===o.fieldChannel){if(Nr(n)){const e=Sr({channel:t,fieldDef:n,isMidPoint:i,markDef:a,stack:o,config:u});if(void 0!==e)return sr({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:s})}return or(n,r,{suffix:"end"},{offset:s})}return tr(e)}({channel:e,channelDef:l,channel2Def:c,markDef:s,config:a,isMidPoint:r,scaleName:f,scale:d,stack:u,offset:g,defaultRef:p});return m?{[i||e]:m}:void 0}function iu({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:o,config:s}=e;return()=>{const a=Et(n),u=$t(n),l=wo(n,o,s,{vgChannel:u});if(void 0!==l)return ur(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const e=r.get("type");if(M([Oi,Di,Fi],e));else if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}if("zeroOrMin"===t)return"y"===a?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[Bt(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}const ru={left:"x",center:"xc",right:"x2"},ou={top:"y",middle:"yc",bottom:"y2"};function su(e,t,n,i="middle"){if("radius"===e||"theta"===e)return $t(e);const r=wo("x"===e?"align":"baseline",t,n);return"x"===e?ru[r||("top"===i?"left":"center")]:ou[r||i]}function au(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?uu(e,t,{defaultPos:n,defaultPos2:i}):nu(e,t,{defaultPos:n})}function uu(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:o}=t,s=St(e),a=Bt(e),u=function(e,t,n){const{encoding:i,mark:r,markDef:o,stack:s,config:a}=e,u=Et(n),l=Bt(n),c=$t(n),f=i[u],d=e.scaleName(u),g=e.getScaleComponent(u),p=tu(n in i||n in o?n:u,e.markDef);if(!f&&("x2"===n||"y2"===n)&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l}){if(Rr(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0))return or(t,o,{suffix:"start"},{offset:u});return tr({channel:e,channelDef:n,scaleName:o,scale:s,stack:a,markDef:i,config:r,offset:u,defaultRef:l})}({channel:n,channelDef:f,channel2Def:i[n],markDef:o,config:a,scaleName:d,scale:g,stack:s,offset:p,defaultRef:void 0});if(void 0!==m)return{[c]:m};return lu(n,o)||lu(n,{[n]:Ao(n,o,a.style),[l]:Ao(l,o,a.style)})||lu(n,a[r])||lu(n,a.mark)||{[c]:iu({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}(t,i,s),l=u[a]?su(e,r,o):$t(e);return Object.assign(Object.assign({},nu(e,t,{defaultPos:n,vgChannel:l})),u)}function lu(e,t){const n=Bt(e),i=$t(e);return void 0!==t[i]?{[i]:ur(e,t[i])}:void 0!==t[e]?{[i]:ur(e,t[e])}:t[n]?{[n]:ur(e,t[n])}:void 0}function cu(e,t,n){var i,r,o,s;const{config:a,encoding:u,markDef:l,stack:c}=e,d=St(t),g=Bt(t),p=u[t],m=u[d],h=e.getScaleComponent(t),b=h?h.get("type"):void 0,v=e.scaleName(t),y=l.orient,x=null!==(r=null!==(i=u[g])&&void 0!==i?i:u.size)&&void 0!==r?r:wo("size",l,a,{vgChannel:g}),O="bar"===n&&("x"===t?"vertical"===y:"horizontal"===y);if(Nr(p)&&(Qt(p.bin)||Kt(p.bin)||p.timeUnit&&!m)&&!x&&!Wi(b)){const n=Sr({channel:t,fieldDef:p,stack:c,markDef:l,config:a}),i=null===(o=e.component.axes[t])||void 0===o?void 0:o[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:o,spacing:s=0,axisTranslate:a,reverse:u,config:l}){const c=St(n),f=$t(n),d=$t(c),g=tu(n,o);if(Qt(e.bin)||e.timeUnit)return{[d]:gu({channel:n,fieldDef:e,scaleName:r,markDef:o,band:(1-i)/2,offset:du(c,s,u,a,g),config:l}),[f]:gu({channel:n,fieldDef:e,scaleName:r,markDef:o,band:1-(1-i)/2,offset:du(n,s,u,a,g),config:l})};if(Kt(e.bin)){const i=or(e,r,{},{offset:du(c,s,u,a,g)});if(Nr(t))return{[d]:i,[f]:or(t,r,{},{offset:du(n,s,u,a,g)})};if(Zt(e.bin)&&e.bin.step)return{[d]:i,[f]:{signal:`scale("${r}", ${Jr(e,{expr:"datum"})} + ${e.bin.step})`,offset:du(n,s,u,a,g)}}}return void Bn(kn(c))}({fieldDef:p,fieldDef2:m,channel:t,markDef:l,scaleName:v,band:n,axisTranslate:null!==(s=null==i?void 0:i.get("translate"))&&void 0!==s?s:.5,spacing:Lt(t)?wo("binSpacing",l,a):void 0,reverse:h.get("reverse"),config:a})}return(Rr(p)&&Wi(b)||O)&&!m?function(e,t,n,i){var r;const{markDef:o,encoding:s,config:a,stack:u}=i,l=o.orient,c=i.scaleName(n),d=i.getScaleComponent(n),g=Bt(n),p=St(n),m="horizontal"===l&&"y"===n||"vertical"===l&&"x"===n,h=wo(m?"size":g,o,a,{vgChannel:g});let b;(s.size||void 0!==h)&&(m?b=Za("size",i,{vgChannel:g,defaultValue:h}):Bn(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(o.type)));const v=null!==(r=Rr(t)?Sr({channel:n,fieldDef:t,markDef:o,stack:u,config:a}):void 0)&&void 0!==r?r:1;b=b||{[g]:fu(e,g,c,d,a,v)};const y="band"!==(null==d?void 0:d.get("type"))||!("band"in b[g]),x=su(n,o,a,y?"middle":"top"),O=tu(n,o),w=tr({channel:n,channelDef:t,markDef:o,config:a,scaleName:c,scale:d,stack:u,offset:O,defaultRef:iu({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:d}),band:y?.5:(1-v)/2});if(g)return Object.assign({[x]:w},b);{const e=$t(p),t=b[g],n=O?Object.assign(Object.assign({},t),{offset:O}):t;return{[x]:w,[e]:f(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,p,t,e):uu(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function fu(e,t,n,i,r,o){if(i){const t=i.get("type");if("point"===t||"band"===t){if(void 0!==r[e].discreteBandSize)return{value:r[e].discreteBandSize};if(t===$i){const e=i.get("range");return Xn(e)&&O(e.step)?{value:e.step-2}:{value:ys-2}}return{scale:n,band:o}}return{value:r[e].continuousBandSize}}const s=bs(r.view,t),a=ue(r[e].discreteBandSize,s-2);return void 0!==a?{value:a}:void 0}function du(e,t,n,i,r){if(mt(e))return 0;const o="x"===e||"y2"===e?-t/2:t/2;if(Yn(n)){const e=xo(r);return{signal:`${n.signal} ? ${i-o}${e?"-"+e:""} : ${i+o}${e?"+"+e:""}`}}if(Yn(r)){const e=i+(n?-o:o);return{signal:`${e||""}${n?" - ":e?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-o:+r+o)}function gu({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:o,config:s}){return nr({fieldDef:t,channel:e,markDef:i,ref:sr({scaleName:n,fieldOrDatumDef:t,band:r,offset:o}),config:s})}const pu=new Set(["aria"]);function mu(e,t){const{fill:n,stroke:i}="include"===t.color?eu(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return Kn.reduce((n,i)=>(pu.has(i)||void 0===e[i]||"ignore"===t[i]||(n[i]=vo(e[i])),n),{})}(e.markDef,t)),hu(e,"fill",n)),hu(e,"stroke",i)),Za("opacity",e)),Za("fillOpacity",e)),Za("strokeOpacity",e)),Za("strokeWidth",e)),Za("strokeDash",e)),Ya(e)),Va(e,"href")),Ka(e))}function hu(e,t,n){const{config:i,mark:r,markDef:o}=e;if("hide"===wo("invalid",o,i)&&n&&!ze(r)){const i=function(e,{invalid:t=!1,channels:n}){const i=n.reduce((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),o=e.vgField(n,{expr:"datum"});o&&Ii(r)&&(t[o]=!0)}return t},{}),r=J(i);if(r.length>0){const e=t?"||":"&&";return r.map(e=>rr(e,t)).join(` ${e} `)}return}(e,{invalid:!0,channels:It});if(i)return{[t]:[{test:i,value:null},...b(n)]}}return n?{[t]:n}:{}}function bu(e){const{config:t,markDef:n}=e;if(wo("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const i=n.reduce((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),o=e.vgField(n,{expr:"datum"});o&&Ii(r)&&(t[o]=!0)}return t},{}),r=J(i);if(r.length>0){const e=t?"||":"&&";return r.map(e=>rr(e,t)).join(` ${e} `)}return}(e,{channels:Nt});if(t)return{defined:{signal:t}}}return{}}function vu(e,t){if(void 0!==t)return{[e]:vo(t)}}const yu={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName("voronoi")},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,o=e.mark;if(ze(o))return Bn(`The "nearest" transform is not supported for ${o} marks.`),n;const s={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Ya(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((t,n)=>{var i;const r=null!==(i=t.name)&&void 0!==i?i:"";r===e.component.mark[0].name?a=n:r.indexOf("voronoi")>=0&&(u=!0)}),u||n.splice(a+1,0,s),n}};class xu{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?console.warn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class Ou extends xu{constructor(e,t,n,i){super(e,t),this.type=n,this.refCounts=i,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output "+function(e){const t=++le;return e?String(e)+t:t}()),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class wu extends xu{constructor(e,t){super(e),this.formula=t}clone(){return new wu(null,_(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,i)=>{const{field:r,timeUnit:o}=n,s=Sd(t)?t.encoding[St(i)]:void 0,a=Sd(t)&&Br(i,n,s,t.stack,t.markDef,t.config);if(o){const t=Jr(n,{forAs:!0});e[L({as:t,field:r,timeUnit:o})]=Object.assign({as:t,field:r,timeUnit:o},a?{band:!0}:{})}return e},{});return V(n)?null:new wu(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=D(n,["timeUnit"]),o=Jn(i),s=Object.assign(Object.assign({},r),{timeUnit:o});return new wu(e,{[L(s)]:s})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Y(this.formula).map(e=>e.as))}dependentFields(){return new Set(Y(this.formula).map(e=>e.field))}hash(){return"TimeUnit "+L(this.formula)}assemble(){const e=[];for(const t of Y(this.formula)){const{field:n,as:i,timeUnit:r}=t,o=Jn(r),{unit:s,utc:a}=o,u=D(o,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:re(n),type:"timeunit"},s?{units:In(s)}:{}),a?{timezone:"utc"}:{}),u),{as:[i,i+"_end"]}))}return e}}class ju{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const Au={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!us(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,o=t.bind,s=t.init&&t.init[0],a=yu.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((e,r)=>{var u,l;const c=K(`${i}_${e.field}`);n.filter(e=>e.name===c).length||n.unshift(Object.assign(Object.assign({name:c},s?{init:Tu(s[r])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${j(e.field)}] : null`}]:[],bind:null!==(l=null!==(u=o[e.field])&&void 0!==u?u:o[e.channel])&&void 0!==l?l:o}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.filter(e=>e.name===i+Ju)[0],s=i+"_tuple_fields",a=r.items.map(e=>K(`${i}_${e.field}`)),u=a.map(e=>e+" !== null").join(" && ");return a.length&&(o.update=`${u} ? {fields: ${s}, values: [${a.join(", ")}]} : null`),delete o.value,delete o.on,n}},Du={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Ju,i=t.name+"_toggle";return`${i} ? null : ${n}, `+("global"===t.resolve?i+" ? null : true, ":`${i} ? null : {unit: ${Zu(e)}}, `)+`${i} ? ${n} : null`}},Fu={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=w(n.clear)?La(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(Au.has(t))for(const e of t.project.items){const i=n.findIndex(n=>n.name===K(`${t.name}_${e.field}`));-1!==i&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(e,i){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:i})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex(t=>t.name===e.signals.visual);if(i(t,"[0, 0]"),-1===t){i(n.findIndex(t=>t.name===e.signals.data),"null")}}else{let e=n.findIndex(e=>e.name===t.name+Ju);i(e,"null"),Du.has(t)&&(e=n.findIndex(e=>e.name===t.name+"_toggle"),i(e,"false"))}return n}},ku={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Ht(r))continue;const o=e.getScaleComponent(r),s=o?o.get("type"):void 0;if(!o||!Ii(s)){Bn("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const a={selection:t.name,field:i.field};o.set("selectionExtent",a,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(e=>0===n.filter(t=>t.name===e.signals.data).length);if(!e.parent||Eu(e)||0===i.length)return n;const r=n.filter(e=>e.name===t.name)[0];let o=r.update;if(o.indexOf(Xu)>=0)r.update=`{${i.map(e=>`${j(e.field)}: ${e.signals.data}`).join(", ")}}`;else{for(const e of i){const t=`${j(e.field)}: ${e.signals.data}`;o.indexOf(t)<0&&(o=`${o.substring(0,o.length-1)}, ${t}}`)}r.update=o}return n.concat(i.map(e=>({name:e.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Eu(e))for(const e of t.scales){const t=n.filter(t=>t.name===e.signals.data)[0];t.push="outer",delete t.value,delete t.update}return n}};function Cu(e,t){return`domain(${j(e.scaleName(t))})`}function Eu(e){var t;return e.parent&&zd(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:Eu(e.parent.parent))}const $u={has:e=>{const t="global"===e.resolve&&e.bind&&us(e.bind),n=1===e.project.items.length&&"_vgsid_"!==e.project.items[0].field;return t&&!n&&Bn("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=b(null!==(r=n.filter)&&void 0!==r?r:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const o=ls(t.bind)?t.bind.legend:"click",s=w(o)?La(o,"view"):b(o);t.bind={legend:{merge:s}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=ls(t.bind)&&t.bind.legend,o=e=>t=>{const n=_(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const s=K(e.field)+"_legend",a=`${i}_${s}`;if(0===n.filter(e=>e.name===a).length){const e=r.merge.map(o(s+"_symbols")).concat(r.merge.map(o(s+"_labels"))).concat(r.merge.map(o(s+"_entries")));n.unshift(Object.assign(Object.assign({name:a},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:"!event.item || !datum ? null : "+a,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.find(e=>e.name===i+Ju),s=i+"_tuple_fields",a=r.items.filter(e=>e.hasLegend).map(e=>K(`${i}_${K(e.field)}_legend`)),u=`${a.map(e=>e+" !== null").join(" && ")} ? {fields: ${s}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?o.on.push({events:a.map(e=>({signal:e})),update:u}):a.length>0&&(o.update=u,delete o.value,delete o.on);const l=n.find(e=>e.name===i+"_toggle"),c=ls(t.bind)&&t.bind.legend;return l&&(t.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:c})):l.on[0].events=c),n}};const Su="_translate_delta",Bu={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const i=t.name,r=ku.has(t),o=i+"_translate_anchor",{x:s,y:a}=t.project.hasChannel;let u=La(t.translate,"scope");return r||(u=u.map(e=>(e.between[0].markname=i+Ru,e))),n.push({name:o,value:{},on:[{events:u.map(e=>e.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==s?", extent_x: "+(r?Cu(e,nt):`slice(${s.signals.visual})`):"")+(void 0!==a?", extent_y: "+(r?Cu(e,it):`slice(${a.signals.visual})`):"")+"}"}]},{name:i+Su,value:{},on:[{events:u,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),void 0!==s&&_u(e,t,s,"width",n),void 0!==a&&_u(e,t,a,"height",n),n}};function _u(e,t,n,i,r){var o;const s=t.name,a=s+"_translate_anchor",u=s+Su,l=n.channel,c=ku.has(t),f=r.filter(e=>e.name===n.signals[c?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,g=e.getScaleComponent(l),p=g.get("type"),m=`${a}.extent_${l}`,h=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&l===nt?"-":""}${u}.${l} / `+(c?""+d:`span(${m})`)}`+(c&&"pow"===p?", "+(null!==(o=g.get("exponent"))&&void 0!==o?o:1):"")+")";f.on.push({events:{signal:u},update:c?h:`clampRange(${h}, 0, ${d})`})}const zu={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=ku.has(t),o=i+"_zoom_delta",{x:s,y:a}=t.project.hasChannel,u=j(e.scaleName(nt)),l=j(e.scaleName(it));let c=La(t.zoom,"scope");return r||(c=c.map(e=>(e.markname=i+Ru,e))),n.push({name:i+"_zoom_anchor",on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(e=>!!e).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==s&&Pu(e,t,s,"width",n),void 0!==a&&Pu(e,t,a,"height",n),n}};function Pu(e,t,n,i,r){var o;const s=t.name,a=n.channel,u=ku.has(t),l=r.filter(e=>e.name===n.signals[u?"data":"visual"])[0],c=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(a),d=f.get("type"),g=u?Cu(e,a):l.name,p=s+"_zoom_delta",m=`${u?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${g}, ${`${s}_zoom_anchor.${a}`}, ${p}`+(u&&"pow"===d?", "+(null!==(o=f.get("exponent"))&&void 0!==o?o:1):"")+")";l.on.push({events:{signal:p},update:u?m:`clampRange(${m}, 0, ${c})`})}const Nu=[{has:()=>!0,parse:(e,t,n)=>{var i,r,o;const s=t.name,a=null!==(i=t.project)&&void 0!==i?i:t.project=new ju,u={},l={},c=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let i=K(`${s}_${n}`);for(let e=1;c.has(i);e++)i=K(`${s}_${n}_${e}`);return c.add(i),{[t]:i}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of b(n.init))for(const i of J(e))Dt[i]?(n.encodings||(n.encodings=[])).push(i):"interval"===n.type?(Bn('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(i);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(r=n.fields)&&void 0!==r?r:[]){const t={type:"E",field:e};t.signals=Object.assign({},f(t,"data")),a.items.push(t),a.hasField[e]=t}for(const i of null!==(o=n.encodings)&&void 0!==o?o:[]){const n=e.fieldDef(i);if(n){let r=n.field;if(n.aggregate){Bn(un(i,n.aggregate));continue}if(!r){Bn(an(i));continue}if(n.timeUnit){r=e.vgField(i);const t={timeUnit:n.timeUnit,as:r,field:n.field};l[L(t)]=t}if(!u[r]){let o="E";if("interval"===t.type){Ii(e.getScaleComponent(i).get("type"))&&(o="R")}else n.bin&&(o="R-RE");const s={field:r,channel:i,type:o};s.signals=Object.assign(Object.assign({},f(s,"data")),f(s,"visual")),a.items.push(u[r]=s),a.hasField[r]=a.hasChannel[i]=u[r]}}else Bn(an(i))}if(n.init){const e=e=>a.items.map(t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]);if("interval"===n.type)t.init=e(n.init);else{const i=b(n.init);t.init=i.map(e)}}V(l)||(a.timeUnit=new wu(null,l))},signals:(e,t,n)=>{const i=t.name+"_tuple_fields";return n.filter(e=>e.name===i).length>0?n:n.concat({name:i,value:t.project.items.map(e=>{const t=D(e,["signals","hasLegend"]);return t.field=re(t.field),t})})}},Du,ku,$u,Bu,zu,Au,yu,Fu];function Lu(e,t){for(const n of Nu)n.has(e)&&t(n)}function Tu(e,t=!0,n=l){if(f(e)){const i=e.map(e=>Tu(e,t,n));return t?`[${i.join(", ")}]`:i}return _n(e)?n(t?Mn(e):function(e){const t=Tn(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function Mu(e,t){return Ku(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,Lu(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function qu(e){return e.map(e=>(e.on&&!e.on.length&&delete e.on,e))}const Ru="_brush",Uu={signals:(e,t)=>{const n=t.name,i=n+"_tuple_fields",r=ku.has(t),o=[],s=[],a=[];if(t.translate&&!r){const e="!event.item || event.item.mark.name !== "+j(n+Ru);Wu(t,(t,n)=>{var i;const r=b(null!==(i=n.between[0].filter)&&void 0!==i?i:n.between[0].filter=[]);return r.indexOf(e)<0&&r.push(e),t})}t.project.items.forEach((n,i)=>{const r=n.channel;if(r!==nt&&r!==it)return void Bn("Interval selections only support x and y encoding channels.");const u=t.init?t.init[i]:null,l=function(e,t,n,i){const r=n.channel,o=n.signals.visual,s=n.signals.data,a=ku.has(t),u=j(e.scaleName(r)),l=e.getScaleComponent(r),c=l?l.get("type"):void 0,f=e=>`scale(${u}, ${e})`,d=e.getSizeSignalRef(r===nt?"width":"height").signal,g=r+"(unit)",p=Wu(t,(e,t)=>[...e,{events:t.between[0],update:`[${g}, ${g}]`},{events:t,update:`[${o}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+"_scale_trigger"},update:Ii(c)?`[${f(s+"[0]")}, ${f(s+"[1]")}]`:"[0, 0]"}),a?[{name:s,on:[]}]:[Object.assign(Object.assign({name:o},i?{init:Tu(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:s},i?{init:Tu(i)}:{}),{on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${u}, ${o})`}]})]}(e,t,n,u),c=n.signals.data,f=n.signals.visual,d=j(e.scaleName(r)),g=Ii(e.getScaleComponent(r).get("type"))?"+":"";o.push(...l),s.push(c),a.push({scaleName:e.scaleName(r),expr:`(!isArray(${c}) || (${g}invert(${d}, ${f})[0] === ${g}${c}[0] && ${g}invert(${d}, ${f})[1] === ${g}${c}[1]))`})}),r||o.push({name:n+"_scale_trigger",value:{},on:[{events:a.map(e=>({scale:e.scaleName})),update:a.map(e=>e.expr).join(" && ")+` ? ${n+"_scale_trigger"} : {}`}]});const u=t.init,l=`unit: ${Zu(e)}, fields: ${i}, values`;return o.concat(Object.assign(Object.assign({name:n+Ju},u?{init:`{${l}: ${Tu(u)}}`}:{}),{on:[{events:[{signal:s.join(" || ")}],update:s.join(" && ")+` ? {${l}: [${s}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Ju+", "+("global"===t.resolve?"true":`{unit: ${Zu(e)}}`),marks:(e,t,n)=>{const i=t.name,{x:r,y:o}=t.project.hasChannel,s=r&&r.signals.visual,a=o&&o.signals.visual,u=`data(${j(t.name+Vu)})`;if(ku.has(t))return n;const l={x:void 0!==r?{signal:s+"[0]"}:{value:0},y:void 0!==o?{signal:a+"[0]"}:{value:0},x2:void 0!==r?{signal:s+"[1]"}:{field:{group:"width"}},y2:void 0!==o?{signal:a+"[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of J(l))l[t]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${Zu(e)}`},l[t]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:g}=c,p=D(c,["fill","fillOpacity","cursor"]),m=J(p).reduce((e,t)=>(e[t]=[{test:[void 0!==r&&`${s}[0] !== ${s}[1]`,void 0!==o&&`${a}[0] !== ${a}[1]`].filter(e=>e).join(" && "),value:p[t]},{value:null}],e),{});return[{name:i+Ru+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+Ru,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function Wu(e,t){return e.events.reduce((e,n)=>n.between?t(e,n):(Bn(n+" is not an ordered event stream for interval selections."),e),[])}function Iu(e,t){const n=t.name,i=n+"_tuple_fields",r=t.project,o="(item().isVoronoi ? datum.datum : datum)",s=r.items.map(t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${o}[${j(e.vgField(t.channel,{}))}], ${o}[${j(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${o}[${j(t.field)}]`}).join(", "),a=`unit: ${Zu(e)}, fields: ${i}, values`,u=t.events;return[{name:n+Ju,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${s}]} : null`,force:!0}]:[]}]}const Hu={signals:Iu,modifyExpr:(e,t)=>t.name+Ju+", "+("global"===t.resolve?"null":`{unit: ${Zu(e)}}`)},Gu={signals:Iu,modifyExpr:(e,t)=>t.name+Ju+", "+("global"===t.resolve?"true":`{unit: ${Zu(e)}}`)},Vu="_store",Ju="_tuple",Yu="_modify",Xu="vlSelectionResolve",Qu={single:Gu,multi:Hu,interval:Uu};function Ku(e,t){const n=e.component.selection;if(n)for(const e of Y(n)){if(!0===t(e,Qu[e.type]))break}}function Zu(e,{escape:t}={escape:!0}){let n=t?j(e.name):e.name;const i=function(e){let t=e.parent;for(;t&&!Bd(t);)t=t.parent;return t}(e);if(i){const{facet:e}=i;for(const t of Ot)e[t]&&(n+=` + '__facet_${t}_' + (facet[${j(i.vgField(t))}])`)}return n}function el(e){let t=!1;return Ku(e,e=>{t=t||e.project.items.some(e=>"_vgsid_"===e.field)}),t}var tl,nl,il,rl,ol;function sl(e){this.type=e}sl.prototype.visit=function(e){var t,n,i;if(e(this))return 1;for(n=0,i=(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":var t=e.arguments.slice();return t.unshift(e.callee),t;case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;n<i;++n)if(t[n].visit(e))return 1};(tl={})[1]="Boolean",tl[2]="<end>",tl[3]="Identifier",tl[4]="Keyword",tl[5]="Null",tl[6]="Numeric",tl[7]="Punctuator",tl[8]="String",tl[9]="RegularExpression";var al=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),ul=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function ll(e,t){if(!e)throw new Error("ASSERT: "+t)}function cl(e){return e>=48&&e<=57}function fl(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function dl(e){return"01234567".indexOf(e)>=0}function gl(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function pl(e){return 10===e||13===e||8232===e||8233===e}function ml(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&al.test(String.fromCharCode(e))}function hl(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&ul.test(String.fromCharCode(e))}var bl={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function vl(){for(var e;il<rl&&(gl(e=nl.charCodeAt(il))||pl(e));)++il}function yl(e){var t,n,i,r=0;for(n="u"===e?4:2,t=0;t<n;++t)il<rl&&fl(nl[il])?(i=nl[il++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):Pl({},"Unexpected token %0","ILLEGAL");return String.fromCharCode(r)}function xl(){var e,t,n,i;for(t=0,"}"===(e=nl[il])&&Pl({},"Unexpected token %0","ILLEGAL");il<rl&&fl(e=nl[il++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&Pl({},"Unexpected token %0","ILLEGAL"),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function Ol(){var e,t;for(e=nl.charCodeAt(il++),t=String.fromCharCode(e),92===e&&(117!==nl.charCodeAt(il)&&Pl({},"Unexpected token %0","ILLEGAL"),++il,(e=yl("u"))&&"\\"!==e&&ml(e.charCodeAt(0))||Pl({},"Unexpected token %0","ILLEGAL"),t=e);il<rl&&hl(e=nl.charCodeAt(il));)++il,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==nl.charCodeAt(il)&&Pl({},"Unexpected token %0","ILLEGAL"),++il,(e=yl("u"))&&"\\"!==e&&hl(e.charCodeAt(0))||Pl({},"Unexpected token %0","ILLEGAL"),t+=e);return t}function wl(){var e,t;return e=il,{type:1===(t=92===nl.charCodeAt(il)?Ol():function(){var e,t;for(e=il++;il<rl;){if(92===(t=nl.charCodeAt(il)))return il=e,Ol();if(!hl(t))break;++il}return nl.slice(e,il)}()).length?3:bl.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:il}}function jl(){var e,t,n,i,r=il,o=nl.charCodeAt(il),s=nl[il];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++il,{type:7,value:String.fromCharCode(o),start:r,end:il};default:if(61===(e=nl.charCodeAt(il+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return il+=2,{type:7,value:String.fromCharCode(o)+String.fromCharCode(e),start:r,end:il};case 33:case 61:return il+=2,61===nl.charCodeAt(il)&&++il,{type:7,value:nl.slice(r,il),start:r,end:il}}}return">>>="===(i=nl.substr(il,4))?{type:7,value:i,start:r,end:il+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:il+=3}:s===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?{type:7,value:t,start:r,end:il+=2}:"<>=!+-*%&|^/".indexOf(s)>=0?{type:7,value:s,start:r,end:++il}:void Pl({},"Unexpected token %0","ILLEGAL")}function Al(){var e,t,n;if(ll(cl((n=nl[il]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=il,e="","."!==n){if(e=nl[il++],n=nl[il],"0"===e){if("x"===n||"X"===n)return++il,function(e){for(var t="";il<rl&&fl(nl[il]);)t+=nl[il++];return 0===t.length&&Pl({},"Unexpected token %0","ILLEGAL"),ml(nl.charCodeAt(il))&&Pl({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt("0x"+t,16),start:e,end:il}}(t);if(dl(n))return function(e){for(var t="0"+nl[il++];il<rl&&dl(nl[il]);)t+=nl[il++];return(ml(nl.charCodeAt(il))||cl(nl.charCodeAt(il)))&&Pl({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt(t,8),octal:!0,start:e,end:il}}(t);n&&cl(n.charCodeAt(0))&&Pl({},"Unexpected token %0","ILLEGAL")}for(;cl(nl.charCodeAt(il));)e+=nl[il++];n=nl[il]}if("."===n){for(e+=nl[il++];cl(nl.charCodeAt(il));)e+=nl[il++];n=nl[il]}if("e"===n||"E"===n)if(e+=nl[il++],"+"!==(n=nl[il])&&"-"!==n||(e+=nl[il++]),cl(nl.charCodeAt(il)))for(;cl(nl.charCodeAt(il));)e+=nl[il++];else Pl({},"Unexpected token %0","ILLEGAL");return ml(nl.charCodeAt(il))&&Pl({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseFloat(e),start:t,end:il}}function Dl(){var e,t,n,i;return ol=null,vl(),e=il,t=function(){var e,t,n,i;for(ll("/"===(e=nl[il]),"Regular expression literal must start with a slash"),t=nl[il++],n=!1,i=!1;il<rl;)if(t+=e=nl[il++],"\\"===e)pl((e=nl[il++]).charCodeAt(0))&&Pl({},"Invalid regular expression: missing /"),t+=e;else if(pl(e.charCodeAt(0)))Pl({},"Invalid regular expression: missing /");else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||Pl({},"Invalid regular expression: missing /"),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";il<rl&&hl((e=nl[il]).charCodeAt(0));)++il,"\\"===e&&il<rl?Pl({},"Unexpected token %0","ILLEGAL"):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Pl({},"Invalid regular expression",n),{value:n,literal:t}}(),i=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";Pl({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){Pl({},"Invalid regular expression")}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:il}}function Fl(){var e;return vl(),il>=rl?{type:2,start:il,end:il}:ml(e=nl.charCodeAt(il))?wl():40===e||41===e||59===e?jl():39===e||34===e?function(){var e,t,n,i,r="",o=!1;for(ll("'"===(e=nl[il])||'"'===e,"String literal must starts with a quote"),t=il,++il;il<rl;){if((n=nl[il++])===e){e="";break}if("\\"===n)if((n=nl[il++])&&pl(n.charCodeAt(0)))"\r"===n&&"\n"===nl[il]&&++il;else switch(n){case"u":case"x":"{"===nl[il]?(++il,r+=xl()):r+=yl(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:dl(n)?(0!==(i="01234567".indexOf(n))&&(o=!0),il<rl&&dl(nl[il])&&(o=!0,i=8*i+"01234567".indexOf(nl[il++]),"0123".indexOf(n)>=0&&il<rl&&dl(nl[il])&&(i=8*i+"01234567".indexOf(nl[il++]))),r+=String.fromCharCode(i)):r+=n}else{if(pl(n.charCodeAt(0)))break;r+=n}}return""!==e&&Pl({},"Unexpected token %0","ILLEGAL"),{type:8,value:r,octal:o,start:t,end:il}}():46===e?cl(nl.charCodeAt(il+1))?Al():jl():cl(e)?Al():jl()}function kl(){var e;return il=(e=ol).end,ol=Fl(),il=e.end,e}function Cl(){var e;e=il,ol=Fl(),il=e}function El(e,t,n){var i=new sl("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return i.operator=e,i.left=t,i.right=n,i}function $l(e,t){var n=new sl("CallExpression");return n.callee=e,n.arguments=t,n}function Sl(e){var t=new sl("Identifier");return t.name=e,t}function Bl(e){var t=new sl("Literal");return t.value=e.value,t.raw=nl.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function _l(e,t,n){var i=new sl("MemberExpression");return i.computed="["===e,i.object=t,i.property=n,i.computed||(n.member=!0),i}function zl(e,t,n){var i=new sl("Property");return i.key=t,i.value=n,i.kind=e,i}function Pl(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(function(e,t){return ll(t<i.length,"Message reference must be in range"),i[t]}));throw(n=new Error(r)).index=il,n.description=r,n}function Nl(e){2===e.type&&Pl(e,"Unexpected end of input"),6===e.type&&Pl(e,"Unexpected number"),8===e.type&&Pl(e,"Unexpected string"),3===e.type&&Pl(e,"Unexpected identifier"),4===e.type&&Pl(e,"Unexpected reserved word"),Pl(e,"Unexpected token %0",e.value)}function Ll(e){var t=kl();7===t.type&&t.value===e||Nl(t)}function Tl(e){return 7===ol.type&&ol.value===e}function Ml(e){return 4===ol.type&&ol.value===e}function ql(){var e=[];for(il=ol.start,Ll("[");!Tl("]");)Tl(",")?(kl(),e.push(null)):(e.push(Kl()),Tl("]")||Ll(","));return kl(),function(e){var t=new sl("ArrayExpression");return t.elements=e,t}(e)}function Rl(){var e;return il=ol.start,8===(e=kl()).type||6===e.type?(e.octal&&Pl(e,"Octal literals are not allowed in strict mode."),Bl(e)):Sl(e.value)}function Ul(){var e,t,n;return il=ol.start,3===(e=ol).type?(n=Rl(),Ll(":"),zl("init",n,Kl())):2!==e.type&&7!==e.type?(t=Rl(),Ll(":"),zl("init",t,Kl())):void Nl(e)}function Wl(){var e,t,n=[],i={},r=String;for(il=ol.start,Ll("{");!Tl("}");)t="$"+("Identifier"===(e=Ul()).key.type?e.key.name:r(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?Pl({},"Duplicate data property in object literal not allowed in strict mode"):i[t]=!0,n.push(e),Tl("}")||Ll(",");return Ll("}"),function(e){var t=new sl("ObjectExpression");return t.properties=e,t}(n)}var Il={if:1};function Hl(){var e,t,n;if(Tl("("))return function(){var e;return Ll("("),e=Zl(),Ll(")"),e}();if(Tl("["))return ql();if(Tl("{"))return Wl();if(e=ol.type,il=ol.start,3===e||Il[ol.value])n=Sl(kl().value);else if(8===e||6===e)ol.octal&&Pl(ol,"Octal literals are not allowed in strict mode."),n=Bl(kl());else{if(4===e)throw new Error("Disabled.");1===e?((t=kl()).value="true"===t.value,n=Bl(t)):5===e?((t=kl()).value=null,n=Bl(t)):Tl("/")||Tl("/=")?(n=Bl(Dl()),Cl()):Nl(kl())}return n}function Gl(){var e=[];if(Ll("("),!Tl(")"))for(;il<rl&&(e.push(Kl()),!Tl(")"));)Ll(",");return Ll(")"),e}function Vl(){return Ll("."),il=ol.start,function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e=kl())||Nl(e),Sl(e.value);var e}function Jl(){var e;return Ll("["),e=Zl(),Ll("]"),e}function Yl(){var e=function(){var e;for(e=Hl();;)if(Tl("."))e=_l(".",e,Vl());else if(Tl("("))e=$l(e,Gl());else{if(!Tl("["))break;e=_l("[",e,Jl())}return e}();if(7===ol.type&&(Tl("++")||Tl("--")))throw new Error("Disabled.");return e}function Xl(){var e,t,n,i,r;if(7!==ol.type&&4!==ol.type)t=Yl();else{if(Tl("++")||Tl("--"))throw new Error("Disabled.");if(Tl("+")||Tl("-")||Tl("~")||Tl("!"))e=kl(),t=Xl(),n=e.value,i=t,(r=new sl("UnaryExpression")).operator=n,r.argument=i,r.prefix=!0,t=r;else{if(Ml("delete")||Ml("void")||Ml("typeof"))throw new Error("Disabled.");t=Yl()}}return t}function Ql(e){var t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Kl(){var e,t;return e=function(){var e,t,n,i,r,o,s,a,u,l;if(e=ol,u=Xl(),0===(r=Ql(i=ol)))return u;for(i.prec=r,kl(),t=[e,ol],o=[u,i,s=Xl()];(r=Ql(ol))>0;){for(;o.length>2&&r<=o[o.length-2].prec;)s=o.pop(),a=o.pop().value,u=o.pop(),t.pop(),n=El(a,u,s),o.push(n);(i=kl()).prec=r,o.push(i),t.push(ol),n=Xl(),o.push(n)}for(n=o[l=o.length-1],t.pop();l>1;)t.pop(),n=El(o[l-1].value,o[l-2],n),l-=2;return n}(),Tl("?")&&(kl(),t=Kl(),Ll(":"),e=function(e,t,n){var i=new sl("ConditionalExpression");return i.test=e,i.consequent=t,i.alternate=n,i}(e,t,Kl())),e}function Zl(){var e=Kl();if(Tl(","))throw new Error("Disabled.");return e}function ec(e){const t=function(e){il=0,rl=(nl=e).length,ol=null,Cl();var t=Zl();if(2!==ol.type)throw new Error("Unexpect token after expression.");return t}(e),n=new Set;return t.visit(e=>{"MemberExpression"===e.type&&function e(t){return"MemberExpression"===t.object.type?e(t.object):"datum"===t.object.name}(e)&&n.add(function e(t){const n=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(n.push(...e(t.object)),n.push(...e(t.property))),n)}(e).slice(1).join("."))}),n}class tc extends xu{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=rc(this.model,this.filter,this),this._dependentFields=ec(this.expr)}clone(){return new tc(null,this.model,_(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter "+this.expr}}function nc(e,t,n,i="datum"){const r=[];const o=Z(t,(function(t){const o=K(t),s=e.getSelectionComponent(o,t),a=j(o+Vu);if(s.project.timeUnit){const t=null!=n?n:e.component.data.raw,i=s.project.timeUnit.clone();t.parent?i.insertAsParentOf(t):t.parent=i}return"none"!==s.empty&&r.push(a),`vlSelectionTest(${a}, ${i}`+("global"===s.resolve?")":`, ${j(s.resolve)})`)}));return(r.length?"!("+r.map(e=>`length(data(${e}))`).join(" || ")+") || ":"")+`(${o})`}function ic(e,t){const n=t.encoding;let i=t.field;if(n||i){if(n&&!i){const r=e.project.items.filter(e=>e.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,Bn((r.length?"Multiple ":"No ")+`matching ${j(n)} encoding found for selection ${j(t.selection)}. `+`Using "field": ${j(i)}.`)):i=r[0].field}}else i=e.project.items[0].field,e.project.items.length>1&&Bn(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${j(i)}.`);return`${e.name}[${j(i)}]`}function rc(e,t,n){return Z(t,t=>w(t)?t:function(e){return null==e?void 0:e.selection}(t)?nc(e,t.selection,n):ci(t))}function oc(e,t,n,i){var r,o,s;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(o=e.encode[t])&&void 0!==o?o:{},e.encode[t].update=null!==(s=e.encode[t].update)&&void 0!==s?s:{},e.encode[t].update[n]=i}function sc(e,t,n,i={header:!1}){var r,o;const s=e.combine(),{disable:a,orient:u,scale:l,labelExpr:c,title:d,zindex:g}=s,p=D(s,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const e in p){const n=me[e],i=p[e];if(n&&n!==t&&"both"!==n)delete p[e];else if(ge(i)){const{condition:t}=i,n=D(i,["condition"]),r=b(t),o=de[e];if(o){const{vgProp:t,part:i}=o;oc(p,i,t,[...r.map(e=>{const{test:t}=e,n=D(e,["test"]);return Object.assign({test:rc(null,t)},n)}),n]),delete p[e]}else if(null===o){const t={signal:r.map(e=>{const{test:t}=e,n=D(e,["test"]);return`${rc(null,t)} ? ${yo(n)} : `}).join("")+yo(n)};p[e]=t}}else if(Yn(i)){const t=de[e];if(t){const{vgProp:n,part:r}=t;oc(p,r,n,i),delete p[e]}}}if("grid"===t){if(!p.grid)return;if(p.encode){const{grid:e}=p.encode;p.encode=Object.assign({},e?{grid:e}:{}),V(p.encode)&&delete p.encode}return Object.assign(Object.assign({scale:l,orient:u},p),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:ue(g,0)})}{if(!i.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(o=null===(r=p.encode)||void 0===r?void 0:r.labels)||void 0===o?void 0:o.update)&&Yn(p.encode.labels.update.text)&&(e=oe(c,"datum.label",p.encode.labels.update.text.signal)),oc(p,"labels","text",{signal:e})}if(null===p.labelAlign&&delete p.labelAlign,p.encode){for(const t of pe)e.hasAxisPart(t)||delete p.encode[t];V(p.encode)&&delete p.encode}const t=function(e,t){if(e)return f(e)&&!bo(e)?e.map(e=>no(e,t)).join(", "):e}(d,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},t?{title:t}:{}),p),!1===n.aria?{aria:!1}:{}),{zindex:ue(g,0)})}}}function ac(e){const{axes:t}=e.component,n=[];for(const i of Nt)if(t[i])for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const t="x"===i?"height":"width",r=e.getSizeSignalRef(t).signal;t!==r&&n.push({name:t,update:r})}return n}const uc={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},lc={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},cc=J(uc),fc=J(lc);function dc(e,t,n,i){return Object.assign.apply(null,[{},...e.map(e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",r=t["x"===n?"axisBottom":"axisLeft"]||{},o=t["x"===n?"axisTop":"axisRight"]||{},s=new Set([...J(r),...J(o)]),a={};for(const t of s.values())a[t]={signal:`${i.signal} === "${e}" ? ${xo(r[t])} : ${xo(o[t])}`};return a}return t[e]})])}function gc(e,t,n,i){const r="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:t in Mi?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[];const o="x"===e?"axisX":"axisY",s=Yn(n)?"axisOrient":"axis"+te(n),a=[...r,...r.map(e=>o+e.substr(4))],u=["axis",s,o];return{vlOnlyAxisConfig:dc(a,i,e,n),vgAxisConfig:dc(u,i,e,n),axisConfigStyle:pc([...u,...a],i)}}function pc(e,t){var n;const i=[{}];for(const r of e){let e=null===(n=t[r])||void 0===n?void 0:n.style;if(e){e=b(e);for(const n of e)i.push(t.style[n])}}return Object.assign.apply(null,i)}function mc(e,t,n,i={}){var r;const o=Do(e,n,t.style);if(void 0!==o)return{configFrom:"style",configValue:o};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(r=i[t])||void 0===r?void 0:r[e]))return{configFrom:t,configValue:i[t][e]};return{}}const hc={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return pr(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return mr(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(!Nr(e)||!Kt(e.bin))&&(null!==(i=t.grid)&&void 0!==i?i:function(e,t){return!Wi(e)&&Nr(t)&&!Qt(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n);return}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||yc(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||vc(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return null!==(i=e.labelFlush)&&void 0!==i?i:function(e,t){if("x"===t&&M(["quantitative","temporal"],e))return!0;return}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return null!==(i=e.labelOverlap)&&void 0!==i?i:function(e,t){if("nominal"!==e)return"log"!==t||"greedy";return}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var o;const s="x"===e?"width":"y"===e?"height":void 0,a=s?t.getSizeSignalRef(s):void 0;return null!==(o=n.tickCount)&&void 0!==o?o:function({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!Wi(t)&&"log"!==t){if(Nr(e)){if(Qt(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&M(["month","hours","day","quarter"],null===(r=Jn(e.timeUnit))||void 0===r?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const i=xc(t,n);if(void 0!==i)return i;const r=t.typedFieldDef(n),o="x"===n?"x2":"y2",s=t.fieldDef(o);return ko(r?[Er(r)]:[],Nr(s)?[Er(s)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;if(f(n))return po(t,n);if(Yn(n))return n;return}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return null!==(i=e.zindex)&&void 0!==i?i:function(e,t){if("rect"===e&&Yr(t))return 1;return 0}(n,t)}};function bc(e){return`(((${e.signal} % 360) + 360) % 360)`}function vc(e,t,n,i){if(void 0!==e){if("x"===n){if(Yn(e)){const n=bc(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${Yn(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Yn(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(Yn(e)){const n=bc(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${Yn(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(Yn(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function yc(e,t,n){if(void 0===e)return;const i="x"===n,r=i?0:90,o=i?"bottom":"left";if(Yn(e)){const n=bc(e);return{signal:`(${r?"("+n+" + 90)":n} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${n} && ${n} < ${180+r}) === ${Yn(t)?`(${t.signal} === "${o}")`:t===o} ? "left" : "right"`}}if((e+r)%180==0)return i?null:"center";if(Yn(t)){const n=r<e&&e<180+r?"===":"!==";return{signal:`${t.signal} ${n} "${o}"`+' ? "left" : "right"'}}return(r<e&&e<180+r)==(t===o)?"left":"right"}function xc(e,t){const n="x"===t?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),o=i?i.title:void 0,s=r?r.title:void 0;return o&&s?Co(o,s):o||(s||(void 0!==o?o:void 0!==s?s:void 0))}class Oc extends xu{constructor(e,t){super(e),this.transform=t,this._dependentFields=ec(this.transform.calculate)}clone(){return new Oc(null,_(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((t,n)=>{if(Ir(t)&&Dr(t.sort)){const{field:i,timeUnit:r}=t,o=t.sort,s=o.map((e,t)=>`${ci({field:i,timeUnit:r,equal:e})} ? ${t} : `).join("")+o.length;e=new Oc(e,{calculate:s,as:wc(t,n,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate "+L(this.transform)}}function wc(e,t,n){return Jr(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function jc(e,t){return M(["top","bottom"],t)?"column":M(["left","right"],t)||"row"===e?"row":"column"}function Ac(e,t,n,i){const r="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return ue(((null==t?void 0:t.header)||{})[e],r[e],n.header[e])}function Dc(e,t,n,i){const r={};for(const o of e){const e=Ac(o,t,n,i);void 0!==e&&(r[o]=e)}return r}const Fc=["row","column"],kc=["header","footer"];function Cc(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:o,titleAngle:s,titleOrient:a}=Dc(["titleAnchor","titleAngle","titleOrient"],r,i,t),u=jc(t,a),l=ce(s);return{name:t+"-title",type:"group",role:u+"-title",title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),$c(l,u)),Ec(u,l,o)),Lc(i,r,t,cc,uc))}}function Ec(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=yc(t,"row"===e?"left":"top","row"===e?"y":"x");return i?{align:i}:{}}function $c(e,t){const n=vc(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function Sc(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of kc)if(n[r])for(const o of n[r]){const s=zc(e,t,r,n,o);null!=s&&i.push(s)}return i}function Bc(e,t){var n;const{sort:i}=e;return Ar(i)?{field:Jr(i,{expr:"datum"}),order:null!==(n=i.order)&&void 0!==n?n:"ascending"}:f(i)?{field:wc(e,t,{expr:"datum"}),order:"ascending"}:{field:Jr(e,{expr:"datum"}),order:null!=i?i:"ascending"}}function _c(e,t,n){const{format:i,formatType:r,labelAngle:o,labelAnchor:s,labelOrient:a,labelExpr:u}=Dc(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),l=fr({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=jc(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?oe(oe(u,"datum.label",l),"datum.value",Jr(e,{expr:"parent"})):l}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),$c(o,c)),Ec(c,o,s)),Lc(n,e,t,fc,lc))}function zc(e,t,n,i,r){if(r){let o=null;const{facetFieldDef:s}=i,a=e.config?e.config:void 0;if(s&&r.labels){const{labelOrient:e}=Dc(["labelOrient"],s,a,t);("row"===t&&!M(["top","bottom"],e)||"column"===t&&!M(["left","right"],e))&&(o=_c(s,t,a))}const u=Bd(e)&&!Fr(e.facet),l=r.axes,c=(null==l?void 0:l.length)>0;if(o||c){const a="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:Bc(s,t)}:{}),c&&u?{from:{data:e.getName("facet_domain_"+t)}}:{}),o?{title:o}:{}),r.sizeSignal?{encode:{update:{[a]:r.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const Pc={column:{start:0,end:1},row:{start:1,end:0}};function Nc(e,t){return Pc[t][e]}function Lc(e,t,n,i,r){const o={};for(const s of i){if(!r[s])continue;const i=Ac(s,t,e,n);void 0!==i&&(o[r[s]]=i)}return o}function Tc(e){return[...Mc(e,"width"),...Mc(e,"height"),...Mc(e,"childWidth"),...Mc(e,"childHeight")]}function Mc(e,t){const n="width"===t?"x":"y",i=e.component.layoutSize.get(t);if(!i||"merged"===i)return[];const r=e.getSizeSignalRef(t).signal;if("step"===i){const t=e.getScaleComponent(n);if(t){const i=t.get("type"),o=t.get("range");if(Wi(i)&&Xn(o)){const i=e.scaleName(n);if(Bd(e.parent)){if("independent"===e.parent.component.resolve.scale[n])return[qc(i,o)]}return[qc(i,o),{name:r,update:Rc(i,t,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==i){const t=r.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",i=`isFinite(${n}) ? ${n} : ${hs(e.config.view,t?"width":"height")}`;return[{name:r,init:i,on:[{update:i,events:"window:resize"}]}]}return[{name:r,value:i}]}function qc(e,t){return{name:e+"_step",value:t.step}}function Rc(e,t,n){const i=t.get("type"),r=t.get("padding"),o=ue(t.get("paddingOuter"),r);let s=t.get("paddingInner");return s="band"===i?void 0!==s?s:r:1,`bandspace(${n}, ${s}, ${o}) * ${e}_step`}function Uc(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function Wc(e,t){return J(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),Ga(t,r,i,e=>Yn(e)?e:{value:e.value}))},{})}function Ic(e,t){if(zd(t)||Bd(t))return"shared";if(_d(t))return Lt(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function Hc(e,t){const n=e.scale[t],i=Lt(t)?"axis":"legend";return"independent"===n?("shared"===e[i][t]&&Bn(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[i][t]||"shared"}const Gc=Object.assign(Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Vc=J(Gc);class Jc extends ra{}const Yc={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:o}){var s,a,u,l,c;if("symbol"!==o)return;const{markDef:d,encoding:g,config:p,mark:m}=n,h=d.filled&&"trail"!==m;let b=Object.assign(Object.assign({},function(e,t,n){for(const i of n){const n=jo(i,t.markDef,t.config);void 0!==n&&(e[i]=vo(n))}return e}({},n,Te)),eu(n,{filled:h}));const v=null!==(s=Xc(g.opacity))&&void 0!==s?s:d.opacity;if(b.fill)if("fill"===i||h&&i===lt)delete b.fill;else if(b.fill.field)r.get("symbolFillColor")?delete b.fill:(b.fill=vo(null!==(a=p.legend.symbolBaseFillColor)&&void 0!==a?a:"black"),b.fillOpacity=vo(null!=v?v:1));else if(f(b.fill)){const e=null!==(c=null!==(l=Qc(null!==(u=g.fill)&&void 0!==u?u:g.color))&&void 0!==l?l:d.fill)&&void 0!==c?c:h&&d.color;e&&(b.fill=vo(e))}if(b.stroke)if("stroke"===i||!h&&i===lt)delete b.stroke;else if(b.stroke.field)delete b.stroke;else if(f(b.stroke)){const e=ue(Qc(g.stroke||g.color),d.stroke,h?d.color:void 0);e&&(b.stroke={value:e})}if("opacity"!==i){const e=Nr(t)&&Zc(n,r,t);e?b.opacity=[Object.assign({test:e},vo(null!=v?v:1)),vo(p.legend.unselectedOpacity)]:v&&(b.opacity=vo(v))}return b=Object.assign(Object.assign({},b),e),V(b)?void 0:b},gradient:function(e,{model:t,legendType:n}){if("gradient"!==n)return;let i={};const r=Xc(t.encoding.opacity)||t.markDef.opacity;r&&(i.opacity=vo(r));return i=Object.assign(Object.assign({},i),e),V(i)?void 0:i},labels:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const o=n.legend(i)||{},s=n.config,a=Nr(t)?Zc(n,r,t):void 0,u=a?[{test:a,value:1},{value:s.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=o,f=lr(c)?gr({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:s}):void 0,d=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return V(d)?void 0:d},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function Xc(e){return Kc(e,(e,t)=>Math.max(e,t.value))}function Qc(e){return Kc(e,(e,t)=>ue(e,t.value))}function Kc(e,t){return function(e){const t=e&&e.condition;return!!t&&(f(t)||Wr(t))}(e)?b(e.condition).reduce(t,e.value):Wr(e)?e.value:void 0}function Zc(e,t,n){const i=t.get("selections");if(!(null==i?void 0:i.length))return;const r=j(n.field);return i.map(e=>`(!length(data(${j(K(e)+Vu)})) || (${e}[${r}] && indexof(${e}[${r}], datum.value) >= 0))`).join(" || ")}const ef={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return pr(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return mr(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return null!==(n=null!==(t=i.gradientLength)&&void 0!==t?t:r.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:s,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(Hi(r))return"horizontal"===n?"top"===i||"bottom"===i?rf(t,"width",s,o):s:rf(t,"height",u,a);return}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return null!==(r=null!==(i=e.labelOverlap)&&void 0!==i?i:t.labelOverlap)&&void 0!==r?r:function(e){if(M(["quantile","threshold","log"],e))return"greedy";return}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return null!==(r=e.symbolType)&&void 0!==r?r:function(e,t,n,i){var r;if("shape"!==t){const e=null!==(r=Qc(n))&&void 0!==r?r:i;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>eo(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(yt(n)&&Hi(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;if(f(n))return po(t,n);if(Yn(n))return n;return}(t,e)};function tf(e){const{legend:t}=e;return ue(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(yt(e)){if(M(["quarter","month","day"],t))return"symbol";if(Hi(n))return"gradient"}return"symbol"}(e))}function nf({legendConfig:e,legendType:t,orient:n,legend:i}){var r,o;return null!==(o=null!==(r=i.direction)&&void 0!==r?r:e[t?"gradientDirection":"symbolDirection"])&&void 0!==o?o:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function rf(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function of(e){const t=Sd(e)?function(e){const{encoding:t}=e,n={};for(const i of[lt,...os]){const r=oo(t[i]);r&&e.getScaleComponent(i)&&(i===dt&&Nr(r)&&r.type===vi||(n[i]=af(e,i)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){of(i);for(const r of J(i.component.legends))n.legend[r]=Hc(e.component.resolve,r),"shared"===n.legend[r]&&(t[r]=uf(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of J(t))for(const t of e.children)t.component.legends[i]&&"shared"===n.legend[i]&&delete t.component.legends[i];return t}(e);return e.component.legends=t,t}function sf(e,t,n,i){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==i?void 0:i.title))return!0}return e===(n||{})[t]}function af(e,t){var n,i,r;let o=e.legend(t);const{markDef:s,encoding:a,config:u}=e,l=u.legend,c=new Jc({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var i;const r=null===(i=e.fieldDef(t))||void 0===i?void 0:i.field;Ku(e,e=>{var i,o;const s=null!==(i=e.project.hasField[r])&&void 0!==i?i:e.project.hasChannel[t];if(s&&$u.has(e)){const t=null!==(o=n.get("selections"))&&void 0!==o?o:[];t.push(e.name),n.set("selections",t,!1),s.hasLegend=!0}})}(e,t,c);const f=void 0!==o?!o:l.disable;if(c.set("disable",f,void 0!==o),f)return c;o=o||{};const d=e.getScaleComponent(t).get("type"),g=oo(a[t]),p=Nr(g)?null===(n=Jn(g.timeUnit))||void 0===n?void 0:n.unit:void 0,m=o.orient||u.legend.orient||"right",h=tf({legend:o,channel:t,timeUnit:p,scaleType:d}),b={legend:o,channel:t,model:e,markDef:s,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:u,scaleType:d,orient:m,legendType:h,direction:nf({legend:o,legendType:h,orient:m,legendConfig:l})};for(const n of Vc){const i=n in ef?ef[n](b):o[n];if(void 0!==i){const r=sf(i,n,o,e.fieldDef(t));(r||void 0===u.legend[n])&&c.set(n,i,r)}}const v=null!==(i=null==o?void 0:o.encoding)&&void 0!==i?i:{},y=c.get("selections"),x={},O={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:c,legendType:h};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=Wc(null!==(r=v[t])&&void 0!==r?r:{},e),i=t in Yc?Yc[t](n,O):n;void 0===i||V(i)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==y?void 0:y.length)&&Nr(g)?{name:`${K(g.field)}_legend_${t}`}:{}),(null==y?void 0:y.length)?{interactive:!!y}:{}),{update:i}))}return V(x)||c.set("encode",x,!!(null==o?void 0:o.encoding)),c}function uf(e,t){var n,i,r,o;if(!e)return t.clone();const s=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(s.explicit&&a.explicit&&s.value!==a.value)return;let u=!1;for(const n of Vc){const i=la(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",(e,t)=>{switch(n){case"symbolType":return lf(e,t);case"title":return Eo(e,t);case"type":return u=!0,sa("symbol")}return ua(e,t,n,"legend")});e.setWithExplicit(n,i)}return u&&((null===(i=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===i?void 0:i.gradient)&&ee(e.implicit,["encode","gradient"]),(null===(o=null===(r=e.explicit)||void 0===r?void 0:r.encode)||void 0===o?void 0:o.gradient)&&ee(e.explicit,["encode","gradient"])),e}function lf(e,t){return"circle"===t.value?t:e}function cf(e,t,n,i){var r,o,s;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(o=e.encode[t])&&void 0!==o?o:{},e.encode[t].update=null!==(s=e.encode[t].update)&&void 0!==s?s:{},e.encode[t].update[n]=i}function ff(e){const t=e.component.legends,n={};for(const i of J(t)){const r=e.getScaleComponent(i),o=N(r.get("domains"));if(n[o])for(const e of n[o]){uf(e,t[i])||n[o].push(t[i])}else n[o]=[t[i].clone()]}return Y(n).flat().map(t=>function(e,t){var n,i,r;const o=e.combine(),{disable:s,labelExpr:a,selections:u}=o,l=D(o,["disable","labelExpr","selections"]);if(s)return;!1===t.aria&&null==l.aria&&(l.aria=!1);if(null===(n=l.encode)||void 0===n?void 0:n.symbols){const e=l.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||l.stroke||(e.stroke={value:"transparent"});for(const t of os)l[t]&&delete e[t]}l.title||delete l.title;if(void 0!==a){let e=a;(null===(r=null===(i=l.encode)||void 0===i?void 0:i.labels)||void 0===r?void 0:r.update)&&Yn(l.encode.labels.update.text)&&(e=oe(a,"datum.label",l.encode.labels.update.text.signal)),cf(l,"labels","text",{signal:e})}for(const e in l){const t=l[e];if(Yn(t)){const n=ss[e];if(n){const{vgProp:i,part:r}=n;cf(l,r,i,t),delete l[e]}}}return l}(t,e.config)).filter(e=>void 0!==e)}function df(e){return zd(e)||_d(e)?function(e){return e.children.reduce((e,t)=>e.concat(t.assembleProjections()),gf(e))}(e):gf(e)}function gf(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(e=>e.signal).join(", ")}]`},o=t.data.reduce((t,n)=>{const i=Yn(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return M(t,i)||t.push(i),t},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]}},n)]}return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const pf=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class mf extends ra{constructor(e,t,n,i){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function hf(e){e.component.projection=Sd(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(null!=n.scale||null!=n.translate)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,o=i?function(e){const t=[],{encoding:n}=e;for(const i of[["longitude","latitude"],["longitude2","latitude2"]])(oo(n[i[0]])||oo(n[i[1]]))&&t.push({signal:e.getName("geojson_"+t.length)});e.channelHasField(dt)&&e.typedFieldDef(dt).type===vi&&t.push({signal:e.getName("geojson_"+t.length)});0===t.length&&t.push(e.requestDataName(va));return t}(e):void 0;return new mf(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),r,o)}return}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)hf(t);const n=R(e.children,e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=R(pf,n=>!y(e.explicit,n)&&!y(t.explicit,n)||!(!y(e.explicit,n)||!y(t.explicit,n)||N(e.get(n))!==N(t.get(n))));if(N(e.size)===N(t.size)){if(n)return e;if(N(e.explicit)===N({}))return t;if(N(t.explicit)===N({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0});if(t&&n){const n=e.projectionName(!0),i=new mf(n,t.specifiedProjection,t.size,_(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&i.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return i}return}(e)}function bf(e,t){return`${Xt(e)}_${t}`}function vf(e,t,n){var i;const r=bf(null!==(i=lo(n,void 0))&&void 0!==i?i:{},t);return e.getName(r+"_bins")}function yf(e,t,n){let i,r;i=function(e){return"as"in e}(e)?w(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]:[Jr(e,{forAs:!0}),Jr(e,{binSuffix:"end",forAs:!0})];const o=Object.assign({},lo(t,void 0)),s=bf(o,e.field),{signal:a,extentSignal:u}=function(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}(n,s);if(en(o.extent)){const e=o.extent,t=e.selection;r=ic(n.getSelectionComponent(K(t),t),e),delete o.extent}return{key:s,binComponent:Object.assign(Object.assign(Object.assign({bin:o,field:e.field,as:[i]},a?{signal:a}:{}),u?{extentSignal:u}:{}),r?{span:r}:{})}}class xf extends xu{constructor(e,t){super(e),this.bins=t}clone(){return new xf(null,_(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,i)=>{if(Ur(n)&&Qt(n.bin)){const{key:r,binComponent:o}=yf(n,n.bin,t);e[r]=Object.assign(Object.assign(Object.assign({},o),e[r]),function(e,t,n,i){var r,o;if(mo(t,n)){const s=Sd(e)&&null!==(o=null!==(r=e.axis(n))&&void 0!==r?r:e.legend(n))&&void 0!==o?o:{},a=Jr(t,{expr:"datum"}),u=Jr(t,{expr:"datum",binSuffix:"end"});return{formulaAs:Jr(t,{binSuffix:"range",forAs:!0}),formula:yr(a,u,s.format,s.formatType,i)}}return{}}(t,n,i,t.config))}return e},{});return V(n)?null:new xf(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=yf(t,t.bin,n);return new xf(e,{[i]:r})}merge(e,t){for(const n of J(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=W([...this.bins[n].as,...e.bins[n].as],L)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Y(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(Y(this.bins).map(e=>e.field))}hash(){return"Bin "+L(this.bins)}assemble(){return Y(this.bins).flatMap(e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:o}=r,s=D(r,["extent"]),a=Object.assign(Object.assign(Object.assign({type:"bin",field:re(e.field),as:n,signal:e.signal},en(o)?{extent:null}:{extent:o}),e.span?{span:{signal:`span(${e.span})`}}:{}),s);!o&&e.extentSignal&&(t.push({type:"extent",field:re(e.field),signal:e.extentSignal}),a.extent={signal:e.extentSignal}),t.push(a);for(const e of i)for(let i=0;i<2;i++)t.push({type:"formula",expr:Jr({field:n[i]},{expr:"datum"}),as:e[i]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class Of extends xu{constructor(e){let t;if(super(null),pa(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},P(e.format,["parse"])):{}),da(e))this._data={values:e.values};else if(fa(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];M(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else ha(e)?this._data={values:[{type:"Sphere"}]}:(ga(e)||pa(e))&&(this._data={});this._generator=pa(e),e.name&&(this._name=e.name),t&&!V(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function wf(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return console.error("Dataflow graph is inconsistent.",t,e),!1;if(!wf(t.children))return!1}return!0}class jf extends xu{constructor(e,t){super(e),this.params=t}clone(){return new jf(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule "+L(this.params)}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class Af extends xu{constructor(e,t){super(e),this.params=t}clone(){return new Af(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return"Hash "+L(this.params)}assemble(){return Object.assign({type:"sequence"},this.params)}}function Df(e){return e instanceof Of||e instanceof jf||e instanceof Af}class Ff{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class kf extends Ff{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(Df(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class Cf extends Ff{}function Ef(e,t,n,i){const r=Sd(i)?i.encoding[St(t)]:void 0;if(Ur(n)&&Sd(i)&&Br(t,n,r,i.stack,i.markDef,i.config))e.add(Jr(n,{})),e.add(Jr(n,{suffix:"end"})),n.bin&&mo(n,t)&&e.add(Jr(n,{binSuffix:"range"}));else if(t in ht){const n=function(e){switch(e){case"latitude":return"y";case"latitude2":return"y2";case"longitude":return"x";case"longitude2":return"x2"}}(t);e.add(i.getName(n))}else e.add(Jr(n));return e}class $f extends xu{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new $f(null,new Set(this.dimensions),_(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(e=>{e.aggregate&&(n=!0)});const i={},r=new Set;return n?(t.forEachFieldDef((e,n)=>{var o,s,a,u;const{aggregate:l,field:c}=e;if(l)if("count"===l)i["*"]=null!==(o=i["*"])&&void 0!==o?o:{},i["*"].count=new Set([Jr(e,{forAs:!0})]);else{if(Ve(l)||Je(l)){const e=Ve(l)?"argmin":"argmax",t=l[e];i[t]=null!==(s=i[t])&&void 0!==s?s:{},i[t][e]=new Set([Jr({op:e,field:t},{forAs:!0})])}else i[c]=null!==(a=i[c])&&void 0!==a?a:{},i[c][l]=new Set([Jr(e,{forAs:!0})]);Ht(n)&&"unaggregated"===t.scaleDomain(n)&&(i[c]=null!==(u=i[c])&&void 0!==u?u:{},i[c].min=new Set([Jr({field:c,aggregate:"min"},{forAs:!0})]),i[c].max=new Set([Jr({field:c,aggregate:"max"},{forAs:!0})]))}else Ef(r,n,e,t)}),r.size+J(i).length===0?null:new $f(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const o=new Set,s={};for(const e of t.aggregate){const{op:t,field:r,as:o}=e;t&&("count"===t?(s["*"]=null!==(n=s["*"])&&void 0!==n?n:{},s["*"].count=new Set([o||Jr(e,{forAs:!0})])):(s[r]=null!==(i=s[r])&&void 0!==i?i:{},s[r][t]=new Set([o||Jr(e,{forAs:!0})])))}for(const e of null!==(r=t.groupby)&&void 0!==r?r:[])o.add(e);return o.size+J(s).length===0?null:new $f(e,o,s)}merge(e){return function(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(this.dimensions,e.dimensions)?(function(e,t){var n;for(const i of J(t)){const r=t[i];for(const t of J(r))i in e?e[i][t]=new Set([...null!==(n=e[i][t])&&void 0!==n?n:[],...r[t]]):e[i]={[t]:r[t]}}}(this.measures,e.measures),!0):(function(...e){Sn.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...J(this.measures)])}producedFields(){const e=new Set;for(const t of J(this.measures))for(const n of J(this.measures[t])){const i=this.measures[t][n];0===i.size?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return"Aggregate "+L({dimensions:this.dimensions,measures:this.measures})}assemble(){const e=[],t=[],n=[];for(const i of J(this.measures))for(const r of J(this.measures[i]))for(const o of this.measures[i][r])n.push(o),e.push(r),t.push("*"===i?null:re(i));return{type:"aggregate",groupby:[...this.dimensions].map(re),ops:e,fields:t,as:n}}}class Sf extends xu{constructor(e,t,n,i){super(e),this.model=t,this.name=n,this.data=i;for(const e of Ot){const n=t.facet[e];if(n){const{bin:i,sort:r}=n;this[e]=Object.assign({name:t.getName(e+"_domain"),fields:[Jr(n),...Qt(i)?[Jr(n,{binSuffix:"end"})]:[]]},Ar(r)?{sortField:r}:f(r)?{sortIndexField:wc(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of Ot)this[t]&&(e+=` ${t.charAt(0)}:${L(this[t])}`);return e}get fields(){var e;const t=[];for(const n of Ot)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of Ot)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of Nt){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(Wi(i)&&Xn(r)){const n=gd(pd(this.childModel,t));n?e[t]=n:Bn(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],o=[],s=[];n&&n[i]&&(t?(r.push("distinct_"+n[i]),o.push("max")):(r.push(n[i]),o.push("distinct")),s.push("distinct_"+n[i]));const{sortField:a,sortIndexField:u}=this[e];if(a){const{op:e=xr,field:t}=a;r.push(t),o.push(e),s.push(Jr(a,{forAs:!0}))}else u&&(r.push(u),o.push("max"),s.push(u));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:o,as:s}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,o=[],s={};for(const e of Fc){for(const i of kc){const o=null!==(t=r[e]&&r[e][i])&&void 0!==t?t:[];for(const t of o)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){s[e]=!0;break}}if(s[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?i?{signal:`ceil(${t} / ${i})`}:1:i?{signal:`min(${t}, ${i})`}:{signal:t};o.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:a,column:u}=s;return(a||u)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,e)),o}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:o,row:s,facet:a}=this;if(o&&s&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const o=[].concat(null!==(e=r.x)&&void 0!==e?e:[],null!==(t=r.y)&&void 0!==t?t:[]),s=o.map(()=>"distinct");n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:o,ops:s}]})}for(const e of[tt,et])this[e]&&n.push(this.assembleRowColumnHeaderData(e,i,r));if(a){const e=this.assembleFacetHeaderData(r);e&&n.push(...e)}return n}}function Bf(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function _f(e){const t={};return function e(t,n){if($(t))e(t.not,n);else if(E(t))for(const i of t.and)e(i,n);else if(C(t))for(const i of t.or)e(i,n);else n(t)}(e.filter,e=>{var n;if(ui(e)){let i=null;ti(e)?i=e.equal:si(e)?i=e.range[0]:ai(e)&&(i=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),i&&(_n(i)?t[e.field]="date":O(i)?t[e.field]="number":w(i)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}}),t}function zf(e){const t={};function n(e){var n;fo(e)?t[e.field]="date":"quantitative"===e.type&&(w(n=e.aggregate)&&M(["min","max"],n))?t[e.field]="number":ae(e.field)>1?e.field in t||(t[e.field]="flatten"):Ir(e)&&Ar(e.sort)&&ae(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((Sd(e)||Bd(e))&&e.forEachFieldDef((t,i)=>{if(Ur(t))n(t);else{const r=Et(i),o=e.fieldDef(r);n(Object.assign(Object.assign({},t),{type:o.type}))}}),Sd(e)){const{mark:n,markDef:i,encoding:r}=e;if(ze(n)&&!e.encoding.order){const e=r["horizontal"===i.orient?"y":"x"];Nr(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}class Pf extends xu{constructor(e,t){super(e),this._parse=t}clone(){return new Pf(null,_(this._parse))}hash(){return"Parse "+L(this._parse)}static makeExplicit(e,t,n){let i={};const r=t.data;return!pa(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const e of J(n)){const t=i.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:Bn(fn(e,n[e],t.value)))}for(const e of J(t)){const n=i.get(e);void 0!==n&&(n===t[e]?delete t[e]:Bn(fn(e,t[e],n)))}const r=new ra(t,n);i.copyAll(r);const o={};for(const e of J(r.combine())){const t=r.get(e);null!==t&&(o[e]=t)}return 0===J(o).length||i.parseNothing?null:new Pf(e,o)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of J(this._parse)){const n=this._parse[t];1===ae(t)&&(e[t]=n)}return e}producedFields(){return new Set(J(this._parse))}dependentFields(){return new Set(J(this._parse))}assembleTransforms(e=!1){return J(this._parse).filter(t=>!e||ae(t)>1).map(e=>{const t=function(e,t){const n=ne(e);if("number"===t)return`toNumber(${n})`;if("boolean"===t)return`toBoolean(${n})`;if("string"===t)return`toString(${n})`;if("date"===t)return`toDate(${n})`;if("flatten"===t)return n;if(0===t.indexOf("date:")){return`timeParse(${n},'${Bf(t.slice(5,t.length))}')`}if(0===t.indexOf("utc:")){return`utcParse(${n},'${Bf(t.slice(4,t.length))}')`}return Bn(`Unrecognized parse "${t}".`),null}(e,this._parse[e]);if(!t)return null;return{type:"formula",expr:t,as:se(e)}}).filter(e=>null!==e)}}class Nf extends xu{clone(){return new Nf(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set(["_vgsid_"])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:"_vgsid_"}}}class Lf extends xu{constructor(e,t){super(e),this.transform=t}clone(){return new Lf(null,_(this.transform))}addDimensions(e){this.transform.groupby=W(this.transform.groupby.concat(e),e=>e)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(e=>e.field).filter(e=>void 0!==e).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:Jr(e)}hash(){return"JoinAggregateTransform "+L(this.transform)}assemble(){const e=[],t=[],n=[];for(const i of this.transform.joinaggregate)t.push(i.op),n.push(this.getDefaultName(i)),e.push(void 0===i.field?null:i.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==i?{groupby:i}:{})}}class Tf extends xu{constructor(e,t){super(e),this._stack=t}clone(){return new Tf(null,_(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:o="zero"}=t,s=[],a=[];if(void 0!==t.sort)for(const e of t.sort)s.push(e.field),a.push(ue(e.order,"ascending"));const u={field:s,order:a};let l;return l=function(e){return f(e)&&e.every(e=>w(e))&&e.length>1}(r)?r:w(r)?[r,r+"_end"]:[t.stack+"_start",t.stack+"_end"],new Tf(e,{stackField:n,groupby:i,offset:o,sort:u,facetby:[],as:l})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;const{groupbyChannel:r,fieldChannel:o,offset:s,impute:a}=n;let u;if(r){u=ro(i[r])}const l=function(e){return e.stack.stackBy.reduce((e,t)=>{const n=Jr(t.fieldDef);return n&&e.push(n),e},[])}(t),c=t.encoding.order;let d;return d=f(c)||Nr(c)?Fo(c):l.reduce((e,t)=>(e.field.push(t),e.order.push("y"===o?"descending":"ascending"),e),{field:[],order:[]}),new Tf(e,{dimensionFieldDef:u,stackField:t.vgField(o),facetby:[],stackby:l,sort:d,offset:s,impute:a,as:[t.vgField(o,{suffix:"start",forAs:!0}),t.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return"Stack "+L(this._stack)}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[Jr(e,{binSuffix:"mid"})]:[Jr(e,{}),Jr(e,{binSuffix:"end"})]:[Jr(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:o,offset:s,impute:a,as:u}=this._stack;if(a&&n){const{band:o=.5,bin:s}=n;s&&e.push({type:"formula",expr:o+"*"+Jr(n,{expr:"datum"})+`+${1-o}*`+Jr(n,{expr:"datum",binSuffix:"end"}),as:Jr(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:Jr(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:o,as:u,offset:s}),e}}class Mf extends xu{constructor(e,t){super(e),this.transform=t}clone(){return new Mf(null,_(this.transform))}addDimensions(e){this.transform.groupby=W(this.transform.groupby.concat(e),e=>e)}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach(e=>n.add(e.field)),this.transform.window.map(e=>e.field).filter(e=>void 0!==e).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:Jr(e)}hash(){return"WindowTransform "+L(this.transform)}assemble(){var e;const t=[],n=[],i=[],r=[];for(const e of this.transform.window)n.push(e.op),i.push(this.getDefaultName(e)),r.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const o=this.transform.frame,s=this.transform.groupby;if(o&&null===o[0]&&null===o[1]&&n.every(e=>Ye(e)))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},void 0!==s?{groupby:s}:{});const a=[],u=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)a.push(t.field),u.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const l={field:a,order:u},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:l},void 0!==c?{ignorePeers:c}:{}),void 0!==s?{groupby:s}:{}),void 0!==o?{frame:o}:{})}}class qf extends kf{run(e){const t=e.parent;if(e instanceof Pf){if(Df(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof Pf)this.setMutated(),t.merge(e);else{if(G(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class Rf extends Cf{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map(e=>e.hash()),n={};for(let i=0;i<t.length;i++)void 0===n[t[i]]?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const t of J(n))n[t].length>1&&(this.setMutated(),this.mergeNodes(e,n[t]));for(const t of e.children)this.run(t);return this.mutatedFlag}}class Uf extends kf{run(e){return e instanceof Ou||e.numChildren()>0||e instanceof Sf||(this.setMutated(),e.remove()),this.flags}}class Wf extends kf{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(e){if(this.setContinue(),e instanceof wu){const t=e.producedFields();I(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class If extends kf{run(e){this.setContinue();const t=e.parent.children.filter(e=>e instanceof wu),n=t.pop();for(const e of t)this.setMutated(),n.merge(e);return this.flags}}function Hf(e){if(e instanceof Sf)if(1!==e.numChildren()||e.children[0]instanceof Ou){const n=e.model.component.data.main;!function e(t){if(t instanceof Ou&&t.type===va&&1===t.numChildren()){const n=t.children[0];n instanceof Sf||(n.swapWithParent(),e(t))}}(n);const i=(t=e,function e(n){if(!(n instanceof Sf)){const i=n.clone();if(i instanceof Ou){const e=Kf+i.getSource();i.setSource(e),t.model.component.data.outputNodes[e]=i}else(i instanceof $f||i instanceof Tf||i instanceof Mf||i instanceof Lf)&&i.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=i;return[i]}return n.children.flatMap(e)}),r=e.children.map(i).flat();for(const e of r)e.parent=n}else{const t=e.children[0];(t instanceof $f||t instanceof Tf||t instanceof Mf||t instanceof Lf)&&t.addDimensions(e.fields),t.swapWithParent(),Hf(e)}else e.children.map(Hf);var t}class Gf extends Cf{constructor(){super()}run(e){e instanceof Ou&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class Vf extends Cf{constructor(e){super(),this.requiresSelectionId=e&&el(e)}run(e){e instanceof Nf&&(this.requiresSelectionId&&(Df(e.parent)||e.parent instanceof $f||e.parent instanceof Pf)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class Jf extends kf{run(e){const t=e.parent,n=[...t.children],i=t.children.filter(e=>e instanceof Pf);if(t.numChildren()>1&&i.length>=1){const e={},r=new Set;for(const t of i){const n=t.parse;for(const t of J(n))t in e?e[t]!==n[t]&&r.add(t):e[t]=n[t]}for(const t of r)delete e[t];if(!V(e)){this.setMutated();const i=new Pf(t,e);for(const r of n){if(r instanceof Pf)for(const t of J(e))delete r.parse[t];t.removeChild(r),r.parent=i,r instanceof Pf&&0===J(r.parse).length&&r.remove()}}}return this.setContinue(),this.flags}}class Yf extends kf{run(e){const t=e.parent,n=t.children.filter(e=>e instanceof $f),i={};for(const e of n){const t=L(e.groupBy);t in i||(i[t]=[]),i[t].push(e)}for(const e of J(i)){const n=i[e];if(n.length>1){const e=n.pop();for(const i of n)e.merge(i)&&(t.removeChild(i),i.parent=e,i.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class Xf extends kf{constructor(e){super(),this.model=e}run(e){const t=e.parent,n=!(Df(t)||t instanceof tc||t instanceof Pf||t instanceof Nf),i=[],r=[];for(const e of t.children)e instanceof xf&&(n&&!G(t.producedFields(),e.dependentFields())?i.push(e):r.push(e));if(i.length>0){const e=i.pop();for(const t of i)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof xf?t.merge(e,this.model.renameSignal.bind(this.model)):e.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class Qf extends kf{run(e){const t=e.parent,n=[...t.children];if(!q(n,e=>e instanceof Ou)||t.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let r;for(const e of n)if(e instanceof Ou){let n=e;for(;1===n.numChildren();){const e=n.children[0];if(!(e instanceof Ou))break;n=e}i.push(...n.children),r?(t.removeChild(e),e.parent=r.parent,r.parent.removeChild(r),r.parent=n,this.setMutated()):r=n}else i.push(e);if(i.length){this.setMutated();for(const e of i)e.parent.removeChild(e),e.parent=r}return this.setContinue(),this.flags}}const Kf="scale_";function Zf(e){const t=[];function n(e){if(0===e.numChildren())t.push(e);else for(const t of e.children)n(t)}for(const t of e)n(t);return t}function ed(e){return e}function td(e,t){return t.map(t=>{if(e instanceof kf){const n=e.optimizeNextFromLeaves(t);return e.reset(),n}return e.run(t)}).some(ed)}function nd(e,t){let n=e.sources;const i=new Set;return i.add(td(new Gf,n)),i.add(td(new Vf(t),n)),n=n.filter(e=>e.numChildren()>0),i.add(td(new Uf,Zf(n))),n=n.filter(e=>e.numChildren()>0),i.add(td(new qf,Zf(n))),i.add(td(new Xf(t),Zf(n))),i.add(td(new Wf,Zf(n))),i.add(td(new Jf,Zf(n))),i.add(td(new Yf,Zf(n))),i.add(td(new If,Zf(n))),i.add(td(new Rf,n)),i.add(td(new Qf,Zf(n))),e.sources=n,i.has(!0)}class id{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new id(()=>e(t))}}function rd(e){Sd(e)?function(e){const t=e.component.scales;for(const n of J(t)){const i=od(e,n);if(t[n].setWithExplicit("domains",i),ld(e,n),e.component.data.isFaceted){let t=e;for(;!Bd(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of i.value)Qn(e)&&(e.data=Kf+e.data.replace(Kf,""))}}}(e):function(e){for(const t of e.children)rd(t);const t=e.component.scales;for(const n of J(t)){let i,r=null;for(const t of e.children){const e=t.component.scales[n];if(e){i=void 0===i?e.getWithExplicit("domains"):la(i,e.getWithExplicit("domains"),"domains","scale",fd);const t=e.get("selectionExtent");r&&t&&r.selection!==t.selection&&Bn("The same selection must be used to override scale domains in a layered view."),r=t}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}(e)}function od(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=function(e,t,n,i){if("unaggregated"===e){const{valid:e,reason:i}=cd(t,n);if(!e)return void Bn(i)}else if(void 0===e&&i.useUnaggregatedDomain){const{valid:e}=cd(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),"x"===t&&oo(i.x2)?oo(i.x)?la(ad(n,r,e,"x"),ad(n,r,e,"x2"),"domain","scale",fd):ad(n,r,e,"x2"):"y"===t&&oo(i.y2)?oo(i.y)?la(ad(n,r,e,"y"),ad(n,r,e,"y2"),"domain","scale",fd):ad(n,r,e,"y2"):ad(n,r,e,t)}function sd(e,t,n){var i;const r=null===(i=Jn(n))||void 0===i?void 0:i.unit;return"temporal"===t||r?function(e,t,n){return e.map(e=>({signal:`{data: ${go(e,{timeUnit:n,type:t})}}`}))}(e,t,r):[e]}function ad(e,t,n,i){const{encoding:r}=n,o=oo(r[i]),{type:s}=o,a=o.timeUnit;if(function(e){return e&&e.unionWith}(t)){const r=ad(e,void 0,n,i),o=sd(t.unionWith,s,a);return oa([...r.value,...o])}if(Yn(t))return oa([t]);if(t&&"unaggregated"!==t&&!Vi(t))return oa(sd(t,s,a));const u=n.stack;if(u&&i===u.fieldChannel){if("normalize"===u.offset)return sa([[0,1]]);const e=n.requestDataName(va);return sa([{data:e,field:n.vgField(i,{suffix:"start"})},{data:e,field:n.vgField(i,{suffix:"end"})}])}const l=Ht(i)&&Nr(o)?function(e,t,n){if(!Wi(n))return;const i=e.fieldDef(t),r=i.sort;if(Dr(r))return{op:"min",field:wc(i,t),order:"ascending"};const{stack:o}=e,s=o?[...o.groupbyField?[o.groupbyField]:[],...o.stackBy.map(e=>e.fieldDef.field)]:void 0;if(Ar(r)){const e=o&&!M(s,r.field);return ud(r,e)}if(jr(r)){const{encoding:t,order:n}=r,i=e.fieldDef(t),{aggregate:a,field:u}=i,l=o&&!M(s,u);if(Ve(a)||Je(a))return ud({field:Jr(i),order:n},l);if(Ye(a)||!a)return ud({op:a,field:u,order:n},l)}else{if("descending"===r)return{op:"min",field:e.vgField(t),order:"descending"};if(M(["ascending",void 0],r))return!0}return}(n,i,e):void 0;if(Tr(o)){return sa(sd([o.datum],s,a))}const c=o;if("unaggregated"===t){const e=n.requestDataName(va),{field:t}=o;return sa([{data:e,field:Jr({field:t,aggregate:"min"})},{data:e,field:Jr({field:t,aggregate:"max"})}])}if(Qt(c.bin)){if(Wi(e))return sa("bin-ordinal"===e?[]:[{data:Q(l)?n.requestDataName(va):n.requestDataName("raw"),field:n.vgField(i,mo(c,i)?{binSuffix:"range"}:{}),sort:!0!==l&&d(l)?l:{field:n.vgField(i,{}),op:"min"}}]);{const{bin:e}=c;if(Qt(e)){const t=vf(n,c.field,e);return sa([new id(()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`})])}return sa([{data:n.requestDataName(va),field:n.vgField(i,{})}])}}if(c.timeUnit&&M(["time","utc"],e)&&Br(i,c,Sd(n)?n.encoding[St(i)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(va);return sa([{data:e,field:n.vgField(i)},{data:e,field:n.vgField(i,{suffix:"end"})}])}return sa(l?[{data:Q(l)?n.requestDataName(va):n.requestDataName("raw"),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(va),field:n.vgField(i)}])}function ud(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":xr},i?{field:re(i)}:{}),r?{order:r}:{})}function ld(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,o=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,s=Vi(r)&&r,a=Zt(o)&&en(o.extent)&&o.extent;(s||a)&&i.set("selectionExtent",null!=s?s:a,!0)}function cd(e,t){const{aggregate:n,type:i}=e;return n?w(n)&&!Ze[n]?{valid:!1,reason:xn(n)}:"quantitative"===i&&"log"===t?{valid:!1,reason:On(e)}:{valid:!0}:{valid:!1,reason:yn(e)}}function fd(e,t,n,i){return e.explicit&&t.explicit&&Bn(function(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${N(n)} and ${N(i)}). Using the union of the two domains.`}(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function dd(e){const t=W(e.map(e=>{if(Qn(e)){return D(e,["sort"])}return e}),L),n=W(e.map(e=>{if(Qn(e)){const t=e.sort;return void 0===t||Q(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(e=>void 0!==e),L);if(0===t.length)return;if(1===t.length){const t=e[0];if(Qn(t)&&n.length>0){let e=n[0];if(n.length>1)Bn(An),e=!0;else if(d(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const i=W(n.map(e=>Q(e)||!("op"in e)||e.op in Ge?e:(Bn(function(e){return`Dropping sort property ${N(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0)),L);let r;1===i.length?r=i[0]:i.length>1&&(Bn(An),r=!0);const o=W(e.map(e=>Qn(e)?e.data:null),e=>e);if(1===o.length&&null!==o[0]){return Object.assign({data:o[0],fields:t.map(e=>e.field)},r?{sort:r}:{})}return Object.assign({fields:t},r?{sort:r}:{})}function gd(e){if(Qn(e)&&w(e.field))return e.field;if(function(e){return!f(e)&&("fields"in e&&!("data"in e))}(e)){let t;for(const n of e.fields)if(Qn(n)&&w(n.field))if(t){if(t!==n.field)return Bn("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return Bn("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!f(e)&&("fields"in e&&"data"in e)}(e)){Bn("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return w(t)?t:void 0}}function pd(e,t){return dd(e.component.scales[t].get("domains").map(t=>(Qn(t)&&(t.data=e.lookupDataSource(t.data)),t)))}function md(e){return J(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:o,type:s,selectionExtent:a,domains:u,range:l,reverse:c}=r,f=D(r,["name","type","selectionExtent","domains","range","reverse"]),d=function(e,t,n){if(Lt(n)&&Xn(e))return{step:{signal:t+"_step"}};return e}(r.range,o,n);let g;a&&(g=function(e,t){const n=t.selection;return{signal:ic(e.getSelectionComponent(n,K(n)),t)}}(e,a));const p=pd(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:o,type:s},p?{domain:p}:{}),g?{domainRaw:g}:{}),{range:d}),void 0!==c?{reverse:c}:{}),f)),t},[])}class hd extends ra{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||q(this.get("domains"),e=>f(e)&&2===e.length&&e[0]<=0&&e[1]>=0)}}const bd=["range","scheme"];function vd(e){return"x"===e?"width":"y"===e?"height":void 0}function yd(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Qt(n.bin)){const i=vf(e,n.field,n.bin),r=vd(t),o=e.getName(r);return new id(()=>{const t=e.getSignalName(i),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(o)} / (${n})`})}}function xd(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e).get("type");for(const i of bd)if(void 0!==n[i]){const o=Xi(r,i),s=Qi(e,i);if(o)if(s)Bn(s);else switch(i){case"range":return f(n.range)&&Lt(e)?oa(n.range.map(e=>{if("width"===e||"height"===e){const n=t.getName(e),i=t.getSignalName.bind(t);return id.fromName(i,n)}return e})):oa(n.range);case"scheme":return oa(Od(n[i]))}else Bn(wn(r,i,e))}if(e===nt||e===it){const t=e===nt?"width":"height",n=i[t];if(gs(n)){if(Wi(r))return oa({step:n.step});Bn(jn(t))}}return sa(function(e,t){const{size:n,config:i,mark:r,encoding:o}=t,s=t.getSignalName.bind(t),{type:a}=oo(o[e]),u=t.getScaleComponent(e).get("type"),{domain:l,domainMid:c}=t.specifiedScales[e];switch(e){case nt:case it:{if(M(["point","band"],u))if(e!==nt||n.width){if(e===it&&!n.height){const e=vs(i.view,"height");if(gs(e))return e}}else{const e=vs(i.view,"width");if(gs(e))return e}const r=vd(e),o=t.getName(r);return e===it&&Ii(u)?[id.fromName(s,o),0]:[0,id.fromName(s,o)]}case gt:{const o=t.component.scales[e].get("zero"),s=function e(t,n,i){if(n)return Yn(n)?{signal:`${n.signal} ? 0 : ${e(t,!1,i)}`}:0;switch(t){case"bar":case"tick":return i.scale.minBandSize;case"line":case"trail":case"rule":return i.scale.minStrokeWidth;case"text":return i.scale.minFontSize;case"point":case"square":case"circle":return i.scale.minSize}throw new Error(hn("size",t))}(r,o,i),a=function(e,t,n,i){const r={x:yd(n,"x"),y:yd(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==i.scale.maxBandSize)return i.scale.maxBandSize;const e=wd(t,r,i.view);return O(e)?e-1:new id(()=>e.signal+" - 1")}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const e=wd(t,r,i.view);return O(e)?Math.pow(.95*e,2):new id(()=>`pow(0.95 * ${e.signal}, 2)`)}}throw new Error(hn("size",e))}(r,n,t,i);return Gi(u)?function(e,t,n){const i=()=>{const i=xo(t),r=xo(e),o=`(${i} - ${r}) / (${n} - 1)`;return`sequence(${r}, ${i} + ${o}, ${o})`};return Yn(t)?new id(i):{signal:i()}}(s,a,function(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&f(n)?n.length+1:(Bn(function(e){return`Domain for ${e} is required for threshold scale.`}(i)),3)}}(u,i,l,e)):[s,a]}case at:return[0,2*Math.PI];case"angle":return[0,360];case st:return[0,new id(()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`)];case"strokeWidth":return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case"strokeDash":return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case dt:return"symbol";case lt:case ct:case ft:return"ordinal"===u?"nominal"===a?"category":"ordinal":void 0!==c?"diverging":"rect"===r||"geoshape"===r?"heatmap":"ramp";case"opacity":case"fillOpacity":case"strokeOpacity":return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}(e,t))}function Od(e){return function(e){return!w(e)&&!!e.name}(e)?Object.assign({scheme:e.name},P(e,["name"])):{scheme:e}}function wd(e,t,n){const i=gs(e.width)?e.width.step:bs(n,"width"),r=gs(e.height)?e.height.step:bs(n,"height");return t.x||t.y?new id(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function jd(e,t){Sd(e)?function(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:o,specifiedScales:s}=e;for(const a of J(n)){const u=s[a],l=n[a],c=e.getScaleComponent(a),f=oo(r[a]),d=u[t],g=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),h=Xi(g,t),b=Qi(a,t);if(void 0!==d&&(h?b&&Bn(b):Bn(wn(g,t,a))),h&&void 0===b)if(void 0!==d)l.copyKeyFromObject(t,u);else{const n=t in Ad?Ad[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:m,domain:u.domain,markDef:o,config:i}):i.scale[t];void 0!==n&&l.set(t,n,!1)}}}(e,t):Fd(e,t)}const Ad={bins:({model:e,fieldOrDatumDef:t})=>Nr(t)?function(e,t){const n=t.bin;if(Qt(n)){const i=vf(e,t.field,n);return new id(()=>e.getSignalName(i))}if(Kt(n)&&Zt(n)&&void 0!==n.step)return{step:n.step};return}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(M([lt,ct,ft],e)&&"nominal"!==t)return"hcl";return}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var i;if((null===(i=ro(n))||void 0===i?void 0:i.bin)||M([Di,Fi],e))return;return t in Pt||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>function(e,t,n,i,r,o){if(e in Pt){if(Hi(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:s}=r;if("bar"===t&&(!Nr(i)||!i.bin&&!i.timeUnit)&&("vertical"===s&&"x"===e||"horizontal"===s&&"y"===e))return o.continuousBandSize}if(t===$i)return n.pointPadding}return}(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>function(e,t,n,i){if(void 0!==e)return;if(t in Pt){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:r}=i;return ue(e,"bar"===n?t:r)}return}(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:o})=>function(e,t,n,i,r,o){if(void 0!==e)return;if(t in Pt&&n===Si){const{bandPaddingOuter:e}=o;return ue(e,Yn(r)?{signal:r.signal+"/2"}:r/2)}return}(e,t,n,i.type,r,o.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>function(e,t,n,i){if("x"===n&&void 0!==i.xReverse)return Ii(e)&&"descending"===t?Yn(i.xReverse)?{signal:"!"+i.xReverse.signal}:!i.xReverse:i.xReverse;if(Ii(e)&&"descending"===t)return!0;return}(t,Nr(e)?e.sort:void 0,n,i.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>function(e,t,n,i,r){if(n&&"unaggregated"!==n&&Ii(r)){if(f(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!Gi(r))return!0;if((!Nr(t)||!t.bin)&&M([...Nt,...Mt],e)){const{orient:t,type:n}=i;return!M(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,i,r)};function Dd(e){Sd(e)?function(e){const t=e.component.scales;for(const n of It){const i=t[n];if(!i)continue;const r=xd(n,e);i.setWithExplicit("range",r)}}(e):Fd(e,"range")}function Fd(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?Dd(n):jd(n,t);for(const i of J(n)){let r;for(const n of e.children){const e=n.component.scales[i];if(e){r=la(r,e.getWithExplicit(t),t,"scale",aa((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function kd(e,t,n,i){const r=function(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(yt(e)||"discrete"===Yt(e))return"shape"===e&&"ordinal"===t.type&&Bn(vn(e,"ordinal")),"ordinal";if(e in Pt){if(M(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in Tt)return"band";return void 0!==t.band||Hr(t)&&(null===(i=t.axis)||void 0===i?void 0:i.tickBand)?"band":"point";case"temporal":return yt(e)?"time":"discrete"===Yt(e)?(Bn(vn(e,"temporal")),"ordinal"):Nr(t)&&t.timeUnit&&Jn(t.timeUnit).utc?"utc":"time";case"quantitative":return yt(e)?Nr(t)&&Qt(t.bin)?"bin-ordinal":"linear":"discrete"===Yt(e)?(Bn(vn(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(gn(t.type))}(t,n,i),{type:o}=e;return Ht(t)?void 0!==o?Zi(t,o)?Nr(n)&&!Ki(o,n.type)?(Bn(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(o,r)),r):o:(Bn(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,o,r)),r):r:null}function Cd(e){Sd(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return It.reduce((i,r)=>{const o=oo(t[r]);if(o&&n===_e&&r===dt&&o.type===vi)return i;let s=o&&o.scale;if(o&&null!==s&&!1!==s){s=null!=s?s:{};const t=kd(s,r,o,n);i[r]=new hd(e.scaleName(r+"",!0),{value:t,explicit:s.type===t})}return i},{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const n of e.children){Cd(n);for(const o of J(n.component.scales))if(r.scale[o]=null!==(t=r.scale[o])&&void 0!==t?t:Ic(o,e),"shared"===r.scale[o]){const e=i[o],t=n.component.scales[o].getWithExplicit("type");e?zi(e.value,t.value)?i[o]=la(e,t,"type","scale",Ed):(r.scale[o]="independent",delete i[o]):i[o]=t}}for(const t of J(i)){const r=e.scaleName(t,!0),o=i[t];n[t]=new hd(r,o);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),r),e.merged=!0)}}return n}(e)}const Ed=aa((e,t)=>Ni(e)-Ni(t));class $d{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Sd(e){return"unit"===(null==e?void 0:e.type)}function Bd(e){return"facet"===(null==e?void 0:e.type)}function _d(e){return"concat"===(null==e?void 0:e.type)}function zd(e){return"layer"===(null==e?void 0:e.type)}class Pd{constructor(e,t,n,i,r,o,s){var a,u;this.type=t,this.parent=n,this.config=r,this.view=s,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=r,this.name=null!==(a=e.name)&&void 0!==a?a:i,this.title=bo(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new $d,this.projectionNameMap=n?n.projectionNameMap:new $d,this.signalNameMap=n?n.signalNameMap:new $d,this.data=e.data,this.description=e.description,this.transforms=(null!==(u=e.transform)&&void 0!==u?u:[]).map(e=>ya(e)?{filter:S(e.filter,di)}:e),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var i,r;const o=n[t],s={},{spacing:a,columns:u}=o;void 0!==a&&(s.spacing=a),void 0!==u&&(Cr(e)&&!Fr(e.facet)||cs(e))&&(s.columns=u),fs(e)&&(s.columns=1);for(const t of ms)if(void 0!==e[t])if("spacing"===t){const n=e[t];s[t]=O(n)?n:{row:null!==(i=n.row)&&void 0!==i?i:a,column:null!==(r=n.column)&&void 0!==r?r:a}}else s[t]=e[t];return s}(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:Cr(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new ra,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?_(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){Cd(e),rd(e);for(const t of Yi)jd(e,t);t||Dd(e)}(this)}parseProjection(){hf(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){of(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=D(e,["style"]),n={};for(const e of J(t)){const i=t[e];void 0!==i&&(n[e]=vo(i))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=vo(this.description)),"unit"!==this.type&&"layer"!==this.type)?V(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=D(e,["spacing"]),{component:i,config:r}=this,o=function(e,t){const n={};for(const i of Ot){const r=e[i];if(null==r?void 0:r.facetFieldDef){const{titleAnchor:e,titleOrient:o}=Dc(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),s=jc(i,o),a=Nc(e,s);void 0!==a&&(n[s]=a)}}return V(n)?void 0:n}(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of Ot)e[n].title&&t.push(Cc(this,n));for(const e of Fc)t=t.concat(Sc(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(e=>sc(e,"grid",t)),...i.map(e=>sc(e,"grid",t)),...n.map(e=>sc(e,"main",t)),...i.map(e=>sc(e,"main",t))].filter(e=>e)}(this.component.axes,this.config)}assembleLegends(){return ff(this)}assembleProjections(){return df(this)}assembleTitle(){var e,t,n;const i=null!==(e=this.title)&&void 0!==e?e:{},{encoding:r}=i,o=D(i,["encoding"]),s=Object.assign(Object.assign(Object.assign({},ho(this.config.title).nonMark),o),r?{encode:{update:r}}:{});if(s.text)return M(["unit","layer"],this.type)?M(["middle",void 0],s.anchor)&&(s.frame=null!==(t=s.frame)&&void 0!==t?t:"group"):s.anchor=null!==(n=s.anchor)&&void 0!==n?n:"start",V(s)?void 0:s}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Bd(this.parent)?function e(t){return zd(t)||_d(t)?t.children.reduce((t,n)=>t.concat(e(n)),md(t)):md(t)}(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const o=this.assembleLegends();return o.length>0&&(t.legends=o),t}getName(e){return K((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),i=this.component.data.outputNodeRefCounts;return i[n]=(null!==(t=i[n])&&void 0!==t?t:0)+1,n}getSizeSignalRef(e){if(Bd(this.parent)){const t=qt(Uc(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),i=n.get("range");if(Wi(e)&&Xn(i)){const e=n.get("name"),i=gd(pd(this,t));if(i){return{signal:Rc(e,n,Jr({aggregate:"distinct",field:i},{expr:"datum"}))}}return Bn(`Unknown field for ${t}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):Ft(e)&&Ht(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(function(e){return`Cannot find a selection named "${e}".`}(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some(e=>e.hasOrientSignalRef()))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some(e=>e.hasOrientSignalRef()))}}class Nd extends Pd{vgField(e,t={}){const n=this.fieldDef(e);if(n)return Jr(n,t)}reduceFieldDef(e,t){return No(this.getMapping(),(t,n,i)=>{const r=ro(n);return r?e(t,r,i):t},t)}forEachFieldDef(e,t){Po(this.getMapping(),(t,n)=>{const i=ro(t);i&&e(i,n)},t)}}class Ld extends xu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=_(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"value",null!==(r=o[1])&&void 0!==r?r:"density"]}clone(){return new Ld(null,_(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform "+L(this.transform)}assemble(){const e=this.transform,{density:t}=e,n=D(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class Td extends xu{constructor(e,t){super(e),this.filter=t}clone(){return new Td(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t;if("filter"!==wo("invalid",r,n))return null;const o=t.reduceFieldDef((e,n,r)=>{const o=Ht(r)&&t.getScaleComponent(r);if(o){Ii(o.get("type"))&&"count"!==n.aggregate&&!ze(i)&&(e[n.field]=n)}return e},{});return J(o).length?new Td(e,o):null}dependentFields(){return new Set(J(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid "+L(this.filter)}assemble(){const e=J(this.filter).reduce((e,t)=>{const n=this.filter[t],i=Jr(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`):"quantitative"===n.type&&(e.push(`isValid(${i})`),e.push(`isFinite(+${i})`))),e},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class Md extends xu{constructor(e,t){super(e),this.transform=t,this.transform=_(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((e,t)=>{var n;return null!==(n=i[t])&&void 0!==n?n:e})}clone(){return new Md(this.parent,_(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform "+L(this.transform)}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class qd extends xu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=_(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"key",null!==(r=o[1])&&void 0!==r?r:"value"]}clone(){return new qd(null,_(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform "+L(this.transform)}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class Rd extends xu{constructor(e,t,n,i){super(e),this.fields=t,this.geojson=n,this.signal=i}clone(){return new Rd(null,_(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[["longitude","latitude"],["longitude2","latitude2"]]){const r=i.map(e=>{const n=oo(t.encoding[e]);return Nr(n)?n.field:Tr(n)?{expr:""+n.datum}:Wr(n)?{expr:""+n.value}:void 0});(r[0]||r[1])&&(e=new Rd(e,r,null,t.getName("geojson_"+n++)))}if(t.channelHasField(dt)){const i=t.typedFieldDef(dt);i.type===vi&&(e=new Rd(e,null,i.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(w);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${L(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class Ud extends xu{constructor(e,t,n,i){super(e),this.projection=t,this.fields=n,this.as=i}clone(){return new Ud(null,this.projection,_(this.fields),_(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[["longitude","latitude"],["longitude2","latitude2"]]){const i=n.map(e=>{const n=oo(t.encoding[e]);return Nr(n)?n.field:Tr(n)?{expr:""+n.datum}:Wr(n)?{expr:""+n.value}:void 0}),r="longitude2"===n[0]?"2":"";(i[0]||i[1])&&(e=new Ud(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(w))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${L(this.fields)} ${L(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Wd extends xu{constructor(e,t){super(e),this.transform=t}clone(){return new Wd(null,_(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e;return{signal:`sequence(${[t,n,...i?[i]:[]].join(",")})`}}static makeFromTransform(e,t){return new Wd(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(Nr(i)&&Nr(r)){const o=i.impute?i:r.impute?r:void 0;if(void 0===o)return;const s=i.impute?r:r.impute?i:void 0,{method:a,value:u,frame:l,keyvals:c}=o.impute,f=Lo(t.mark,n);return new Wd(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:s.field},a?{method:a}:{}),void 0!==u?{value:u}:{}),l?{frame:l}:{}),void 0!==c?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return"Impute "+L(this.transform)}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:o,frame:s=[null,null]}=this.transform,a=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:(u=n,void 0!==(null==u?void 0:u.stop)?this.processSequence(n):n)}:{}),{method:"value"}),r?{groupby:r}:{}),{value:i&&"value"!==i?null:o});var u;if(i&&"value"!==i){return[a,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:s,ignorePeers:!1},r?{groupby:r}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]}return[a]}}class Id extends xu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=_(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:t.on,null!==(r=o[1])&&void 0!==r?r:t.loess]}clone(){return new Id(null,_(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform "+L(this.transform)}assemble(){const e=this.transform,{loess:t,on:n}=e,i=D(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},i)}}class Hd extends xu{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new Hd(null,_(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:o}=n;let s=null;if(function(e){return"data"in e}(o)){let e=sg(o.data,r);e||(e=new Of(o.data),r.push(e));const n=t.getName("lookup_"+i);s=new Ou(e,n,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=s}else if(function(e){return"selection"in e}(o)){const e=o.selection;if(n=Object.assign({as:e},n),s=t.getSelectionComponent(K(e),e).materialized,!s)throw new Error(function(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}(e))}return new Hd(e,n,s.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?b(this.transform.as):this.transform.from.fields)}hash(){return"Lookup "+L({transform:this.transform,secondary:this.secondary})}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:b(this.transform.as)}:{});else{let t=this.transform.as;w(t)||(Bn('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class Gd extends xu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=_(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"prob",null!==(r=o[1])&&void 0!==r?r:"value"]}clone(){return new Gd(null,_(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform "+L(this.transform)}assemble(){const e=this.transform,{quantile:t}=e,n=D(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}class Vd extends xu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=_(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:t.on,null!==(r=o[1])&&void 0!==r?r:t.regression]}clone(){return new Vd(null,_(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform "+L(this.transform)}assemble(){const e=this.transform,{regression:t,on:n}=e,i=D(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},i)}}class Jd extends xu{constructor(e,t){super(e),this.transform=t}clone(){return new Jd(null,_(this.transform))}addDimensions(e){var t;this.transform.groupby=W((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),e=>e)}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return"PivotTransform "+L(this.transform)}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==i?{limit:i}:{}),void 0!==r?{op:r}:{}),void 0!==n?{groupby:n}:{})}}class Yd extends xu{constructor(e,t){super(e),this.transform=t}clone(){return new Yd(null,_(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform "+L(this.transform)}assemble(){return{type:"sample",size:this.transform.sample}}}function Xd(e){let t=0;return function n(i,r){var o;if(i instanceof Of&&!i.isGenerator&&!fa(i.data)){e.push(r);r={name:null,source:r.name,transform:[]}}if(i instanceof Pf&&(i.parent instanceof Of&&!r.source?(r.format=Object.assign(Object.assign({},null!==(o=r.format)&&void 0!==o?o:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Sf){r.name||(r.name="data_"+t++),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const t of i.assemble())e.push(t)}else{if((i instanceof jf||i instanceof Af||i instanceof Td||i instanceof tc||i instanceof Oc||i instanceof Ud||i instanceof Rd||i instanceof $f||i instanceof Hd||i instanceof Mf||i instanceof Lf||i instanceof qd||i instanceof Md||i instanceof Ld||i instanceof Id||i instanceof Gd||i instanceof Vd||i instanceof Nf||i instanceof Yd||i instanceof Jd)&&r.transform.push(i.assemble()),(i instanceof xf||i instanceof wu||i instanceof Wd||i instanceof Tf)&&r.transform.push(...i.assemble()),i instanceof Ou)if(r.source&&0===r.transform.length)i.setSource(r.source);else if(i.parent instanceof Ou)i.setSource(r.name);else if(r.name||(r.name="data_"+t++),i.setSource(r.name),1===i.numChildren()){e.push(r);r={name:null,source:r.name,transform:[]}}switch(i.numChildren()){case 0:i instanceof Ou&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name="data_"+t++);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const e of i.children){n(e,{name:null,source:o,transform:[]})}break}}}}}function Qd(e){return"top"===e||"left"===e||Yn(e)?"header":"footer"}function Kd(e,t){var n;const{facet:i,config:r,child:o,component:s}=e;if(e.channelHasField(t)){const a=i[t],u=Ac("title",null,r,t);let l=eo(a,r,{allowDisabling:!0,includeDefault:void 0===u||!!u});o.component.layoutHeaders[t].title&&(l=f(l)?l.join(", "):l,l+=" / "+o.component.layoutHeaders[t].title,o.component.layoutHeaders[t].title=null);const c=Ac("labelOrient",a,r,t),d=ue((null!==(n=a.header)&&void 0!==n?n:{}).labels,r.header.labels,!0),g=M(["bottom","right"],c)?"footer":"header";s.layoutHeaders[t]={title:l,facetFieldDef:a,[g]:"facet"===t?[]:[Zd(e,t,d)]}}}function Zd(e,t,n){const i="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function eg(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:o}=e.component;if(o.axis[t]=Hc(o,t),"shared"===o.axis[t]){const o="x"===t?"column":"row",s=r[o];for(const r of i.component.axes[t]){const t=Qd(r.get("orient"));s[t]=null!==(n=s[t])&&void 0!==n?n:[Zd(e,o,!1)];const i=sc(r,"main",e.config,{header:!0});i&&s[t][0].axes.push(i),r.mainExtracted=!0}}}}function tg(e){for(const t of e.children)t.parseLayoutSize()}function ng(e,t){const n=Uc(t),i=qt(n),r=e.component.resolve,o=e.component.layoutSize;let s;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),o=r.scale[i];if("independent"===o&&"step"===e.value){s=void 0;break}if(s){if("independent"===o&&s.value!==e.value){s=void 0;break}s=la(s,e,n,"")}else s=e}if(s){for(const i of e.children)e.renameSignal(i.getName(n),e.getName(t)),i.component.layoutSize.set(n,"merged",!1);o.setWithExplicit(t,s)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function ig(e,t){const n="width"===t?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const e=r.get("type"),n=r.get("range");if(Wi(e)){const e=vs(i.view,t);return Xn(n)||gs(e)?"step":e}return hs(i.view,t)}if(e.hasProjection||"arc"===e.mark)return hs(i.view,t);{const e=vs(i.view,t);return gs(e)?e.step:e}}function rg(e,t,n){return Jr(t,Object.assign({suffix:"by_"+Jr(e)},null!=n?n:{}))}class og extends Nd{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve),this.child=kg(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet,i)}initFacet(e,t){return Fr(e)?No(e,(e,n,i)=>M([et,tt],i)?void 0===n.field?(Bn(mn(n,i)),e):(e[i]=so(n,i,t),e):(Bn(hn(i,"facet")),e),{}):{facet:so(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=ug(this),this.child.parseData()}parseLayoutSize(){tg(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of Ot)Kd(e,t);eg(e,"x"),eg(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of Ot)for(const o of kc){const s=this.component.layoutHeaders[r],a=s[o],{facetFieldDef:u}=s;if(u){const t=Ac("titleOrient",u,this.config,r);if(M(["right","bottom"],t)){const n=jc(r,t);i.titleAnchor=null!==(e=i.titleAnchor)&&void 0!==e?e:{},i.titleAnchor[n]="end"}}if(null==a?void 0:a[0]){const e="row"===r?"height":"width",a="header"===o?"headerBand":"footerBand";"facet"===r||this.child.component.layoutSize.get(e)||(i[a]=null!==(t=i[a])&&void 0!==t?t:{},i[a][r]=.5),s.title&&(i.offset=null!==(n=i.offset)&&void 0!==n?n:{},i.offset["row"===r?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof og)){return{signal:`length(data('${this.getName("column_domain")}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof og?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:Jr(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof og){if(this.child.channelHasField("column")){const i=Jr(this.child.facet.column);e.push(i),t.push("distinct"),n.push("distinct_"+i)}}else for(const i of Nt){const r=this.child.component.scales[i];if(r&&!r.merged){const o=r.get("type"),s=r.get("range");if(Wi(o)&&Xn(s)){const r=gd(pd(this.child,i));r?(e.push(r),t.push("distinct"),n.push("distinct_"+r)):Bn(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:o,as:s}=this.getCardinalityAggregateForChild(),a=[];for(const e of Ot){const t=this.facet[e];if(t){a.push(Jr(t));const{bin:u,sort:l}=t;if(Qt(u)&&a.push(Jr(t,{binSuffix:"end"})),Ar(l)){const{field:e,op:a=xr}=l,u=rg(t,l);n&&i?(r.push(u),o.push("max"),s.push(u)):(r.push(e),o.push(a),s.push(u))}else if(f(l)){const n=wc(t,e);r.push(n),o.push("max"),s.push(n)}}}const u=!!n&&!!i;return Object.assign({name:e,data:t,groupby:a},u||r.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),r.length?{fields:r,ops:o,as:s}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?Ar(n.sort)?[rg(n,n.sort,{expr:"datum"})]:f(n.sort)?[wc(n,e,{expr:"datum"})]:[Jr(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(Ar(e)?e.order:!f(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return _c(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of Fc)if(e[i]){const r=Ac("labelOrient",e[i],t,i);if(M(n[i],r))return _c(e[i],i,t)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=Xd(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||e.assembleTitle(),r=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),r?{style:r}:{}),{from:{facet:this.assembleFacet()},sort:{field:Ot.map(e=>this.facetSortFields(e)).flat(),order:Ot.map(e=>this.facetSortOrder(e)).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&J(e.component.selection).length){const n=j(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:La("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return qu(t)}(this,[])))]}getMapping(){return this.facet}}function sg(e,t){var n,i,r,o,s,a,u,l,c,f;for(const d of t){const t=d.data;if((!e.name||!d.hasName()||e.name===d.dataName)&&!((null===(n=e.format)||void 0===n?void 0:n.mesh)&&(null===(i=t.format)||void 0===i?void 0:i.feature)||((null===(r=e.format)||void 0===r?void 0:r.feature)||(null===(o=t.format)||void 0===o?void 0:o.feature))&&(null===(s=e.format)||void 0===s?void 0:s.feature)!==(null===(a=t.format)||void 0===a?void 0:a.feature)||((null===(u=e.format)||void 0===u?void 0:u.mesh)||(null===(l=t.format)||void 0===l?void 0:l.mesh))&&(null===(c=e.format)||void 0===c?void 0:c.mesh)!==(null===(f=t.format)||void 0===f?void 0:f.mesh)))if(da(e)&&da(t)){if(B(e.values,t.values))return d}else if(fa(e)&&fa(t)){if(e.url===t.url)return d}else if(ga(e)&&e.name===d.dataName)return d}return null}function ag(e,t){if(e.data||!e.parent){if(null===e.data){const e=new Of({values:[]});return t.push(e),e}const n=sg(e.data,t);if(n)return pa(e.data)||(n.data.format=function(e,...t){for(const n of t)U(e,null!=n?n:{});return e}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new Of(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function ug(e){var t,n,i,r,o,s,a,u,l,c;let f=ag(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new ca,m=e.data;pa(m)?(ma(m)?f=new Af(f,m.sequence):ba(m)&&(f=new jf(f,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),f=null!==(n=Pf.makeExplicit(f,e,p))&&void 0!==n?n:f,f=new Nf(f);const h=e.parent&&zd(e.parent);(Sd(e)||Bd(e))&&h&&(f=null!==(i=xf.makeFromEncoding(f,e))&&void 0!==i?i:f),e.transforms.length>0&&(f=function(e,t,n){var i,r;let o=0;for(const s of t.transforms){let a,u=void 0;if($a(s))a=e=new Oc(e,s),u="derived";else if(ya(s)){const r=_f(s);a=e=null!==(i=Pf.makeWithAncestors(e,{},r,n))&&void 0!==i?i:e,e=new tc(e,t,s.filter)}else if(Sa(s))a=e=xf.makeFromTransform(e,s,t),u="number";else if(_a(s)){u="date";void 0===n.getWithExplicit(s.field).value&&(e=new Pf(e,{[s.field]:u}),n.set(s.field,u,!1)),a=e=wu.makeFromTransform(e,s)}else if(za(s))a=e=$f.makeFromTransform(e,s),u="number",el(t)&&(e=new Nf(e));else if(xa(s))a=e=Hd.make(e,t,s,o++),u="derived";else if(ka(s))a=e=new Mf(e,s),u="number";else if(Ca(s))a=e=new Lf(e,s),u="number";else if(Pa(s))a=e=Tf.makeFromTransform(e,s),u="derived";else if(Na(s))a=e=new qd(e,s),u="derived";else if(Ea(s))a=e=new Md(e,s),u="derived";else if(Oa(s))a=e=new Jd(e,s),u="derived";else if(Fa(s))e=new Yd(e,s);else if(Ba(s))a=e=Wd.makeFromTransform(e,s),u="derived";else if(wa(s))a=e=new Ld(e,s),u="derived";else if(ja(s))a=e=new Gd(e,s),u="derived";else if(Aa(s))a=e=new Vd(e,s),u="derived";else{if(!Da(s)){Bn(`Ignoring an invalid transform: ${N(s)}.`);continue}a=e=new Id(e,s),u="derived"}if(a&&void 0!==u)for(const e of null!==(r=a.producedFields())&&void 0!==r?r:[])n.set(e,u,!1)}return e}(f,e,p));const b=function(e){const t={};if(Sd(e)&&e.component.selection)for(const n of J(e.component.selection)){const i=e.component.selection[n];for(const e of i.project.items)!e.channel&&ae(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=zf(e);f=null!==(r=Pf.makeWithAncestors(f,{},Object.assign(Object.assign({},b),v),p))&&void 0!==r?r:f,Sd(e)&&(f=Rd.parseAll(f,e),f=Ud.parseAll(f,e)),(Sd(e)||Bd(e))&&(h||(f=null!==(o=xf.makeFromEncoding(f,e))&&void 0!==o?o:f),f=null!==(s=wu.makeFromEncoding(f,e))&&void 0!==s?s:f,f=Oc.parseAllForSortIndex(f,e));const y=e.getName("raw"),x=new Ou(f,y,"raw",g);if(d[y]=x,f=x,Sd(e)){const t=$f.makeFromEncoding(f,e);t&&(f=t,el(e)&&(f=new Nf(f))),f=null!==(a=Wd.makeFromEncoding(f,e))&&void 0!==a?a:f,f=null!==(u=Tf.makeFromEncoding(f,e))&&void 0!==u?u:f}Sd(e)&&(f=null!==(l=Td.make(f,e))&&void 0!==l?l:f);const O=e.getName(va),w=new Ou(f,O,va,g);d[O]=w,f=w,Sd(e)&&function(e,t){Ku(e,n=>{const i=n.name,r=e.getName("lookup_"+i);e.component.data.outputNodes[r]=n.materialized=new Ou(new tc(t,e,{selection:i}),r,"lookup",e.component.data.outputNodeRefCounts)})}(e,w);let j=null;if(Bd(e)){const t=e.getName("facet");f=null!==(c=function(e,t){const{row:n,column:i}=t;if(n&&i){let t=null;for(const r of[n,i])if(Ar(r.sort)){const{field:n,op:i=xr}=r.sort;e=t=new Lf(e,{joinaggregate:[{op:i,field:n,as:rg(r,r.sort,{forAs:!0})}],groupby:[Jr(r)]})}return t}return null}(f,e.facet))&&void 0!==c?c:f,j=new Sf(f,e,t,w.getSource()),d[t]=j}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:x,main:w,facetRoot:j,ancestorParse:p})}class lg extends Pd{constructor(e,t,n,i){var r,o,s,a;super(e,"concat",t,n,i,e.resolve),"shared"!==(null===(o=null===(r=e.resolve)||void 0===r?void 0:r.axis)||void 0===o?void 0:o.x)&&"shared"!==(null===(a=null===(s=e.resolve)||void 0===s?void 0:s.axis)||void 0===a?void 0:a.y)||Bn("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map((e,t)=>kg(e,this,this.getName("concat_"+t),void 0,i))}parseData(){this.component.data=ug(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of J(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return fs(e)?e.vconcat:ds(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){tg(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";ng(e,t),ng(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=Tc(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const cg=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},he),{labelExpr:1,encode:1}),fg=J(cg);class dg extends ra{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new dg(_(this.explicit),_(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return Yn(this.explicit.orient)}}const gg={bottom:"top",top:"bottom",left:"right",right:"left"};function pg(e,t){if(!e)return t.map(e=>e.clone());{if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const n=e[i],r=t[i];if(!!n!=!!r)return;if(n&&r){const t=n.getWithExplicit("orient"),o=r.getWithExplicit("orient");if(t.explicit&&o.explicit&&t.value!==o.value)return;e[i]=mg(n,r)}}}return e}function mg(e,t){for(const n of fg){const i=la(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(e,t)=>{switch(n){case"title":return Eo(e,t);case"gridScale":return{explicit:e.explicit,value:ue(e.value,t.value)}}return ua(e,t,n,"axis")});e.setWithExplicit(n,i)}return e}function hg(e,t,n,i,r){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Yn(n.labelAngle)?n.labelAngle:ce(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===xc(i,r))return!0}return e===n[t]}const bg=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function vg(e,t){var n,i,r;let o=t.axis(e);const s=new dg,a=oo(t.encoding[e]),{mark:u,config:l}=t,c=(null==o?void 0:o.orient)||(null===(n=l["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(i=l.axis)||void 0===i?void 0:i.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),d=gc(e,f,c,t.config),g=void 0!==o?!o:mc("disable",l,null==o?void 0:o.style,d).configValue;if(s.set("disable",g,void 0!==o),g)return s;o=o||{};const p=function(e,t,n,i,r){const o=null==t?void 0:t.labelAngle;if(void 0!==o)return Yn(o)?o:ce(o);{const{configValue:o}=mc("labelAngle",e.config,null==t?void 0:t.style,r);return void 0!==o?ce(o):n===nt&&M([bi,mi],i.type)?270:void 0}}(t,o,e,a,d),m={fieldOrDatumDef:a,axis:o,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:u,config:l};for(const n of fg){const i=n in hc?hc[n](m):ve(n)?o[n]:void 0,r=void 0!==i,a=hg(i,n,o,t,e);if(r&&a)s.set(n,i,a);else{const{configValue:e,configFrom:u}=ve(n)&&"values"!==n?mc(n,t.config,o.style,d):{},l=void 0!==e;r&&!l?s.set(n,i,a):("vgAxisConfig"!==u||bg.has(n)&&l||ge(e)||Yn(e))&&s.set(n,e,!1)}}const h=null!==(r=o.encoding)&&void 0!==r?r:{},b=pe.reduce((n,i)=>{var r;if(!s.hasAxisPart(i))return n;const o=Wc(null!==(r=h[i])&&void 0!==r?r:{},t),a="labels"===i?function(e,t,n){var i;const{encoding:r,config:o}=e,s=null!==(i=oo(r[t]))&&void 0!==i?i:oo(r[St(t)]),a=e.axis(t)||{},{format:u,formatType:l}=a;return lr(l)?Object.assign({text:gr({fieldOrDatumDef:s,field:"datum.value",format:u,formatType:l,config:o})},n):n}(t,e,o):o;return void 0===a||V(a)||(n[i]={update:a}),n},{});return V(b)||s.set("encode",b,!!o.encoding||void 0!==o.labelAngle),s}function yg(e,t,n,{graticule:i}){const r=Le(e)?Object.assign({},e):{type:e},o=wo("orient",r,n);if(r.orient=function(e,t,n){switch(e){case De:case Se:case Be:case Ce:case Fe:case je:return}const{x:i,y:r,x2:o,y2:s}=t;switch(e){case we:if(Nr(i)&&(Kt(i.bin)||Nr(r)&&r.aggregate&&!i.aggregate))return"vertical";if(Nr(r)&&(Kt(r.bin)||Nr(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(s||o){if(n)return n;if(!o&&(Nr(i)&&i.type===pi&&!Qt(i.bin)||qr(i)))return"horizontal";if(!s&&(Nr(r)&&r.type===pi&&!Qt(r.bin)||qr(r)))return"vertical"}case ke:if(o&&(!Nr(i)||!Kt(i.bin))&&s&&(!Nr(r)||!Kt(r.bin)))return;case Oe:if(s)return Nr(r)&&Kt(r.bin)?"horizontal":"vertical";if(o)return Nr(i)&&Kt(i.bin)?"vertical":"horizontal";if(e===ke){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Ae:case Ee:{const t=Mr(i),o=Mr(r);if(t&&!o)return"tick"!==e?"horizontal":"vertical";if(!t&&o)return"tick"!==e?"vertical":"horizontal";if(t&&o){const t=i,o=r,s=t.type===hi,a=o.type===hi;return s&&!a?"tick"!==e?"vertical":"horizontal":!s&&a?"tick"!==e?"horizontal":"vertical":!t.aggregate&&o.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!o.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,o),void 0!==o&&o!==r.orient&&Bn(`Specified orient "${r.orient}" overridden with "${o}".`),"bar"===r.type&&r.orient){const e=wo("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:qe[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}void 0===wo("opacity",r,n)&&(r.opacity=function(e,t){if(M([De,Ee,Se,Be],e)&&!So(t))return.7;return}(r.type,t));void 0===r.filled&&(r.filled=!i&&function(e,t){const n=jo("filled",e,t),i=e.type;return ue(n,i!==De&&i!==Ae&&i!==ke)}(r,n));return void 0===wo("cursor",r,n)&&(r.cursor=function(e,t,n){if(t.href||e.href||wo("href",e,n))return"pointer";return e.cursor}(r,t,n)),r}function xg(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),nu("x",e,{defaultPos:"mid"})),nu("y",e,{defaultPos:"mid"})),Za("size",e)),Za("angle",e)),function(e,t,n){if(n)return{shape:{value:n}};return Za("shape",e)}(e,0,t))}function Og(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,o="horizontal"===r?"width":"height",s=e.getScaleComponent("horizontal"===r?"x":"y"),a=null!==(t=wo("size",i,n,{vgChannel:o}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==a)return a;{const e=s?s.get("range"):void 0;if(e&&Xn(e)&&O(e.step))return 3*e.step/4;return 3*bs(n.view,o)/4}}const wg={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),nu("x",e,{defaultPos:"mid"})),nu("y",e,{defaultPos:"mid"})),cu(e,"radius","arc")),cu(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),au("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),au("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),bu(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),cu(e,"x","bar")),cu(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>xg(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&Nr(n)&&n.type===vi?{field:Jr(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),cu(e,"x","image")),cu(e,"y","image")),Va(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),nu("x",e,{defaultPos:"mid"})),nu("y",e,{defaultPos:"mid"})),Za("size",e,{vgChannel:"strokeWidth"})),bu(e))},point:{vgMark:"symbol",encodeEntry:e=>xg(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),cu(e,"x","rect")),cu(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),au("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),au("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),Za("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>xg(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),nu("x",e,{defaultPos:"mid"})),nu("y",e,{defaultPos:"mid"})),Va(e)),Za("size",e,{vgChannel:"fontSize"})),Za("angle",e)),vu("align",function(e,t,n){if(void 0===wo("align",e,n))return"center";return}(e.markDef,0,t))),vu("baseline",function(e,t,n){if(void 0===wo("baseline",e,n))return"middle";return}(e.markDef,0,t))),nu("radius",e,{defaultPos:null,isMidPoint:!0})),nu("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r="horizontal"===i?"width":"height",o="horizontal"===i?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),nu("x",e,{defaultPos:"mid",vgChannel:"xc"})),nu("y",e,{defaultPos:"mid",vgChannel:"yc"})),Za("size",e,{defaultValue:Og(e),vgChannel:r})),{[o]:vo(wo("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},mu(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),nu("x",e,{defaultPos:"mid"})),nu("y",e,{defaultPos:"mid"})),Za("size",e)),bu(e))}};function jg(e){return M([Ae,Oe,$e],e.mark)?function(e){const t=Lo(e.mark,e.encoding),n=Ag(e,{fromPrefix:t.length>0?"faceted_path_":""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:"faceted_path_"+e.requestDataName(va),data:e.requestDataName(va),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(e):M([we],e.mark)?function(e){const t=ei.some(t=>wo(t,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[t]=Ag(e,{fromPrefix:"stack_group_"}),n=e.scaleName(e.stack.fieldChannel),i=(t={})=>e.vgField(e.stack.fieldChannel,t),r=(e,t)=>`${e}(${[i({prefix:"min",suffix:"start",expr:t}),i({prefix:"max",suffix:"start",expr:t}),i({prefix:"min",suffix:"end",expr:t}),i({prefix:"max",suffix:"end",expr:t})].map(e=>`scale('${n}',${e})`).join(",")})`;let o,s;"x"===e.stack.fieldChannel?(o=Object.assign(Object.assign({},z(t.encode.update,["y","yc","y2","height",...ei])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},P(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},z(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},P(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of ei){const i=jo(n,e.markDef,e.config);t.encode.update[n]?(o[n]=t.encode.update[n],delete t.encode.update[n]):i&&(o[n]=vo(i)),i&&(t.encode.update[n]={value:0})}const a=e.fieldDef(e.stack.groupbyChannel),u=Jr(a)?[Jr(a)]:[];((null==a?void 0:a.bin)||(null==a?void 0:a.timeUnit))&&u.push(Jr(a,{binSuffix:"end"}));return o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((n,i)=>{if(t.encode.update[i])return Object.assign(Object.assign({},n),{[i]:t.encode.update[i]});{const t=jo(i,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[i]:vo(t)}):n}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(va),name:"stack_group_"+e.requestDataName(va),groupby:u,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[t]}]}]}return Ag(e)}(e):Ag(e)}function Ag(e,t={fromPrefix:""}){const{mark:n,markDef:i,config:r}=e,o=ue(i.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=Oo(i),a=e.encoding.key,u=function(e){const{encoding:t,stack:n,mark:i,markDef:r,config:o}=e,s=t.order;if(!(!f(s)&&Wr(s)&&T(s.value)||!s&&T(wo("order",r,o)))){if((f(s)||Nr(s))&&!n)return Fo(s,{expr:"datum"});if(ze(i)){const n="horizontal"===r.orient?"y":"x",i=t[n];if(Nr(i)){const t=i.sort;if(f(t))return{field:Jr(i,{prefix:n,suffix:"sort_index",expr:"datum"})};if(Ar(t))return{field:Jr({aggregate:So(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})};if(jr(t)){return{field:Jr(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}}return null===t?void 0:{field:Jr(i,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}else;}}(e),l=function(e){if(!e.component.selection)return null;const t=J(e.component.selection).length;let n=t,i=e.parent;for(;i&&0===n;)n=J(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}(e),c=wo("aria",i,r),d=wg[n].postEncodingTransform?wg[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:wg[n].vgMark},o?{clip:!0}:{}),s?{style:s}:{}),a?{key:a.field}:{}),u?{sort:u}:{}),l||{}),!1===c?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(va)},encode:{update:wg[n].encodeEntry(e)}}),d?{transform:d}:{})]}class Dg extends Nd{constructor(e,t,n,i={},r){var o,s;super(e,"unit",t,n,r,void 0,ps(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=Le(e.mark)?e.mark.type:e.mark;this.markDef=yg(e.mark,null!==(o=e.encoding)&&void 0!==o?o:{},r,{graticule:e.data&&ba(e.data)});const u=this.encoding=_o(null!==(s=e.encoding)&&void 0!==s?s:{},this.markDef,r);this.size=function({encoding:e,size:t}){for(const n of Nt){const i=Bt(n);gs(t[i])&&Mr(e[n])&&(delete t[i],Bn(jn(i)))}return t}({encoding:u,size:ps(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=Ns(a,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegend(u),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===_e,n=e&&bt.some(t=>Rr(e[t]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return It.reduce((e,n)=>{var i;const r=oo(t[n]);return r&&(e[n]=null!==(i=r.scale)&&void 0!==i?i:{}),e},{})}initAxes(e){return Nt.reduce((t,n)=>{const i=e[n];if(Rr(i)||n===nt&&Rr(e.x2)||n===it&&Rr(e.y2)){const e=Rr(i)?i.axis:void 0;t[n]=e?Object.assign({},e):e}return t},{})}initLegend(e){return Ut.reduce((t,n)=>{const i=oo(e[n]);if(i&&function(e){switch(e){case lt:case ct:case ft:case gt:case dt:case"opacity":case"strokeWidth":case"strokeDash":return!0;case"fillOpacity":case"strokeOpacity":case"angle":return!1}}(n)){const e=i.legend;t[n]=e?Object.assign({},e):e}return t},{})}parseData(){this.component.data=ug(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const i of Nt){const r=Bt(i);if(t[r]){const e=t[r];n.layoutSize.set(r,gs(e)?"step":e,!0)}else{const t=ig(e,r);n.layoutSize.set(r,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const i={},r=e.config.selection;for(const o of J(null!=t?t:{})){const s=_(t[o]),a=D(r[s.type],["fields","encodings"]);for(const e in a)"encodings"===e&&s.fields||"fields"===e&&s.encodings||("mark"===e&&(s[e]=Object.assign(Object.assign({},a[e]),s[e])),void 0!==s[e]&&!0!==s[e]||(s[e]=null!==(n=a[e])&&void 0!==n?n:s[e]));const u=K(o),l=i[u]=Object.assign(Object.assign({},s),{name:u,events:w(s.on)?La(s.on,"scope"):_(s.on)});Lu(l,n=>{n.has(l)&&n.parse&&n.parse(e,l,s,t[o])})}return i}(this,this.selection)}parseMarkGroup(){this.component.mark=jg(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,Nt.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[vg(n,e)]),t),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;if(Ku(e,(i,r)=>{const o=i.name,s=j(o+Vu);if(0===t.filter(e=>e.name===o).length){const e="global"===i.resolve?"union":i.resolve,n="multi"===i.type?", true)":")";t.push({name:i.name,update:`${Xu}(${s}, ${j(e)}${n}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),Lu(i,n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,i,t))})}),n){0===t.filter(e=>"unit"===e.name).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return qu(t)}(this,e)}assembleSignals(){return[...ac(this),...(e=this,t=[],Ku(e,(n,i)=>{const r=n.name;let o=i.modifyExpr(e,n);t.push(...i.signals(e,n)),Lu(n,i=>{i.signals&&(t=i.signals(e,n,t)),i.modifyExpr&&(o=i.modifyExpr(e,n,o))}),t.push({name:r+Yu,on:[{events:{signal:n.name+Ju},update:`modify(${j(n.name+Vu)}, ${o})`}]})}),qu(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return Ku(e,t=>{const i={name:t.name+Vu};if(t.init){const n=t.project.items.map(e=>D(e,["signals"])),r=t.init.map(e=>Tu(e,!1));i.values="interval"===t.type?[{unit:Zu(e,{escape:!1}),fields:n,values:r}]:r.map(t=>({unit:Zu(e,{escape:!1}),fields:n,values:t}))}n.filter(e=>e.name===t.name+Vu).length||n.push(i)}),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return Tc(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&zd(this.parent)||(t=Mu(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return $o(this.encoding,e)}fieldDef(e){return ro(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return Ur(t)?t:null}}class Fg extends Pd{constructor(e,t,n,i,r){super(e,"layer",t,n,r,e.resolve,e.view);const o=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((e,t)=>{if($s(e))return new Fg(e,this,this.getName("layer_"+t),o,r);if(We(e))return new Dg(e,this,this.getName("layer_"+t),o,r);throw new Error(nn(e))})}parseData(){this.component.data=ug(this);for(const e of this.children)e.parseData()}parseLayoutSize(){var e;tg(e=this),ng(e,"width"),ng(e,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of J(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const r of J(t.component.axes))i.axis[r]=Hc(e.component.resolve,r),"shared"===i.axis[r]&&(n[r]=pg(n[r],t.component.axes[r]),n[r]||(i.axis[r]="independent",delete n[r]))}for(const o of Nt){for(const s of e.children)if(s.component.axes[o]){if("independent"===i.axis[o]){n[o]=(null!==(t=n[o])&&void 0!==t?t:[]).concat(s.component.axes[o]);for(const e of s.component.axes[o]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!Yn(t)){if(r[t]>0&&!n){const n=gg[t];r[t]>r[n]&&e.set("orient",n,!1)}r[t]++}}}delete s.component.axes[o]}if("independent"===i.axis[o]&&n[o]&&n[o].length>1)for(const e of n[o])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),ac(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),Tc(this))}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)Sd(n)&&(t=Mu(n,t));return t}(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),ff(this))}}function kg(e,t,n,i,r){if(Cr(e))return new og(e,t,n,r);if($s(e))return new Fg(e,t,n,i,r);if(We(e))return new Dg(e,t,n,i,r);if(function(e){return fs(e)||ds(e)||cs(e)}(e))return new lg(e,t,n,r);throw new Error(nn(e))}const Cg=new class extends Ss{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:r,timeUnits:o,aggregate:s,groupby:a,encoding:u}=Bo(n,t),l=[...i||[],...r,...o,...0===s.length?[]:[{aggregate:s,groupby:a}]];return Object.assign(Object.assign(Object.assign({},e),l.length>0?{transform:l}:{}),{encoding:u})}return e}};const Eg=t;e.compile=function(e,t={}){var n;t.logger&&(n=t.logger,Sn=n),t.fieldTitle&&Zr(t.fieldTitle);try{const n=As(p(t.config,e.config)),i=Zs(e,n),r=kg(i,null,"",void 0,n);r.parse(),function(e,t){wf(e.sources);let n=0,i=0;for(let i=0;i<5&&nd(e,t);i++)n++;e.sources.map(Hf);for(let n=0;n<5&&nd(e,t);n++)i++;wf(e.sources),5===Math.max(n,i)&&Bn("Maximum optimization runs(5) reached.")}(r.component.data,r);return{spec:function(e,t,n={},i){const r=e.config?Cs(e.config):void 0,o=[].concat(e.assembleSelectionData([]),function(e,t){var n,i;const r=[],o=Xd(r);let s=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+s++);const e=t.assemble();o(t,e)}for(const e of r)0===e.transform.length&&delete e.transform;let a=0;for(const[e,t]of r.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||r.splice(a++,0,r.splice(e,1)[0]);for(const t of r)for(const n of null!==(i=t.transform)&&void 0!==i?i:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of r)e.name in t&&(e.values=t[e.name]);return r}(e.component.data,n)),s=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:o}),s.length>0?{projections:s}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}(r,function(e,t,n,i){const r=i.component.layoutSize.get("width"),o=i.component.layoutSize.get("height");void 0===t?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):w(t)&&(t={type:t});if(r&&o&&(s=t.type,"fit"===s||"fit-x"===s||"fit-y"===s))if("step"===r&&"step"===o)Bn(sn()),t.type="pad";else if("step"===r||"step"===o){const e="step"===r?"width":"height";Bn(sn(qt(e)));const n="width"===e?"height":"width";t.type=function(e){return e?"fit-"+qt(e):"fit"}(n)}var s;return Object.assign(Object.assign(Object.assign({},1===J(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),ia(n)),ia(e))}(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&(Sn=Cn),t.fieldTitle&&Zr(Qr)}},e.extractTransforms=function(e,t){return Cg.map(e,{config:t})},e.normalize=Zs,e.version=Eg,Object.defineProperty(e,"__esModule",{value:!0})}));
class CCVegaCARenderer extends vega.Renderer {
  constructor(loader) {
    super(loader);
    this._previousScene = null;
  initialize(el, width, height, origin, scaleFactor) {
    // Create a cc-layer element to fake the canvas element
    this._canvas = document.createElement("div");
    el.appendChild(this._canvas);
    this._CARenderer = el.viewRenderer.options.CADelegate;
    return super.initialize(el, width, height, origin, scaleFactor);
  resize(width, height, origin, scaleFactor) {
    super.resize(width, height, origin, scaleFactor);
    this._CARenderer.resize(width, height, origin[0], origin[1]);
    return this;
  // Need to have a canvas element for event processing to go properly.
  canvas() { return this._canvas; }
  _render(scene) {
    this._previousScene = scene;
    this._CARenderer.backgroundColor = this._bgcolor;
    this._CARenderer.render(scene);
    if (this.onViewUpdate) {
      this.onViewUpdate();
    }
  redraw() { this._CARenderer.dirtyAll(); }
  rerender() {
    if (this._previousScene != null) {
      this.redraw();
      this._render(this._previousScene);
      this._CARenderer.invalidateCaches();
      this._CARenderer.updateCALayers();
    }
  dirty(item) { this._CARenderer.dirty(item); }
// The handler for the Core Animation renderer
class CCVegaCAHandler extends vega.CanvasHandler {
  initialize(el, origin, obj) {
    // add event listeners
    this._pickCanvas = document.createElement("canvas");
    this._pickContext = this._pickCanvas.getContext("2d");
    this._pickContext.pixelRatio = 1;
    var prototype = vega.CanvasHandler.prototype;
    var canvas = (this._canvas = el.childNodes[0]);
    if (canvas) {
      var that = this;
      this.events.forEach(function(type) {
        canvas.addEventListener(type, function(evt) {
          if (prototype[type]) {
            prototype[type].call(that, evt);
          } else {
            that.fire(type, evt);
          }
        });
      });
    }
    return vega.Handler.prototype.initialize.call(this, el, origin, obj);
  origin(origin) {
    if (arguments.length) {
      this._pickContext.setTransform(1, 0, 0, 1, origin[0], origin[1]);
    }
    return super.origin(origin);
  context() { return this._pickContext; }
vega.renderModule("CCVegaCARenderer", {renderer : CCVegaCARenderer, handler : CCVegaCAHandler});
// Determine the mode ('vega' | 'vega-lite' | 'vega-dataflow' | 'cc-precompiled') for a spec object
function getSpecMode(spec) {
  if (spec["$schema"]) {
    // If there is a schema check the schema url
    var vlPrefix = "https://vega.github.io/schema/vega-lite/";
    var mode = spec["$schema"].startsWith(vlPrefix) ? "vega-lite" : "vega";
    return mode;
  } else {
    // Check if the spec is a Vega dataflow (output of vega.parse)
    if ('dataflow' in spec) {
      return 'cc-precompiled';
    }
    if ('operators' in spec) {
      return 'vega-dataflow';
    }
    // Check if the spec is Vega-Lite
    if ('mark' in spec || 'encoding' in spec || 'layer' in spec || 'hconcat' in spec || 'vconcat' in spec ||
        'facet' in spec || 'repeat' in spec) {
      return 'vega-lite';
    }
    // Check if the spec is Vega
    if ('marks' in spec || 'signals' in spec || 'scales' in spec || 'axes' in spec) {
      return 'vega';
    }
    // Fallback to Vega-Lite
    return 'vega-lite';
function parseVersion(versionString) {
  return versionString.split(".").map(function(x) { parseInt(x, 10); });
function isDataflowCompatible(originalVegaVersion) {
  var original = parseVersion(originalVegaVersion);
  var current = parseVersion(VEGA_VERSION);
  if (original[0] != current[0]) {
    // If major version is different we declare that it's not compatible.
    return false;
  return true;
// Prepare spec and config
function prepareSpecDict(dict) {
  var {spec, config, baseConfig} = dict;
  try {
    spec = spec || {};
    if (typeof spec === "string") {
      spec = JSON.parse(spec);
    }
    config = config || {};
    if (typeof config === "string") {
      config = JSON.parse(config);
    }
    baseConfig = baseConfig || {};
    if (typeof baseConfig === "string") {
      baseConfig = JSON.parse(baseConfig);
    }
  } catch (e) {
    return { error: e, mode: "error" }
  // Merge baseConfig into config
  config = vega.mergeConfig(baseConfig, config);
  return {spec, config, mode : getSpecMode(spec)};
// Compile any Vega-Lite, Vega spec, return the compiled dataflow.
function compileAnySpec(specDict, expressionFunctionNames) {
  var {spec, config, mode} = specDict;
  var originalSpecDict = {spec : spec, config : config, mode : mode};
  if (mode == "error") {
    return {error : specDict.error};
  try {
    // Register dummy expression functions if they are not already registered
    if (expressionFunctionNames != null) {
      for (var func of expressionFunctionNames) {
        if (vega.expressionFunction(func) == null) {
          vega.expressionFunction(func, () => {})
        }
      }
    }
    // mode: vega-lite | vega
    if (mode == "vega-lite") {
      if (console.benchmark !== undefined) {
        var t_start = console.benchmark.measureTime();
      }
      spec = window.vegaLite.compile(spec, {config : specDict.config}).spec;
      if (console.benchmark !== undefined) {
        var t_complete_vl = console.benchmark.measureTime();
      }
      // When using Vega-Lite spec, include the Vega spec in originalSpecDict.
      originalSpecDict.vgSpec = spec;
      spec = vega.parse(spec, {});
      if (console.benchmark !== undefined) {
        var t_end = console.benchmark.measureTime();
        console.benchmark.reportInterval(console.benchmark.kEntityVegaLiteCompile, t_start, t_complete_vl);
        console.benchmark.reportInterval(console.benchmark.kEntityVegaParse, t_complete_vl, t_end);
      }
    } else if (mode == "vega") {
      spec = vega.parse(spec, config);
    } else if (mode == "vega-dataflow") {
      // noop, spec is the dataflow.
    } else {
      return {error : "invalid spec mode"};
    }
  } catch (e) {
    return {error : e.message};
  return {runtime : spec, original : originalSpecDict};
function precompileSpec(specDict, expressionFunctionNames) {
  var compiledDataflow = compileAnySpec(specDict, expressionFunctionNames);
  if (compiledDataflow.error) {
    return {error : compiledDataflow.error};
  var result = {
    versions : {vega : VEGA_VERSION, vegaLite : VEGA_LITE_VERSION},
    original : compiledDataflow.original,
    dataflow : compiledDataflow.runtime
  };
  return {result : JSON.stringify(result)};
// Used in the native function `callInJSContext`
function callFunction(func) { func(); }
class Loader {
  constructor(viewRenderer) { this.viewRenderer = viewRenderer; }
  // (uri: string, options: any) => Promise<{ href: string }>;
  // options: { context: "href" | "image" }
  async sanitize(url, options) { return {href : url}; }
  // (uri: string, options?: any) => Promise<string>
  // options: {"context":"dataflow","response":"json"}
  async load(url, options) {
    return new Promise((resolve, reject) => {
      this.viewRenderer.delegate.loadURL(url, options, (result, error) => {
        if (result) {
          resolve(result);
        } else {
          reject(error);
        }
      });
    });
// Prepare dataflow runtime from specDict.
function prepareRuntimeFromSpecDict(specDict) {
  if (specDict.mode == "cc-precompiled") {
    // If it's a pre-compiled spec, let's check if the dataflow is compatible first.
    var precompiled = specDict.spec;
    if (isDataflowCompatible(precompiled.versions.vega)) {
      // Compatible, we can use the runtime.
      return {runtime : precompiled.dataflow};
    } else {
      // Not compatible, we should re-compile.
      console.warn("precompiled dataflow is not compatible with the current version of CoreChart, recompiling.");
      specDict = precompiled.original;
      if (specDict.mode == "vega-lite" && specDict.vgSpec) {
        // If it was a Vega-Lite spec, and we have a pre-compiled Vega spec, then start from the pre-compiled Vega spec.
        specDict = {spec : specDict.vgSpec, mode : "vega"};
      }
      return compileAnySpec(specDict, null);
    }
  return compileAnySpec(specDict, null);
// The primary view class for the JavaScript world
class ViewRenderer {
  // Construct a view from spec, config, container, and delegate
  constructor(specDict, container, delegate, options) {
    this.container = container;
    this.delegate = delegate;
    this.options = options;
    this.signalHandlers = {};
    var compileResult = prepareRuntimeFromSpecDict(specDict);
    if (compileResult.error) {
      throw compileResult.error;
    }
    var runtime = compileResult.runtime;
    window.addEventListener = container.addEventListener.bind(container);
    window.removeEventListener = container.removeEventListener.bind(container);
    this.container.viewRenderer = this;
    if (console.benchmark !== undefined) {
      var t_start = console.benchmark.measureTime();
    }
    this.vegaView = new vega.View(
        runtime, {logLevel : vega.Warn, renderer : options.renderer, loader : new Loader(this), hover : true});
    // set 'none' to bindContainer so Vega won't attempt to bind any signal
    this.vegaView.initialize(this.container);
    this.canvas = this.vegaView._renderer._canvas;
    this.vegaView._renderer.onViewUpdate = () => { this.delegate.updateNativeView(); };
    if (console.benchmark !== undefined) {
      var t_end = console.benchmark.measureTime();
      console.benchmark.reportInterval(console.benchmark.kEntityInitVegaView, t_start, t_end);
    }
  isEventConsumed(event) {
    // A hacky implementation for now. Ideally Vega should be able to tell us.
    // (note that event.defaultPrevented doesn't help here)
    return event && event.item && event.item.datum != null;
  getWidth() { return this.vegaView._renderer._width; }
  getHeight() { return this.vegaView._renderer._height; }
  saveState(named_datasets) {
    return this.vegaView.getState({
      signals : (name, op) => {
        // Skip native-handled signals.
        // They can't be saved correctly; they will work without saving.
        return !(name === 'parent' || this.signalHandlers[name] != null || op instanceof vega.transforms.proxy);
      },
      data : (name, data) => {
        if (named_datasets.indexOf(name) < 0) {
          return false;
        }
        return vega.isArray(data.input.value) && name.indexOf('_:vega:_');
      },
      recurse : true
    });
  loadState(state) { this.vegaView.setState(state); }
  redraw() {
    this.vegaView._renderer.redraw();
    this.vegaView._redraw = true;
  // Call touch on all dataflow operators. This will cause the dataflow to rerun on next runAsync
  touchDataflow() {
    var context = this.vegaView._runtime;
    for (var key of Object.keys(context.nodes)) {
      var node = context.nodes[key];
      context.dataflow.touch(node);
    }
  rerender() { this.vegaView._renderer.rerender(); }
  finalize() { this.vegaView.finalize(); }
  safeSetSignal(name, value) {
    if (this.signalHandlers[name] != null) {
      var handler = this.signalHandlers[name];
      var newValue = new Proxy({}, {
        get : (target, property) => {
          var val = handler.get(target, property);
          if (val != null) {
            return val;
          }
          return undefined;
        }
      });
      try {
        this.vegaView.signal(name, newValue);
      } catch (e) {
      }
    } else {
      try {
        this.vegaView.signal(name, value);
      } catch (e) {
      }
    }
  safeGetSignal(name) {
    try {
      return this.vegaView.signal(name);
    } catch (e) {
      return undefined;
    }
  safeAddSignalListener(name, listener) {
    try {
      this.vegaView.addSignalListener(name, listener);
    } catch (e) {
    }
  safeRemoveSignalListener(name, listener) {
    try {
      this.vegaView.removeSignalListener(name, listener);
    } catch (e) {
    }
  setupSignalHandler(name, handler) {
    this.signalHandlers[name] = handler;
    this.safeSetSignal(name, this.safeGetSignal(name));
  setScaleZoomFactor(scaleFactor, zoomFactor) {
    console.log("setScaleZoomFactor", scaleFactor, zoomFactor);
    if (this.vegaView._renderer) {
      if (this.vegaView._renderer.setScaleZoomFactor) {
        this.vegaView._renderer.setScaleZoomFactor(scaleFactor, zoomFactor);
        this.vegaView._redraw = true;
      }
    } else {
      console.warn("setScaleZoomFactor: renderer is not available so this call has no effect", scaleFactor, zoomFactor);
    }
function createViewRenderer(specDict, container, delegate, options) {
  return new ViewRenderer(specDict, container, delegate, options);
// ==== The original CoreGraphics renderer ====
function resize(canvas, width, height, origin, scaleFactor, opt) {
  var context = canvas.getContext("2d"), ratio = scaleFactor != undefined ? scaleFactor : window.devicePixelRatio, key;
  console.log("resizing canvas with width: " + width + ", height: " + height + ", scale: " + ratio);
  canvas.width = width * ratio;
  canvas.height = height * ratio;
  for (key in opt) {
    context[key] = opt[key];
  if (ratio !== 1) {
    canvas.style.width = width + "px";
    canvas.style.height = height + "px";
  context.pixelRatio = ratio;
  context.setTransform(ratio, 0, 0, ratio, ratio * origin[0], ratio * origin[1]);
  return canvas;
class CCVegaCanvasRenderer extends vega.CanvasRenderer {
  constructor(loader) {
    super(loader);
    this._previousScene = null;
  resize(width, height, origin) {
    if (this._scaleFactor == undefined) {
      this._scaleFactor = window.devicePixelRatio;
    }
    vega.Renderer.prototype.resize.call(this, width, height, origin, this._scaleFactor);
    resize(this._canvas, this._width, this._height, this._origin, this._scaleFactor,
           this._options && this._options.context);
    this._redraw = true;
    return this;
  };
  redraw() { this._redraw = true; }
  rerender() {
    if (this._previousScene != null) {
      this.redraw();
      this._render(this._previousScene);
    }
  setScaleZoomFactor(scaleFactor) {
    this._scaleFactor = scaleFactor;
    this.resize(this._width, this._height, this._origin, this._scaleFactor);
    this._redraw = true;
  _render(scene) {
    this._previousScene = scene;
    super._render(scene);
    if (this.onViewUpdate) {
      this.onViewUpdate();
    }
vega.renderModule("CCVegaCanvasRenderer", {renderer : CCVegaCanvasRenderer, handler : vega.CanvasHandler})
